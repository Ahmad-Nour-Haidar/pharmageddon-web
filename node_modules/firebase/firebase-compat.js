!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).firebase=t()}(this,function(){"use strict";const t={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},f=function(e,t){if(!e)throw u(t)},u=function(e){return new Error("Firebase Database ("+t.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},n=function(t){const n=[];let r=0;for(let i=0;i<t.length;i++){let e=t.charCodeAt(i);e<128?n[r++]=e:(e<2048?n[r++]=e>>6|192:(55296==(64512&e)&&i+1<t.length&&56320==(64512&t.charCodeAt(i+1))?(e=65536+((1023&e)<<10)+(1023&t.charCodeAt(++i)),n[r++]=e>>18|240,n[r++]=e>>12&63|128):n[r++]=e>>12|224,n[r++]=e>>6&63|128),n[r++]=63&e|128)}return n},r={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();var r=e?this.byteToCharMapWebSafe_:this.byteToCharMap_;const i=[];for(let u=0;u<n.length;u+=3){var s=n[u],a=u+1<n.length,o=a?n[u+1]:0,c=u+2<n.length,l=c?n[u+2]:0;let e=(15&o)<<2|l>>6,t=63&l;c||(t=64,a||(e=64)),i.push(r[s>>2],r[(3&s)<<4|o>>4],r[e],r[t])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(n(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){var i,s,a=e[n++];a<128?t[r++]=String.fromCharCode(a):191<a&&a<224?(i=e[n++],t[r++]=String.fromCharCode((31&a)<<6|63&i)):239<a&&a<365?(s=((7&a)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536,t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))):(i=e[n++],s=e[n++],t[r++]=String.fromCharCode((15&a)<<12|(63&i)<<6|63&s))}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();var n=t?this.charToByteMapWebSafe_:this.charToByteMap_;const r=[];for(let c=0;c<e.length;){var i=n[e.charAt(c++)],s=c<e.length?n[e.charAt(c)]:0;++c;var a=c<e.length?n[e.charAt(c)]:64;++c;var o=c<e.length?n[e.charAt(c)]:64;if(++c,null==i||null==s||null==a||null==o)throw new l;r.push(i<<2|s>>4),64!==a&&(r.push(s<<4&240|a>>2),64!==o&&r.push(a<<6&192|o))}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class l extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}function i(e){var t=n(e);return r.encodeByteArray(t,!0)}const s=function(e){return i(e).replace(/\./g,"")},a=function(e){try{return r.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function c(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:const n=t;return new Date(n.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const r in t)t.hasOwnProperty(r)&&"__proto__"!==r&&(e[r]=c(e[r],t[r]));return e}function o(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}const e=()=>o().__FIREBASE_DEFAULTS__,h=()=>{if("undefined"!=typeof process&&void 0!==process.env){var e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0}},d=()=>{if("undefined"!=typeof document){let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}var t=e&&a(e[1]);return t&&JSON.parse(t)}},p=()=>{try{return e()||h()||d()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},g=()=>{var e;return null===(e=p())||void 0===e?void 0:e.config};var m,v,_;class y{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(n){return(e,t)=>{e?this.reject(e):this.resolve(t),"function"==typeof n&&(this.promise.catch(()=>{}),1===n.length?n(e):n(e,t))}}}function w(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");i=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[s(JSON.stringify({alg:"none",type:"JWT"})),s(JSON.stringify(i)),""].join(".")}function b(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function I(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(b())}function T(){var e=null===(e=p())||void 0===e?void 0:e.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return!1}}function E(){var e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function C(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function S(){const e=b();return 0<=e.indexOf("MSIE ")||0<=e.indexOf("Trident/")}function k(){return!0===t.NODE_ADMIN}function A(){try{return"object"==typeof indexedDB}catch(e){return!1}}function N(){return new Promise((t,n)=>{try{let e=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),e||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{e=!1},i.onerror=()=>{var e;n((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){n(e)}})}function R(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}class P extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,P.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,D.prototype.create)}}class D{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var r,n=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],s=s?(r=n,s.replace(x,(e,t)=>{var n=r[t];return null!=n?String(n):`<${t}?>`})):"Error",s=`${this.serviceName}: ${s} (${i}).`;return new P(i,s,n)}}const x=/\{\$([^}]+)}/g;function O(e){return JSON.parse(e)}function M(e){return JSON.stringify(e)}function L(e){let t={},n={},r={},i="";try{var s=e.split(".");t=O(a(s[0])||""),n=O(a(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:r,signature:i}}function F(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function U(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]}function V(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function q(e,t,n){const r={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function B(e,t){if(e===t)return 1;const n=Object.keys(e),r=Object.keys(t);for(const a of n){if(!r.includes(a))return;var i=e[a],s=t[a];if(j(i)&&j(s)){if(!B(i,s))return}else if(i!==s)return}for(const o of r)if(!n.includes(o))return;return 1}function j(e){return null!==e&&"object"==typeof e}function z(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function $(e){const r={},t=e.replace(/^\?/,"").split("&");return t.forEach(e=>{var t,n;e&&([t,n]=e.split("="),r[decodeURIComponent(t)]=decodeURIComponent(n))}),r}function K(e){var t=e.indexOf("?");if(!t)return"";var n=e.indexOf("#",t);return e.substring(t,0<n?n:void 0)}class W{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(n,r){r=r||0;const i=this.W_;if("string"==typeof n)for(let e=0;e<16;e++)i[e]=n.charCodeAt(r)<<24|n.charCodeAt(r+1)<<16|n.charCodeAt(r+2)<<8|n.charCodeAt(r+3),r+=4;else for(let t=0;t<16;t++)i[t]=n[r]<<24|n[r+1]<<16|n[r+2]<<8|n[r+3],r+=4;for(let d=16;d<80;d++){var e=i[d-3]^i[d-8]^i[d-14]^i[d-16];i[d]=4294967295&(e<<1|e>>>31)}let t=this.chain_[0],s=this.chain_[1],a=this.chain_[2],o=this.chain_[3],c=this.chain_[4],l,u;for(let p=0;p<80;p++){u=p<40?p<20?(l=o^s&(a^o),1518500249):(l=s^a^o,1859775393):p<60?(l=s&a|o&(s|a),2400959708):(l=s^a^o,3395469782);var h=(t<<5|t>>>27)+l+c+u+i[p]&4294967295;c=o,o=a,a=4294967295&(s<<30|s>>>2),s=t,t=h}this.chain_[0]=this.chain_[0]+t&4294967295,this.chain_[1]=this.chain_[1]+s&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+o&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(n,r){if(null!=n){var i=(r=void 0===r?n.length:r)-this.blockSize;let e=0;const s=this.buf_;let t=this.inbuf_;for(;e<r;){if(0===t)for(;e<=i;)this.compress_(n,e),e+=this.blockSize;if("string"==typeof n){for(;e<r;)if(s[t]=n.charCodeAt(e),++t,++e,t===this.blockSize){this.compress_(s),t=0;break}}else for(;e<r;)if(s[t]=n[e],++t,++e,t===this.blockSize){this.compress_(s),t=0;break}}this.inbuf_=t,this.total_+=r}}digest(){const t=[];let e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;56<=r;r--)this.buf_[r]=255&e,e/=256;this.compress_(this.buf_);let n=0;for(let i=0;i<5;i++)for(let e=24;0<=e;e-=8)t[n]=this.chain_[i]>>e&255,++n;return t}}function G(e,t){const n=new H(e,t);return n.subscribe.bind(n)}class H{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=Q),void 0===r.error&&(r.error=Q),void 0===r.complete&&(r.complete=Q);var i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],--this.observerCount,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Q(){}function Y(e,t,n,r){let i;if(r<t?i="at least "+t:n<r&&(i=0===n?"none":"no more than "+n),i){var s=e+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".";throw new Error(s)}}function J(e,t){return`${e} failed: ${t} argument `}function X(e,t,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(J(e,t)+"must be a valid function.")}function Z(e,t,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(J(e,t)+"must be a valid context object.")}function ee(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)})}const te=function(e){let t=0;for(let r=0;r<e.length;r++){var n=e.charCodeAt(r);n<128?t++:n<2048?t+=2:55296<=n&&n<=56319?(t+=4,r++):t+=3}return t},ne=1e3,re=2,ie=144e5,se=.5;function ae(e,t=ne,n=re){var r=t*Math.pow(n,e),i=Math.round(se*r*(Math.random()-.5)*2);return Math.min(ie,r+i)}function oe(e){return e&&e._delegate?e._delegate:e}class ce{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const le="[DEFAULT]";class ue{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new y;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{var n=this.getOrInitializeService({instanceIdentifier:t});n&&r.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),n=null!==(n=null==e?void 0:e.optional)&&void 0!==n&&n;if(!this.isInitialized(t)&&!this.shouldAutoInitialize()){if(n)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(n)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:le})}catch(e){}for(var[t,n]of this.instancesDeferred.entries()){t=this.normalizeInstanceIdentifier(t);try{var r=this.getOrInitializeService({instanceIdentifier:t});n.resolve(r)}catch(e){}}}}clearInstance(e=le){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=le){return this.instances.has(e)}getOptions(e=le){return this.instancesOptions.get(e)||{}}initialize(e={}){var{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);var r,i,s=this.getOrInitializeService({instanceIdentifier:n,options:t});for([r,i]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(r)&&i.resolve(s);return s}onInit(e,t){var n=this.normalizeInstanceIdentifier(t);const r=null!==(i=this.onInitCallbacks.get(n))&&void 0!==i?i:new Set;r.add(e),this.onInitCallbacks.set(n,r);var i=this.instances.get(n);return i&&e(i,n),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){var n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e)===le?void 0:r,options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=le){return!this.component||this.component.multipleInstances?e:le}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class he{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){const t=this.getProvider(e.name);t.isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);var t=new ue(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const de=[];(v=m=m||{})[v.DEBUG=0]="DEBUG",v[v.VERBOSE=1]="VERBOSE",v[v.INFO=2]="INFO",v[v.WARN=3]="WARN",v[v.ERROR=4]="ERROR",v[v.SILENT=5]="SILENT";const pe={debug:m.DEBUG,verbose:m.VERBOSE,info:m.INFO,warn:m.WARN,error:m.ERROR,silent:m.SILENT},fe=m.INFO,ge={[m.DEBUG]:"log",[m.VERBOSE]:"log",[m.INFO]:"info",[m.WARN]:"warn",[m.ERROR]:"error"},me=(e,t,...n)=>{if(!(t<e.logLevel)){var r=(new Date).toISOString(),i=ge[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)}};class ve{constructor(e){this.name=e,this._logLevel=fe,this._logHandler=me,this._userLogHandler=null,de.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in m))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?pe[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,m.DEBUG,...e),this._logHandler(this,m.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,m.VERBOSE,...e),this._logHandler(this,m.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,m.INFO,...e),this._logHandler(this,m.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,m.WARN,...e),this._logHandler(this,m.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,m.ERROR,...e),this._logHandler(this,m.ERROR,...e)}}const _e=(t,e)=>e.some(e=>t instanceof e);let ye,we;const be=new WeakMap,Ie=new WeakMap,Te=new WeakMap,Ee=new WeakMap,Ce=new WeakMap;let Se={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return Ie.get(e);if("objectStoreNames"===t)return e.objectStoreNames||Te.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Ne(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function ke(r){return r!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(we=we||[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey]).includes(r)?function(...e){return r.apply(Re(this),e),Ne(be.get(this))}:function(...e){return Ne(r.apply(Re(this),e))}:function(e,...t){var n=r.call(Re(this),e,...t);return Te.set(n,e.sort?e.sort():[e]),Ne(n)}}function Ae(e){return"function"==typeof e?ke(e):(e instanceof IDBTransaction&&(s=e,Ie.has(s)||(t=new Promise((e,t)=>{const n=()=>{s.removeEventListener("complete",r),s.removeEventListener("error",i),s.removeEventListener("abort",i)},r=()=>{e(),n()},i=()=>{t(s.error||new DOMException("AbortError","AbortError")),n()};s.addEventListener("complete",r),s.addEventListener("error",i),s.addEventListener("abort",i)}),Ie.set(s,t))),_e(e,ye=ye||[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])?new Proxy(e,Se):e);var s,t}function Ne(e){if(e instanceof IDBRequest)return function(s){const e=new Promise((e,t)=>{const n=()=>{s.removeEventListener("success",r),s.removeEventListener("error",i)},r=()=>{e(Ne(s.result)),n()},i=()=>{t(s.error),n()};s.addEventListener("success",r),s.addEventListener("error",i)});return e.then(e=>{e instanceof IDBCursor&&be.set(e,s)}).catch(()=>{}),Ce.set(e,s),e}(e);if(Ee.has(e))return Ee.get(e);var t=Ae(e);return t!==e&&(Ee.set(e,t),Ce.set(t,e)),t}const Re=e=>Ce.get(e);function Pe(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const a=indexedDB.open(e,t),o=Ne(a);return r&&a.addEventListener("upgradeneeded",e=>{r(Ne(a.result),e.oldVersion,e.newVersion,Ne(a.transaction),e)}),n&&a.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}function De(e,{blocked:t}={}){const n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",e=>t(e.oldVersion,e)),Ne(n).then(()=>{})}const xe=["get","getKey","getAll","getAllKeys","count"],Oe=["put","add","delete","clear"],Me=new Map;function Le(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t){if(Me.get(t))return Me.get(t);const i=t.replace(/FromIndex$/,""),s=t!==i,a=Oe.includes(i);if(i in(s?IDBIndex:IDBObjectStore).prototype&&(a||xe.includes(i))){var n=async function(e,...t){var n=this.transaction(e,a?"readwrite":"readonly");let r=n.store;return s&&(r=r.index(t.shift())),(await Promise.all([r[i](...t),a&&n.done]))[0]};return Me.set(t,n),n}}}Se={..._=Se,get:(e,t,n)=>Le(e,t)||_.get(e,t,n),has:(e,t)=>!!Le(e,t)||_.has(e,t)};class Fe{constructor(e){this.container=e}getPlatformInfoString(){const e=this.container.getProviders();return e.map(e=>{if("VERSION"!==(null==(t=e.getComponent())?void 0:t.type))return null;var t,t=e.getImmediate();return`${t.library}/${t.version}`}).filter(e=>e).join(" ")}}const Ue="@firebase/app",Ve=new ve("@firebase/app");var qe;const Be="[DEFAULT]",je={"@firebase/app":"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},ze=new Map,$e=new Map;function Ke(t,n){try{t.container.addComponent(n)}catch(e){Ve.debug(`Component ${n.name} failed to register with FirebaseApp ${t.name}`,e)}}function We(e,t){e.container.addOrOverwriteComponent(t)}function Ge(e){var t=e.name;if($e.has(t))return Ve.debug(`There were multiple attempts to register component ${t}.`),!1;$e.set(t,e);for(const n of ze.values())Ke(n,e);return!0}function He(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}const Qe=new D("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class Ye{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new ce("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Qe.create("app-deleted",{appName:this._name})}}const Je="10.7.1";function Xe(e,t={}){let n=e;if("object"!=typeof t){const i=t;t={name:i}}var r=Object.assign({name:Be,automaticDataCollectionEnabled:!1},t);const i=r.name;if("string"!=typeof i||!i)throw Qe.create("bad-app-name",{appName:String(i)});if(n=n||g(),!n)throw Qe.create("no-options");var s=ze.get(i);if(s){if(B(n,s.options)&&B(r,s.config))return s;throw Qe.create("duplicate-app",{appName:i})}const a=new he(i);for(const o of $e.values())a.addComponent(o);r=new Ye(n,r,a);return ze.set(i,r),r}function Ze(e=Be){var t=ze.get(e);if(!t&&e===Be&&g())return Xe();if(!t)throw Qe.create("no-app",{appName:e});return t}async function et(e){var t=e.name;ze.has(t)&&(ze.delete(t),await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function tt(e,t,n){let r=null!==(s=je[e])&&void 0!==s?s:e;n&&(r+=`-${n}`);var i=r.match(/\s|\//),s=t.match(/\s|\//);if(i||s){const a=[`Unable to register library "${r}" with version "${t}":`];return i&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&s&&a.push("and"),s&&a.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void Ve.warn(a.join(" "))}Ge(new ce(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}function nt(e,t){if(null!==e&&"function"!=typeof e)throw Qe.create("invalid-log-argument");!function(s,e){for(const t of de){let i=null;e&&e.level&&(i=pe[e.level]),t.userLogHandler=null===s?null:(e,t,...n)=>{var r=n.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");t>=(null!==i&&void 0!==i?i:e.logLevel)&&s({level:m[t].toLowerCase(),message:r,args:n,type:e.name})}}}(e,t)}function rt(e){var t;t=e,de.forEach(e=>{e.setLogLevel(t)})}const it="firebase-heartbeat-database",st=1,at="firebase-heartbeat-store";let ot=null;function ct(){return ot=ot||Pe(it,st,{upgrade:(e,t)=>{0===t&&e.createObjectStore(at)}}).catch(e=>{throw Qe.create("idb-open",{originalErrorMessage:e.message})}),ot}async function lt(e,t){try{const r=await ct(),i=r.transaction(at,"readwrite"),s=i.objectStore(at);await s.put(t,ut(e)),await i.done}catch(e){var n;e instanceof P?Ve.warn(e.message):(n=Qe.create("idb-set",{originalErrorMessage:null==e?void 0:e.message}),Ve.warn(n.message))}}function ut(e){return`${e.name}!${e.options.appId}`}class ht{constructor(e){this.container=e,this._heartbeatsCache=null;var t=this.container.getProvider("app").getImmediate();this._storage=new pt(t),this._heartbeatsCachePromise=this._storage.read().then(e=>this._heartbeatsCache=e)}async triggerHeartbeat(){var e;const t=this.container.getProvider("platform-logger").getImmediate();var n=t.getPlatformInfoString();const r=dt();if((null!=(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||(this._heartbeatsCache=await this._heartbeatsCachePromise,null!=(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)))&&this._heartbeatsCache.lastSentHeartbeatDate!==r&&!this._heartbeatsCache.heartbeats.some(e=>e.date===r))return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{var t=new Date(e.date).valueOf();return Date.now()-t<=2592e6}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(n=this._heartbeatsCache)||void 0===n?void 0:n.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";var e=dt(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const s=n.find(e=>e.agent===i.agent);if(s){if(s.dates.push(i.date),ft(n)>t){s.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),ft(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),t=s(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,0<n.length?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),t}}function dt(){const e=new Date;return e.toISOString().substring(0,10)}class pt{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!A()&&N().then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){var e=await async function(e){try{const n=await ct();return await n.transaction(at).objectStore(at).get(ut(e))}catch(e){var t;e instanceof P?Ve.warn(e.message):(t=Qe.create("idb-get",{originalErrorMessage:null==e?void 0:e.message}),Ve.warn(t.message))}}(this.app);return null!=e&&e.heartbeats?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){var n=await this.read();return lt(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){var n=await this.read();return lt(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function ft(e){return s(JSON.stringify({version:2,heartbeats:e})).length}qe="",Ge(new ce("platform-logger",e=>new Fe(e),"PRIVATE")),Ge(new ce("heartbeat",e=>new ht(e),"PRIVATE")),tt(Ue,"0.9.25",qe),tt(Ue,"0.9.25","esm2017"),tt("fire-js","");var gt=Object.freeze({__proto__:null,SDK_VERSION:Je,_DEFAULT_ENTRY_NAME:Be,_addComponent:Ke,_addOrOverwriteComponent:We,_apps:ze,_clearComponents:function(){$e.clear()},_components:$e,_getProvider:He,_registerComponent:Ge,_removeServiceInstance:function(e,t,n=Be){He(e,t).clearInstance(n)},deleteApp:et,getApp:Ze,getApps:function(){return Array.from(ze.values())},initializeApp:Xe,onLog:nt,registerVersion:tt,setLogLevel:rt,FirebaseError:P});class mt{constructor(e,t){this._delegate=e,this.firebase=t,Ke(e,new ce("app-compat",()=>this,"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(e=>{this._delegate.checkDestroyed(),e()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),et(this._delegate)))}_getService(e,t=Be){var n;this._delegate.checkDestroyed();const r=this._delegate.container.getProvider(e);return r.isInitialized()||"EXPLICIT"!==(null===(n=r.getComponent())||void 0===n?void 0:n.instantiationMode)||r.initialize(),r.getImmediate({identifier:t})}_removeServiceInstance(e,t=Be){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){Ke(this._delegate,e)}_addOrOverwriteComponent(e){We(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const vt=new D("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."});function _t(i){const s={},a={__esModule:!0,initializeApp:function(e,t={}){var n=Xe(e,t);if(F(s,n.name))return s[n.name];var r=new i(n,a);return s[n.name]=r},app:o,registerVersion:tt,setLogLevel:rt,onLog:nt,apps:null,SDK_VERSION:Je,INTERNAL:{registerComponent:function(n){const r=n.name,t=r.replace("-compat","");{var e;Ge(n)&&"PUBLIC"===n.type&&(e=(e=o())=>{if("function"!=typeof e[t])throw vt.create("invalid-app-argument",{appName:r});return e[t]()},void 0!==n.serviceProps&&c(e,n.serviceProps),a[t]=e,i.prototype[t]=function(...e){const t=this._getService.bind(this,r);return t.apply(this,n.multipleInstances?e:[])})}return"PUBLIC"===n.type?a[t]:null},removeApp:function(e){delete s[e]},useAsService:function(e,t){if("serverAuth"===t)return null;var n=t;return n},modularAPIs:gt}};function o(e){if(e=e||Be,!F(s,e))throw vt.create("no-app",{appName:e});return s[e]}return a.default=a,Object.defineProperty(a,"apps",{get:function(){return Object.keys(s).map(e=>s[e])}}),o.App=i,a}var yt=function e(){const t=_t(mt);return t.INTERNAL=Object.assign(Object.assign({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){c(t,e)},createSubscribe:G,ErrorFactory:D,deepExtend:c}),t}();const wt=new ve("@firebase/app-compat");if("object"==typeof self&&self.self===self&&void 0!==self.firebase){wt.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);const Y1=self.firebase.SDK_VERSION;Y1&&0<=Y1.indexOf("LITE")&&wt.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}const bt=yt;tt("@firebase/app-compat","0.2.25",void 0);bt.registerVersion("firebase","10.7.1","app-compat");var It="@firebase/installations",Tt="0.6.4";const Et=1e4,Ct="w:0.6.4",St="FIS_v2",kt="https://firebaseinstallations.googleapis.com/v1",At=36e5;const Nt=new D("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function Rt(e){return e instanceof P&&e.code.includes("request-failed")}function Pt({projectId:e}){return`${kt}/projects/${e}/installations`}function Dt(e){return{token:e.token,requestStatus:2,expiresIn:(e=e.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()}}async function xt(e,t){var n=(await t.json()).error;return Nt.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function Ot({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function Mt(e,{refreshToken:t}){const n=Ot(e);return n.append("Authorization",(t=t,`${St} ${t}`)),n}async function Lt(e){var t=await e();return 500<=t.status&&t.status<600?e():t}function Ft(t){return new Promise(e=>{setTimeout(e,t)})}const Ut=/^[cdef][\w-]{21}$/,Vt="";function qt(){try{const t=new Uint8Array(17),n=self.crypto||self.msCrypto;n.getRandomValues(t),t[0]=112+t[0]%16;var e=function(e){const t=function(e){const t=btoa(String.fromCharCode(...e));return t.replace(/\+/g,"-").replace(/\//g,"_")}(e);return t.substr(0,22)}(t);return Ut.test(e)?e:Vt}catch(e){return Vt}}function Bt(e){return`${e.appName}!${e.appId}`}const jt=new Map;function zt(e,t){var n=Bt(e);$t(n,t),function(e,t){const n=function(){!Kt&&"BroadcastChannel"in self&&(Kt=new BroadcastChannel("[Firebase] FID Change"),Kt.onmessage=e=>{$t(e.data.key,e.data.fid)});return Kt}();n&&n.postMessage({key:e,fid:t});0===jt.size&&Kt&&(Kt.close(),Kt=null)}(n,t)}function $t(e,t){var n=jt.get(e);if(n)for(const r of n)r(t)}let Kt=null;const Wt="firebase-installations-store";let Gt=null;function Ht(){return Gt=Gt||Pe("firebase-installations-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(Wt)}}),Gt}async function Qt(e,t){var n=Bt(e);const r=await Ht(),i=r.transaction(Wt,"readwrite"),s=i.objectStore(Wt);var a=await s.get(n);return await s.put(t,n),await i.done,a&&a.fid===t.fid||zt(e,t.fid),t}async function Yt(e){var t=Bt(e);const n=await Ht(),r=n.transaction(Wt,"readwrite");await r.objectStore(Wt).delete(t),await r.done}async function Jt(e,t){var n=Bt(e);const r=await Ht(),i=r.transaction(Wt,"readwrite"),s=i.objectStore(Wt);var a=await s.get(n),o=t(a);return void 0===o?await s.delete(n):await s.put(o,n),await i.done,!o||a&&a.fid===o.fid||zt(e,o.fid),o}async function Xt(n){let r;var e=await Jt(n.appConfig,e=>{var t=en(e||{fid:qt(),registrationStatus:0}),t=function(e,t){{if(0!==t.registrationStatus)return 1===t.registrationStatus?{installationEntry:t,registrationPromise:async function(e){let t=await Zt(e.appConfig);for(;1===t.registrationStatus;)await Ft(100),t=await Zt(e.appConfig);if(0!==t.registrationStatus)return t;{var{installationEntry:n,registrationPromise:r}=await Xt(e);return r||n}}(e)}:{installationEntry:t};if(!navigator.onLine){var n=Promise.reject(Nt.create("app-offline"));return{installationEntry:t,registrationPromise:n}}var r={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},n=async function(t,n){try{var e=await async function({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const r=Pt(e),i=Ot(e),s=t.getImmediate({optional:!0});!s||(a=await s.getHeartbeatsHeader())&&i.append("x-firebase-client",a);var a={fid:n,authVersion:St,appId:e.appId,sdkVersion:Ct};const o={method:"POST",headers:i,body:JSON.stringify(a)},c=await Lt(()=>fetch(r,o));if(c.ok){a=await c.json();return{fid:a.fid||n,registrationStatus:2,refreshToken:a.refreshToken,authToken:Dt(a.authToken)}}throw await xt("Create Installation",c)}(t,n);return Qt(t.appConfig,e)}catch(e){throw Rt(e)&&409===e.customData.serverCode?await Yt(t.appConfig):await Qt(t.appConfig,{fid:n.fid,registrationStatus:0}),e}}(e,r);return{installationEntry:r,registrationPromise:n}}}(n,t);return r=t.registrationPromise,t.installationEntry});return e.fid===Vt?{installationEntry:await r}:{installationEntry:e,registrationPromise:r}}function Zt(e){return Jt(e,e=>{if(!e)throw Nt.create("installation-not-found");return en(e)})}function en(e){return 1===(t=e).registrationStatus&&t.registrationTime+Et<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function tn({appConfig:e,heartbeatServiceProvider:t},n){const r=([i,s]=[e,n["fid"]],`${Pt(i)}/${s}/authTokens:generate`);var i,s;const a=Mt(e,n),o=t.getImmediate({optional:!0});!o||(c=await o.getHeartbeatsHeader())&&a.append("x-firebase-client",c);var c={installation:{sdkVersion:Ct,appId:e.appId}};const l={method:"POST",headers:a,body:JSON.stringify(c)},u=await Lt(()=>fetch(r,l));if(u.ok)return Dt(await u.json());throw await xt("Generate Auth Token",u)}async function nn(r,i=!1){let s;var e=await Jt(r.appConfig,e=>{if(!sn(e))throw Nt.create("not-registered");var t,n=e.authToken;if(i||2!==(t=n).requestStatus||function(e){var t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+At}(t)){if(1===n.requestStatus)return s=async function(e,t){let n=await rn(e.appConfig);for(;1===n.authToken.requestStatus;)await Ft(100),n=await rn(e.appConfig);var r=n.authToken;return 0===r.requestStatus?nn(e,t):r}(r,i),e;if(!navigator.onLine)throw Nt.create("app-offline");n=(t=e,n={requestStatus:1,requestTime:Date.now()},Object.assign(Object.assign({},t),{authToken:n}));return s=async function(t,n){try{var r=await tn(t,n),e=Object.assign(Object.assign({},n),{authToken:r});return await Qt(t.appConfig,e),r}catch(e){throw!Rt(e)||401!==e.customData.serverCode&&404!==e.customData.serverCode?(r=Object.assign(Object.assign({},n),{authToken:{requestStatus:0}}),await Qt(t.appConfig,r)):await Yt(t.appConfig),e}}(r,n),n}return e});return s?await s:e.authToken}function rn(e){return Jt(e,e=>{if(!sn(e))throw Nt.create("not-registered");var t,n=e.authToken;return 1===(t=n).requestStatus&&t.requestTime+Et<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}function sn(e){return void 0!==e&&2===e.registrationStatus}async function an(e,t=!1){var n,r=e;return await((n=(await Xt(r)).registrationPromise)&&await n),(await nn(r,t)).token}function on(e){return Nt.create("missing-app-config-values",{valueName:e})}const cn="installations",ln=e=>{var t=e.getProvider("app").getImmediate();return{app:t,appConfig:function(e){if(!e||!e.options)throw on("App Configuration");if(!e.name)throw on("App Name");for(const t of["projectId","apiKey","appId"])if(!e.options[t])throw on(t);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t),heartbeatServiceProvider:He(t,"heartbeat"),_delete:()=>Promise.resolve()}},un=e=>{const t=He(e.getProvider("app").getImmediate(),cn).getImmediate();return{getId:()=>async function(e){var t=e;const{installationEntry:n,registrationPromise:r}=await Xt(t);return(r||nn(t)).catch(console.error),n.fid}(t),getToken:e=>an(t,e)}};Ge(new ce(cn,ln,"PUBLIC")),Ge(new ce("installations-internal",un,"PRIVATE")),tt(It,Tt),tt(It,Tt,"esm2017");const hn="analytics",dn="firebase_id",pn="origin",fn="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",gn="https://www.googletagmanager.com/gtag/js",mn=new ve("@firebase/analytics"),vn=new D("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function _n(e){if(e.startsWith(gn))return e;var t=vn.create("invalid-gtag-resource",{gtagURL:e});return mn.warn(t.message),""}function yn(e){return Promise.all(e.map(e=>e.catch(e=>e)))}function wn(e,t){const n=function(e,t){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy(e,t)),n}("firebase-js-sdk-policy",{createScriptURL:_n}),r=document.createElement("script");var i=`${gn}?l=${e}&id=${t}`;r.src=n?null===n||void 0===n?void 0:n.createScriptURL(i):i,r.async=!0,document.head.appendChild(r)}function bn(h,d,p,f){return async function(e,...t){try{var n,r,i,s,a,o,c,l,u;"event"===e?([n,r]=t,await async function(e,n,r,i,s){try{let t=[];if(s&&s.send_to){let e=s.send_to;Array.isArray(e)||(e=[e]);const c=await yn(r);for(const l of e){var a=c.find(e=>e.measurementId===l),o=a&&n[a.appId];if(!o){t=[];break}t.push(o)}}0===t.length&&(t=Object.values(n)),await Promise.all(t),e("event",i,s||{})}catch(e){mn.error(e)}}(h,d,p,n,r)):"config"===e?([i,s]=t,await async function(e,t,n,r,i,s){var a=r[i];try{if(a)await t[a];else{const c=await yn(n);var o=c.find(e=>e.measurementId===i);o&&await t[o.appId]}}catch(e){mn.error(e)}e("config",i,s)}(h,d,p,f,i,s)):"consent"===e?([a]=t,h("consent","update",a)):"get"===e?([o,c,l]=t,h("get",o,c,l)):"set"===e?([u]=t,h("set",u)):h(e,...t)}catch(e){mn.error(e)}}}const In=30;const Tn=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};async function En(e){var t,{appId:n,apiKey:r}=e,r={method:"GET",headers:new Headers({Accept:"application/json","x-goog-api-key":r})},n=fn.replace("{app-id}",n);const i=await fetch(n,r);if(200===i.status||304===i.status)return i.json();{let e="";try{var s=await i.json();null!==(t=s.error)&&void 0!==t&&t.message&&(e=s.error.message)}catch(e){}throw vn.create("config-fetch-failed",{httpStatus:i.status,responseMessage:e})}}async function Cn(e,t=Tn,n){var{appId:r,apiKey:i,measurementId:s}=e.options;if(!r)throw vn.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw vn.create("no-api-key")}var a=t.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()};const o=new An;return setTimeout(async()=>{o.abort()},void 0!==n?n:6e4),async function t(n,{throttleEndTimeMillis:e,backoffCount:r},i,s=Tn){var a;const{appId:o,measurementId:c}=n;try{await Sn(i,e)}catch(e){if(c)return mn.warn("Timed out fetching this Firebase app's measurement ID from the server."+` Falling back to the measurement ID ${c}`+` provided in the "measurementId" field in the local Firebase config. [${null==e?void 0:e.message}]`),{appId:o,measurementId:c};throw e}try{const l=await En(n);return s.deleteThrottleMetadata(o),l}catch(e){const u=e;if(!kn(u)){if(s.deleteThrottleMetadata(o),c)return mn.warn("Failed to fetch this Firebase app's measurement ID from the server."+` Falling back to the measurement ID ${c}`+` provided in the "measurementId" field in the local Firebase config. [${null===u||void 0===u?void 0:u.message}]`),{appId:o,measurementId:c};throw e}const h=503===Number(null===(a=null===u||void 0===u?void 0:u.customData)||void 0===a?void 0:a.httpStatus)?ae(r,s.intervalMillis,In):ae(r,s.intervalMillis),d={throttleEndTimeMillis:Date.now()+h,backoffCount:r+1};return s.setThrottleMetadata(o,d),mn.debug(`Calling attemptFetch again in ${h} millis`),t(n,d,i,s)}}({appId:r,apiKey:i,measurementId:s},a,o,t)}function Sn(i,s){return new Promise((e,t)=>{var n=Math.max(s-Date.now(),0);const r=setTimeout(e,n);i.addEventListener(()=>{clearTimeout(r),t(vn.create("fetch-throttle",{throttleEndTimeMillis:s}))})})}function kn(e){if(!(e instanceof P&&e.customData))return!1;var t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}class An{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function Nn(t,e,n,r,i,s,a){const o=Cn(t);o.then(e=>{n[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&mn.warn(`The measurement ID in the local Firebase config (${t.options.measurementId})`+` does not match the measurement ID fetched from the server (${e.measurementId}).`+" To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.")}).catch(e=>mn.error(e)),e.push(o);var c=async function(){if(!A())return mn.warn(vn.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await N()}catch(e){return mn.warn(vn.create("indexeddb-unavailable",{errorInfo:null==e?void 0:e.toString()}).message),!1}return!0}().then(e=>{if(e)return r.getId()}),[l,u]=await Promise.all([o,c]);!function(e){var t=window.document.getElementsByTagName("script");for(const n of Object.values(t))if(n.src&&n.src.includes(gn)&&n.src.includes(e))return n}(s)&&wn(s,l.measurementId),i("js",new Date);const h=null!==(c=null==a?void 0:a.config)&&void 0!==c?c:{};return h[pn]="firebase",h.update=!0,null!=u&&(h[dn]=u),i("config",l.measurementId,h),l.measurementId}class Rn{constructor(e){this.app=e}_delete(){return delete Pn[this.app.options.appId],Promise.resolve()}}let Pn={},Dn=[];const xn={};let On="dataLayer",Mn="gtag",Ln,Fn,Un=!1;function Vn(e){if(Un)throw vn.create("already-initialized");e.dataLayerName&&(On=e.dataLayerName),e.gtagName&&(Mn=e.gtagName)}function qn(e,t,n){!function(){const e=[];var t;E()&&e.push("This is a browser extension environment."),R()||e.push("Cookies are not available."),0<e.length&&(t=e.map((e,t)=>`(${t+1}) ${e}`).join(" "),t=vn.create("invalid-analytics-context",{errorInfo:t}),mn.warn(t.message))}();var r,i,s=e.options.appId;if(!s)throw vn.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw vn.create("no-api-key");mn.warn('The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest'+` measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId}`+' provided in the "measurementId" field in the local Firebase config.')}if(null!=Pn[s])throw vn.create("already-exists",{id:s});return Un||(function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t,t}(On),{wrappedGtag:r,gtagCore:i}=function(e,t,n,r,i){let s=function(){window[r].push(arguments)};return window[i]&&"function"==typeof window[i]&&(s=window[i]),window[i]=bn(s,e,t,n),{gtagCore:s,wrappedGtag:window[i]}}(Pn,Dn,xn,On,Mn),Fn=r,Ln=i,Un=!0),Pn[s]=Nn(e,Dn,xn,t,Ln,On,n),new Rn(e)}async function Bn(){if(E())return!1;if(!R())return!1;if(!A())return!1;try{return await N()}catch(e){return!1}}function jn(e,t,n){e=oe(e),async function(e,t,n,r){if(r&&r.global)return e("set",{screen_name:n}),Promise.resolve();e("config",await t,{update:!0,screen_name:n})}(Fn,Pn[e.app.options.appId],t,n).catch(e=>mn.error(e))}function zn(e,t,n){e=oe(e),async function(e,t,n,r){if(r&&r.global)return e("set",{user_id:n}),Promise.resolve();e("config",await t,{update:!0,user_id:n})}(Fn,Pn[e.app.options.appId],t,n).catch(e=>mn.error(e))}function $n(e,t,n){e=oe(e),async function(e,t,n,r){if(r&&r.global){const i={};for(const s of Object.keys(n))i[`user_properties.${s}`]=n[s];return e("set",i),Promise.resolve()}e("config",await t,{update:!0,user_properties:n})}(Fn,Pn[e.app.options.appId],t,n).catch(e=>mn.error(e))}function Kn(e,t){e=oe(e),async function(e,t){var n=await e;window[`ga-disable-${n}`]=!t}(Pn[e.app.options.appId],t).catch(e=>mn.error(e))}function Wn(e,t,n,r){e=oe(e),async function(e,t,n,r,i){var s;i&&i.global?e("event",n,r):(s=await t,e("event",n,Object.assign(Object.assign({},r),{send_to:s})))}(Fn,Pn[e.app.options.appId],t,n,r).catch(e=>mn.error(e))}const Gn="@firebase/analytics";Ge(new ce(hn,(e,{options:t})=>{return qn(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t)},"PUBLIC")),Ge(new ce("analytics-internal",function(e){try{const r=e.getProvider(hn).getImmediate();return{logEvent:(e,t,n)=>Wn(r,e,t,n)}}catch(e){throw vn.create("interop-component-reg-failed",{reason:e})}},"PRIVATE")),tt(Gn,"0.10.0"),tt(Gn,"0.10.0","esm2017");var Hn,Qn;class Yn{constructor(e,t){this.app=e,this._delegate=t}logEvent(e,t,n){Wn(this._delegate,e,t,n)}setCurrentScreen(e,t){jn(this._delegate,e,t)}setUserId(e,t){zn(this._delegate,e,t)}setUserProperties(e,t){$n(this._delegate,e,t)}setAnalyticsCollectionEnabled(e){Kn(this._delegate,e)}}(Kk=Hn=Hn||{}).ADD_SHIPPING_INFO="add_shipping_info",Kk.ADD_PAYMENT_INFO="add_payment_info",Kk.ADD_TO_CART="add_to_cart",Kk.ADD_TO_WISHLIST="add_to_wishlist",Kk.BEGIN_CHECKOUT="begin_checkout",Kk.CHECKOUT_PROGRESS="checkout_progress",Kk.EXCEPTION="exception",Kk.GENERATE_LEAD="generate_lead",Kk.LOGIN="login",Kk.PAGE_VIEW="page_view",Kk.PURCHASE="purchase",Kk.REFUND="refund",Kk.REMOVE_FROM_CART="remove_from_cart",Kk.SCREEN_VIEW="screen_view",Kk.SEARCH="search",Kk.SELECT_CONTENT="select_content",Kk.SELECT_ITEM="select_item",Kk.SELECT_PROMOTION="select_promotion",Kk.SET_CHECKOUT_OPTION="set_checkout_option",Kk.SHARE="share",Kk.SIGN_UP="sign_up",Kk.TIMING_COMPLETE="timing_complete",Kk.VIEW_CART="view_cart",Kk.VIEW_ITEM="view_item",Kk.VIEW_ITEM_LIST="view_item_list",Kk.VIEW_PROMOTION="view_promotion",Kk.VIEW_SEARCH_RESULTS="view_search_results";const Jn=e=>{var t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("analytics").getImmediate();return new Yn(t,n)};Qn={Analytics:Yn,settings:Vn,isSupported:Bn,EventName:Hn},bt.INTERNAL.registerComponent(new ce("analytics-compat",Jn,"PUBLIC").setServiceProps(Qn).setMultipleInstances(!0)),bt.registerVersion("@firebase/analytics-compat","0.2.6");const Xn=new Map,Zn={activated:!1,tokenObservers:[]},er={initialized:!1,enabled:!1};function tr(e){return Xn.get(e)||Object.assign({},Zn)}const nr="https://content-firebaseappcheck.googleapis.com/v1",rr="exchangeDebugToken",ir={OFFSET_DURATION:3e5,RETRIAL_MIN_WAIT:3e4,RETRIAL_MAX_WAIT:96e4};class sr{constructor(e,t,n,r,i){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=r,this.upperBound=i,this.pending=null,i<(this.nextErrorWaitInterval=r))throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(e){this.stop();try{this.pending=new y,this.pending.promise.catch(e=>{}),t=this.getNextRun(e),await new Promise(e=>{setTimeout(e,t)}),this.pending.resolve(),await this.pending.promise,this.pending=new y,this.pending.promise.catch(e=>{}),await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch(()=>{})}catch(e){this.retryPolicy(e)?this.process(!1).catch(()=>{}):this.stop()}var t}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();var t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}const ar=new D("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"});function or(e=!1){var t;return e?null===(t=self.grecaptcha)||void 0===t?void 0:t.enterprise:self.grecaptcha}function cr(e){if(!tr(e).activated)throw ar.create("use-before-activation",{appName:e.name})}function lr(e){var t=Math.round(e/1e3),n=Math.floor(t/86400),r=Math.floor((t-3600*n*24)/3600),i=Math.floor((t-3600*n*24-3600*r)/60),t=t-3600*n*24-3600*r-60*i;let s="";return n&&(s+=ur(n)+"d:"),r&&(s+=ur(r)+"h:"),s+=ur(i)+"m:"+ur(t)+"s",s}function ur(e){return 0===e?"00":10<=e?e.toString():"0"+e}async function hr({url:e,body:t},n){const r={"Content-Type":"application/json"},i=n.getImmediate({optional:!0});!i||(c=await i.getHeartbeatsHeader())&&(r["X-Firebase-Client"]=c);var s={method:"POST",body:JSON.stringify(t),headers:r};let a;try{a=await fetch(e,s)}catch(e){throw ar.create("fetch-network-error",{originalErrorMessage:null==e?void 0:e.message})}if(200!==a.status)throw ar.create("fetch-status-error",{httpStatus:a.status});let o;try{o=await a.json()}catch(e){throw ar.create("fetch-parse-error",{originalErrorMessage:null==e?void 0:e.message})}var c=o.ttl.match(/^([\d.]+)(s)$/);if(!c||!c[2]||isNaN(Number(c[1])))throw ar.create("fetch-parse-error",{originalErrorMessage:"ttl field (timeToLive) is not in standard Protobuf Duration "+`format: ${o.ttl}`});s=1e3*Number(c[1]),c=Date.now();return{token:o.token,expireTimeMillis:c+s,issuedAtTimeMillis:c}}function dr(e,t){var{projectId:n,appId:r,apiKey:i}=e.options;return{url:`${nr}/projects/${n}/apps/${r}:${rr}?key=${i}`,body:{debug_token:t}}}const pr="firebase-app-check-database",fr=1,gr="firebase-app-check-store",mr="debug-token";let vr=null;function _r(){return vr||(vr=new Promise((t,n)=>{try{const e=indexedDB.open(pr,fr);e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{var t;n(ar.create("storage-open",{originalErrorMessage:null===(t=e.target.error)||void 0===t?void 0:t.message}))},e.onupgradeneeded=e=>{const t=e.target.result;0===e.oldVersion&&t.createObjectStore(gr,{keyPath:"compositeKey"})}}catch(e){n(ar.create("storage-open",{originalErrorMessage:null==e?void 0:e.message}))}}),vr)}async function yr(e,t){const n=await _r(),r=n.transaction(gr,"readwrite"),i=r.objectStore(gr),s=i.put({compositeKey:e,value:t});return new Promise((t,n)=>{s.onsuccess=e=>{t()},r.onerror=e=>{var t;n(ar.create("storage-set",{originalErrorMessage:null===(t=e.target.error)||void 0===t?void 0:t.message}))}})}async function wr(e){const t=await _r(),i=t.transaction(gr,"readonly"),n=i.objectStore(gr),s=n.get(e);return new Promise((n,r)=>{s.onsuccess=e=>{var t=e.target.result;n(t?t.value:void 0)},i.onerror=e=>{var t;r(ar.create("storage-get",{originalErrorMessage:null===(t=e.target.error)||void 0===t?void 0:t.message}))}})}function br(e){return`${e.options.appId}-${e.name}`}const Ir=new ve("@firebase/app-check");async function Tr(t){if(A()){let e=void 0;try{e=await wr(br(t))}catch(e){Ir.warn(`Failed to read token from IndexedDB. Error: ${e}`)}return e}}function Er(e,t){return A()?yr(br(e),t).catch(e=>{Ir.warn(`Failed to write token to IndexedDB. Error: ${e}`)}):Promise.resolve()}async function Cr(){let e=void 0;try{e=await wr(mr)}catch(e){}if(e)return e;var t,n=ee();return t=n,yr(mr,t).catch(e=>Ir.warn(`Failed to persist debug token to IndexedDB. Error: ${e}`)),n}function Sr(){return er.enabled}async function kr(){var e=er;if(e.enabled&&e.token)return e.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)}const Ar={error:"UNKNOWN_ERROR"};async function Nr(e,t=!1){var n=e.app;cr(n);const r=tr(n);let i=r.token,s=void 0;if(i&&!Or(i)&&(r.token=void 0,i=void 0),i||(o=await r.cachedTokenPromise)&&(Or(o)?i=o:await Er(n,void 0)),!t&&i&&Or(i))return{token:i.token};let a=!1;if(Sr()){r.exchangeTokenPromise||(r.exchangeTokenPromise=hr(dr(n,await kr()),e.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),a=!0);var o=await r.exchangeTokenPromise;return await Er(n,o),{token:(r.token=o).token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),a=!0),i=await tr(n).exchangeTokenPromise}catch(e){"appCheck/throttled"===e.code?Ir.warn(e.message):Ir.error(e),s=e}let c;return i?s?c=Or(i)?{token:i.token,internalError:s}:Mr(s):(c={token:i.token},r.token=i,await Er(n,i)):c=Mr(s),a&&xr(n,c),c}function Rr(e,t,n,r){var i=e["app"];const s=tr(i);i={next:n,error:r,type:t};if(s.tokenObservers=[...s.tokenObservers,i],s.token&&Or(s.token)){const a=s.token;Promise.resolve().then(()=>{n({token:a.token}),Dr(e)}).catch(()=>{})}s.cachedTokenPromise.then(()=>Dr(e))}function Pr(e,t){const n=tr(e);var r=n.tokenObservers.filter(e=>e.next!==t);0===r.length&&n.tokenRefresher&&n.tokenRefresher.isRunning()&&n.tokenRefresher.stop(),n.tokenObservers=r}function Dr(e){var t=e["app"];const n=tr(t);let r=n.tokenRefresher;r||(r=function(n){const r=n["app"];return new sr(async()=>{var e=tr(r);let t;if(t=e.token?await Nr(n,!0):await Nr(n),t.error)throw t.error;if(t.internalError)throw t.internalError},()=>!0,()=>{var e=tr(r);if(e.token){var t=e.token.issuedAtTimeMillis+.5*(e.token.expireTimeMillis-e.token.issuedAtTimeMillis)+3e5,e=e.token.expireTimeMillis-3e5,t=Math.min(t,e);return Math.max(0,t-Date.now())}return 0},ir.RETRIAL_MIN_WAIT,ir.RETRIAL_MAX_WAIT)}(e),n.tokenRefresher=r),!r.isRunning()&&n.isTokenAutoRefreshEnabled&&r.start()}function xr(e,t){for(const n of tr(e).tokenObservers)try{"EXTERNAL"===n.type&&null!=t.error?n.error(t.error):n.next(t)}catch(e){}}function Or(e){return 0<e.expireTimeMillis-Date.now()}function Mr(e){return{token:(t=Ar,r.encodeString(JSON.stringify(t),!1)),error:e};var t}class Lr{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){var e=tr(this.app)["tokenObservers"];for(const t of e)Pr(this.app,t.next);return Promise.resolve()}}function Fr(t){return{getToken:e=>Nr(t,e),getLimitedUseToken:()=>async function(e){var t=e.app;cr(t);const n=tr(t)["provider"];if(Sr()){var r=(await hr(dr(t,await kr()),e.heartbeatServiceProvider))["token"];return{token:r}}return{token:r=(await n.getToken())["token"]}}(t),addTokenListener:e=>Rr(t,"INTERNAL",e),removeTokenListener:e=>Pr(t.app,e)}}const Ur="https://www.google.com/recaptcha/api.js",Vr="https://www.google.com/recaptcha/enterprise.js";function qr(t,n){const r=new y,e=tr(t);e.reCAPTCHAState={initialized:r};const i=zr(t);var s=or(!1);return s?jr(t,n,s,i,r):function(e){const t=document.createElement("script");t.src=Ur,t.onload=e,document.head.appendChild(t)}(()=>{var e=or(!1);if(!e)throw new Error("no recaptcha");jr(t,n,e,i,r)}),r.promise}function Br(t,n){const r=new y,e=tr(t);e.reCAPTCHAState={initialized:r};const i=zr(t);var s=or(!0);return s?jr(t,n,s,i,r):function(e){const t=document.createElement("script");t.src=Vr,t.onload=e,document.head.appendChild(t)}(()=>{var e=or(!0);if(!e)throw new Error("no recaptcha");jr(t,n,e,i,r)}),r.promise}function jr(e,t,n,r,i){n.ready(()=>{!function(e,t,n,r){const i=n.render(r,{sitekey:t,size:"invisible",callback:()=>{tr(e).reCAPTCHAState.succeeded=!0},"error-callback":()=>{tr(e).reCAPTCHAState.succeeded=!1}}),s=tr(e);s.reCAPTCHAState=Object.assign(Object.assign({},s.reCAPTCHAState),{widgetId:i})}(e,t,n,r),i.resolve(n)})}function zr(e){var t=`fire_app_check_${e.name}`;const n=document.createElement("div");return n.id=t,n.style.display="none",document.body.appendChild(n),t}async function $r(r){cr(r);const i=await tr(r).reCAPTCHAState.initialized.promise;return new Promise((e,t)=>{const n=tr(r).reCAPTCHAState;i.ready(()=>{e(i.execute(n.widgetId,{action:"fire_app_check"}))})})}class Kr{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){var e;Qr(this._throttleData);var t=await $r(this._app).catch(e=>{throw ar.create("recaptcha-error")});if(null===(e=tr(this._app).reCAPTCHAState)||void 0===e||!e.succeeded)throw ar.create("recaptcha-error");let n;try{n=await hr(function(e,t){var{projectId:n,appId:r,apiKey:i}=e.options;return{url:`${nr}/projects/${n}/apps/${r}:exchangeRecaptchaV3Token?key=${i}`,body:{recaptcha_v3_token:t}}}(this._app,t),this._heartbeatServiceProvider)}catch(e){throw null!==(t=e.code)&&void 0!==t&&t.includes("fetch-status-error")?(this._throttleData=Hr(Number(null===(t=e.customData)||void 0===t?void 0:t.httpStatus),this._throttleData),ar.create("throttled",{time:lr(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):e}return this._throttleData=null,n}initialize(e){this._app=e,this._heartbeatServiceProvider=He(e,"heartbeat"),qr(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof Kr&&this._siteKey===e._siteKey}}class Wr{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){var e;Qr(this._throttleData);var t=await $r(this._app).catch(e=>{throw ar.create("recaptcha-error")});if(null===(e=tr(this._app).reCAPTCHAState)||void 0===e||!e.succeeded)throw ar.create("recaptcha-error");let n;try{n=await hr(function(e,t){var{projectId:n,appId:r,apiKey:i}=e.options;return{url:`${nr}/projects/${n}/apps/${r}:exchangeRecaptchaEnterpriseToken?key=${i}`,body:{recaptcha_enterprise_token:t}}}(this._app,t),this._heartbeatServiceProvider)}catch(e){throw null!==(t=e.code)&&void 0!==t&&t.includes("fetch-status-error")?(this._throttleData=Hr(Number(null===(t=e.customData)||void 0===t?void 0:t.httpStatus),this._throttleData),ar.create("throttled",{time:lr(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):e}return this._throttleData=null,n}initialize(e){this._app=e,this._heartbeatServiceProvider=He(e,"heartbeat"),Br(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof Wr&&this._siteKey===e._siteKey}}class Gr{constructor(e){this._customProviderOptions=e}async getToken(){var e=await this._customProviderOptions.getToken(),t=function(e){const t=L(e).claims;return"object"==typeof t&&t.hasOwnProperty("iat")?t.iat:null}(e.token),t=null!==t&&t<Date.now()&&0<t?1e3*t:Date.now();return Object.assign(Object.assign({},e),{issuedAtTimeMillis:t})}initialize(e){this._app=e}isEqual(e){return e instanceof Gr&&this._customProviderOptions.getToken.toString()===e._customProviderOptions.getToken.toString()}}function Hr(e,t){if(404===e||403===e)return{backoffCount:1,allowRequestsAfter:Date.now()+864e5,httpStatus:e};var n=t?t.backoffCount:0,r=ae(n,1e3,2);return{backoffCount:n+1,allowRequestsAfter:Date.now()+r,httpStatus:e}}function Qr(e){if(e&&Date.now()-e.allowRequestsAfter<=0)throw ar.create("throttled",{time:lr(e.allowRequestsAfter-Date.now()),httpStatus:e.httpStatus})}function Yr(e=Ze(),t){const n=He(e=oe(e),"app-check");if(er.initialized||function(){var e=o();const t=er;if(t.initialized=!0,"string"==typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN||!0===e.FIREBASE_APPCHECK_DEBUG_TOKEN){t.enabled=!0;const n=new y;t.token=n,"string"==typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN?n.resolve(e.FIREBASE_APPCHECK_DEBUG_TOKEN):n.resolve(Cr())}}(),Sr()&&kr().then(e=>console.log(`App Check debug token: ${e}. You will need to add it to your app's App Check settings in the Firebase console for it to work.`)),n.isInitialized()){var r=n.getImmediate();const i=n.getOptions();if(i.isTokenAutoRefreshEnabled===t.isTokenAutoRefreshEnabled&&i.provider.isEqual(t.provider))return r;throw ar.create("already-initialized",{appName:e.name})}r=n.initialize({options:t});return function(t,e,n){const r=function(e,t){return Xn.set(e,t),Xn.get(e)}(t,Object.assign({},Zn));r.activated=!0,r.provider=e,r.cachedTokenPromise=Tr(t).then(e=>(e&&Or(e)&&(r.token=e,xr(t,{token:e.token})),e)),r.isTokenAutoRefreshEnabled=void 0===n?t.automaticDataCollectionEnabled:n,r.provider.initialize(t)}(e,t.provider,t.isTokenAutoRefreshEnabled),tr(e).isTokenAutoRefreshEnabled&&Rr(r,"INTERNAL",()=>{}),r}const Jr="app-check-internal";Ge(new ce("app-check",e=>{var t,n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat");return t=n,e=r,new Lr(t,e)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider(Jr).initialize()})),Ge(new ce(Jr,e=>{return Fr(e.getProvider("app-check").getImmediate())},"PUBLIC").setInstantiationMode("EXPLICIT")),tt("@firebase/app-check","0.8.1");const Xr=new D("appCheck","AppCheck",{"use-before-activation":"App Check is being used before activate() is called for FirebaseApp {$appName}. Call activate() before instantiating other Firebase services."});class Zr{constructor(e){this.app=e}activate(e,t){let n;n="string"==typeof e?new Kr(e):e instanceof Wr||e instanceof Kr||e instanceof Gr?e:new Gr({getToken:e.getToken}),this._delegate=Yr(this.app,{provider:n,isTokenAutoRefreshEnabled:t})}setTokenAutoRefreshEnabled(e){if(!this._delegate)throw Xr.create("use-before-activation",{appName:this.app.name});!function(e,t){const n=tr(e.app);n.tokenRefresher&&(!0===t?n.tokenRefresher.start():n.tokenRefresher.stop()),n.isTokenAutoRefreshEnabled=t}(this._delegate,e)}getToken(e){if(!this._delegate)throw Xr.create("use-before-activation",{appName:this.app.name});return async function(e,t){var n=await Nr(e,t);if(n.error)throw n.error;return{token:n.token}}(this._delegate,e)}onTokenChanged(e,t,n){if(!this._delegate)throw Xr.create("use-before-activation",{appName:this.app.name});return function(e,t,n){let r=()=>{},i=()=>{};return r=null!=t.next?t.next.bind(t):t,null!=t.error?i=t.error.bind(t):n&&(i=n),Rr(e,"EXTERNAL",r,i),()=>Pr(e.app,r)}(this._delegate,e,t)}}const ei=e=>{var t=e.getProvider("app-compat").getImmediate();return new Zr(t)};function ti(e,t){var n={};for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n}bt.INTERNAL.registerComponent(new ce("appCheck-compat",ei,"PUBLIC").setServiceProps({ReCaptchaEnterpriseProvider:Wr,ReCaptchaV3Provider:Kr,CustomProvider:Gr})),bt.registerVersion("@firebase/app-check-compat","0.3.8");const ni={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},ri={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};function ii(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}function si(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}}const ai=ii,oi=new D("auth","Firebase",ii()),ci=new ve("@firebase/auth");function li(e,...t){ci.logLevel<=m.ERROR&&ci.error(`Auth (${Je}): ${e}`,...t)}function ui(e,...t){throw fi(e,...t)}function hi(e,...t){return fi(e,...t)}function di(e,t,n){var r=Object.assign(Object.assign({},ai()),{[t]:n});const i=new D("auth","Firebase",r);return i.create(t,{appName:e.name})}function pi(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&ui(e,"argument-error"),di(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.`+"Did you pass a reference from a different Auth SDK?")}function fi(e,...t){if("string"==typeof e)return oi.create(e,...t);{var n=t[0];const r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}}function gi(e,t,...n){if(!e)throw fi(t,...n)}function mi(e){var t="INTERNAL ASSERTION FAILED: "+e;throw li(t),new Error(t)}function vi(e,t){e||mi(t)}function _i(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function yi(){return"http:"===wi()||"https:"===wi()}function wi(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class bi{constructor(e,t){vi((this.shortDelay=e)<(this.longDelay=t),"Short delay should be less than long delay!"),this.isMobile=I()||C()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(yi()||E()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function Ii(e,t){vi(e.emulator,"Emulator should always be set here");var n=e.emulator["url"];return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class Ti{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl||("undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void mi("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}static headers(){return this.headersImpl||("undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void mi("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}static response(){return this.responseImpl||("undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void mi("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}}const Ei={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Ci=new bi(3e4,6e4);function Si(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function ki(i,s,a,o,e={}){return Ai(i,e,async()=>{let e={},t={};o&&("GET"===s?t=o:e={body:JSON.stringify(o)});var n=z(Object.assign({key:i.config.apiKey},t)).slice(1);const r=await i._getAdditionalHeaders();return r["Content-Type"]="application/json",i.languageCode&&(r["X-Firebase-Locale"]=i.languageCode),Ti.fetch()(Ri(i,i.config.apiHost,a,n),Object.assign({method:s,headers:r,referrerPolicy:"no-referrer"},e))})}async function Ai(t,e,n){t._canInitEmulator=!1;var r=Object.assign(Object.assign({},Ei),e);try{const a=new Pi(t),o=await Promise.race([n(),a.promise]);a.clearNetworkTimeout();var i=await o.json();if("needConfirmation"in i)throw Di(t,"account-exists-with-different-credential",i);if(o.ok&&!("errorMessage"in i))return i;{const c=o.ok?i.errorMessage:i.error.message,[l,u]=c.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===l)throw Di(t,"credential-already-in-use",i);if("EMAIL_EXISTS"===l)throw Di(t,"email-already-in-use",i);if("USER_DISABLED"===l)throw Di(t,"user-disabled",i);var s=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw di(t,s,u);ui(t,s)}}catch(e){if(e instanceof P)throw e;ui(t,"network-request-failed",{message:String(e)})}}async function Ni(e,t,n,r,i={}){var s=await ki(e,t,n,r,i);return"mfaPendingCredential"in s&&ui(e,"multi-factor-auth-required",{_serverResponse:s}),s}function Ri(e,t,n,r){var i=`${t}${n}?${r}`;return e.config.emulator?Ii(e.config,i):`${e.config.apiScheme}://${i}`}class Pi{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(hi(this.auth,"network-request-failed")),Ci.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Di(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=hi(e,t,r);return i.customData._tokenResponse=n,i}function xi(e){return void 0!==e&&void 0!==e.getResponse}function Oi(e){return void 0!==e&&void 0!==e.enterprise}class Mi{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return function(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}}function Li(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function Fi(e){return 1e3*Number(e)}function Ui(e){var[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return li("JWT malformed, contained fewer than 3 sections"),null;try{var i=a(n);return i?JSON.parse(i):(li("Failed to decode base64 JWT payload"),null)}catch(e){return li("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}async function Vi(t,n,e=!1){if(e)return n;try{return n}catch(e){throw e instanceof P&&(n=[e["code"]][0],"auth/user-disabled"===n||"auth/user-token-expired"===n)&&t.auth.currentUser===t&&await t.auth.signOut(),e}}class qi{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(e){var t=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),t}this.errorBackoff=3e4;t=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,t)}schedule(e=!1){var t;this.isRunning&&(t=this.getInterval(e),this.timerId=setTimeout(async()=>{await this.iteration()},t))}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class Bi{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Li(this.lastLoginAt),this.creationTime=Li(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function ji(e){var t=e.auth,n=await e.getIdToken(),r=await Vi(e,async function(e,t){return ki(e,"POST","/v1/accounts:lookup",t)}(t,{idToken:n}));gi(null==r?void 0:r.users.length,t,"internal-error");var i=r.users[0];e._notifyReloadListener(i);var s,a,t=null!==(n=i.providerUserInfo)&&void 0!==n&&n.length?i.providerUserInfo.map(e=>{var t=e["providerId"],n=ti(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}}):[],r=(s=e.providerData,a=t,[...s.filter(t=>!a.some(e=>e.providerId===t.providerId)),...a]),n=e.isAnonymous,t=!(e.email&&i.passwordHash||null!==r&&r.length),t=!!n&&t,t={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new Bi(i.createdAt,i.lastLoginAt),isAnonymous:t};Object.assign(e,t)}class zi{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){gi(e.idToken,"internal-error"),gi(void 0!==e.idToken,"internal-error"),gi(void 0!==e.refreshToken,"internal-error");var t,n,n="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):(t=e.idToken,gi(n=Ui(t),"internal-error"),gi(void 0!==n.exp,"internal-error"),gi(void 0!==n.iat,"internal-error"),Number(n.exp)-Number(n.iat));this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}async getToken(e,t=!1){return gi(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){var i,s,{accessToken:n,refreshToken:r,expiresIn:a}=(s=t,await{accessToken:(a=await Ai(i=e,{},async()=>{var e=z({grant_type:"refresh_token",refresh_token:s}).slice(1),{tokenApiHost:t,apiKey:n}=i.config,n=Ri(i,t,"/v1/token",`key=${n}`);const r=await i._getAdditionalHeaders();return r["Content-Type"]="application/x-www-form-urlencoded",Ti.fetch()(n,{method:"POST",headers:r,body:e})})).access_token,expiresIn:a.expires_in,refreshToken:a.refresh_token});this.updateTokensAndExpiration(n,r,Number(a))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){var{refreshToken:n,accessToken:r,expirationTime:i}=t;const s=new zi;return n&&(gi("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(gi("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(gi("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new zi,this.toJSON())}_performRefresh(){return mi("not implemented")}}function $i(e,t){gi("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Ki{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=ti(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new qi(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Bi(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){var t=await Vi(this,this.stsTokenManager.getToken(this.auth,e));return gi(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=oe(e);var r=await n.getIdToken(t),i=Ui(r);gi(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");var s="object"==typeof i.firebase?i.firebase:void 0,a=null==s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:Li(Fi(i.auth_time)),issuedAtTime:Li(Fi(i.iat)),expirationTime:Li(Fi(i.exp)),signInProvider:a||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=oe(e);await ji(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(gi(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Ki(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){gi(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await ji(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){var e=await this.getIdToken();return await Vi(this,async function(e,t){return ki(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n=null!==(a=t.displayName)&&void 0!==a?a:void 0,r=null!==(g=t.email)&&void 0!==g?g:void 0,i=null!==(o=t.phoneNumber)&&void 0!==o?o:void 0,s=null!==(l=t.photoURL)&&void 0!==l?l:void 0,a=null!==(c=t.tenantId)&&void 0!==c?c:void 0,o=null!==(g=t._redirectEventId)&&void 0!==g?g:void 0,c=null!==(l=t.createdAt)&&void 0!==l?l:void 0,l=null!==(g=t.lastLoginAt)&&void 0!==g?g:void 0;const{uid:u,emailVerified:h,isAnonymous:d,providerData:p,stsTokenManager:f}=t;gi(u&&f,e,"internal-error");var g=zi.fromJSON(this.name,f);gi("string"==typeof u,e,"internal-error"),$i(n,e.name),$i(r,e.name),gi("boolean"==typeof h,e,"internal-error"),gi("boolean"==typeof d,e,"internal-error"),$i(i,e.name),$i(s,e.name),$i(a,e.name),$i(o,e.name),$i(c,e.name),$i(l,e.name);const m=new Ki({uid:u,auth:e,email:r,emailVerified:h,displayName:n,isAnonymous:d,photoURL:s,phoneNumber:i,tenantId:a,stsTokenManager:g,createdAt:c,lastLoginAt:l});return p&&Array.isArray(p)&&(m.providerData=p.map(e=>Object.assign({},e))),o&&(m._redirectEventId=o),m}static async _fromIdTokenResponse(e,t,n=!1){const r=new zi;r.updateFromServerResponse(t);var i=new Ki({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await ji(i),i}}const Wi=new Map;function Gi(e){vi(e instanceof Function,"Expected a class definition");let t=Wi.get(e);return t?vi(t instanceof e,"Instance stored in cache mismatched with class"):(t=new e,Wi.set(e,t)),t}class Hi{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){var t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Hi.type="NONE";const Qi=Hi;function Yi(e,t,n){return`firebase:${e}:${t}:${n}`}class Ji{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;var{config:r,name:i}=this.auth;this.fullUserKey=Yi(this.userKey,r.apiKey,i),this.fullPersistenceKey=Yi("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){var e=await this.persistence._get(this.fullUserKey);return e?Ki._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence!==e){var t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new Ji(Gi(Qi),e,n);const r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let i=r[0]||Gi(Qi);const s=Yi(n,e.config.apiKey,e.name);let a=null;for(const u of t)try{var o=await u._get(s);if(o){var c=Ki._fromJSON(e,o);u!==i&&(a=c),i=u;break}}catch(e){}var l=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&l.length&&(i=l[0],a&&await i._set(s,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new Ji(i,e,n)}}function Xi(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(ns(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Zi(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(is(t))return"Blackberry";if(ss(t))return"Webos";if(es(t))return"Safari";if((t.includes("chrome/")||ts(t))&&!t.includes("edge/"))return"Chrome";if(rs(t))return"Android";var n=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);return 2===(null==n?void 0:n.length)?n[1]:"Other"}function Zi(e=b()){return/firefox\//i.test(e)}function es(e=b()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function ts(e=b()){return/crios\//i.test(e)}function ns(e=b()){return/iemobile/i.test(e)}function rs(e=b()){return/android/i.test(e)}function is(e=b()){return/blackberry/i.test(e)}function ss(e=b()){return/webos/i.test(e)}function as(e=b()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function os(e=b()){return as(e)||rs(e)||ss(e)||is(e)||/windows phone/i.test(e)||ns(e)}function cs(e,t=[]){let n;switch(e){case"Browser":n=Xi(b());break;case"Worker":n=`${Xi(b())}-${e}`;break;default:n=e}var r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${Je}/${r}`}class ls{constructor(e){this.auth=e,this.queue=[]}pushCallback(r,e){var t=n=>new Promise((e,t)=>{try{e(r(n))}catch(e){t(e)}});t.onAbort=e,this.queue.push(t);const n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser!==e){const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const r of t)try{r()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}}class us{constructor(e){var t,n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=n.minPasswordLength)&&void 0!==t?t:6,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),void 0!==n.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),void 0!==n.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),void 0!==n.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),void 0!==n.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(n=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==n?n:"",this.forceUpgradeOnSignin=null!==(n=e.forceUpgradeOnSignin)&&void 0!==n&&n,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r;const i={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,i),this.validatePasswordCharacterOptions(e,i),i.isValid&&(i.isValid=null===(t=i.meetsMinPasswordLength)||void 0===t||t),i.isValid&&(i.isValid=null===(t=i.meetsMaxPasswordLength)||void 0===t||t),i.isValid&&(i.isValid=null===(n=i.containsLowercaseLetter)||void 0===n||n),i.isValid&&(i.isValid=null===(n=i.containsUppercaseLetter)||void 0===n||n),i.isValid&&(i.isValid=null===(r=i.containsNumericCharacter)||void 0===r||r),i.isValid&&(i.isValid=null===(r=i.containsNonAlphanumericCharacter)||void 0===r||r),i}validatePasswordLengthOptions(e,t){var n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){var n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,"a"<=n&&n<="z","A"<=n&&n<="Z","0"<=n&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class hs{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ps(this),this.idTokenSubscription=new ps(this),this.beforeStateQueue=new ls(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=oi,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(t,n){return n&&(this._popupRedirectResolver=Gi(n)),this._initializationPromise=this.queue(async()=>{var e;if(!this._deleted&&(this.persistenceManager=await Ji.create(this,t),!this._deleted)){if(null!==(e=this._popupRedirectResolver)&&void 0!==e&&e._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(n),this.lastNotifiedUid=(null===(e=this.currentUser)||void 0===e?void 0:e.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(!this._deleted){var e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e)return this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0)}}async initializeCurrentUser(e){var t,n,r,i=await this.assertedPersistence.getCurrentUser();let s=i,a=!1;if(e&&this.config.authDomain&&(await this.getOrInitRedirectPersistenceManager(),t=null===(r=this.redirectUser)||void 0===r?void 0:r._redirectEventId,n=null===s||void 0===s?void 0:s._redirectEventId,r=await this.tryRedirectSignIn(e),t&&t!==n||null==r||!r.user||(s=r.user,a=!0)),!s)return this.directlySetCurrentUser(null);if(s._redirectEventId)return gi(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s);if(a)try{await this.beforeStateQueue.runMiddleware(s)}catch(e){s=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await ji(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;var e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?oe(e):null;return t&&gi(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&gi(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(Gi(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){var e,t=await ki(e=this,"GET","/v2/passwordPolicy",Si(e,{})),t=new us(t);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new D("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(n.tenantId=this.tenantId),t=this,e=n,await ki(t,"POST","/v2/accounts:revokeToken",Si(t,e))}var t}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){var t;return this.redirectPersistenceManager||(gi(t=e&&Gi(e)||this._popupRedirectResolver,this,"argument-error"),this.redirectPersistenceManager=await Ji.create(this,[Gi(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()),this.redirectPersistenceManager}async _redirectUserForId(e){var t;return this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e;this._isInitialized&&(this.idTokenSubscription.next(this.currentUser),e=null!==(e=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==e?e:null,this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser)))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t);let s=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(gi(a,this,"internal-error"),a.then(()=>{s||i(this.currentUser)}),"function"==typeof t){const o=e.addObserver(t,n,r);return()=>{s=!0,o()}}{const c=e.addObserver(t);return()=>{s=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),(this.currentUser=e)?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return gi(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=cs(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);var t=await(null===(t=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);t=await this._getAppCheckToken();return t&&(e["X-Firebase-AppCheck"]=t),e}async _getAppCheckToken(){var e,t,n=await(null===(n=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===n?void 0:n.getToken());return null!=n&&n.error&&(e=`Error while retrieving App Check token: ${n.error}`,t=[],ci.logLevel<=m.WARN&&ci.warn(`Auth (${Je}): ${e}`,...t)),null==n?void 0:n.token}}function ds(e){return oe(e)}class ps{constructor(e){this.auth=e,this.observer=null,this.addObserver=G(e=>this.observer=e)}get next(){return gi(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function fs(i){return new Promise((e,n)=>{const t=document.createElement("script");var r;t.setAttribute("src",i),t.onload=e,t.onerror=e=>{const t=hi("internal-error");t.customData=e,n(t)},t.type="text/javascript",t.charset="UTF-8",(null!==(r=null===(r=document.getElementsByTagName("head"))||void 0===r?void 0:r[0])&&void 0!==r?r:document).appendChild(t)})}function gs(e){return`__${e}${Math.floor(1e6*Math.random())}`}class ms{constructor(e){this.type="recaptcha-enterprise",this.auth=ds(e)}async verify(i="verify",r=!1){async function e(i){if(!r){if(null==i.tenantId&&null!=i._agentRecaptchaConfig)return i._agentRecaptchaConfig.siteKey;if(null!=i.tenantId&&void 0!==i._tenantRecaptchaConfigs[i.tenantId])return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(n,r)=>{!async function(e,t){return ki(e,"GET","/v2/recaptchaConfig",Si(e,t))}(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(e=>{if(void 0!==e.recaptchaKey){var t=new Mi(e);return null==i.tenantId?i._agentRecaptchaConfig=t:i._tenantRecaptchaConfigs[i.tenantId]=t,n(t.siteKey)}r(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{r(e)})})}function s(e,t,n){const r=window.grecaptcha;Oi(r)?r.enterprise.ready(()=>{r.enterprise.execute(e,{action:i}).then(e=>{t(e)}).catch(()=>{t("NO_RECAPTCHA")})}):n(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((t,n)=>{e(this.auth).then(e=>{!r&&Oi(window.grecaptcha)?s(e,t,n):"undefined"!=typeof window?fs("https://www.google.com/recaptcha/enterprise.js?render="+e).then(()=>{s(e,t,n)}).catch(e=>{n(e)}):n(new Error("RecaptchaVerifier is only supported in browser"))}).catch(e=>{n(e)})})}}async function vs(e,t,n,r=!1){const i=new ms(e);let s;try{s=await i.verify(n)}catch(e){s=await i.verify(n,!0)}var a=Object.assign({},t);return r?Object.assign(a,{captchaResp:s}):Object.assign(a,{captchaResponse:s}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function _s(n,r,i,s){if(null!==(e=n._getRecaptchaConfig())&&void 0!==e&&e.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){var e=await vs(n,r,i,"getOobCode"===i);return s(n,e)}return s(n,r).catch(async e=>{if("auth/missing-recaptcha-token"!==e.code)return Promise.reject(e);console.log(`${i} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);var t=await vs(n,r,i,"getOobCode"===i);return s(n,t)})}function ys(e,t,n){const r=ds(e);gi(r._canInitEmulator,r,"emulator-config-failed"),gi(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");var i=!(null==n||!n.disableWarnings);const s=ws(t);var{host:a,port:o}=function(e){const t=ws(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);{if(i){var s=i[1];return{host:s,port:bs(r.substr(s.length+1))}}var[a,s]=r.split(":");return{host:a,port:bs(s)}}}(t);r.config.emulator={url:`${s}//${a}${null===o?"":`:${o}`}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:a,port:o,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function ws(e){var t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function bs(e){if(!e)return null;var t=Number(e);return isNaN(t)?null:t}class Is{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return mi("not implemented")}_getIdTokenResponse(e){return mi("not implemented")}_linkToIdToken(e,t){return mi("not implemented")}_getReauthenticationResolver(e){return mi("not implemented")}}async function Ts(e,t){return ki(e,"POST","/v1/accounts:resetPassword",Si(e,t))}async function Es(e,t){return ki(e,"POST","/v1/accounts:signUp",t)}async function Cs(e,t){return Ni(e,"POST","/v1/accounts:signInWithPassword",Si(e,t))}async function Ss(e,t){return ki(e,"POST","/v1/accounts:sendOobCode",Si(e,t))}async function ks(e,t){return Ss(e,t)}async function As(e,t){return Ss(e,t)}class Ns extends Is{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Ns(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Ns(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){var t="string"==typeof e?JSON.parse(e):e;if(null!=t&&t.email&&null!=t&&t.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return _s(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",Cs);case"emailLink":return async function(e,t){return Ni(e,"POST","/v1/accounts:signInWithEmailLink",Si(e,t))}(e,{email:this._email,oobCode:this._password});default:ui(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return _s(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Es);case"emailLink":return async function(e,t){return Ni(e,"POST","/v1/accounts:signInWithEmailLink",Si(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:ui(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Rs(e,t){return Ni(e,"POST","/v1/accounts:signInWithIdp",Si(e,t))}class Ps extends Is{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Ps(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):ui("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){var t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,t=ti(t,["providerId","signInMethod"]);if(!n||!r)return null;const i=new Ps(n,r);return i.idToken=t.idToken||void 0,i.accessToken=t.accessToken||void 0,i.secret=t.secret,i.nonce=t.nonce,i.pendingToken=t.pendingToken||null,i}_getIdTokenResponse(e){return Rs(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Rs(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Rs(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=z(t)}return e}}const Ds={USER_NOT_FOUND:"user-not-found"};class xs extends Is{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new xs({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new xs({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return Ni(e,"POST","/v1/accounts:signInWithPhoneNumber",Si(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){var n=await Ni(e,"POST","/v1/accounts:signInWithPhoneNumber",Si(e,t));if(n.temporaryProof)throw Di(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return Ni(e,"POST","/v1/accounts:signInWithPhoneNumber",Si(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),Ds)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){var{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){var{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e="string"==typeof e?JSON.parse(e):e;return n||t||r||i?new xs({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class Os{constructor(e){var t=$(K(e)),n=null!==(r=t.apiKey)&&void 0!==r?r:null,r=null!==(i=t.oobCode)&&void 0!==i?i:null,i=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(i=t.mode)&&void 0!==i?i:null);gi(n&&r&&i,"argument-error"),this.apiKey=n,this.operation=i,this.code=r,this.continueUrl=null!==(r=t.continueUrl)&&void 0!==r?r:null,this.languageCode=null!==(r=t.languageCode)&&void 0!==r?r:null,this.tenantId=null!==(t=t.tenantId)&&void 0!==t?t:null}static parseLink(e){var t,n,r,t=(t=$(K(e=e)).link,n=t?$(K(t)).deep_link_id:null,((r=$(K(e)).deep_link_id)?$(K(r)).link:null)||r||n||t||e);try{return new Os(t)}catch(e){return null}}}class Ms{constructor(){this.providerId=Ms.PROVIDER_ID}static credential(e,t){return Ns._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){var n=Os.parseLink(t);return gi(n,"argument-error"),Ns._fromEmailAndCode(e,n.code,n.tenantId)}}Ms.PROVIDER_ID="password",Ms.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Ms.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Ls{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Fs extends Ls{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Us extends Fs{static credentialFromJSON(e){var t="string"==typeof e?JSON.parse(e):e;return gi("providerId"in t&&"signInMethod"in t,"argument-error"),Ps._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return gi(e.idToken||e.accessToken,"argument-error"),Ps._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return Us.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return Us.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:r,pendingToken:i,nonce:s,providerId:a}=e;if(!(n||r||t||i))return null;if(!a)return null;try{return new Us(a)._credential({idToken:t,accessToken:n,nonce:s,pendingToken:i})}catch(e){return null}}}class Vs extends Fs{constructor(){super("facebook.com")}static credential(e){return Ps._fromParams({providerId:Vs.PROVIDER_ID,signInMethod:Vs.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Vs.credentialFromTaggedObject(e)}static credentialFromError(e){return Vs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!(e&&"oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Vs.credential(e.oauthAccessToken)}catch(e){return null}}}Vs.FACEBOOK_SIGN_IN_METHOD="facebook.com",Vs.PROVIDER_ID="facebook.com";class qs extends Fs{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Ps._fromParams({providerId:qs.PROVIDER_ID,signInMethod:qs.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return qs.credentialFromTaggedObject(e)}static credentialFromError(e){return qs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return qs.credential(t,n)}catch(e){return null}}}qs.GOOGLE_SIGN_IN_METHOD="google.com",qs.PROVIDER_ID="google.com";class Bs extends Fs{constructor(){super("github.com")}static credential(e){return Ps._fromParams({providerId:Bs.PROVIDER_ID,signInMethod:Bs.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Bs.credentialFromTaggedObject(e)}static credentialFromError(e){return Bs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!(e&&"oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Bs.credential(e.oauthAccessToken)}catch(e){return null}}}Bs.GITHUB_SIGN_IN_METHOD="github.com",Bs.PROVIDER_ID="github.com";class js extends Is{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return Rs(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Rs(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Rs(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){var{providerId:t,signInMethod:n,pendingToken:r}="string"==typeof e?JSON.parse(e):e;return t&&n&&r&&t===n?new js(t,r):null}static _create(e,t){return new js(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class zs extends Ls{constructor(e){gi(e.startsWith("saml."),"argument-error"),super(e)}static credentialFromResult(e){return zs.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return zs.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){var t=js.fromJSON(e);return gi(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{pendingToken:t,providerId:n}=e;if(!t||!n)return null;try{return js._create(n,t)}catch(e){return null}}}class $s extends Fs{constructor(){super("twitter.com")}static credential(e,t){return Ps._fromParams({providerId:$s.PROVIDER_ID,signInMethod:$s.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return $s.credentialFromTaggedObject(e)}static credentialFromError(e){return $s.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return $s.credential(t,n)}catch(e){return null}}}async function Ks(e,t){return Ni(e,"POST","/v1/accounts:signUp",Si(e,t))}$s.TWITTER_SIGN_IN_METHOD="twitter.com",$s.PROVIDER_ID="twitter.com";class Ws{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){var i=await Ki._fromIdTokenResponse(e,n,r),s=Gs(n);return new Ws({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);var r=Gs(n);return new Ws({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function Gs(e){return e.providerId||("phoneNumber"in e?"phone":null)}class Hs extends P{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,Hs.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new Hs(e,t,n,r)}}function Qs(t,n,e,r){const i="reauthenticate"===n?e._getReauthenticationResolver(t):e._getIdTokenResponse(t);return i.catch(e=>{if("auth/multi-factor-auth-required"===e.code)throw Hs._fromErrorAndOperation(t,e,n,r);throw e})}function Ys(e){return new Set(e.map(({providerId:e})=>e).filter(e=>!!e))}async function Js(e,t){const n=oe(e);await Zs(!0,n,t);var r=(e=n.auth,t={idToken:await n.getIdToken(),deleteProvider:[t]},await ki(e,"POST","/v1/accounts:update",t))["providerUserInfo"];const i=Ys(r||[]);return n.providerData=n.providerData.filter(e=>i.has(e.providerId)),i.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n}async function Xs(e,t,n=!1){var r=await Vi(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return Ws._forOperation(e,"link",r)}async function Zs(e,t,n){await ji(t);const r=Ys(t.providerData);var i=!1===e?"provider-already-linked":"no-such-provider";gi(r.has(n)===e,t.auth,i)}async function ea(e,t,n=!1){var r=e["auth"],i="reauthenticate";try{var s=await Vi(e,Qs(r,i,t,e),n);gi(s.idToken,r,"internal-error");var a=Ui(s.idToken);gi(a,r,"internal-error");var o=a["sub"];return gi(e.uid===o,r,"user-mismatch"),Ws._forOperation(e,i,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&ui(r,"user-mismatch"),e}}async function ta(e,t,n=!1){var r=await Qs(e,"signIn",t),r=await Ws._fromIdTokenResponse(e,"signIn",r);return n||await e._updateCurrentUser(r.user),r}async function na(e,t){return ta(ds(e),t)}async function ra(e,t){var n=oe(e);return await Zs(!1,n,t.providerId),Xs(n,t)}async function ia(e,t){return ea(oe(e),t)}async function sa(e,t){const n=ds(e);var r=await Ni(n,"POST","/v1/accounts:signInWithCustomToken",Si(n,{token:t,returnSecureToken:!0})),r=await Ws._fromIdTokenResponse(n,"signIn",r);return await n._updateCurrentUser(r.user),r}class aa{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?oa._fromServerResponse(e,t):"totpInfo"in t?ca._fromServerResponse(e,t):ui(e,"internal-error")}}class oa extends aa{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new oa(t)}}class ca extends aa{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new ca(t)}}function la(e,t,n){var r;gi(0<(null===(r=n.url)||void 0===r?void 0:r.length),e,"invalid-continue-uri"),gi(void 0===n.dynamicLinkDomain||0<n.dynamicLinkDomain.length,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(gi(0<n.iOS.bundleId.length,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(gi(0<n.android.packageName.length,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function ua(e){const t=ds(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function ha(e,t){await ki(e=oe(e),"POST","/v1/accounts:update",Si(e,{oobCode:t}))}async function da(e,t){var n=oe(e),r=await Ts(n,{oobCode:t}),i=r.requestType;switch(gi(i,n,"internal-error"),i){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":gi(r.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":gi(r.mfaInfo,n,"internal-error");default:gi(r.email,n,"internal-error")}let s=null;return r.mfaInfo&&(s=aa._fromServerResponse(ds(n),r.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.newEmail:r.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.email:r.newEmail)||null,multiFactorInfo:s},operation:i}}async function pa(e,t){var n=yi()?_i():"http://localhost",n=(await ki(e=oe(e),"POST","/v1/accounts:createAuthUri",Si(e,{identifier:t,continueUri:n})))["signinMethods"];return n||[]}async function fa(e,t){var n=oe(e),r={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&la(n.auth,r,t);var r=(await Ss(n.auth,r))["email"];r!==e.email&&await e.reload()}async function ga(e,t,n){var r=oe(e),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&la(r.auth,i,n);var i=(await Ss(r.auth,i))["email"];i!==e.email&&await e.reload()}async function ma(e,{displayName:t,photoURL:n}){if(void 0!==t||void 0!==n){const i=oe(e);var r=await i.getIdToken(),r=await Vi(i,async function(e,t){return ki(e,"POST","/v1/accounts:update",t)}(i.auth,{idToken:r,displayName:t,photoUrl:n,returnSecureToken:!0}));i.displayName=r.displayName||null,i.photoURL=r.photoUrl||null;const s=i.providerData.find(({providerId:e})=>"password"===e);s&&(s.displayName=i.displayName,s.photoURL=i.photoURL),await i._updateTokensIfNecessary(r)}}async function va(e,t,n){var r=e["auth"];const i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n);r=await Vi(e,async function(e,t){return ki(e,"POST","/v1/accounts:update",t)}(r,i));await e._updateTokensIfNecessary(r,!0)}class _a{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class ya extends _a{constructor(e,t,n,r){super(e,t,n),this.username=r}}class wa extends _a{constructor(e,t){super(e,"facebook.com",t)}}class ba extends ya{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class Ia extends _a{constructor(e,t){super(e,"google.com",t)}}class Ta extends ya{constructor(e,t,n){super(e,"twitter.com",t,n)}}function Ea(e){var{user:t,_tokenResponse:n}=e;return t.isAnonymous&&!n?{providerId:null,isNewUser:!1,profile:null}:function(e){if(!e)return null;var t=e["providerId"],n=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},r=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!t&&null!=e&&e.idToken){var i=null===(i=null===(i=Ui(e.idToken))||void 0===i?void 0:i.firebase)||void 0===i?void 0:i.sign_in_provider;if(i){i="anonymous"!==i&&"custom"!==i?i:null;return new _a(r,i)}}if(!t)return null;switch(t){case"facebook.com":return new wa(r,n);case"github.com":return new ba(r,n);case"google.com":return new Ia(r,n);case"twitter.com":return new Ta(r,n,e.screenName||null);case"custom":case"anonymous":return new _a(r,null);default:return new _a(r,t,n)}}(n)}class Ca{constructor(e,t,n){this.type=e,this.credential=t,this.user=n}static _fromIdtoken(e,t){return new Ca("enroll",e,t)}static _fromMfaPendingCredential(e){return new Ca("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t;if(null!=e&&e.multiFactorSession){if(null!==(t=e.multiFactorSession)&&void 0!==t&&t.pendingCredential)return Ca._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null!==(t=e.multiFactorSession)&&void 0!==t&&t.idToken)return Ca._fromIdtoken(e.multiFactorSession.idToken)}return null}}class Sa{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,i){const s=ds(e),a=i.customData._serverResponse;var t=(a.mfaInfo||[]).map(e=>aa._fromServerResponse(s,e));gi(a.mfaPendingCredential,s,"internal-error");const o=Ca._fromMfaPendingCredential(a.mfaPendingCredential);return new Sa(o,t,async e=>{var t=await e._process(s,o);delete a.mfaInfo,delete a.mfaPendingCredential;var n=Object.assign(Object.assign({},a),{idToken:t.idToken,refreshToken:t.refreshToken});switch(i.operationType){case"signIn":var r=await Ws._fromIdTokenResponse(s,i.operationType,n);return await s._updateCurrentUser(r.user),r;case"reauthenticate":return gi(i.user,s,"internal-error"),Ws._forOperation(i.user,i.operationType,n);default:ui(s,"internal-error")}})}async resolveSignIn(e){return this.signInResolver(e)}}class ka{constructor(t){this.user=t,this.enrolledFactors=[],t._onReload(e=>{e.mfaInfo&&(this.enrolledFactors=e.mfaInfo.map(e=>aa._fromServerResponse(t.auth,e)))})}static _fromUser(e){return new ka(e)}async getSession(){return Ca._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const n=e;var r=await this.getSession(),r=await Vi(this.user,n._process(this.user.auth,r,t));return await this.user._updateTokensIfNecessary(r),this.user.reload()}async unenroll(e){const t="string"==typeof e?e:e.uid;var n,r,i=await this.user.getIdToken();try{var s=await Vi(this.user,(n=this.user.auth,r={idToken:i,mfaEnrollmentId:t},ki(n,"POST","/v2/accounts/mfaEnrollment:withdraw",Si(n,r))));this.enrolledFactors=this.enrolledFactors.filter(({uid:e})=>e!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(e){throw e}}}const Aa=new WeakMap;const Na="__sak";class Ra{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Na,"1"),this.storage.removeItem(Na),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){var t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Pa extends Ra{constructor(){var e;super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=(es(e=b())||as(e))&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=os(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const r of Object.keys(this.listeners)){var t=this.storage.getItem(r),n=this.localCache[r];t!==n&&e(r,n,t)}}onStorageEvent(e,t=!1){if(e.key){const r=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const i=this.storage.getItem(r);if(e.newValue!==i)null!==e.newValue?this.storage.setItem(r,e.newValue):this.storage.removeItem(r);else if(this.localCache[r]===e.newValue&&!t)return}var n=()=>{var e=this.storage.getItem(r);!t&&this.localCache[r]===e||this.notifyListeners(r,e)};const i=this.storage.getItem(r);S()&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(n,10):n()}else this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)})}notifyListeners(e,t){this.localCache[e]=t;var n=this.listeners[e];if(n)for(const r of Array.from(n))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){var t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Pa.type="LOCAL";const Da=Pa;class xa extends Ra{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}xa.type="SESSION";const Oa=xa;class Ma{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){var e=this.receivers.find(e=>e.isListeningto(t));if(e)return e;e=new Ma(t);return this.receivers.push(e),e}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data;var s=this.handlersMap[r];null!=s&&s.size&&(t.ports[0].postMessage({status:"ack",eventId:n,eventType:r}),s=Array.from(s).map(async e=>e(t.origin,i)),s=await Promise.all(s.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})),t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:s}))}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function La(e="",t=10){let n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}Ma.receivers=[];class Fa{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,a=50){const o="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!o)throw new Error("connection_unavailable");let c,l;return new Promise((n,r)=>{const i=La("",20);o.port1.start();const s=setTimeout(()=>{r(new Error("unsupported_event"))},a);l={messageChannel:o,onMessage(e){var t=e;if(t.data.eventId===i)switch(t.data.status){case"ack":clearTimeout(s),c=setTimeout(()=>{r(new Error("timeout"))},3e3);break;case"done":clearTimeout(c),n(t.data.response);break;default:clearTimeout(s),clearTimeout(c),r(new Error("invalid_response"))}}},this.handlers.add(l),o.port1.addEventListener("message",l.onMessage),this.target.postMessage({eventType:e,eventId:i,data:t},[o.port2])}).finally(()=>{l&&this.removeMessageHandler(l)})}}function Ua(){return window}function Va(){return void 0!==Ua().WorkerGlobalScope&&"function"==typeof Ua().importScripts}const qa="firebaseLocalStorageDb",Ba="firebaseLocalStorage",ja="fbase_key";class za{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function $a(e,t){return e.transaction([Ba],t?"readwrite":"readonly").objectStore(Ba)}function Ka(){const r=indexedDB.open(qa,1);return new Promise((n,t)=>{r.addEventListener("error",()=>{t(r.error)}),r.addEventListener("upgradeneeded",()=>{const e=r.result;try{e.createObjectStore(Ba,{keyPath:ja})}catch(e){t(e)}}),r.addEventListener("success",async()=>{const e=r.result;var t;e.objectStoreNames.contains(Ba)?n(e):(e.close(),t=indexedDB.deleteDatabase(qa),await new za(t).toPromise(),n(await Ka()))})})}async function Wa(e,t,n){var r=$a(e,!0).put({fbase_key:t,value:n});return new za(r).toPromise()}function Ga(e,t){var n=$a(e,!0).delete(t);return new za(n).toPromise()}class Ha{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await Ka(),this.db)}async _withRetries(e){let t=0;for(;;)try{return e(await this._openDb())}catch(e){if(3<t++)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Va()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Ma._getInstance(Va()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>{const n=await this._poll();return{keyProcessed:n.includes(t.key)}}),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t,n;this.activeServiceWorker=await async function(){if(null===navigator||void 0===navigator||!navigator.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),this.activeServiceWorker&&(this.sender=new Fa(this.activeServiceWorker),(n=await this.sender._send("ping",{},800))&&null!==(e=n[0])&&void 0!==e&&e.fulfilled&&null!==(t=n[0])&&void 0!==t&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0))}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;var e=await Ka();return await Wa(e,Na,"1"),await Ga(e,Na),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(t,n){return this._withPendingWrite(async()=>(await this._withRetries(e=>Wa(e,t,n)),this.localCache[t]=n,this.notifyServiceWorker(t)))}async _get(t){var e=await this._withRetries(e=>async function(e,t){var n=$a(e,!1).get(t);return void 0===(n=await new za(n).toPromise())?null:n.value}(e,t));return this.localCache[t]=e}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(e=>Ga(e,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){var e=await this._withRetries(e=>{var t=$a(e,!1).getAll();return new za(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(var{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const s of Object.keys(this.localCache))this.localCache[s]&&!n.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;var n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Ha.type="LOCAL";const Qa=Ha;class Ya{constructor(e){this.auth=e,this.counter=1e12,this._widgets=new Map}render(e,t){var n=this.counter;return this._widgets.set(n,new Ja(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t,n=e||1e12;null===(t=this._widgets.get(n))||void 0===t||t.delete(),this._widgets.delete(n)}getResponse(e){var t;return(null===(t=this._widgets.get(e||1e12))||void 0===t?void 0:t.getResponse())||""}async execute(e){var t;return null===(t=this._widgets.get(e||1e12))||void 0===t||t.execute(),""}}class Ja{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};var r="string"==typeof e?document.getElementById(e):e;gi(r,"argument-error",{appName:t}),this.container=r,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout(()=>{this.responseToken=function(e){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<e;r++)t.push(n.charAt(Math.floor(Math.random()*n.length)));return t.join("")}(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(e){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(e){}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const Xa=gs("rcb"),Za=new bi(3e4,6e4);class eo{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!(null===(e=Ua().grecaptcha)||void 0===e||!e.render)}load(s,a=""){var e;return gi((e=a).length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e),s,"argument-error"),this.shouldResolveImmediately(a)&&xi(Ua().grecaptcha)?Promise.resolve(Ua().grecaptcha):new Promise((t,n)=>{const i=Ua().setTimeout(()=>{n(hi(s,"network-request-failed"))},Za.get());Ua()[Xa]=()=>{Ua().clearTimeout(i),delete Ua()[Xa];const e=Ua().grecaptcha;if(e&&xi(e)){const r=e.render;e.render=(e,t)=>{var n=r(e,t);return this.counter++,n},this.hostLanguage=a,t(e)}else n(hi(s,"internal-error"))},fs(`https://www.google.com/recaptcha/api.js??${z({onload:Xa,render:"explicit",hl:a})}`).catch(()=>{clearTimeout(i),n(hi(s,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!(null===(t=Ua().grecaptcha)||void 0===t||!t.render)&&(e===this.hostLanguage||0<this.counter||this.librarySeparatelyLoaded)}}class to{async load(e){return new Ya(e)}clearedOneInstance(){}}const no="recaptcha",ro={theme:"light",type:"image"};class io{constructor(e,t,n=Object.assign({},ro)){this.parameters=n,this.type=no,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=ds(e),this.isInvisible="invisible"===this.parameters.size,gi("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");var r="string"==typeof t?document.getElementById(t):t;gi(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=new(this.auth.settings.appVerificationDisabledForTesting?to:eo),this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),r=this.getAssertedRecaptcha();var t=r.getResponse(e);return t||new Promise(t=>{const n=e=>{e&&(this.tokenChangeListeners.delete(n),t(e))};this.tokenChangeListeners.add(n),this.isInvisible&&r.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){gi(!this.parameters.sitekey,this.auth,"argument-error"),gi(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),gi("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(n){return t=>{if(this.tokenChangeListeners.forEach(e=>e(t)),"function"==typeof n)n(t);else if("string"==typeof n){const e=Ua()[n];"function"==typeof e&&e(t)}}}assertNotDestroyed(){gi(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;var t;this.isInvisible||(t=document.createElement("div"),e.appendChild(t),e=t),this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){gi(yi()&&!Va(),this.auth,"internal-error"),await function(){let t=null;return new Promise(e=>{"complete"!==document.readyState?(t=()=>e(),window.addEventListener("load",t)):e()}).catch(e=>{throw t&&window.removeEventListener("load",t),e})}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);var e=await((await ki(this.auth,"GET","/v1/recaptchaParams")).recaptchaSiteKey||"");gi(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return gi(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class so{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){var t=xs._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function ao(t,n,r){var i,s,a,o,c,l,u=await r.verify();try{gi("string"==typeof u,t,"argument-error"),gi(r.type===no,t,"argument-error");let e;if(e="string"==typeof n?{phoneNumber:n}:n,"session"in e){var h=e.session;if("phoneNumber"in e)return gi("enroll"===h.type,t,"internal-error"),(c=t,l={idToken:h.credential,phoneEnrollmentInfo:{phoneNumber:e.phoneNumber,recaptchaToken:u}},await ki(c,"POST","/v2/accounts/mfaEnrollment:start",Si(c,l))).phoneSessionInfo.sessionInfo;gi("signin"===h.type,t,"internal-error");var d=(null===(i=e.multiFactorHint)||void 0===i?void 0:i.uid)||e.multiFactorUid;return gi(d,t,"missing-multi-factor-info"),(o={mfaPendingCredential:h.credential,mfaEnrollmentId:d,phoneSignInInfo:{recaptchaToken:u}},await ki(t,"POST","/v2/accounts/mfaSignIn:start",Si(t,o))).phoneResponseInfo.sessionInfo}var p=(s=t,a={phoneNumber:e.phoneNumber,recaptchaToken:u},await ki(s,"POST","/v1/accounts:sendVerificationCode",Si(s,a)))["sessionInfo"];return p}finally{r._reset()}}class oo{constructor(e){this.providerId=oo.PROVIDER_ID,this.auth=ds(e)}verifyPhoneNumber(e,t){return ao(this.auth,e,oe(t))}static credential(e,t){return xs._fromVerification(e,t)}static credentialFromResult(e){var t=e;return oo.credentialFromTaggedObject(t)}static credentialFromError(e){return oo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{phoneNumber:t,temporaryProof:n}=e;return t&&n?xs._fromTokenResponse(t,n):null}}function co(e,t){return t?Gi(t):(gi(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}oo.PROVIDER_ID="phone",oo.PHONE_SIGN_IN_METHOD="phone";class lo extends Is{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Rs(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Rs(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Rs(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function uo(e){return ta(e.auth,new lo(e),e.bypassAuthState)}function ho(e){var{auth:t,user:n}=e;return gi(n,t,"internal-error"),ea(n,new lo(e),e.bypassAuthState)}async function po(e){var{auth:t,user:n}=e;return gi(n,t,"internal-error"),Xs(n,new lo(e),e.bypassAuthState)}class fo{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){var{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:a}=e;if(s)this.reject(s);else{r={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(r))}catch(e){this.reject(e)}}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return uo;case"linkViaPopup":case"linkViaRedirect":return po;case"reauthViaPopup":case"reauthViaRedirect":return ho;default:ui(this.auth,"internal-error")}}resolve(e){vi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){vi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const go=new bi(2e3,1e4);class mo extends fo{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,mo.currentPopupAction&&mo.currentPopupAction.cancel(),mo.currentPopupAction=this}async executeNotNull(){var e=await this.execute();return gi(e,this.auth,"internal-error"),e}async onExecution(){vi(1===this.filter.length,"Popup operations only handle one event");var e=La();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(hi(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(hi(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,mo.currentPopupAction=null}pollUserCancellation(){const t=()=>{var e;null!==(e=null===(e=this.authWindow)||void 0===e?void 0:e.window)&&void 0!==e&&e.closed?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(hi(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(t,go.get())};t()}}mo.currentPopupAction=null;const vo="pendingRedirect",_o=new Map;class yo extends fo{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let t=_o.get(this.auth._key());if(!t){try{const e=await async function(e,t){const n=To(t),r=Io(e);if(!await r._isAvailable())return!1;var i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(e)}catch(e){t=()=>Promise.reject(e)}_o.set(this.auth._key(),t)}return this.bypassAuthState||_o.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){var t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function wo(e,t){return Io(e)._set(To(t),"true")}function bo(e,t){_o.set(e._key(),t)}function Io(e){return Gi(e._redirectPersistence)}function To(e){return Yi(vo,e.config.apiKey,e.name)}function Eo(e,t,n){return async function(e,t,n){var r=ds(e);pi(e,t,Ls),await r._initializationPromise;const i=co(r,n);return await wo(i,r),i._openRedirect(r,t,"signInViaRedirect")}(e,t,n)}function Co(e,t,n){return async function(e,t,n){var r=oe(e);pi(r.auth,t,Ls),await r.auth._initializationPromise;const i=co(r.auth,n);await wo(i,r.auth);var s=await Ao(r);return i._openRedirect(r.auth,t,"reauthViaRedirect",s)}(e,t,n)}function So(e,t,n){return async function(e,t,n){var r=oe(e);pi(r.auth,t,Ls),await r.auth._initializationPromise;const i=co(r.auth,n);await Zs(!1,r,t.providerId),await wo(i,r.auth);var s=await Ao(r);return i._openRedirect(r.auth,t,"linkViaRedirect",s)}(e,t,n)}async function ko(e,t,n=!1){const r=ds(e);var i=co(r,t);const s=new yo(r,i,n),a=await s.execute();return a&&!n&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,t)),a}async function Ao(e){var t=La(`${e.uid}:::`);return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class No{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let n=!1;return this.consumers.forEach(e=>{this.isEventForConsumer(t,e)&&(n=!0,this.sendToConsumer(t,e),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Po(e);default:return!1}}(t)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=t,n=!0)),n}sendToConsumer(e,t){var n;e.error&&!Po(e)?(n=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error",t.onError(hi(this.auth,n))):t.onAuthEvent(e)}isEventForConsumer(e,t){var n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return 6e5<=Date.now()-this.lastProcessedEventTime&&this.cachedEventUids.clear(),this.cachedEventUids.has(Ro(e))}saveEventToCache(e){this.cachedEventUids.add(Ro(e)),this.lastProcessedEventTime=Date.now()}}function Ro(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function Po({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}async function Do(e,t={}){return ki(e,"GET","/v1/projects",t)}const xo=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Oo=/^https?/;async function Mo(e){if(!e.config.emulator){var t=(await Do(e))["authorizedDomains"];for(const n of t)try{if(function(e){const t=_i(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){var i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!Oo.test(n))return!1;if(xo.test(e))return r===e;const s=e.replace(/\./g,"\\."),a=new RegExp("^(.+\\."+s+"|"+s+")$","i");return a.test(r)}(n))return}catch(e){}ui(e,"unauthorized-domain")}}const Lo=new bi(3e4,6e4);function Fo(){const t=Ua().___jsl;if(null!==t&&void 0!==t&&t.H)for(const n of Object.keys(t.H))if(t.H[n].r=t.H[n].r||[],t.H[n].L=t.H[n].L||[],t.H[n].r=[...t.H[n].L],t.CP)for(let e=0;e<t.CP.length;e++)t.CP[e]=null}let Uo=null;function Vo(e){var i;return Uo=Uo||(i=e,new Promise((e,t)=>{function n(){Fo(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Fo(),t(hi(i,"network-request-failed"))},timeout:Lo.get()})}if(null!==(r=null===(r=Ua().gapi)||void 0===r?void 0:r.iframes)&&void 0!==r&&r.Iframe)e(gapi.iframes.getContext());else{if(null===(r=Ua().gapi)||void 0===r||!r.load){var r=gs("iframefcb");return Ua()[r]=()=>{gapi.load?n():t(hi(i,"network-request-failed"))},fs(`https://apis.google.com/js/api.js?onload=${r}`).catch(e=>t(e))}n()}}).catch(e=>{throw Uo=null,e})),Uo}const qo=new bi(5e3,15e3),Bo="__/auth/iframe",jo="emulator/auth/iframe",zo={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},$o=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function Ko(a){const e=await Vo(a);var t=Ua().gapi;return gi(t,a,"internal-error"),e.open({where:document.body,url:function(e){var t=e.config;gi(t.authDomain,e,"auth-domain-config-required");var n=t.emulator?Ii(t,jo):`https://${e.config.authDomain}/${Bo}`;const r={apiKey:t.apiKey,appName:e.name,v:Je};(t=$o.get(e.config.apiHost))&&(r.eid=t);const i=e._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${z(r).slice(1)}`}(a),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:zo,dontclear:!0},s=>new Promise(async(e,t)=>{await s.restyle({setHideOnLeave:!1});const n=hi(a,"network-request-failed"),r=Ua().setTimeout(()=>{t(n)},qo.get());function i(){Ua().clearTimeout(r),e(s)}s.ping(i).then(i,()=>{t(n)})}))}const Wo={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Go{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function Ho(e,t,n,r=500,i=600){var s=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let o="";const c=Object.assign(Object.assign({},Wo),{width:r.toString(),height:i.toString(),top:s,left:a});s=b().toLowerCase();n&&(o=ts(s)?"_blank":n),Zi(s)&&(t=t||"http://localhost",c.scrollbars="yes");var l,a=Object.entries(c).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if([n=b()]=[s],as(n)&&null!==(l=window.navigator)&&void 0!==l&&l.standalone&&"_self"!==o)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",o),new Go(null);const u=window.open(t||"",o,a);gi(u,e,"popup-blocked");try{u.focus()}catch(e){}return new Go(u)}const Qo="__/auth/handler",Yo="emulator/auth/handler",Jo=encodeURIComponent("fac");async function Xo(e,t,n,r,i,s){gi(e.config.authDomain,e,"auth-domain-config-required"),gi(e.config.apiKey,e,"invalid-api-key");const a={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:Je,eventId:i};if(t instanceof Ls){t.setDefaultLanguage(e.languageCode),a.providerId=t.providerId||"",V(t.getCustomParameters())||(a.customParameters=JSON.stringify(t.getCustomParameters()));for(var[o,c]of Object.entries(s||{}))a[o]=c}if(t instanceof Fs){const h=t.getScopes().filter(e=>""!==e);0<h.length&&(a.scopes=h.join(","))}e.tenantId&&(a.tid=e.tenantId);const l=a;for(const d of Object.keys(l))void 0===l[d]&&delete l[d];var u=await e._getAppCheckToken(),u=u?`#${Jo}=${encodeURIComponent(u)}`:"";return`${e=[e["config"]][0],e.emulator?Ii(e,Yo):`https://${e.authDomain}/${Qo}`}?${z(l).slice(1)}${u}`}const Zo="webStorageSupport";const ec=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Oa,this._completeRedirectFn=ko,this._overrideRedirectResult=bo}async _openPopup(e,t,n,r){var i;return vi(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()"),Ho(e,await Xo(e,t,n,_i(),r),La())}async _openRedirect(e,t,n,r){await this._originValidation(e);var i=await Xo(e,t,n,_i(),r);return Ua().location.href=i,new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:r,promise:n}=this.eventManagers[t];return r?Promise.resolve(r):(vi(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(t){const e=await Ko(t),n=new No(t);return e.register("authEvent",e=>{return gi(null==e?void 0:e.authEvent,t,"invalid-auth-event"),{status:n.onEvent(e.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:n},this.iframes[t._key()]=e,n}_isIframeWebStorageSupported(n,r){const e=this.iframes[n._key()];e.send(Zo,{type:Zo},e=>{var t=null===(t=null==e?void 0:e[0])||void 0===t?void 0:t[Zo];void 0!==t&&r(!!t),ui(n,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){var t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Mo(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return os()||es()||as()}};class tc extends class{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return mi("unexpected MultiFactorSessionType")}}}{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new tc(e)}_finalizeEnroll(e,t,n){return e=e,n={idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()},ki(e,"POST","/v2/accounts/mfaEnrollment:finalize",Si(e,n))}_finalizeSignIn(e,t){return e=e,t={mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()},ki(e,"POST","/v2/accounts/mfaSignIn:finalize",Si(e,t))}}class nc{constructor(){}static assertion(e){return tc._fromCredential(e)}}nc.FACTOR_ID="phone";var rc="@firebase/auth";class ic{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(t){var e;this.assertAuthConfigured(),this.internalListeners.has(t)||(e=this.auth.onIdTokenChanged(e=>{t((null==e?void 0:e.stsTokenManager.accessToken)||null)}),this.internalListeners.set(t,e),this.updateProactiveRefresh())}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){gi(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){0<this.internalListeners.size?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}var sc,ac,oc;function cc(){return window}sc="authIdTokenMaxAge",null===(ac=p())||void 0===ac||ac[`_${sc}`],oc="Browser",Ge(new ce("auth",(e,{options:t})=>{var n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal");const{apiKey:s,authDomain:a}=n.options;gi(s&&!s.includes(":"),"invalid-api-key",{appName:n.name});var o={apiKey:s,authDomain:a,clientPlatform:oc,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:cs(oc)},o=new hs(n,r,i,o);return function(e,t){const n=(null==t?void 0:t.persistence)||[];var r=(Array.isArray(n)?n:[n]).map(Gi);null!=t&&t.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(o,t),o},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{const r=e.getProvider("auth-internal");r.initialize()})),Ge(new ce("auth-internal",e=>{var t=ds(e.getProvider("auth").getImmediate());return e=t,new ic(e)},"PRIVATE").setInstantiationMode("EXPLICIT")),tt(rc,"1.5.1",function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(oc)),tt(rc,"1.5.1","esm2017");async function lc(e,t,n){var r=cc()["BuildInfo"];vi(t.sessionId,"AuthEvent did not contain a session ID");var i=await async function(e){const t=function(e){if(vi(/[0-9a-zA-Z]+/.test(e),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e);const t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n}(e),n=await crypto.subtle.digest("SHA-256",t),r=Array.from(new Uint8Array(n));return r.map(e=>e.toString(16).padStart(2,"0")).join("")}(t.sessionId);const s={};return as()?s.ibi=r.packageName:rs()?s.apn=r.packageName:ui(e,"operation-not-supported-in-this-environment"),r.displayName&&(s.appDisplayName=r.displayName),s.sessionId=i,Xo(e,n,t.type,void 0,null!==(i=t.eventId)&&void 0!==i?i:void 0,s)}function uc(r){const i=cc()["cordova"];return new Promise(n=>{i.plugins.browsertab.isAvailable(e=>{let t=null;e?i.plugins.browsertab.openUrl(r):t=i.InAppBrowser.open(r,(e=b(),/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)?"_blank":"_system"),"location=yes"),n(t)})})}const hc=20;class dc extends No{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(e=>{this.resolveInialized=e})}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(t){return this.resolveInialized(),this.passiveListeners.forEach(e=>e(t)),super.onEvent(t)}async initialized(){await this.initPromise}}function pc(e,t,n=null){return{type:t,eventId:n,urlResponse:null,sessionId:function(){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<hc;r++){var n=Math.floor(Math.random()*t.length);e.push(t.charAt(n))}return e.join("")}(),postBody:null,tenantId:e.tenantId,error:hi(e,"no-auth-event")}}async function fc(e){var t=await mc()._get(vc(e));return t&&await mc()._remove(vc(e)),t}function gc(e,t){var n,r,i;const s=(n=_c(t=t),a=n.link?decodeURIComponent(n.link):void 0,r=_c(a).link,i=n.deep_link_id?decodeURIComponent(n.deep_link_id):void 0,(n=_c(i).link)||i||r||a||t);if(s.includes("/__/auth/callback")){var a=_c(s),a=a.firebaseError?function(e){try{return JSON.parse(e)}catch(e){return null}}(decodeURIComponent(a.firebaseError)):null,a=null===(a=null===(a=null==a?void 0:a.code)||void 0===a?void 0:a.split("auth/"))||void 0===a?void 0:a[1],a=a?hi(a):null;return a?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:a,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:s,postBody:null}}return null}function mc(){return Gi(Da)}function vc(e){return Yi("authEvent",e.config.apiKey,e.name)}function _c(e){if(null==e||!e.includes("?"))return{};const[,...t]=e.split("?");return $(t.join("?"))}const yc=class{constructor(){this._redirectPersistence=Oa,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=ko,this._overrideRedirectResult=bo}async _initialize(e){var t=e._key();let n=this.eventManagers.get(t);return n||(n=new dc(e),this.eventManagers.set(t,n),this.attachCallbackListeners(e,n)),n}_openPopup(e){ui(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,n,r){var i,s;i=e,o=cc(),gi("function"==typeof(null===(s=null==o?void 0:o.universalLinks)||void 0===s?void 0:s.subscribe),i,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),gi(void 0!==(null===(s=null==o?void 0:o.BuildInfo)||void 0===s?void 0:s.packageName),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),gi("function"==typeof(null===(s=null===(s=null===(s=null==o?void 0:o.cordova)||void 0===s?void 0:s.plugins)||void 0===s?void 0:s.browsertab)||void 0===s?void 0:s.openUrl),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),gi("function"==typeof(null===(s=null===(s=null===(s=null==o?void 0:o.cordova)||void 0===s?void 0:s.plugins)||void 0===s?void 0:s.browsertab)||void 0===s?void 0:s.isAvailable),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),gi("function"==typeof(null===(o=null===(o=null==o?void 0:o.cordova)||void 0===o?void 0:o.InAppBrowser)||void 0===o?void 0:o.open),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"});const a=await this._initialize(e);await a.initialized(),a.resetRedirect(),_o.clear(),await this._originValidation(e);var o=pc(e,n,r);n=e,r=o,await mc()._set(vc(n),r);o=await uc(await lc(e,o,t));return async function(a,o,c){const l=cc()["cordova"];let u=()=>{};try{await new Promise((n,e)=>{let t=null;function r(){var e;n();const t=null===(e=l.plugins.browsertab)||void 0===e?void 0:e.close;"function"==typeof t&&t(),"function"==typeof(null==c?void 0:c.close)&&c.close()}function i(){t=t||window.setTimeout(()=>{e(hi(a,"redirect-cancelled-by-user"))},2e3)}function s(){"visible"===(null===document||void 0===document?void 0:document.visibilityState)&&i()}o.addPassiveListener(r),document.addEventListener("resume",i,!1),rs()&&document.addEventListener("visibilitychange",s,!1),u=()=>{o.removePassiveListener(r),document.removeEventListener("resume",i,!1),document.removeEventListener("visibilitychange",s,!1),t&&window.clearTimeout(t)}})}finally{u()}}(e,a,o)}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){var t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){var t=cc()["BuildInfo"];const n={};as()?n.iosBundleId=t.packageName:rs()?n.androidPackageName=t.packageName:ui(e,"operation-not-supported-in-this-environment"),await Do(e,n)}(e)),this.originValidationPromises[t]}attachCallbackListeners(r,i){const{universalLinks:e,handleOpenURL:t,BuildInfo:n}=cc(),s=setTimeout(async()=>{await fc(r),i.onEvent(wc())},500),a=async e=>{clearTimeout(s);var t=await fc(r);let n=null;t&&null!=e&&e.url&&(n=gc(t,e.url)),i.onEvent(n||wc())};void 0!==e&&"function"==typeof e.subscribe&&e.subscribe(null,a);const o=t,c=`${n.packageName.toLowerCase()}://`;cc().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(c)&&a({url:e}),"function"==typeof o)try{o(e)}catch(e){console.error(e)}}}};function wc(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:hi("no-auth-event")}}var bc;function Ic(){var e;return(null===(e=null===self||void 0===self?void 0:self.location)||void 0===e?void 0:e.protocol)||null}function Tc(e=b()){return!("file:"!==Ic()&&"ionic:"!==Ic()&&"capacitor:"!==Ic()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function Ec(e=b()){return S()&&11===(null===document||void 0===document?void 0:document.documentMode)||([e=b()]=[e],/Edge\/\d+/.test(e))}function Cc(){try{const t=self.localStorage;var e=La();if(t)return t.setItem(e,"1"),t.removeItem(e),!Ec()||A()}catch(e){return Sc()&&A()}return!1}function Sc(){return"undefined"!=typeof global&&"WorkerGlobalScope"in global&&"importScripts"in global}function kc(){return("http:"===Ic()||"https:"===Ic()||E()||Tc())&&!(C()||T())&&Cc()&&!Sc()}function Ac(){return Tc()&&"undefined"!=typeof document}const Nc={LOCAL:"local",NONE:"none",SESSION:"session"},Rc=gi,Pc="persistence";async function Dc(e){await e._initializationPromise;const t=xc();var n=Yi(Pc,e.config.apiKey,e.name);t&&t.setItem(n,e._getPersistence())}function xc(){var e;try{return(null===(e="undefined"!=typeof window?window:null)?void 0:e.sessionStorage)||null}catch(e){return null}}const Oc=gi;class Mc{constructor(){this.browserResolver=Gi(ec),this.cordovaResolver=Gi(yc),this.underlyingResolver=null,this._redirectPersistence=Oa,this._completeRedirectFn=ko,this._overrideRedirectResult=bo}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,n,r)}async _openRedirect(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,n,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return Ac()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return Oc(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){var e;this.underlyingResolver||(e=await(!!Ac()&&new Promise(e=>{const t=setTimeout(()=>{e(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(t),e(!0)})})),this.underlyingResolver=e?this.cordovaResolver:this.browserResolver)}}function Lc(e){return e.unwrap()}function Fc(e,t){var n,r,i,s=null===(r=t.customData)||void 0===r?void 0:r._tokenResponse;if("auth/multi-factor-auth-required"===(null==t?void 0:t.code)){const o=t;o.resolver=new Bc(e,(n=t,i=oe(e),gi((a=n).customData.operationType,i,"argument-error"),gi(null===(r=a.customData._serverResponse)||void 0===r?void 0:r.mfaPendingCredential,i,"argument-error"),Sa._fromError(i,a)))}else if(s){var a=Uc(t);const c=t;a&&(c.credential=a,c.tenantId=s.tenantId||void 0,c.email=s.email||void 0,c.phoneNumber=s.phoneNumber||void 0)}}function Uc(e){var t=(e instanceof P?e.customData:e)["_tokenResponse"];if(!t)return null;if(!(e instanceof P)&&"temporaryProof"in t&&"phoneNumber"in t)return oo.credentialFromResult(e);const n=t.providerId;if(!n||n===ni.PASSWORD)return null;let r;switch(n){case ni.GOOGLE:r=qs;break;case ni.FACEBOOK:r=Vs;break;case ni.GITHUB:r=Bs;break;case ni.TWITTER:r=$s;break;default:var{oauthIdToken:i,oauthAccessToken:s,oauthTokenSecret:a,pendingToken:o,nonce:c}=t;return s||a||i||o?o?n.startsWith("saml.")?js._create(n,o):Ps._fromParams({providerId:n,signInMethod:n,pendingToken:o,idToken:i,accessToken:s}):new Us(n).credential({idToken:i,accessToken:s,rawNonce:c}):null}return e instanceof P?r.credentialFromError(e):r.credentialFromResult(e)}function Vc(t,e){return e.catch(e=>{throw e instanceof P&&Fc(t,e),e}).then(e=>{var t=e.operationType,n=e.user;return{operationType:t,credential:Uc(e),additionalUserInfo:Ea(e),user:jc.getOrCreate(n)}})}async function qc(t,e){const n=await e;return{verificationId:n.verificationId,confirm:e=>Vc(t,n.confirm(e))}}class Bc{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return Vc(Lc(this.auth),this.resolver.resolveSignIn(e))}}class jc{constructor(e){var t;this._delegate=e,this.multiFactor=(t=oe(e),Aa.has(t)||Aa.set(t,ka._fromUser(t)),Aa.get(t))}static getOrCreate(e){return jc.USER_MAP.has(e)||jc.USER_MAP.set(e,new jc(e)),jc.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return Vc(this.auth,ra(this._delegate,e))}async linkWithPhoneNumber(e,t){return qc(this.auth,async function(e,t,n){const r=oe(e);await Zs(!1,r,"phone");var i=await ao(r.auth,t,oe(n));return new so(i,e=>ra(r,e))}(this._delegate,e,t))}async linkWithPopup(e){return Vc(this.auth,async function(e,t,n){var r=oe(e);pi(r.auth,t,Ls);var i=co(r.auth,n);const s=new mo(r.auth,"linkViaPopup",t,i,r);return s.executeNotNull()}(this._delegate,e,Mc))}async linkWithRedirect(e){return await Dc(ds(this.auth)),So(this._delegate,e,Mc)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return Vc(this.auth,ia(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return qc(this.auth,async function(e,t,n){const r=oe(e);var i=await ao(r.auth,t,oe(n));return new so(i,e=>ia(r,e))}(this._delegate,e,t))}reauthenticateWithPopup(e){return Vc(this.auth,async function(e,t,n){var r=oe(e);pi(r.auth,t,Ls);var i=co(r.auth,n);const s=new mo(r.auth,"reauthViaPopup",t,i,r);return s.executeNotNull()}(this._delegate,e,Mc))}async reauthenticateWithRedirect(e){return await Dc(ds(this.auth)),Co(this._delegate,e,Mc)}sendEmailVerification(e){return fa(this._delegate,e)}async unlink(e){return await Js(this._delegate,e),this}updateEmail(e){return va(oe(this._delegate),e,null)}updatePassword(e){return va(oe(this._delegate),null,e)}updatePhoneNumber(e){return async function(e,t){await Xs(oe(e),t)}(this._delegate,e)}updateProfile(e){return ma(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return ga(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}jc.USER_MAP=new WeakMap;const zc=gi;class $c{constructor(e,t){if(this.app=e,t.isInitialized())return this._delegate=t.getImmediate(),void this.linkUnderlyingAuth();var n=e.options["apiKey"];zc(n,"invalid-api-key",{appName:e.name}),zc(n,"invalid-api-key",{appName:e.name});var r="undefined"!=typeof window?Mc:void 0;this._delegate=t.initialize({options:{persistence:function(e,t){const n=function(e,t){const n=xc();if(!n)return[];var r=Yi(Pc,e,t);switch(n.getItem(r)){case Nc.NONE:return[Qi];case Nc.LOCAL:return[Qa,Oa];case Nc.SESSION:return[Oa];default:return[]}}(e,t);"undefined"==typeof self||n.includes(Qa)||n.push(Qa);if("undefined"!=typeof window)for(const r of[Da,Oa])n.includes(r)||n.push(r);n.includes(Qi)||n.push(Qi);return n}(n,e.name),popupRedirectResolver:r}}),this._delegate._updateErrorMap(si),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?jc.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){ys(this._delegate,e,t)}applyActionCode(e){return ha(this._delegate,e)}checkActionCode(e){return da(this._delegate,e)}confirmPasswordReset(e,t){return async function(t,e,n){await Ts(oe(t),{oobCode:e,newPassword:n}).catch(async e=>{throw"auth/password-does-not-meet-requirements"===e.code&&ua(t),e})}(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return Vc(this._delegate,async function(t,e,n){const r=ds(t),i=_s(r,{returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Ks);var s=await i.catch(e=>{throw"auth/password-does-not-meet-requirements"===e.code&&ua(t),e}),s=await Ws._fromIdTokenResponse(r,"signIn",s);return await r._updateCurrentUser(s.user),s}(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return pa(this._delegate,e)}isSignInWithEmailLink(e){return this._delegate,e=e,"EMAIL_SIGNIN"===(null==(t=Os.parseLink(e))?void 0:t.operation);var t}async getRedirectResult(){zc(kc(),this._delegate,"operation-not-supported-in-this-environment");var e,t,n=(e=this._delegate,t=Mc,await ds(e)._initializationPromise,await ko(e,t,!1));return n?Vc(this._delegate,Promise.resolve(n)):{credential:null,user:null}}addFrameworkForLogging(e){ds(this._delegate)._logFramework(e)}onAuthStateChanged(e,t,n){var{next:r,error:i,complete:s}=Kc(e,t,n);return this._delegate.onAuthStateChanged(r,i,s)}onIdTokenChanged(e,t,n){var{next:r,error:i,complete:s}=Kc(e,t,n);return this._delegate.onIdTokenChanged(r,i,s)}sendSignInLinkToEmail(e,t){return async function(e,t,n){const r=ds(e);var i={requestType:"EMAIL_SIGNIN",email:t,clientType:"CLIENT_TYPE_WEB"};t=i,gi((n=n).handleCodeInApp,r,"argument-error"),n&&la(r,t,n),await _s(r,i,"getOobCode",As)}(this._delegate,e,t)}sendPasswordResetEmail(e,t){return async function(e,t,n){var r=ds(e),i={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};n&&la(r,i,n),await _s(r,i,"getOobCode",ks)}(this._delegate,e,t||void 0)}async setPersistence(e){var t,n;t=this._delegate,n=e,Rc(Object.values(Nc).includes(n),t,"invalid-persistence-type"),C()?Rc(n!==Nc.SESSION,t,"unsupported-persistence-type"):T()?Rc(n===Nc.NONE,t,"unsupported-persistence-type"):Sc()?Rc(n===Nc.NONE||n===Nc.LOCAL&&A(),t,"unsupported-persistence-type"):Rc(n===Nc.NONE||Cc(),t,"unsupported-persistence-type");let r;switch(e){case Nc.SESSION:r=Oa;break;case Nc.LOCAL:var i=await Gi(Qa)._isAvailable();r=i?Qa:Da;break;case Nc.NONE:r=Qi;break;default:return ui("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(r)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return Vc(this._delegate,async function(e){const t=ds(e);if(await t._initializationPromise,null!==(n=t.currentUser)&&void 0!==n&&n.isAnonymous)return new Ws({user:t.currentUser,providerId:null,operationType:"signIn"});var n=await Ks(t,{returnSecureToken:!0}),n=await Ws._fromIdTokenResponse(t,"signIn",n,!0);return await t._updateCurrentUser(n.user),n}(this._delegate))}signInWithCredential(e){return Vc(this._delegate,na(this._delegate,e))}signInWithCustomToken(e){return Vc(this._delegate,sa(this._delegate,e))}signInWithEmailAndPassword(e,t){return Vc(this._delegate,(n=this._delegate,e=e,t=t,na(oe(n),Ms.credential(e,t)).catch(async e=>{throw"auth/password-does-not-meet-requirements"===e.code&&ua(n),e})));var n}signInWithEmailLink(e,t){return Vc(this._delegate,async function(e,t,n){var r=oe(e),i=Ms.credentialWithLink(t,n||_i());return gi(i._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),na(r,i)}(this._delegate,e,t))}signInWithPhoneNumber(e,t){return qc(this._delegate,async function(e,t,n){const r=ds(e);var i=await ao(r,t,oe(n));return new so(i,e=>na(r,e))}(this._delegate,e,t))}async signInWithPopup(e){return zc(kc(),this._delegate,"operation-not-supported-in-this-environment"),Vc(this._delegate,async function(e,t,n){var r=ds(e);pi(e,t,Ls);var i=co(r,n);const s=new mo(r,"signInViaPopup",t,i);return s.executeNotNull()}(this._delegate,e,Mc))}async signInWithRedirect(e){return zc(kc(),this._delegate,"operation-not-supported-in-this-environment"),await Dc(this._delegate),Eo(this._delegate,e,Mc)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return async function(e,t){var n=(await da(oe(e),t))["data"];return n.email}(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function Kc(e,t,n){let r=e;"function"!=typeof e&&({next:r,error:t,complete:n}=e);const i=r;return{next:e=>i(e&&jc.getOrCreate(e)),error:t,complete:n}}$c.Persistence=Nc;class Wc{constructor(){this.providerId="phone",this._delegate=new oo(Lc(bt.auth()))}static credential(e,t){return oo.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}Wc.PHONE_SIGN_IN_METHOD=oo.PHONE_SIGN_IN_METHOD,Wc.PROVIDER_ID=oo.PROVIDER_ID;const Gc=gi;class Hc{constructor(e,t,n=bt.app()){var r;Gc(null===(r=n.options)||void 0===r?void 0:r.apiKey,"invalid-api-key",{appName:n.name}),this._delegate=new io(n.auth(),e,t),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}(bc=bt).INTERNAL.registerComponent(new ce("auth-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("auth");return new $c(t,n)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:ri.EMAIL_SIGNIN,PASSWORD_RESET:ri.PASSWORD_RESET,RECOVER_EMAIL:ri.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:ri.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:ri.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:ri.VERIFY_EMAIL}},EmailAuthProvider:Ms,FacebookAuthProvider:Vs,GithubAuthProvider:Bs,GoogleAuthProvider:qs,OAuthProvider:Us,SAMLAuthProvider:zs,PhoneAuthProvider:Wc,PhoneMultiFactorGenerator:nc,RecaptchaVerifier:Hc,TwitterAuthProvider:$s,Auth:$c,AuthCredential:Is,Error:P}).setInstantiationMode("LAZY").setMultipleInstances(!1)),bc.registerVersion("@firebase/auth-compat","0.5.1");const Qc="@firebase/database";let Yc="";function Jc(e){Yc=e}class Xc{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),M(t))}get(e){var t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:O(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class Zc{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return F(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}var el,tl,nl,rl,il,sl,al=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new Xc(t)}}catch(e){}return new Zc};function ol(e){var t=function(t){const n=[];let r=0;for(let a=0;a<t.length;a++){let e=t.charCodeAt(a);var i,s;55296<=e&&e<=56319&&(i=e-55296,a++,f(a<t.length,"Surrogate pair missing trail surrogate."),s=t.charCodeAt(a)-56320,e=65536+(i<<10)+s),e<128?n[r++]=e:(e<2048?n[r++]=e>>6|192:(e<65536?n[r++]=e>>12|224:(n[r++]=e>>18|240,n[r++]=e>>12&63|128),n[r++]=e>>6&63|128),n[r++]=63&e|128)}return n}(e);const n=new W;return n.update(t),t=n.digest(),r.encodeByteArray(t)}const cl=al("localStorage"),ll=al("sessionStorage"),ul=new ve("@firebase/database"),hl=function(){let e=1;return function(){return e++}}(),dl=function(...e){let t="";for(let r=0;r<e.length;r++){var n=e[r];Array.isArray(n)||n&&"object"==typeof n&&"number"==typeof n.length?t+=dl.apply(null,n):t+="object"==typeof n?M(n):n,t+=" "}return t};let pl=null,fl=!0;function gl(t){return function(...e){Il(t,...e)}}function ml(...e){var t="FIREBASE INTERNAL ERROR: "+dl(...e);ul.error(t)}function vl(e,t){return e===t?0:e<t?-1:1}function _l(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+M(t))}function yl(e){if("object"!=typeof e||null===e)return M(e);const t=[];for(const r in e)t.push(r);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=M(t[i]),n+=":",n+=yl(e[t[i]]);return n+="}",n}function wl(e,t){var n=e.length;if(n<=t)return[e];const r=[];for(let i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r}const bl=function(e,t){f(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(ul.logLevel=m.VERBOSE,pl=ul.log.bind(ul),t&&ll.set("logging_enabled",!0)):"function"==typeof e?pl=e:(pl=null,ll.remove("logging_enabled"))},Il=function(...e){var t;!0===fl&&(fl=!1,null===pl&&!0===ll.get("logging_enabled")&&bl(!0)),pl&&(t=dl.apply(null,e),pl(t))},Tl=function(...e){var t=`FIREBASE FATAL ERROR: ${dl(...e)}`;throw ul.error(t),new Error(t)},El=function(...e){var t="FIREBASE WARNING: "+dl(...e);ul.warn(t)},Cl=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&El("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Sl=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},kl="[MIN_NAME]",Al="[MAX_NAME]",Nl=function(e,t){if(e===t)return 0;if(e===kl||t===Al)return-1;if(t===kl||e===Al)return 1;var n=Dl(e),r=Dl(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null===r&&e<t?-1:1};function Rl(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}function Pl(e){f(!Sl(e),"Invalid JSON number");let t,n,r,i,s;0===e?(n=0,r=0,t=1/e==-1/0?1:0):(t=e<0,e=Math.abs(e),r=e>=Math.pow(2,-1022)?(i=Math.min(Math.floor(Math.log(e)/Math.LN2),1023),n=i+1023,Math.round(e*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,Math.round(e/Math.pow(2,-1074))));const a=[];for(s=52;s;--s)a.push(r%2?1:0),r=Math.floor(r/2);for(s=11;s;--s)a.push(n%2?1:0),n=Math.floor(n/2);a.push(t?1:0),a.reverse();const o=a.join("");let c="";for(s=0;s<64;s+=8){let e=parseInt(o.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),c+=e}return c.toLowerCase()}function Dl(e){if(Ol.test(e)){var t=Number(e);if(t>=Ml&&t<=Ll)return t}return null}function xl(e,t){const n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n}const Ol=new RegExp("^-?(0*)\\d{1,10}$"),Ml=-2147483648,Ll=2147483647,Fl=function(e){try{e()}catch(t){setTimeout(()=>{var e=t.stack||"";throw El("Exception was thrown by user callback.",e),t},Math.floor(0))}};class Ul{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null!=t&&t.get().then(e=>this.appCheck=e)}getToken(n){return this.appCheck?this.appCheck.getToken(n):new Promise((e,t)=>{setTimeout(()=>{this.appCheck?this.getToken(n).then(e,t):e(null)},0)})}addTokenChangeListener(t){var e;null!==(e=this.appCheckProvider)&&void 0!==e&&e.get().then(e=>e.addTokenListener(t))}notifyForInvalidToken(){El(`Provided AppCheck credentials for the app named "${this.appName_}" `+"are invalid. This usually indicates your app was not initialized correctly.")}}class Vl{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(n){return this.auth_?this.auth_.getToken(n).catch(e=>e&&"auth/token-not-initialized"===e.code?(Il("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((e,t)=>{setTimeout(()=>{this.auth_?this.getToken(n).then(e,t):e(null)},0)})}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then(e=>e.addAuthTokenListener(t))}removeTokenChangeListener(t){this.authProvider_.get().then(e=>e.removeAuthTokenListener(t))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',El(e)}}class ql{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}ql.OWNER="owner";const Bl=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,jl="websocket",zl="long_polling";class $l{constructor(e,t,n,r,i=!1,s="",a=!1,o=!1){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=o,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=cl.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&cl.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){var e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Kl(e,t,n){f("string"==typeof t,"typeof type must == string"),f("object"==typeof n,"typeof params must == object");let r;if(t===jl)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==zl)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}((t=e).host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams)&&(n.ns=e.namespace);const i=[];return Rl(n,(e,t)=>{i.push(e+"="+t)}),r+i.join("&")}class Wl{constructor(){this.counters_={}}incrementCounter(e,t=1){F(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return c(void 0,this.counters_)}}const Gl={},Hl={};function Ql(e){var t=e.toString();return Gl[t]||(Gl[t]=new Wl),Gl[t]}class Yl{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const n=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let e=0;e<n.length;++e)n[e]&&Fl(()=>{this.onMessage_(n[e])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}class Jl{constructor(e,t,n,r,i,s,a){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=s,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=gl(e),this.stats_=Ql(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),Kl(t,zl,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Yl(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(t){if("complete"===document.readyState)t();else{let e=!1;const n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(()=>{if(!this.isClosed_){this.scriptTagHolder=new Xl((...e)=>{var[t,n,r]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===t)this.id=n,this.password=r;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_()}},(...e)=>{var[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);const t={start:"t"};t.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=this.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",this.transportSessionId&&(t.s=this.transportSessionId),this.lastSessionId&&(t.ls=this.lastSessionId),this.applicationId&&(t.p=this.applicationId),this.appCheckToken&&(t.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&Bl.test(location.hostname)&&(t.r="f");var e=this.urlFn(t);this.log_("Connecting via long-poll to "+e),this.scriptTagHolder.addTag(e,()=>{})}})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Jl.forceAllow_=!0}static forceDisallow(){Jl.forceDisallow_=!0}static isAvailable(){return!!Jl.forceAllow_||!(Jl.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){var t=M(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var t=i(t),n=wl(t,1840);for(let r=0;r<n.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){var t=M(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Xl{constructor(t,n,e,r){this.onDisconnect=e,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=hl(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=n,this.myIFrame=Xl.createIFrame_();let e="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(i=document.domain,e='<script>document.domain="'+i+'";<\/script>');var i="<html><body>"+e+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(e){Il("frame writing exception"),e.stack&&Il(e.stack),Il(e)}}}static createIFrame_(){const t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||Il("No IE domain setting required")}catch(e){var n=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(0<this.pendingSegs.length?2:1)){this.currentSerial++;const i={};i.id=this.myID,i.pw=this.myPW,i.ser=this.currentSerial;var n=this.urlFn(i);let e="",t=0;for(;0<this.pendingSegs.length;){if(!(this.pendingSegs[0].d.length+30+e.length<=1870))break;var r=this.pendingSegs.shift();e=e+"&seg"+t+"="+r.seg+"&ts"+t+"="+r.ts+"&d"+t+"="+r.d,t++}return n+=e,this.addLongPollTag_(n,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(r),n()})}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const t=this.myIFrame.doc.createElement("script");t.type="text/javascript",t.async=!0,t.src=e,t.onload=t.onreadystatechange=function(){var e=t.readyState;e&&"loaded"!==e&&"complete"!==e||(t.onload=t.onreadystatechange=null,t.parentNode&&t.parentNode.removeChild(t),n())},t.onerror=()=>{Il("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(t)}catch(e){}},Math.floor(1))}}let Zl=null;"undefined"!=typeof MozWebSocket?Zl=MozWebSocket:"undefined"!=typeof WebSocket&&(Zl=WebSocket);class eu{constructor(e,t,n,r,i,s,a){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=gl(this.connId),this.stats_=Ql(t),this.connURL=eu.connectionURL_(t,s,a,r,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r,i){const s={v:"5"};return"undefined"!=typeof location&&location.hostname&&Bl.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),r&&(s.ac=r),i&&(s.p=i),Kl(e,jl,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,cl.set("previous_websocket_failure",!0);try{k(),this.mySock=new Zl(this.connURL,[],void 0)}catch(e){this.log_("Error instantiating WebSocket.");var n=e.message||e.data;return n&&this.log_(n),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");var t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){eu.forceDisallow_=!0}static isAvailable(){let e=!1;var t;return"undefined"==typeof navigator||!navigator.userAgent||(t=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/))&&1<t.length&&parseFloat(t[1])<4.4&&(e=!0),!e&&null!==Zl&&!eu.forceDisallow_}static previouslyFailed(){return cl.isInMemoryStorage||!0===cl.get("previous_websocket_failure")}markConnectionHealthy(){cl.remove("previous_websocket_failure")}appendFrame_(e){var t;this.frames.push(e),this.frames.length===this.totalFrames&&(t=this.frames.join(""),this.frames=null,t=O(t),this.onMessage(t))}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(f(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){var t;null!==this.mySock&&(t=e.data,this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames?this.appendFrame_(t):null!==(t=this.extractFrameCount_(t))&&this.appendFrame_(t))}send(e){this.resetKeepAlive();var t=M(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var n=wl(t,16384);1<n.length&&this.sendString_(String(n.length));for(let r=0;r<n.length;r++)this.sendString_(n[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}eu.responsesRequiredToBeHealthy=2,eu.healthyTimeout=3e4;class tu{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Jl,eu]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){var t=eu&&eu.isAvailable();let n=t&&!eu.previouslyFailed();if(e.webSocketOnly&&(t||El("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[eu];else{const r=this.transports_=[];for(const i of tu.ALL_TRANSPORTS)i&&i.isAvailable()&&r.push(i);tu.globalTransportInitialized_=!0}}initialTransport(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return 1<this.transports_.length?this.transports_[1]:null}}tu.globalTransportInitialized_=!1;class nu{constructor(e,t,n,r,i,s,a,o,c,l){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=s,this.onReady_=a,this.onDisconnect_=o,this.onKill_=c,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=gl("c:"+this.id+":"),this.transportManager_=new tu(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));var r=e.healthyTimeout||0;0<r&&(this.healthyTimeout_=xl(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&102400<this.conn_.bytesReceived?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&10240<this.conn_.bytesSent?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{2!==this.state_&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){var t;"t"in e&&("a"===(t=e.t)?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_()))}onSecondaryMessageReceived_(e){var t=_l("t",e),n=_l("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){var t=_l("t",e),n=_l("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){var t=_l("t",e);if("d"in e){var n=e.d;if("h"===t){const r=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?ml("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):ml("Unknown control packet command: "+t)}}onHandshake_(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&El("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),xl(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):xl(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(cl.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class ru{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class iu{constructor(e){this.allowedEvents_=e,this.listeners_={},f(Array.isArray(e)&&0<e.length,"Requires a non-empty array")}trigger(t,...n){if(Array.isArray(this.listeners_[t])){const r=[...this.listeners_[t]];for(let e=0;e<r.length;e++)r[e].callback.apply(r[e].context,n)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});var r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)}validateEventType_(t){f(this.allowedEvents_.find(e=>e===t),"Unknown event: "+t)}}class su extends iu{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||I()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new su}getInitialEvent(e){return f("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class au{constructor(n,e){if(void 0===e){this.pieces_=n.split("/");let e=0;for(let t=0;t<this.pieces_.length;t++)0<this.pieces_[t].length&&(this.pieces_[e]=this.pieces_[t],e++);this.pieces_.length=e,this.pieceNum_=0}else this.pieces_=n,this.pieceNum_=e}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function ou(){return new au("")}function cu(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function lu(e){return e.pieces_.length-e.pieceNum_}function uu(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new au(e.pieces_,t)}function hu(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function du(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function pu(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new au(t,0)}function fu(e,t){const n=[];for(let i=e.pieceNum_;i<e.pieces_.length;i++)n.push(e.pieces_[i]);if(t instanceof au)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{var r=t.split("/");for(let e=0;e<r.length;e++)0<r[e].length&&n.push(r[e])}return new au(n,0)}function gu(e){return e.pieceNum_>=e.pieces_.length}function mu(e,t){var n=cu(e),r=cu(t);if(null===n)return t;if(n===r)return mu(uu(e),uu(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function vu(e,t){var n=du(e,0),r=du(t,0);for(let s=0;s<n.length&&s<r.length;s++){var i=Nl(n[s],r[s]);if(0!==i)return i}return n.length===r.length?0:n.length<r.length?-1:1}function _u(e,t){if(lu(e)!==lu(t))return!1;for(let n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function yu(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(lu(e)>lu(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}class wu{constructor(e,t){this.errorPrefix_=t,this.parts_=du(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=te(this.parts_[n]);bu(this)}}function bu(e){if(768<e.byteLength_)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(32<e.parts_.length)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+Iu(e))}function Iu(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class Tu extends iu{constructor(){super(["visible"]);let t,e;"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(e="visibilitychange",t="hidden"):void 0!==document.mozHidden?(e="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(e="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,()=>{var e=!document[t];e!==this.visible_&&(this.visible_=e,this.trigger("visible",e))},!1)}static getInstance(){return new Tu}getInitialEvent(e){return f("visible"===e,"Unknown event type: "+e),[this.visible_]}}class Eu extends ru{constructor(e,t,n,r,i,s,a,o){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=s,this.appCheckTokenProvider_=a,this.authOverride_=o,this.id=Eu.nextPersistentConnectionId_++,this.log_=gl("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,o&&!k())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Tu.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&su.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){var r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_(M(i)),f(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();const n=new y;var t={p:e._path.toString(),q:e._queryObject};this.outstandingGets_.push({action:"g",request:t,onComplete:e=>{var t=e.d;"ok"===e.s?n.resolve(t):n.reject(t)}}),this.outstandingGetCount_++;t=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(t),n.promise}listen(e,t,n,r){this.initConnection_();var i=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),f(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),f(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");var a={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(s).set(i,a),this.connected_&&this.sendListen_(a)}sendGet_(t){const n=this.outstandingGets_[t];this.sendRequest("g",n.request,e=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(e)})}sendListen_(r){const i=r.query,s=i._path.toString(),a=i._queryIdentifier;this.log_("Listen on "+s+" for "+a);const e={p:s};r.tag&&(e.q=i._queryObject,e.t=r.tag),e.h=r.hashFn(),this.sendRequest("q",e,e=>{var t=e.d,n=e.s;Eu.warnOnListenWarnings_(t,i),(this.listens.get(s)&&this.listens.get(s).get(a))===r&&(this.log_("listen response",e),"ok"!==n&&this.removeListen_(s,a),r.onComplete&&r.onComplete(n,t))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&F(e,"w")){const i=U(e,"w");var n,r;Array.isArray(i)&&~i.indexOf("no_index")&&(n='".indexOn": "'+t._queryParams.getIndex().toString()+'"',r=t._path.toString(),El("Using an unspecified index. Your data will be downloaded and "+`filtered on the client. Consider adding ${n} at `+`${r} to your security rules for better performance.`))}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){var t;(e&&40===e.length||(e=e,"object"==typeof(t=L(e).claims)&&!0===t.admin))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const r=this.authToken_;var e=function(e){const t=L(e),n=t.claims;return!!n&&"object"==typeof n&&n.hasOwnProperty("iat")}(r)?"auth":"gauth";const t={cred:r};null===this.authOverride_?t.noauth=!0:"object"==typeof this.authOverride_&&(t.authvar=this.authOverride_),this.sendRequest(e,t,e=>{var t=e.s,n=e.d||"error";this.authToken_===r&&("ok"===t?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(t,n))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{var t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){var n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),f(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);const i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){var i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,e=>{r&&setTimeout(()=>{r(e.s,e.d)},Math.floor(0))})}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();const s={p:t,d:n};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:r}),this.outstandingPutCount_++;var a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(t){const n=this.outstandingPuts_[t].action;var e=this.outstandingPuts_[t].request;const r=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,e,e=>{this.log_(n+" response",e),delete this.outstandingPuts_[t],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(e.s,e.d)})}reportStats(e){var t;this.connected_&&(this.log_("reportStats",t={c:e}),this.sendRequest("s",t,e=>{var t;"ok"!==e.s&&(t=e.d,this.log_("reportStats","Error sending stats: "+t))}))}onDataMessage_(e){if("r"in e){this.log_("from server: "+M(e));var t=e.r;const n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):ml("Unrecognized action received from server: "+M(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){f(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){var e;this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()&&(this.visible_?this.lastConnectionEstablishedTime_&&(3e4<(new Date).getTime()-this.lastConnectionEstablishedTime_&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime()),e=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-e),e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)),this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var e=this.onDataMessage_.bind(this),r=this.onReady_.bind(this);const u=this.onRealtimeDisconnect_.bind(this);var i=this.id+":"+Eu.nextConnectionId_++,s=this.lastSessionId;let t=!1,n=null;var a=function(){n?n.close():(t=!0,u())};this.realtime_={close:a,sendRequest:function(e){f(n,"sendRequest call when we're not connected not allowed."),n.sendRequest(e)}};var o=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{var[c,l]=await Promise.all([this.authTokenProvider_.getToken(o),this.appCheckTokenProvider_.getToken(o)]);t?Il("getToken() completed but was canceled"):(Il("getToken() completed. Creating connection."),this.authToken_=c&&c.accessToken,this.appCheckToken_=l&&l.token,n=new nu(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,r,u,e=>{El(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},s))}catch(e){this.log_("Failed to get token: "+e),t||(this.repoInfo_.nodeAdmin&&El(e),a())}}}interrupt(e){Il("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Il("Resuming connection for reason: "+e),delete this.interruptReasons_[e],V(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){var t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>yl(e)).join("$"):"default";const r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){var n=new au(e).toString();let r;if(this.listens.has(n)){const i=this.listens.get(n);r=i.get(t),i.delete(t),0===i.size&&this.listens.delete(n)}else r=void 0;return r}onAuthRevoked_(e,t){Il("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,3<=this.invalidAuthTokenCount_&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Il("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,3<=this.invalidAppCheckTokenCount_&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const n of t.values())this.sendListen_(n);for(let r=0;r<this.outstandingPuts_.length;r++)this.outstandingPuts_[r]&&this.sendPut_(r);for(;this.onDisconnectRequestQueue_.length;){var e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let i=0;i<this.outstandingGets_.length;i++)this.outstandingGets_[i]&&this.sendGet_(i)}sendConnectStats_(){const e={};e["sdk.js."+Yc.replace(/\./g,"-")]=1,I()?e["framework.cordova"]=1:C()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){var e=su.getInstance().currentlyOnline();return V(this.interruptReasons_)&&e}}Eu.nextPersistentConnectionId_=0,Eu.nextConnectionId_=0;class Cu{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Cu(e,t)}}class Su{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){var n=new Cu(kl,e),r=new Cu(kl,t);return 0!==this.compare(n,r)}minPost(){return Cu.MIN}}let ku;class Au extends Su{static get __EMPTY_NODE(){return ku}static set __EMPTY_NODE(e){ku=e}compare(e,t){return Nl(e.name,t.name)}isDefinedOn(e){throw u("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Cu.MIN}maxPost(){return new Cu(Al,ku)}makePost(e,t){return f("string"==typeof e,"KeyIndex indexValue must always be a string."),new Cu(e,ku)}toString(){return".key"}}const Nu=new Au;class Ru{constructor(e,t,n,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_.pop(),t;if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack_.length}peek(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Pu{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:Pu.RED,this.left=null!=r?r:xu.EMPTY_NODE,this.right=null!=i?i:xu.EMPTY_NODE}copy(e,t,n,r,i){return new Pu(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;var i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return xu.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,r;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return xu.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){var e=this.copy(null,null,Pu.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){var e=this.copy(null,null,Pu.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){var e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Pu.RED=!0,Pu.BLACK=!1;class Du{copy(e,t,n,r,i){return this}insert(e,t,n){return new Pu(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class xu{constructor(e,t=xu.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new xu(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Pu.BLACK,null,null))}remove(e){return new xu(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Pu.BLACK,null,null))}get(e){var t;let n=this.root_;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:0<t&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:0<t&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Ru(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Ru(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Ru(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Ru(this.root_,null,this.comparator_,!0,e)}}function Ou(e,t){return Nl(e.name,t.name)}function Mu(e,t){return Nl(e,t)}xu.EMPTY_NODE=new Du;let Lu;function Fu(e){return"number"==typeof e?"number:"+Pl(e):"string:"+e}function Uu(e){var t;e.isLeafNode()?(t=e.val(),f("string"==typeof t||"number"==typeof t||"object"==typeof t&&F(t,".sv"),"Priority must be a string or number.")):f(e===Lu||e.isEmpty(),"priority of unexpected type."),f(e===Lu||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")}let Vu;class qu{constructor(e,t=qu.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,f(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Uu(this.priorityNode_)}static set __childrenNodeConstructor(e){Vu=e}static get __childrenNodeConstructor(){return Vu}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new qu(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:qu.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return gu(e)?this:".priority"===cu(e)?this.priorityNode_:qu.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:qu.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){var n=cu(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(f(".priority"!==n||1===lu(e),".priority must be the last token in a path"),this.updateImmediateChild(n,qu.__childrenNodeConstructor.EMPTY_NODE.updateChild(uu(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Fu(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":",e+="number"==t?Pl(this.value_):this.value_,this.lazyHash_=ol(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===qu.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof qu.__childrenNodeConstructor?-1:(f(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){var t=typeof e.value_,n=typeof this.value_,r=qu.VALUE_TYPE_ORDER.indexOf(t),i=qu.VALUE_TYPE_ORDER.indexOf(n);return f(0<=r,"Unknown leaf type: "+t),f(0<=i,"Unknown leaf type: "+n),r===i?"object"==n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-r}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&(this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_))}}qu.VALUE_TYPE_ORDER=["object","boolean","number","string"];let Bu,ju;const zu=new class extends Su{compare(e,t){const n=e.node.getPriority();var r=t.node.getPriority(),r=n.compareTo(r);return 0===r?Nl(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Cu.MIN}maxPost(){return new Cu(Al,new qu("[PRIORITY-POST]",ju))}makePost(e,t){var n=Bu(e);return new Cu(t,new qu("[PRIORITY-POST]",n))}toString(){return".priority"}},$u=Math.log(2);class Ku{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/$u,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=e+1&r}nextBitIsOne(){var e=!(this.bits_&1<<this.current_);return this.current_--,e}}function Wu(c,e,l,t){c.sort(e);const u=function(e,t){var n=t-e;let r,i;if(0==n)return null;if(1==n)return r=c[e],i=l?l(r):r,new Pu(i,r.node,Pu.BLACK,null,null);var s=parseInt(n/2,10)+e,a=u(e,s),n=u(s+1,t);return r=c[s],i=l?l(r):r,new Pu(i,r.node,Pu.BLACK,a,n)};var n=function(e){let s=null,a=null,o=c.length;function t(e,t){var n=o-e,r=o;o-=e;var i=u(1+n,r),r=c[n],n=l?l(r):r;!function(e){if(s){s.left=e;s=e}else{a=e;s=e}}(new Pu(n,r.node,t,null,i))}for(let i=0;i<e.count;++i){var n=e.nextBitIsOne(),r=Math.pow(2,e.count-(i+1));n?t(r,Pu.BLACK):(t(r,Pu.BLACK),t(r,Pu.RED))}return a}(new Ku(c.length));return new xu(t||e,n)}let Gu;const Hu={};class Qu{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return f((Hu,zu),"ChildrenNode.ts has not been loaded"),Gu=Gu||new Qu({".priority":Hu},{".priority":zu}),Gu}get(e){var t=U(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof xu?t:null}hasIndex(e){return F(this.indexSet_,e.toString())}addIndex(e,t){f(e!==Nu,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const i=t.getIterator(Cu.Wrap);let s=i.getNext();for(;s;)r=r||e.isDefinedOn(s.node),n.push(s),s=i.getNext();let a;a=r?Wu(n,e.getCompare()):Hu;var o=e.toString();const c=Object.assign({},this.indexSet_);c[o]=e;const l=Object.assign({},this.indexes_);return l[o]=a,new Qu(l,c)}addToIndexes(a,o){var e=q(this.indexes_,(t,e)=>{const n=U(this.indexSet_,e);if(f(n,"Missing index implementation for "+e),t===Hu){if(n.isDefinedOn(a.node)){const i=[],s=o.getIterator(Cu.Wrap);let e=s.getNext();for(;e;)e.name!==a.name&&i.push(e),e=s.getNext();return i.push(a),Wu(i,n.getCompare())}return Hu}{var r=o.get(a.name);let e=t;return r&&(e=e.remove(new Cu(a.name,r))),e.insert(a,a.node)}});return new Qu(e,this.indexSet_)}removeFromIndexes(n,r){var e=q(this.indexes_,e=>{if(e===Hu)return e;var t=r.get(n.name);return t?e.remove(new Cu(n.name,t)):e});return new Qu(e,this.indexSet_)}}let Yu;class Ju{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Uu(this.priorityNode_),this.children_.isEmpty()&&f(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Yu=Yu||new Ju(new xu(Mu),null,Qu.Default)}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Yu}updatePriority(e){return this.children_.isEmpty()?this:new Ju(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();var t=this.children_.get(e);return null===t?Yu:t}getChild(e){var t=cu(e);return null===t?this:this.getImmediateChild(t).getChild(uu(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(n,r){if(f(r,"We should always be passing snapshot nodes"),".priority"===n)return this.updatePriority(r);{var i=new Cu(n,r);let e,t;t=r.isEmpty()?(e=this.children_.remove(n),this.indexMap_.removeFromIndexes(i,this.children_)):(e=this.children_.insert(n,r),this.indexMap_.addToIndexes(i,this.children_));i=e.isEmpty()?Yu:this.priorityNode_;return new Ju(e,i,t)}}updateChild(e,t){var n=cu(e);if(null===n)return t;f(".priority"!==cu(e)||1===lu(e),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(uu(e),t);return this.updateImmediateChild(n,r)}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(n){if(this.isEmpty())return null;const r={};let i=0,s=0,a=!0;if(this.forEachChild(zu,(e,t)=>{r[e]=t.val(n),i++,a&&Ju.INTEGER_REGEXP_.test(e)?s=Math.max(s,Number(e)):a=!1}),!n&&a&&s<2*i){const e=[];for(const t in r)e[t]=r[t];return e}return n&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r}hash(){if(null===this.lazyHash_){let r="";this.getPriority().isEmpty()||(r+="priority:"+Fu(this.getPriority().val())+":"),this.forEachChild(zu,(e,t)=>{var n=t.hash();""!==n&&(r+=":"+e+":"+n)}),this.lazyHash_=""===r?"":ol(r)}return this.lazyHash_}getPredecessorChildName(e,t,n){const r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new Cu(e,t));return i?i.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){var n=t.minKey();return n&&n.name}return this.children_.minKey()}getFirstChild(e){var t=this.getFirstChildName(e);return t?new Cu(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){var n=t.maxKey();return n&&n.name}return this.children_.maxKey()}getLastChild(e){var t=this.getLastChildName(e);return t?new Cu(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(t,n){const e=this.resolveIndex_(n);if(e)return e.getIteratorFrom(t,e=>e);{const r=this.children_.getIteratorFrom(t.name,Cu.Wrap);let e=r.peek();for(;null!=e&&n.compare(e,t)<0;)r.getNext(),e=r.peek();return r}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(t,n){const e=this.resolveIndex_(n);if(e)return e.getReverseIteratorFrom(t,e=>e);{const r=this.children_.getReverseIteratorFrom(t.name,Cu.Wrap);let e=r.peek();for(;null!=e&&0<n.compare(e,t);)r.getNext(),e=r.peek();return r}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Zu?-1:0}withIndex(e){if(e===Nu||this.indexMap_.hasIndex(e))return this;var t=this.indexMap_.addIndex(e,this.children_);return new Ju(this.children_,this.priorityNode_,t)}isIndexed(e){return e===Nu||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority())){if(this.children_.count()!==n.children_.count())return!1;{const r=this.getIterator(zu),i=n.getIterator(zu);let e=r.getNext(),t=i.getNext();for(;e&&t;){if(e.name!==t.name||!e.node.equals(t.node))return!1;e=r.getNext(),t=i.getNext()}return null===e&&null===t}}return!1}}resolveIndex_(e){return e===Nu?null:this.indexMap_.get(e.toString())}}Ju.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Xu extends Ju{constructor(){super(new xu(Mu),Ju.EMPTY_NODE,Qu.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Ju.EMPTY_NODE}isEmpty(){return!1}}const Zu=new Xu;Object.defineProperties(Cu,{MIN:{value:new Cu(kl,Ju.EMPTY_NODE)},MAX:{value:new Cu(Al,Zu)}}),Au.__EMPTY_NODE=Ju.EMPTY_NODE,qu.__childrenNodeConstructor=Ju,el=Zu,Lu=el,tl=Zu,ju=tl;const eh=!0;function th(i,e=null){if(null===i)return Ju.EMPTY_NODE;if("object"==typeof i&&".priority"in i&&(e=i[".priority"]),f(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"!=typeof(i="object"==typeof i&&".value"in i&&null!==i[".value"]?i[".value"]:i)||".sv"in i){var t=i;return new qu(t,th(e))}if(i instanceof Array||!eh){let r=Ju.EMPTY_NODE;return Rl(i,(e,t)=>{if(F(i,e)&&"."!==e.substring(0,1)){const n=th(t);!n.isLeafNode()&&n.isEmpty()||(r=r.updateImmediateChild(e,n))}}),r.updatePriority(th(e))}{const s=[];let r=!1;if(Rl(i,(e,t)=>{if("."!==e.substring(0,1)){const n=th(t);n.isEmpty()||(r=r||!n.getPriority().isEmpty(),s.push(new Cu(e,n)))}}),0===s.length)return Ju.EMPTY_NODE;var n=Wu(s,Ou,e=>e.name,Mu);if(r){t=Wu(s,zu.getCompare());return new Ju(n,th(e),new Qu({".priority":t},{".priority":zu}))}return new Ju(n,th(e),Qu.Default)}}Bu=th;class nh extends Su{constructor(e){super(),this.indexPath_=e,f(!gu(e)&&".priority"!==cu(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node);var r=this.extractChild(t.node),r=n.compareTo(r);return 0===r?Nl(e.name,t.name):r}makePost(e,t){var n=th(e),n=Ju.EMPTY_NODE.updateChild(this.indexPath_,n);return new Cu(t,n)}maxPost(){var e=Ju.EMPTY_NODE.updateChild(this.indexPath_,Zu);return new Cu(Al,e)}toString(){return du(this.indexPath_,0).join("/")}}const rh=new class extends Su{compare(e,t){var n=e.node.compareTo(t.node);return 0===n?Nl(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Cu.MIN}maxPost(){return Cu.MAX}makePost(e,t){var n=th(e);return new Cu(t,n)}toString(){return".value"}};function ih(e){return{type:"value",snapshotNode:e}}function sh(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function ah(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function oh(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class ch{constructor(e){this.index_=e}updateChild(e,t,n,r,i,s){f(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()===n.isEmpty()?e:(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(ah(t,a)):f(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?s.trackChildChange(sh(t,n)):s.trackChildChange(oh(t,n,a))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))}updateFullNode(r,n,i){return null!=i&&(r.isLeafNode()||r.forEachChild(zu,(e,t)=>{n.hasChild(e)||i.trackChildChange(ah(e,t))}),n.isLeafNode()||n.forEachChild(zu,(e,t)=>{if(r.hasChild(e)){const n=r.getImmediateChild(e);n.equals(t)||i.trackChildChange(oh(e,t,n))}else i.trackChildChange(sh(e,t))})),n.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?Ju.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class lh{constructor(e){this.indexedFilter_=new ch(e.getIndex()),this.index_=e.getIndex(),this.startPost_=lh.getStartPost_(e),this.endPost_=lh.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){var t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,r,i,s){return this.matches(new Cu(t,n))||(n=Ju.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,s)}updateFullNode(e,t,n){let r=(t=t.isLeafNode()?Ju.EMPTY_NODE:t).withIndex(this.index_);r=r.updatePriority(Ju.EMPTY_NODE);const i=this;return t.forEachChild(zu,(e,t)=>{i.matches(new Cu(e,t))||(r=r.updateImmediateChild(e,Ju.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class uh{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{var t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{var t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new lh(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,r,i,s){return this.rangedFilter_.matches(new Cu(t,n))||(n=Ju.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,s):this.fullLimitUpdateChild_(e,t,n,i,s)}updateFullNode(e,n,t){let r;if(n.isLeafNode()||n.isEmpty())r=Ju.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<n.numChildren()&&n.isIndexed(this.index_)){r=Ju.EMPTY_NODE.withIndex(this.index_);let e;e=this.reverse_?n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let t=0;for(;e.hasNext()&&t<this.limit_;){var i=e.getNext();if(this.withinDirectionalStart(i)){if(!this.withinDirectionalEnd(i))break;r=r.updateImmediateChild(i.name,i.node),t++}}}else{r=n.withIndex(this.index_),r=r.updatePriority(Ju.EMPTY_NODE);let e;e=this.reverse_?r.getReverseIterator(this.index_):r.getIterator(this.index_);let t=0;for(;e.hasNext();){var s=e.getNext();t<this.limit_&&this.withinDirectionalStart(s)&&this.withinDirectionalEnd(s)?t++:r=r.updateImmediateChild(s.name,Ju.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,t)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,r,i){let s;if(this.reverse_){const d=this.index_.getCompare();s=(e,t)=>d(t,e)}else s=this.index_.getCompare();const a=e;f(a.numChildren()===this.limit_,"");var o=new Cu(t,n),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),l=this.rangedFilter_.matches(o);if(a.hasChild(t)){var u=a.getImmediateChild(t);let e=r.getChildAfterChild(this.index_,c,this.reverse_);for(;null!=e&&(e.name===t||a.hasChild(e.name));)e=r.getChildAfterChild(this.index_,e,this.reverse_);var h=null==e?1:s(e,o);if(l&&!n.isEmpty()&&0<=h)return null!=i&&i.trackChildChange(oh(t,n,u)),a.updateImmediateChild(t,n);{null!=i&&i.trackChildChange(ah(t,u));const p=a.updateImmediateChild(t,Ju.EMPTY_NODE);return null!=e&&this.rangedFilter_.matches(e)?(null!=i&&i.trackChildChange(sh(e.name,e.node)),p.updateImmediateChild(e.name,e.node)):p}}return!n.isEmpty()&&l&&0<=s(c,o)?(null!=i&&(i.trackChildChange(ah(c.name,c.node)),i.trackChildChange(sh(t,n))),a.updateImmediateChild(t,n).updateImmediateChild(c.name,Ju.EMPTY_NODE)):e}}class hh{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=zu}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return f(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return f(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:kl}hasEnd(){return this.endSet_}getIndexEndValue(){return f(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return f(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Al}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return f(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===zu}copy(){const e=new hh;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function dh(e,t,n){const r=e.copy();return r.startSet_=!0,void 0===t&&(t=null),r.indexStartValue_=t,null!=n?(r.startNameSet_=!0,r.indexStartName_=n):(r.startNameSet_=!1,r.indexStartName_=""),r}function ph(e,t,n){const r=e.copy();return r.endSet_=!0,void 0===t&&(t=null),r.indexEndValue_=t,void 0!==n?(r.endNameSet_=!0,r.indexEndName_=n):(r.endNameSet_=!1,r.indexEndName_=""),r}function fh(e,t){const n=e.copy();return n.index_=t,n}function gh(e){const t={};if(e.isDefault())return t;let n;var r;return n=e.index_===zu?"$priority":e.index_===rh?"$value":e.index_===Nu?"$key":(f(e.index_ instanceof nh,"Unrecognized index type!"),e.index_.toString()),t.orderBy=M(n),e.startSet_&&(r=e.startAfterSet_?"startAfter":"startAt",t[r]=M(e.indexStartValue_),e.startNameSet_&&(t[r]+=","+M(e.indexStartName_))),e.endSet_&&(r=e.endBeforeSet_?"endBefore":"endAt",t[r]=M(e.indexEndValue_),e.endNameSet_&&(t[r]+=","+M(e.indexEndName_))),e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function mh(t){const n={};if(t.startSet_&&(n.sp=t.indexStartValue_,t.startNameSet_&&(n.sn=t.indexStartName_),n.sin=!t.startAfterSet_),t.endSet_&&(n.ep=t.indexEndValue_,t.endNameSet_&&(n.en=t.indexEndName_),n.ein=!t.endBeforeSet_),t.limitSet_){n.l=t.limit_;let e=t.viewFrom_;""===e&&(e=t.isViewFromLeft()?"l":"r"),n.vf=e}return t.index_!==zu&&(n.i=t.index_.toString()),n}class vh extends ru{constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=gl("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(f(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,r,i){const s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);const a=vh.getListenId_(e,r),o={};this.listens_[a]=o;var n=gh(e._queryParams);this.restRequest_(s+".json",n,(t,e)=>{let n=e;if(null===(t=404===t?n=null:t)&&this.onDataUpdate_(s,n,!1,r),U(this.listens_,a)===o){let e;e=t?401===t?"permission_denied":"rest_error:"+t:"ok",i(e,null)}})}unlisten(e,t){var n=vh.getListenId_(e,t);delete this.listens_[n]}get(e){var t=gh(e._queryParams);const r=e._path.toString(),i=new y;return this.restRequest_(r+".json",t,(e,t)=>{let n=t;null===(e=404===e?n=null:e)?(this.onDataUpdate_(r,n,!1,null),i.resolve(n)):i.reject(new Error(n))}),i.promise}refreshAuthToken(e){}restRequest_(i,s={},a){return s.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([e,t])=>{e&&e.accessToken&&(s.auth=e.accessToken),t&&t.token&&(s.ac=t.token);const n=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+i+"?ns="+this.repoInfo_.namespace+z(s);this.log_("Sending REST request for "+n);const r=new XMLHttpRequest;r.onreadystatechange=()=>{if(a&&4===r.readyState){this.log_("REST Response for "+n+" received. status:",r.status,"response:",r.responseText);let e=null;if(200<=r.status&&r.status<300){try{e=O(r.responseText)}catch(e){El("Failed to parse JSON response for "+n+": "+r.responseText)}a(null,e)}else 401!==r.status&&404!==r.status&&El("Got unsuccessful REST response for "+n+" Status: "+r.status),a(r.status);a=null}},r.open("GET",n,!0),r.send()})}}class _h{constructor(){this.rootNode_=Ju.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function yh(){return{value:null,children:new Map}}function wh(e,t,n){var r;gu(t)?(e.value=n,e.children.clear()):null!==e.value?e.value=e.value.updateChild(t,n):(r=cu(t),e.children.has(r)||e.children.set(r,yh()),wh(e.children.get(r),t=uu(t),n))}function bh(e,n,r){var i;null!==e.value?r(n,e.value):(i=(e,t)=>{bh(t,new au(n.toString()+"/"+e),r)},e.children.forEach((e,t)=>{i(t,e)}))}class Ih{constructor(e){this.collection_=e,this.last_=null}get(){var e=this.collection_.get();const n=Object.assign({},e);return this.last_&&Rl(this.last_,(e,t)=>{n[e]=n[e]-t}),this.last_=e,n}}class Th{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Ih(e);var n=1e4+2e4*Math.random();xl(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){var e=this.statsListener_.get();const n={};let r=!1;Rl(e,(e,t)=>{0<t&&F(this.statsToReport_,e)&&(n[e]=t,r=!0)}),r&&this.server_.reportStats(n),xl(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function Eh(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Ch(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Sh(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}(Kk=nl=nl||{})[Kk.OVERWRITE=0]="OVERWRITE",Kk[Kk.MERGE=1]="MERGE",Kk[Kk.ACK_USER_WRITE=2]="ACK_USER_WRITE",Kk[Kk.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class kh{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=nl.ACK_USER_WRITE,this.source=Eh()}operationForChild(e){if(gu(this.path)){if(null!=this.affectedTree.value)return f(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var t=this.affectedTree.subtree(new au(e));return new kh(ou(),t,this.revert)}return f(cu(this.path)===e,"operationForChild called for unrelated child."),new kh(uu(this.path),this.affectedTree,this.revert)}}class Ah{constructor(e,t){this.source=e,this.path=t,this.type=nl.LISTEN_COMPLETE}operationForChild(e){return gu(this.path)?new Ah(this.source,ou()):new Ah(this.source,uu(this.path))}}class Nh{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=nl.OVERWRITE}operationForChild(e){return gu(this.path)?new Nh(this.source,ou(),this.snap.getImmediateChild(e)):new Nh(this.source,uu(this.path),this.snap)}}class Rh{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=nl.MERGE}operationForChild(e){if(gu(this.path)){const t=this.children.subtree(new au(e));return t.isEmpty()?null:t.value?new Nh(this.source,ou(),t.value):new Rh(this.source,ou(),t)}return f(cu(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Rh(this.source,uu(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Ph{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(gu(e))return this.isFullyInitialized()&&!this.filtered_;var t=cu(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class Dh{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function xh(n,e,t,r){var i=[];const s=[];return e.forEach(e=>{var t;"child_changed"===e.type&&n.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&s.push((t=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:t}))}),Oh(n,i,"child_removed",e,r,t),Oh(n,i,"child_added",e,r,t),Oh(n,i,"child_moved",s,r,t),Oh(n,i,"child_changed",e,r,t),Oh(n,i,"value",e,r,t),i}function Oh(s,a,t,e,o,c){const n=e.filter(e=>e.type===t);n.sort((e,t)=>function(e,t,n){if(null==t.childName||null==n.childName)throw u("Should only compare child_ events.");var r=new Cu(t.childName,t.snapshotNode),i=new Cu(n.childName,n.snapshotNode);return e.index_.compare(r,i)}(s,e,t)),n.forEach(t=>{const n=(e=s,i=c,"value"===(r=t).type||"child_removed"===r.type||(r.prevName=i.getPredecessorChildName(r.childName,r.snapshotNode,e.index_)),r);var e,r,i;o.forEach(e=>{e.respondsTo(t.type)&&a.push(e.createEvent(n,s.query_))})})}function Mh(e,t){return{eventCache:e,serverCache:t}}function Lh(e,t,n,r){return Mh(new Ph(t,n,r),e.serverCache)}function Fh(e,t,n,r){return Mh(e.eventCache,new Ph(t,n,r))}function Uh(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function Vh(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let qh;class Bh{constructor(e,t=(qh=qh||new xu(vl),qh)){this.value=e,this.children=t}static fromObject(e){let n=new Bh(null);return Rl(e,(e,t)=>{n=n.set(new au(e),t)}),n}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:ou(),value:this.value};if(gu(e))return null;{var n=cu(e);const i=this.children.get(n);if(null===i)return null;var r=i.findRootMostMatchingPathAndValue(uu(e),t);return null==r?null:{path:fu(new au(n),r.path),value:r.value}}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(gu(e))return this;{var t=cu(e);const n=this.children.get(t);return null!==n?n.subtree(uu(e)):new Bh(null)}}set(e,t){if(gu(e))return new Bh(t,this.children);{var n=cu(e);const i=this.children.get(n)||new Bh(null);var r=i.set(uu(e),t),r=this.children.insert(n,r);return new Bh(this.value,r)}}remove(t){if(gu(t))return this.children.isEmpty()?new Bh(null):new Bh(null,this.children);{var n=cu(t);const r=this.children.get(n);if(r){const i=r.remove(uu(t));let e;return e=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&e.isEmpty()?new Bh(null):new Bh(this.value,e)}return this}}get(e){if(gu(e))return this.value;{var t=cu(e);const n=this.children.get(t);return n?n.get(uu(e)):null}}setTree(t,n){if(gu(t))return n;{var r=cu(t);const i=this.children.get(r)||new Bh(null),s=i.setTree(uu(t),n);let e;return e=s.isEmpty()?this.children.remove(r):this.children.insert(r,s),new Bh(this.value,e)}}fold(e){return this.fold_(ou(),e)}fold_(n,r){const i={};return this.children.inorderTraversal((e,t)=>{i[e]=t.fold_(fu(n,e),r)}),r(n,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,ou(),t)}findOnPath_(e,t,n){var r=!!this.value&&n(t,this.value);if(r)return r;if(gu(e))return null;{r=cu(e);const i=this.children.get(r);return i?i.findOnPath_(uu(e),fu(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,ou(),t)}foreachOnPath_(e,t,n){if(gu(e))return this;{this.value&&n(t,this.value);var r=cu(e);const i=this.children.get(r);return i?i.foreachOnPath_(uu(e),fu(t,r),n):new Bh(null)}}foreach(e){this.foreach_(ou(),e)}foreach_(n,r){this.children.inorderTraversal((e,t)=>{t.foreach_(fu(n,e),r)}),this.value&&r(n,this.value)}foreachChild(n){this.children.inorderTraversal((e,t)=>{t.value&&n(e,t.value)})}}class jh{constructor(e){this.writeTree_=e}static empty(){return new jh(new Bh(null))}}function zh(t,n,r){if(gu(n))return new jh(new Bh(r));var i=t.writeTree_.findRootMostValueAndPath(n);if(null!=i){var s=i.path;let e=i.value;i=mu(s,n);return e=e.updateChild(i,r),new jh(t.writeTree_.set(s,e))}s=new Bh(r),s=t.writeTree_.setTree(n,s);return new jh(s)}function $h(e,n,t){let r=e;return Rl(t,(e,t)=>{r=zh(r,fu(n,e),t)}),r}function Kh(e,t){if(gu(t))return jh.empty();var n=e.writeTree_.setTree(t,new Bh(null));return new jh(n)}function Wh(e,t){return null!=Gh(e,t)}function Gh(e,t){var n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(mu(n.path,t)):null}function Hh(e){const n=[],t=e.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(zu,(e,t)=>{n.push(new Cu(e,t))}):e.writeTree_.children.inorderTraversal((e,t)=>{null!=t.value&&n.push(new Cu(e,t.value))}),n}function Qh(e,t){if(gu(t))return e;var n=Gh(e,t);return null!=n?new jh(new Bh(n)):new jh(e.writeTree_.subtree(t))}function Yh(e){return e.writeTree_.isEmpty()}function Jh(e,t){return function r(i,e,s){{if(null!=e.value)return s.updateChild(i,e.value);{let n=null;return e.children.inorderTraversal((e,t)=>{".priority"===e?(f(null!==t.value,"Priority writes must always be leaf nodes"),n=t.value):s=r(fu(i,e),t,s)}),s=!s.getChild(i).isEmpty()&&null!==n?s.updateChild(fu(i,".priority"),n):s}}}(ou(),e.writeTree_,t)}function Xh(e,t){return ud(t,e)}function Zh(t,n){var e,r=t.allWrites.findIndex(e=>e.writeId===n);f(0<=r,"removeWrite called with nonexistent writeId.");const i=t.allWrites[r];t.allWrites.splice(r,1);let s=i.visible,a=!1,o=t.allWrites.length-1;for(;s&&0<=o;){var c=t.allWrites[o];c.visible&&(o>=r&&function(e,t){{if(e.snap)return yu(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&yu(fu(e.path,n),t))return!0;return!1}}(c,i.path)?s=!1:yu(i.path,c.path)&&(a=!0)),o--}return!!s&&(a?((e=t).visibleWrites=td(e.allWrites,ed,ou()),0<e.allWrites.length?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1):i.snap?t.visibleWrites=Kh(t.visibleWrites,i.path):Rl(i.children,e=>{t.visibleWrites=Kh(t.visibleWrites,fu(i.path,e))}),!0)}function ed(e){return e.visible}function td(e,t,n){let r=jh.empty();for(let s=0;s<e.length;++s){const a=e[s];if(t(a)){var i=a.path;let e;if(a.snap)yu(n,i)?(e=mu(n,i),r=zh(r,e,a.snap)):yu(i,n)&&(e=mu(i,n),r=zh(r,ou(),a.snap.getChild(e)));else{if(!a.children)throw u("WriteRecord should have .snap or .children");if(yu(n,i))e=mu(n,i),r=$h(r,e,a.children);else if(yu(i,n))if(e=mu(i,n),gu(e))r=$h(r,ou(),a.children);else{const o=U(a.children,cu(e));o&&(i=o.getChild(uu(e)),r=zh(r,ou(),i))}}}}return r}function nd(e,t,n,r,i){if(r||i){var s=Qh(e.visibleWrites,t);if(!i&&Yh(s))return n;if(i||null!=n||Wh(s,ou()))return Jh(td(e.allWrites,function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(yu(e.path,t)||yu(t,e.path))},t),n||Ju.EMPTY_NODE);return null}s=Gh(e.visibleWrites,t);if(null!=s)return s;s=Qh(e.visibleWrites,t);return Yh(s)?n:null!=n||Wh(s,ou())?Jh(s,n||Ju.EMPTY_NODE):null}function rd(e,t,n,r){return nd(e.writeTree,e.treePath,t,n,r)}function id(e,t){return function(e,t,n){let r=Ju.EMPTY_NODE;const i=Gh(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(zu,(e,t)=>{r=r.updateImmediateChild(e,t)}),r;if(n){const s=Qh(e.visibleWrites,t);return n.forEachChild(zu,(e,t)=>{var n=Jh(Qh(s,new au(e)),t);r=r.updateImmediateChild(e,n)}),Hh(s).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}return Hh(Qh(e.visibleWrites,t)).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}(e.writeTree,e.treePath,t)}function sd(e,t,n,r){return function(e,t,n,r,i){f(r||i,"Either existingEventSnap or existingServerSnap must exist");var s=fu(t,n);return Wh(e.visibleWrites,s)?null:Yh(s=Qh(e.visibleWrites,s))?i.getChild(n):Jh(s,i.getChild(n))}(e.writeTree,e.treePath,t,n,r)}function ad(e,t){return n=e.writeTree,t=fu(e.treePath,t),Gh(n.visibleWrites,t);var n}function od(e,t,n,r,i,s){return function(e,t,n,r,i,s,a){let o;var c=Qh(e.visibleWrites,t),l=Gh(c,ou());if(null!=l)o=l;else{if(null==n)return[];o=Jh(c,n)}if(o=o.withIndex(a),o.isEmpty()||o.isLeafNode())return[];{const u=[],h=a.getCompare(),d=s?o.getReverseIteratorFrom(r,a):o.getIteratorFrom(r,a);let e=d.getNext();for(;e&&u.length<i;)0!==h(e,r)&&u.push(e),e=d.getNext();return u}}(e.writeTree,e.treePath,t,n,r,i,s)}function cd(e,t,n){return r=e.writeTree,e=e.treePath,n=n,i=fu(e,t=t),null!=(s=Gh(r.visibleWrites,i))?s:n.isCompleteForChild(t)?Jh(Qh(r.visibleWrites,i),n.getNode().getImmediateChild(t)):null;var r,i,s}function ld(e,t){return ud(fu(e.treePath,t),e.writeTree)}function ud(e,t){return{treePath:e,writeTree:t}}class hd{constructor(){this.changeMap=new Map}trackChildChange(e){var t=e.type,n=e.childName;f("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),f(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,oh(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,ah(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,sh(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw u("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,oh(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const dd=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class pd{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var n=null!=this.optCompleteServerCache_?new Ph(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return cd(this.writes_,e,n)}getChildAfterChild(e,t,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Vh(this.viewCache_),r=od(this.writes_,r,t,1,n,e);return 0===r.length?null:r[0]}}function fd(e,t,n,r,i){const s=new hd;let a,o;if(n.type===nl.OVERWRITE){var c=n;a=c.source.fromUser?vd(e,t,c.path,c.snap,r,i,s):(f(c.source.fromServer,"Unknown source."),o=c.source.tagged||t.serverCache.isFiltered()&&!gu(c.path),md(e,t,c.path,c.snap,r,i,o,s))}else if(n.type===nl.MERGE){c=n;a=c.source.fromUser?function(r,i,s,e,a,o,c){let l=i;return e.foreach((e,t)=>{var n=fu(s,e);_d(i,cu(n))&&(l=vd(r,l,n,t,a,o,c))}),e.foreach((e,t)=>{var n=fu(s,e);_d(i,cu(n))||(l=vd(r,l,n,t,a,o,c))}),l}(e,t,c.path,c.children,r,i,s):(f(c.source.fromServer,"Unknown source."),o=c.source.tagged||t.serverCache.isFiltered(),wd(e,t,c.path,c.children,r,i,o,s))}else if(n.type===nl.ACK_USER_WRITE){var l=n;a=l.revert?function(n,r,i,s,e,a){let o;{if(null!=ad(s,i))return r;{var c=new pd(s,r,e);const u=r.eventCache.getNode();let t;if(gu(i)||".priority"===cu(i)){let e;e=r.serverCache.isFullyInitialized()?rd(s,Vh(r)):(l=r.serverCache.getNode(),f(l instanceof Ju,"serverChildren would be complete if leaf node"),id(s,l)),e=e,t=n.filter.updateFullNode(u,e,a)}else{var l=cu(i);let e=cd(s,l,r.serverCache);null==e&&r.serverCache.isCompleteForChild(l)&&(e=u.getImmediateChild(l)),t=null!=e?n.filter.updateChild(u,l,e,uu(i),c,a):r.eventCache.getNode().hasChild(l)?n.filter.updateChild(u,l,Ju.EMPTY_NODE,uu(i),c,a):u,t.isEmpty()&&r.serverCache.isFullyInitialized()&&(o=rd(s,Vh(r)),o.isLeafNode()&&(t=n.filter.updateFullNode(t,o,a)))}return o=r.serverCache.isFullyInitialized()||null!=ad(s,ou()),Lh(r,t,o,n.filter.filtersNodes())}}}(e,t,l.path,r,i,s):function(e,t,i,n,s,a,o){if(null!=ad(s,i))return t;const c=t.serverCache.isFiltered(),l=t.serverCache;{if(null!=n.value){if(gu(i)&&l.isFullyInitialized()||l.isCompleteForPath(i))return md(e,t,i,l.getNode().getChild(i),s,a,c,o);if(gu(i)){let n=new Bh(null);return l.getNode().forEachChild(Nu,(e,t)=>{n=n.set(new au(e),t)}),wd(e,t,i,n,s,a,c,o)}return t}{let r=new Bh(null);return n.foreach((e,t)=>{var n=fu(i,e);l.isCompleteForPath(n)&&(r=r.set(e,l.getNode().getChild(n)))}),wd(e,t,i,r,s,a,c,o)}}}(e,t,l.path,l.affectedTree,r,i,s)}else{if(n.type!==nl.LISTEN_COMPLETE)throw u("Unknown operation type: "+n.type);a=function(e,t,n,r,i){const s=t.serverCache,a=Fh(t,s.getNode(),s.isFullyInitialized()||gu(n),s.isFiltered());return gd(e,a,n,r,dd,i)}(e,t,n.path,r,s)}l=s.getChanges();return function(e,t,n){const r=t.eventCache;if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty();const s=Uh(e);(0<n.length||!e.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&n.push(ih(Uh(t)))}}(t,a,l),{viewCache:a,changes:l}}function gd(r,i,s,a,o,c){const l=i.eventCache;if(null!=ad(a,s))return i;{let t,n;if(gu(s)){var e;f(i.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t=i.serverCache.isFiltered()?(e=id(a,(e=Vh(i))instanceof Ju?e:Ju.EMPTY_NODE),r.filter.updateFullNode(i.eventCache.getNode(),e,c)):(u=rd(a,Vh(i)),r.filter.updateFullNode(i.eventCache.getNode(),u,c))}else{var u=cu(s);if(".priority"===u){f(1===lu(s),"Can't have a priority with additional path components");var h=l.getNode();n=i.serverCache.getNode();var d=sd(a,s,h,n);t=null!=d?r.filter.updatePriority(h,d):l.getNode()}else{h=uu(s);let e;e=l.isCompleteForChild(u)?(n=i.serverCache.getNode(),null!=(d=sd(a,s,l.getNode(),n))?l.getNode().getImmediateChild(u).updateChild(h,d):l.getNode().getImmediateChild(u)):cd(a,u,i.serverCache),t=null!=e?r.filter.updateChild(l.getNode(),u,e,h,o,c):l.getNode()}}return Lh(i,t,l.isFullyInitialized()||gu(s),r.filter.filtersNodes())}}function md(e,t,n,r,i,s,a,o){const c=t.serverCache;let l;const u=a?e.filter:e.filter.getIndexedFilter();if(gu(n))l=u.updateFullNode(c.getNode(),r,null);else if(u.filtersNodes()&&!c.isFiltered()){var h=c.getNode().updateChild(n,r);l=u.updateFullNode(c.getNode(),h,null)}else{var d=cu(n);if(!c.isCompleteForPath(n)&&1<lu(n))return t;var p=uu(n);const f=c.getNode().getImmediateChild(d);h=f.updateChild(p,r);l=".priority"===d?u.updatePriority(c.getNode(),h):u.updateChild(c.getNode(),d,h,p,dd,null)}p=Fh(t,l,c.isFullyInitialized()||gu(n),u.filtersNodes());return gd(e,p,n,i,new pd(i,p,s),o)}function vd(t,n,r,i,e,s,a){const o=n.eventCache;let c,l;const u=new pd(e,n,s);if(gu(r))l=t.filter.updateFullNode(n.eventCache.getNode(),i,a),c=Lh(n,l,!0,t.filter.filtersNodes());else{var h=cu(r);if(".priority"===h)l=t.filter.updatePriority(n.eventCache.getNode(),i),c=Lh(n,l,o.isFullyInitialized(),o.isFiltered());else{var d=uu(r);const p=o.getNode().getImmediateChild(h);let e;if(gu(d))e=i;else{const f=u.getCompleteChild(h);e=null!=f?".priority"===hu(d)&&f.getChild(pu(d)).isEmpty()?f:f.updateChild(d,i):Ju.EMPTY_NODE}c=p.equals(e)?n:Lh(n,t.filter.updateChild(o.getNode(),h,e,d,u,a),o.isFullyInitialized(),t.filter.filtersNodes())}}return c}function _d(e,t){return e.eventCache.isCompleteForChild(t)}function yd(e,n,t){return t.foreach((e,t)=>{n=n.updateChild(e,t)}),n}function wd(r,i,e,t,s,a,o,c){if(i.serverCache.getNode().isEmpty()&&!i.serverCache.isFullyInitialized())return i;let l=i,n;n=gu(e)?t:new Bh(null).setTree(e,t);const u=i.serverCache.getNode();return n.children.inorderTraversal((e,t)=>{var n;u.hasChild(e)&&(n=yd(0,i.serverCache.getNode().getImmediateChild(e),t),l=md(r,l,new au(e),n,s,a,o,c))}),n.children.inorderTraversal((e,t)=>{var n=!i.serverCache.isCompleteForChild(e)&&null===t.value;u.hasChild(e)||n||(n=yd(0,i.serverCache.getNode().getImmediateChild(e),t),l=md(r,l,new au(e),n,s,a,o,c))}),l}class bd{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,r=new ch(n.getIndex()),i=(e=n).loadsAllData()?new ch(e.getIndex()):new(e.hasLimit()?uh:lh)(e);this.processor_={filter:i};const s=t.serverCache,a=t.eventCache;var o=r.updateFullNode(Ju.EMPTY_NODE,s.getNode(),null),c=i.updateFullNode(Ju.EMPTY_NODE,a.getNode(),null),o=new Ph(o,s.isFullyInitialized(),r.filtersNodes()),c=new Ph(c,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=Mh(c,o),this.eventGenerator_=new Dh(this.query_)}get query(){return this.query_}}function Id(e){return 0===e.eventRegistrations_.length}function Td(n,r,i){const s=[];if(i){f(null==r,"A cancel should cancel all event registrations.");const a=n.query._path;n.eventRegistrations_.forEach(e=>{var t=e.createCancelEvent(i,a);t&&s.push(t)})}if(r){let e=[];for(let t=0;t<n.eventRegistrations_.length;++t){const o=n.eventRegistrations_[t];if(o.matches(r)){if(r.hasAnyCallback()){e=e.concat(n.eventRegistrations_.slice(t+1));break}}else e.push(o)}n.eventRegistrations_=e}else n.eventRegistrations_=[];return s}function Ed(e,t,n,r){t.type===nl.MERGE&&null!==t.source.queryId&&(f(Vh(e.viewCache_),"We should always have a full cache before handling merges"),f(Uh(e.viewCache_),"Missing event cache, even though we have a server cache"));const i=e.viewCache_,s=fd(e.processor_,i,t,n,r);return n=e.processor_,r=s.viewCache,f(r.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),f(r.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed"),f(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,Cd(e,s.changes,s.viewCache.eventCache.getNode(),null)}function Cd(e,t,n,r){var i=r?[r]:e.eventRegistrations_;return xh(e.eventGenerator_,t,n,i)}let Sd;class kd{constructor(){this.views=new Map}}function Ad(t,n,r,i){var e=n.source.queryId;if(null!==e){e=t.views.get(e);return f(null!=e,"SyncTree gave us an op for an invalid query."),Ed(e,n,r,i)}{let e=[];for(const s of t.views.values())e=e.concat(Ed(s,n,r,i));return e}}function Nd(e,n,r,i,s){var a=n._queryIdentifier,a=e.views.get(a);if(a)return a;{let e=rd(r,s?i:null),t=!1;t=!!e||(e=i instanceof Ju?id(r,i):Ju.EMPTY_NODE,!1);a=Mh(new Ph(e,t,!1),new Ph(i,s,!1));return new bd(n,a)}}function Rd(e,t,n,r,i,s){var a=Nd(e,t,r,i,s);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,a),a.eventRegistrations_.push(n),function(e,t){const n=e.viewCache_.eventCache,r=[];if(!n.getNode().isLeafNode()){const i=n.getNode();i.forEachChild(zu,(e,t)=>{r.push(sh(e,t))})}return n.isFullyInitialized()&&r.push(ih(n.getNode())),Cd(e,r,n.getNode(),t)}(a,n)}function Pd(e,t,n,r){var i=t._queryIdentifier;const s=[];let a=[];var o=Ld(e);if("default"===i)for(var[c,l]of e.views.entries())a=a.concat(Td(l,n,r)),Id(l)&&(e.views.delete(c),l.query._queryParams.loadsAllData()||s.push(l.query));else{const u=e.views.get(i);u&&(a=a.concat(Td(u,n,r)),Id(u)&&(e.views.delete(i),u.query._queryParams.loadsAllData()||s.push(u.query)))}return o&&!Ld(e)&&s.push((f(Sd,"Reference.ts has not been loaded"),new Sd(t._repo,t._path))),{removed:s,events:a}}function Dd(e){const t=[];for(const n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function xd(e,t){let n=null;for(const r of e.views.values())n=n||function(e,t){const n=Vh(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!gu(t)&&!n.getImmediateChild(cu(t)).isEmpty())?n.getChild(t):null}(r,t);return n}function Od(e,t){const n=t._queryParams;if(n.loadsAllData())return Fd(e);var r=t._queryIdentifier;return e.views.get(r)}function Md(e,t){return null!=Od(e,t)}function Ld(e){return null!=Fd(e)}function Fd(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let Ud;let Vd=1;class qd{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Bh(null),this.pendingWriteTree_={visibleWrites:jh.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Bd(e,t,n,r,i){var s,a,o,c;return s=e.pendingWriteTree_,a=t,o=n,c=r,r=i,f(c>s.lastWriteId,"Stacking an older write on top of newer ones"),s.allWrites.push({path:a,snap:o,writeId:c,visible:r=void 0===r?!0:r}),r&&(s.visibleWrites=zh(s.visibleWrites,a,o)),s.lastWriteId=c,i?Yd(e,new Nh(Eh(),t,n)):[]}function jd(e,t,n,r){var i,s,a;i=e.pendingWriteTree_,s=t,a=n,r=r,f(r>i.lastWriteId,"Stacking an older merge on top of newer ones"),i.allWrites.push({path:s,children:a,writeId:r,visible:!0}),i.visibleWrites=$h(i.visibleWrites,s,a),i.lastWriteId=r;var o=Bh.fromObject(n);return Yd(e,new Rh(Eh(),t,o))}function zd(e,t,n=!1){var r=function(e,t){for(let r=0;r<e.allWrites.length;r++){var n=e.allWrites[r];if(n.writeId===t)return n}return null}(e.pendingWriteTree_,t);if(Zh(e.pendingWriteTree_,t)){let t=new Bh(null);return null!=r.snap?t=t.set(ou(),!0):Rl(r.children,e=>{t=t.set(new au(e),!0)}),Yd(e,new kh(r.path,t,n))}return[]}function $d(e,t,n){return Yd(e,new Nh(Ch(),t,n))}function Kd(n,e,t,r,i=!1){var s=e._path,a=n.syncPointTree_.get(s);let o=[];if(a&&("default"===e._queryIdentifier||Md(a,e))){var c=Pd(a,e,t,r);0===a.views.size&&(n.syncPointTree_=n.syncPointTree_.remove(s));const d=c.removed;if(o=c.events,!i){a=-1!==d.findIndex(e=>e._queryParams.loadsAllData()),c=n.syncPointTree_.findOnPath(s,(e,t)=>Ld(t));if(a&&!c){const p=n.syncPointTree_.subtree(s);if(!p.isEmpty()){var l=p.fold((e,t,r)=>{if(t&&Ld(t))return[Fd(t)];{let n=[];return t&&(n=Dd(t)),Rl(r,(e,t)=>{n=n.concat(t)}),n}});for(let e=0;e<l.length;++e){var u=l[e],h=u.query,u=Xd(n,u);n.listenProvider_.startListening(ip(h),Zd(n,h),u.hashFn,u.onComplete)}}}!c&&0<d.length&&!r&&(a?n.listenProvider_.stopListening(ip(e),null):d.forEach(e=>{var t=n.queryToTagMap.get(ep(e));n.listenProvider_.stopListening(ip(e),t)}))}!function(e,t){for(let i=0;i<t.length;++i){const s=t[i];var n,r;s._queryParams.loadsAllData()||(n=ep(s),r=e.queryToTagMap.get(n),e.queryToTagMap.delete(n),e.tagToQueryMap.delete(r))}}(n,d)}return o}function Wd(e,t,n,r){var i=tp(e,r);if(null==i)return[];var s=np(i),a=s.path,i=s.queryId,s=mu(a,t);return rp(e,a,new Nh(Sh(i),s,n))}function Gd(e,t,n,r=!1){const i=t._path;let s=null,a=!1;e.syncPointTree_.foreachOnPath(i,(e,t)=>{var n=mu(e,i);s=s||xd(t,n),a=a||Ld(t)});let o=e.syncPointTree_.get(i);o?(a=a||Ld(o),s=s||xd(o,ou())):(o=new kd,e.syncPointTree_=e.syncPointTree_.set(i,o));let c;if(null!=s)c=!0;else{c=!1,s=Ju.EMPTY_NODE;const p=e.syncPointTree_.subtree(i);p.foreachChild((e,t)=>{var n=xd(t,ou());n&&(s=s.updateImmediateChild(e,n))})}var l,u=Md(o,t);u||t._queryParams.loadsAllData()||(h=ep(t),f(!e.queryToTagMap.has(h),"View does not exist, but we have a tag"),l=Vd++,e.queryToTagMap.set(h,l),e.tagToQueryMap.set(l,h));var h=Xh(e.pendingWriteTree_,i);let d=Rd(o,t,n,h,s,c);return u||a||r||(u=Od(o,t),d=d.concat(function(t,e,n){const r=e._path,i=Zd(t,e),s=Xd(t,n),a=t.listenProvider_.startListening(ip(e),i,s.hashFn,s.onComplete),o=t.syncPointTree_.subtree(r);if(i)f(!Ld(o.value),"If we're adding a query, it shouldn't be shadowed");else{var c=o.fold((e,t,r)=>{if(!gu(e)&&t&&Ld(t))return[Fd(t).query];{let n=[];return t&&(n=n.concat(Dd(t).map(e=>e.query))),Rl(r,(e,t)=>{n=n.concat(t)}),n}});for(let e=0;e<c.length;++e){var l=c[e];t.listenProvider_.stopListening(ip(l),Zd(t,l))}}return a}(e,t,u))),d}function Hd(e,r,t){var n=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(r,(e,t)=>{var n=xd(t,mu(e,r));if(n)return n});return nd(n,r,i,t,!0)}function Qd(e,t){const r=t._path;let i=null;e.syncPointTree_.foreachOnPath(r,(e,t)=>{var n=mu(e,r);i=i||xd(t,n)});let n=e.syncPointTree_.get(r);n?i=i||xd(n,ou()):(n=new kd,e.syncPointTree_=e.syncPointTree_.set(r,n));var s=null!=i;const a=s?new Ph(i,!0,!1):null;var o=Xh(e.pendingWriteTree_,t._path);return Uh(Nd(n,t,o,s?a.getNode():Ju.EMPTY_NODE,s).viewCache_)}function Yd(e,t){return function t(n,r,i,s){{if(gu(n.path))return Jd(n,r,i,s);{const a=r.get(ou());null==i&&null!=a&&(i=xd(a,ou()));let e=[];const o=cu(n.path),c=n.operationForChild(o),l=r.children.get(o);if(l&&c){const u=i?i.getImmediateChild(o):null,h=ld(s,o);e=e.concat(t(c,l,u,h))}return a&&(e=e.concat(Ad(a,n,s,i))),e}}}(t,e.syncPointTree_,null,Xh(e.pendingWriteTree_,ou()))}function Jd(s,e,a,o){var t=e.get(ou());null==a&&null!=t&&(a=xd(t,ou()));let c=[];return e.children.inorderTraversal((e,t)=>{var n=a?a.getImmediateChild(e):null,r=ld(o,e),i=s.operationForChild(e);i&&(c=c.concat(Jd(i,t,n,r)))}),t&&(c=c.concat(Ad(t,s,o,a))),c}function Xd(i,t){const s=t.query,a=Zd(i,s);return{hashFn:()=>{const e=t.viewCache_.serverCache.getNode()||Ju.EMPTY_NODE;return e.hash()},onComplete:e=>{if("ok"===e)return a?function(e,t,n){if(s=tp(e,n)){var r=np(s),i=r.path,s=r.queryId,r=mu(i,t);return rp(e,i,new Ah(Sh(s),r))}return[]}(i,s._path,a):(t=i,n=s._path,Yd(t,new Ah(Ch(),n)));var t,n,r=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");const r=new Error(e+" at "+t._path.toString()+": "+n);return r.code=e.toUpperCase(),r}(e,s);return Kd(i,s,null,r)}}}function Zd(e,t){var n=ep(t);return e.queryToTagMap.get(n)}function ep(e){return e._path.toString()+"$"+e._queryIdentifier}function tp(e,t){return e.tagToQueryMap.get(t)}function np(e){var t=e.indexOf("$");return f(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new au(e.substr(0,t))}}function rp(e,t,n){var r=e.syncPointTree_.get(t);return f(r,"Missing sync point for query tag that we're tracking"),Ad(r,n,Xh(e.pendingWriteTree_,t),null)}function ip(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?(f(Ud,"Reference.ts has not been loaded"),new Ud(e._repo,e._path)):e}class sp{constructor(e){this.node_=e}getImmediateChild(e){var t=this.node_.getImmediateChild(e);return new sp(t)}node(){return this.node_}}class ap{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){var t=fu(this.path_,e);return new ap(this.syncTree_,t)}node(){return Hd(this.syncTree_,this.path_)}}function op(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e}function cp(e,t,n){return e&&"object"==typeof e?(f(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?lp(e[".sv"],t,n):"object"==typeof e[".sv"]?up(e[".sv"],t):void f(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e}const lp=function(e,t,n){if("timestamp"===e)return n.timestamp;f(!1,"Unexpected server value: "+e)},up=function(e,t,n){e.hasOwnProperty("increment")||f(!1,"Unexpected server value: "+JSON.stringify(e,null,2));var r=e.increment;"number"!=typeof r&&f(!1,"Unexpected increment value: "+r);const i=t.node();if(f(null!==i&&void 0!==i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;const s=i;var a=s.getValue();return"number"!=typeof a?r:a+r},hp=function(e,t,n,r){return pp(t,new ap(n,e),r)},dp=function(e,t,n){return pp(e,new sp(t),n)};function pp(e,r,i){var t=e.getPriority().val(),n=cp(t,r.getImmediateChild(".priority"),i);let s;if(e.isLeafNode()){const a=e;t=cp(a.getValue(),r,i);return t!==a.getValue()||n!==a.getPriority().val()?new qu(t,th(n)):e}{const o=e;return s=o,n!==o.getPriority().val()&&(s=s.updatePriority(new qu(n))),o.forEachChild(zu,(e,t)=>{var n=pp(t,r.getImmediateChild(e),i);n!==t&&(s=s.updateImmediateChild(e,n))}),s}}class fp{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function gp(e,t){let n=t instanceof au?t:new au(t),r=e,i=cu(n);for(;null!==i;){var s=U(r.node.children,i)||{children:{},childCount:0};r=new fp(i,r,s),n=uu(n),i=cu(n)}return r}function mp(e){return e.node.value}function vp(e,t){e.node.value=t,bp(e)}function _p(e){return 0<e.node.childCount}function yp(n,r){Rl(n.node.children,(e,t)=>{r(new fp(e,n,t))})}function wp(e){return new au(null===e.parent?e.name:wp(e.parent)+"/"+e.name)}function bp(e){var t,n,r,i;null!==e.parent&&(t=e.parent,n=e.name,r=function(e){return void 0===mp(e)&&!_p(e)}(e=e),i=F(t.node.children,n),r&&i?(delete t.node.children[n],t.node.childCount--,bp(t)):r||i||(t.node.children[n]=e.node,t.node.childCount++,bp(t)))}function Ip(e,t,n,r){r&&void 0===t||Mp(J(e,"value"),t,n)}function Tp(e,t,r,n){if(!n||void 0!==t){const i=J(e,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(i+" must be an object containing the children to replace.");const s=[];Rl(t,(e,t)=>{const n=new au(e);if(Mp(i,t,fu(r,n)),".priority"===hu(n)&&!Op(t))throw new Error(i+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(n)}),function(t,n){let r,i;for(r=0;r<n.length;r++){i=n[r];var s=du(i);for(let e=0;e<s.length;e++)if((".priority"!==s[e]||e!==s.length-1)&&!Pp(s[e]))throw new Error(t+"contains an invalid key ("+s[e]+") in path "+i.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}n.sort(vu);let e=null;for(r=0;r<n.length;r++){if(i=n[r],null!==e&&yu(e,i))throw new Error(t+"contains a path "+e.toString()+" that is ancestor of another path "+i.toString());e=i}}(i,s)}}function Ep(e,t,n){if(!n||void 0!==t){if(Sl(t))throw new Error(J(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Op(t))throw new Error(J(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}}function Cp(e,t,n,r){if(!(r&&void 0===n||Pp(n)))throw new Error(J(e,t)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')}function Sp(e,t,n,r){n=n&&n.replace(/^\/*\.info(\/|$)/,"/"),Lp(e,t,n,r)}function kp(e,t){if(".info"===cu(t))throw new Error(e+" failed = Can't modify data under /.info/")}const Ap=/[\[\].#$\/\u0000-\u001F\u007F]/,Np=/[\[\].#$\u0000-\u001F\u007F]/,Rp=10485760,Pp=function(e){return"string"==typeof e&&0!==e.length&&!Ap.test(e)},Dp=function(e){return"string"==typeof e&&0!==e.length&&!Np.test(e)},xp=function(e){return e=e&&e.replace(/^\/*\.info(\/|$)/,"/"),Dp(e)},Op=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!Sl(e)||e&&"object"==typeof e&&F(e,".sv")},Mp=function(a,e,t){const o=t instanceof au?new wu(t,a):t;if(void 0===e)throw new Error(a+"contains undefined "+Iu(o));if("function"==typeof e)throw new Error(a+"contains a function "+Iu(o)+" with contents = "+e.toString());if(Sl(e))throw new Error(a+"contains "+e.toString()+" "+Iu(o));if("string"==typeof e&&e.length>Rp/3&&te(e)>Rp)throw new Error(a+"contains a string greater than "+Rp+" utf8 bytes "+Iu(o)+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){let i=!1,s=!1;if(Rl(e,(e,t)=>{if(".value"===e)i=!0;else if(".priority"!==e&&".sv"!==e&&(s=!0,!Pp(e)))throw new Error(a+" contains an invalid key ("+e+") "+Iu(o)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var n,r;n=o,e=e,0<n.parts_.length&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=te(e),bu(n),Mp(a,t,o),t=o,r=t.parts_.pop(),t.byteLength_-=te(r),0<t.parts_.length&&--t.byteLength_}),i&&s)throw new Error(a+' contains ".value" child '+Iu(o)+" in addition to actual children.")}},Lp=function(e,t,n,r){if(!(r&&void 0===n||Dp(n)))throw new Error(J(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Fp=function(e,t){var n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!Pp(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!xp(n))throw new Error(J(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class Up{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Vp(e,t){let n=null;for(let i=0;i<t.length;i++){const s=t[i];var r=s.getPath();null===n||_u(r,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:r}),n.events.push(s)}n&&e.eventLists_.push(n)}function qp(e,t,n){Vp(e,n),jp(e,e=>_u(e,t))}function Bp(e,t,n){Vp(e,n),jp(e,e=>yu(e,t)||yu(t,e))}function jp(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){var r=e.eventLists_[i];r&&(t(r.path)?(function(e){for(let n=0;n<e.events.length;n++){const r=e.events[n];var t;null!==r&&(e.events[n]=null,t=r.getEventRunner(),pl&&Il("event: "+r.toString()),Fl(t))}}(e.eventLists_[i]),e.eventLists_[i]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}const zp="repo_interrupt",$p=25;class Kp{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Up,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=yh(),this.transactionQueueTree_=new fp,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Wp(a,e,t){if(a.stats_=Ql(a.repoInfo_),a.forceRestClient_||function(){const e="object"==typeof window&&window.navigator&&window.navigator.userAgent||"";return 0<=e.search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)}())a.server_=new vh(a.repoInfo_,(e,t,n,r)=>{Qp(a,e,t,n,r)},a.authTokenProvider_,a.appCheckProvider_),setTimeout(()=>Yp(a,!0),0);else{if(null!=t){if("object"!=typeof t)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{M(t)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}a.persistentConnection_=new Eu(a.repoInfo_,e,(e,t,n,r)=>{Qp(a,e,t,n,r)},e=>{Yp(a,e)},e=>{var n;n=a,Rl(e,(e,t)=>{Jp(n,e,t)})},a.authTokenProvider_,a.appCheckProvider_,t),a.server_=a.persistentConnection_}var n;a.authTokenProvider_.addTokenChangeListener(e=>{a.server_.refreshAuthToken(e)}),a.appCheckProvider_.addTokenChangeListener(e=>{a.server_.refreshAppCheckToken(e.token)}),a.statsReporter_=(e=a.repoInfo_,t=()=>new Th(a.stats_,a.server_),n=e.toString(),Hl[n]||(Hl[n]=t()),Hl[n]),a.infoData_=new _h,a.infoSyncTree_=new qd({startListening:(e,t,n,r)=>{let i=[];const s=a.infoData_.getNode(e._path);return s.isEmpty()||(i=$d(a.infoSyncTree_,e._path,s),setTimeout(()=>{r("ok")},0)),i},stopListening:()=>{}}),Jp(a,"connected",!1),a.serverSyncTree_=new qd({startListening:(r,e,t,i)=>(a.server_.listen(r,t,e,(e,t)=>{var n=i(e,t);Bp(a.eventQueue_,r._path,n)}),[]),stopListening:(e,t)=>{a.server_.unlisten(e,t)}})}function Gp(e){const t=e.infoData_.getNode(new au(".info/serverTimeOffset"));var n=t.val()||0;return(new Date).getTime()+n}function Hp(e){return op({timestamp:Gp(e)})}function Qp(e,t,n,r,i){e.dataUpdateCount++;var s,a,o=new au(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let c=[];c=i?r?(s=q(n,e=>th(e)),function(e,t,n,r){if(o=tp(e,r)){var i=np(o),s=i.path,a=i.queryId,o=mu(s,t),i=Bh.fromObject(n);return rp(e,s,new Rh(Sh(a),o,i))}return[]}(e.serverSyncTree_,o,s,i)):(s=th(n),Wd(e.serverSyncTree_,o,s,i)):r?(a=q(n,e=>th(e)),t=e.serverSyncTree_,i=o,r=a,a=Bh.fromObject(r),Yd(t,new Rh(Ch(),i,a))):(a=th(n),$d(e.serverSyncTree_,o,a));let l=o;0<c.length&&(l=lf(e,o)),Bp(e.eventQueue_,l,c)}function Yp(e,t){Jp(e,"connected",t),!1===t&&function(r){sf(r,"onDisconnectEvents");const i=Hp(r),s=yh();bh(r.onDisconnect_,ou(),(e,t)=>{var n=hp(e,t,r.serverSyncTree_,i);wh(s,e,n)});let a=[];bh(s,ou(),(e,t)=>{a=a.concat($d(r.serverSyncTree_,e,t));var n=pf(r,e);lf(r,n)}),r.onDisconnect_=yh(),Bp(r.eventQueue_,ou(),a)}(e)}function Jp(e,t,n){var r=new au("/.info/"+t),i=th(n);e.infoData_.updateSnapshot(r,i);i=$d(e.infoSyncTree_,r,i);Bp(e.eventQueue_,r,i)}function Xp(e){return e.nextWriteId_++}function Zp(r,i,e,t,s){sf(r,"set",{path:i.toString(),value:e,priority:t});var n=Hp(r);const a=th(e,t);var o=Hd(r.serverSyncTree_,i),n=dp(a,o,n);const c=Xp(r);n=Bd(r.serverSyncTree_,i,n,c,!0);Vp(r.eventQueue_,n),r.server_.put(i.toString(),a.val(!0),(e,t)=>{var n="ok"===e;n||El("set at "+i+" failed: "+e);n=zd(r.serverSyncTree_,c,!n);Bp(r.eventQueue_,i,n),af(0,s,e,t)});n=pf(r,i);lf(r,n),Bp(r.eventQueue_,n,[])}function ef(n,r,i){n.server_.onDisconnectCancel(r.toString(),(e,t)=>{"ok"===e&&!function e(n,t){if(gu(t))return n.value=null,n.children.clear(),!0;if(null!==n.value){if(n.value.isLeafNode())return!1;{const i=n.value;return n.value=null,i.forEachChild(zu,(e,t)=>{wh(n,new au(e),t)}),e(n,t)}}if(0<n.children.size){var r=cu(t);return t=uu(t),n.children.has(r)&&e(n.children.get(r),t)&&n.children.delete(r),0===n.children.size}return!0}(n.onDisconnect_,r),af(0,i,e,t)})}function tf(n,r,e,i){const s=th(e);n.server_.onDisconnectPut(r.toString(),s.val(!0),(e,t)=>{"ok"===e&&wh(n.onDisconnect_,r,s),af(0,i,e,t)})}function nf(e,t,n){let r;r=".info"===cu(t._path)?Kd(e.infoSyncTree_,t,n):Kd(e.serverSyncTree_,t,n),qp(e.eventQueue_,t._path,r)}function rf(e){e.persistentConnection_&&e.persistentConnection_.interrupt(zp)}function sf(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),Il(n,...t)}function af(e,r,i,s){r&&Fl(()=>{if("ok"===i)r(null);else{var t=(i||"error").toUpperCase();let e=t;s&&(e+=": "+s);const n=new Error(e);n.code=t,r(n)}})}function of(e,t,n){return Hd(e.serverSyncTree_,t,n)||Ju.EMPTY_NODE}function cf(t,e=t.transactionQueueTree_){if(e||df(t,e),mp(e)){const n=hf(t,e);f(0<n.length,"Sending zero length transaction queue"),n.every(e=>0===e.status)&&function(i,s,a){const e=a.map(e=>e.currentWriteId),t=of(i,s,e);let n=t;var r=t.hash();for(let u=0;u<a.length;u++){const h=a[u];f(0===h.status,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;var o=mu(s,h.path);n=n.updateChild(o,h.currentOutputSnapshotRaw)}const c=n.val(!0),l=s;i.server_.put(l.toString(),c,t=>{sf(i,"transaction put response",{path:l.toString(),status:t});let n=[];if("ok"===t){const r=[];for(let e=0;e<a.length;e++)a[e].status=2,n=n.concat(zd(i.serverSyncTree_,a[e].currentWriteId)),a[e].onComplete&&r.push(()=>a[e].onComplete(null,!0,a[e].currentOutputSnapshotResolved)),a[e].unwatcher();df(i,gp(i.transactionQueueTree_,s)),cf(i,i.transactionQueueTree_),Bp(i.eventQueue_,s,n);for(let t=0;t<r.length;t++)Fl(r[t])}else{if("datastale"===t)for(let e=0;e<a.length;e++)3===a[e].status?a[e].status=4:a[e].status=0;else{El("transaction at "+l.toString()+" failed: "+t);for(let e=0;e<a.length;e++)a[e].status=4,a[e].abortReason=t}lf(i,s)}},r)}(t,wp(e),n)}else _p(e)&&yp(e,e=>{cf(t,e)})}function lf(e,t){var n=uf(e,t),r=wp(n);return function(i,s,a){if(0!==s.length){const l=[];let n=[];const t=s.filter(e=>0===e.status),u=t.map(e=>e.currentWriteId);for(let r=0;r<s.length;r++){const h=s[r];var o=mu(a,h.path);let e=!1,t;if(f(null!==o,"rerunTransactionsUnderNode_: relativePath should not be null."),4===h.status)e=!0,t=h.abortReason,n=n.concat(zd(i.serverSyncTree_,h.currentWriteId,!0));else if(0===h.status)if(h.retryCount>=$p)e=!0,t="maxretry",n=n.concat(zd(i.serverSyncTree_,h.currentWriteId,!0));else{const d=of(i,h.path,u);h.currentInputSnapshot=d;var c=s[r].update(d.val());if(void 0!==c){Mp("transaction failed: Data returned ",c,h.path);let e=th(c);"object"==typeof c&&null!=c&&F(c,".priority")||(e=e.updatePriority(d.getPriority()));o=h.currentWriteId,c=Hp(i),c=dp(e,d,c);h.currentOutputSnapshotRaw=e,h.currentOutputSnapshotResolved=c,h.currentWriteId=Xp(i),u.splice(u.indexOf(o),1),n=n.concat(Bd(i.serverSyncTree_,h.path,c,h.currentWriteId,h.applyLocally)),n=n.concat(zd(i.serverSyncTree_,o,!0))}else e=!0,t="nodata",n=n.concat(zd(i.serverSyncTree_,h.currentWriteId,!0))}Bp(i.eventQueue_,a,n),n=[],e&&(s[r].status=2,function(e){setTimeout(e,Math.floor(0))}(s[r].unwatcher),s[r].onComplete&&("nodata"===t?l.push(()=>s[r].onComplete(null,!1,s[r].currentInputSnapshot)):l.push(()=>s[r].onComplete(new Error(t),!1,null))))}df(i,i.transactionQueueTree_);for(let e=0;e<l.length;e++)Fl(l[e]);cf(i,i.transactionQueueTree_)}}(e,hf(e,n),r),r}function uf(e,t){let n,r=e.transactionQueueTree_;for(n=cu(t);null!==n&&void 0===mp(r);)r=gp(r,n),t=uu(t),n=cu(t);return r}function hf(e,t){const n=[];return function t(n,e,r){const i=mp(e);if(i)for(let e=0;e<i.length;e++)r.push(i[e]);yp(e,e=>{t(n,e,r)})}(e,t,n),n.sort((e,t)=>e.order-t.order),n}function df(t,n){const r=mp(n);if(r){let e=0;for(let t=0;t<r.length;t++)2!==r[t].status&&(r[e]=r[t],e++);r.length=e,vp(n,0<r.length?r:void 0)}yp(n,e=>{df(t,e)})}function pf(t,e){var n=wp(uf(t,e)),r=gp(t.transactionQueueTree_,e);return function(e,t,n){let r=n?e:e.parent;for(;null!==r;){if(t(r))return;r=r.parent}}(r,e=>{ff(t,e)}),ff(t,r),function t(e,n,r,i){r&&!i&&n(e),yp(e,e=>{t(e,n,!0,i)}),r&&i&&n(e)}(r,e=>{ff(t,e)}),n}function ff(i,s){const a=mp(s);if(a){const o=[];let e=[],t=-1;for(let n=0;n<a.length;n++)3===a[n].status||(1===a[n].status?(f(t===n-1,"All SENT items should be at beginning of queue."),t=n,a[n].status=3,a[n].abortReason="set"):(f(0===a[n].status,"Unexpected transaction status in abort"),a[n].unwatcher(),e=e.concat(zd(i.serverSyncTree_,a[n].currentWriteId,!0)),a[n].onComplete&&o.push(a[n].onComplete.bind(null,new Error("set"),!1,null))));-1===t?vp(s,void 0):a.length=t+1,Bp(i.eventQueue_,wp(s),e);for(let r=0;r<o.length;r++)Fl(o[r])}}const gf=function(e,t){var n=mf(e),r=n.namespace;"firebase.com"===n.domain&&Tl(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||Tl("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||Cl();var i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new $l(n.host,n.secure,r,i,t,"",r!==n.subdomain),path:new au(n.pathString)}},mf=function(r){let i="",s="",a="",o="",c="",l=!0,u="https",h=443;if("string"==typeof r){let e=r.indexOf("//");0<=e&&(u=r.substring(0,e-1),r=r.substring(e+2));let t=r.indexOf("/");-1===t&&(t=r.length);let n=r.indexOf("?");-1===n&&(n=r.length),i=r.substring(0,Math.min(t,n)),t<n&&(o=function(e){let t="";var n=e.split("/");for(let r=0;r<n.length;r++)if(0<n[r].length){let e=n[r];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch(e){}t+="/"+e}return t}(r.substring(t,n)));var d,p=function(e){const t={};for(const r of(e="?"===e.charAt(0)?e.substring(1):e).split("&")){var n;0!==r.length&&(2===(n=r.split("=")).length?t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):El(`Invalid query segment '${r}' in query '${e}'`))}return t}(r.substring(Math.min(r.length,n)));e=i.indexOf(":"),0<=e?(l="https"===u||"wss"===u,h=parseInt(i.substring(e+1),10)):e=i.length;const f=i.slice(0,e);"localhost"===f.toLowerCase()?s="localhost":f.split(".").length<=2?s=f:(d=i.indexOf("."),a=i.substring(0,d).toLowerCase(),s=i.substring(d+1),c=a),"ns"in p&&(c=p.ns)}return{host:i,port:h,domain:s,subdomain:a,secure:l,scheme:u,pathString:o,namespace:c}},vf="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",_f=function(){let s=0;const a=[];return function(e){var t=e===s;s=e;let n;const r=new Array(8);for(n=7;0<=n;n--)r[n]=vf.charAt(e%64),e=Math.floor(e/64);f(0===e,"Cannot push at time == 0");let i=r.join("");if(t){for(n=11;0<=n&&63===a[n];n--)a[n]=0;a[n]++}else for(n=0;n<12;n++)a[n]=Math.floor(64*Math.random());for(n=0;n<12;n++)i+=vf.charAt(a[n]);return f(20===i.length,"nextPushId: Length should be 20."),i}}();class yf{constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){var e=this.snapshot.ref;return("value"===this.eventType?e:e.parent)._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+M(this.snapshot.exportVal())}}class wf{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class bf{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return f(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class If{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new y;return ef(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){kp("OnDisconnect.remove",this._path);const e=new y;return tf(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){kp("OnDisconnect.set",this._path),Ip("OnDisconnect.set",e,this._path,!1);const t=new y;return tf(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){kp("OnDisconnect.setWithPriority",this._path),Ip("OnDisconnect.setWithPriority",e,this._path,!1),Ep("OnDisconnect.setWithPriority",t,!1);const n=new y;return function(n,r,e,t,i){const s=th(e,t);n.server_.onDisconnectPut(r.toString(),s.val(!0),(e,t)=>{"ok"===e&&wh(n.onDisconnect_,r,s),af(0,i,e,t)})}(this._repo,this._path,e,t,n.wrapCallback(()=>{})),n.promise}update(e){kp("OnDisconnect.update",this._path),Tp("OnDisconnect.update",e,this._path,!1);const t=new y;return function(r,i,n,s){if(V(n))return Il("onDisconnect().update() called with empty data.  Don't do anything."),af(0,s,"ok",void 0);r.server_.onDisconnectMerge(i.toString(),n,(e,t)=>{"ok"===e&&Rl(n,(e,t)=>{var n=th(t);wh(r.onDisconnect_,fu(i,e),n)}),af(0,s,e,t)})}(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}class Tf{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return gu(this._path)?null:hu(this._path)}get ref(){return new kf(this._repo,this._path)}get _queryIdentifier(){var e=mh(this._queryParams),e=yl(e);return"{}"===e?"default":e}get _queryObject(){return mh(this._queryParams)}isEqual(e){if(!((e=oe(e))instanceof Tf))return!1;var t=this._repo===e._repo,n=_u(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&n&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}function Ef(e,t){if(!0===e._orderByCalled)throw new Error(t+": You can't combine multiple orderBy calls.")}function Cf(e){let t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===Nu){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==kl)throw new Error(r);if("string"!=typeof t)throw new Error(i)}if(e.hasEnd()){if(e.getIndexEndName()!==Al)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(e.getIndex()===zu){if(null!=t&&!Op(t)||null!=n&&!Op(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(f(e.getIndex()instanceof nh||e.getIndex()===rh,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Sf(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class kf extends Tf{constructor(e,t){super(e,t,new hh,!1)}get parent(){var e=pu(this._path);return null===e?null:new kf(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class Af{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){var t=new au(e),n=Pf(this.ref,e);return new Af(this._node.getChild(t),n,zu)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(n){if(this._node.isLeafNode())return!1;const e=this._node;return!!e.forEachChild(this._index,(e,t)=>n(new Af(t,Pf(this.ref,e),zu)))}hasChild(e){var t=new au(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Nf(e,t){return(e=oe(e))._checkNotDeleted("ref"),void 0!==t?Pf(e._root,t):e._root}function Rf(e,t){(e=oe(e))._checkNotDeleted("refFromURL");const n=gf(t,e._repo.repoInfo_.nodeAdmin);Fp("refFromURL",n);var r=n.repoInfo;return e._repo.repoInfo_.isCustomHost()||r.host===e._repo.repoInfo_.host||Tl("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+e._repo.repoInfo_.host+")"),Nf(e,n.path.toString())}function Pf(e,t){return(null===cu((e=oe(e))._path)?Sp:Lp)("child","path",t,!1),new kf(e._repo,fu(e._path,t))}function Df(e,t){e=oe(e),kp("set",e._path),Ip("set",t,e._path,!1);const n=new y;return Zp(e._repo,e._path,t,null,n.wrapCallback(()=>{})),n.promise}function xf(e,t){Tp("update",t,e._path,!1);const n=new y;return function(i,s,e,a){sf(i,"update",{path:s.toString(),value:e});let n=!0;const r=Hp(i),o={};if(Rl(e,(e,t)=>{n=!1,o[e]=hp(fu(s,e),th(t),i.serverSyncTree_,r)}),n)Il("update() called with empty data.  Don't do anything."),af(0,a,"ok",void 0);else{const c=Xp(i);var t=jd(i.serverSyncTree_,s,o,c);Vp(i.eventQueue_,t),i.server_.merge(s.toString(),e,(e,t)=>{var n="ok"===e;n||El("update at "+s+" failed: "+e);var r=zd(i.serverSyncTree_,c,!n),n=0<r.length?lf(i,s):s;Bp(i.eventQueue_,n,r),af(0,a,e,t)}),Rl(e,e=>{var t=pf(i,fu(s,e));lf(i,t)}),Bp(i.eventQueue_,s,[])}}(e._repo,e._path,t,n.wrapCallback(()=>{})),n.promise}function Of(t){t=oe(t);var i,s,a,e=new bf(()=>{}),e=new Mf(e);return i=t._repo,s=t,a=e,(null!=(e=Qd(i.serverSyncTree_,s))?Promise.resolve(e):i.server_.get(s).then(e=>{var t,n=th(e).withIndex(s._queryParams.getIndex());Gd(i.serverSyncTree_,s,a,!0);let r;return r=s._queryParams.loadsAllData()?$d(i.serverSyncTree_,s._path,n):(t=Zd(i.serverSyncTree_,s),Wd(i.serverSyncTree_,s._path,n,t)),Bp(i.eventQueue_,s._path,r),Kd(i.serverSyncTree_,s,a,null,!0),n},e=>(sf(i,"get for query "+M(s)+" failed: "+e),Promise.reject(new Error(e))))).then(e=>new Af(e,new kf(t._repo,t._path),t._queryParams.getIndex()))}class Mf{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){var n=t._queryParams.getIndex();return new yf("value",this,new Af(e.snapshotNode,new kf(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new wf(this,e,t):null}matches(e){return e instanceof Mf&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class Lf{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new wf(this,e,t):null}createEvent(e,t){f(null!=e.childName,"Child events should have a childName.");var n=Pf(new kf(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new yf(e.type,this,new Af(e.snapshotNode,n,r),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof Lf&&(this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)))}hasAnyCallback(){return!!this.callbackContext}}function Ff(n,e,t,r,i){let s;if("object"==typeof r&&(s=void 0,i=r),"function"==typeof r&&(s=r),i&&i.onlyOnce){const c=t;var a=(e,t)=>{nf(n._repo,n,o),c(e,t)};a.userCallback=t.userCallback,a.context=t.context,t=a}a=new bf(t,s||void 0);const o="value"===e?new Mf(a):new Lf(e,a);return function(e,t,n){let r;r=".info"===cu(t._path)?Gd(e.infoSyncTree_,t,n):Gd(e.serverSyncTree_,t,n),qp(e.eventQueue_,t._path,r)}(n._repo,n,o),()=>nf(n._repo,n,o)}function Uf(e,t,n,r){return Ff(e,"value",t,n,r)}function Vf(e,t,n,r){return Ff(e,"child_added",t,n,r)}function qf(e,t,n,r){return Ff(e,"child_changed",t,n,r)}function Bf(e,t,n,r){return Ff(e,"child_moved",t,n,r)}function jf(e,t,n,r){return Ff(e,"child_removed",t,n,r)}function zf(e,t,n){let r=null;var i=n?new bf(n):null;"value"===t?r=new Mf(i):t&&(r=new Lf(t,i)),nf(e._repo,e,r)}class $f{}class Kf extends $f{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Ip("endAt",this._value,e._path,!0);var t=ph(e._queryParams,this._value,this._key);if(Sf(t),Cf(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Tf(e._repo,e._path,t,e._orderByCalled)}}class Wf extends $f{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Ip("endBefore",this._value,e._path,!1);var t=function(e,t,n){let r;return r=e.index_===Nu||n?ph(e,t,n):ph(e,t,kl),r.endBeforeSet_=!0,r}(e._queryParams,this._value,this._key);if(Sf(t),Cf(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Tf(e._repo,e._path,t,e._orderByCalled)}}class Gf extends $f{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Ip("startAt",this._value,e._path,!0);var t=dh(e._queryParams,this._value,this._key);if(Sf(t),Cf(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Tf(e._repo,e._path,t,e._orderByCalled)}}class Hf extends $f{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Ip("startAfter",this._value,e._path,!1);var t=function(e,t,n){let r;return r=e.index_===Nu||n?dh(e,t,n):dh(e,t,Al),r.startAfterSet_=!0,r}(e._queryParams,this._value,this._key);if(Sf(t),Cf(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new Tf(e._repo,e._path,t,e._orderByCalled)}}class Qf extends $f{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new Tf(e._repo,e._path,function(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="l",n}(e._queryParams,this._limit),e._orderByCalled)}}class Yf extends $f{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Tf(e._repo,e._path,function(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="r",n}(e._queryParams,this._limit),e._orderByCalled)}}class Jf extends $f{constructor(e){super(),this._path=e}_apply(e){Ef(e,"orderByChild");var t=new au(this._path);if(gu(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");t=new nh(t),t=fh(e._queryParams,t);return Cf(t),new Tf(e._repo,e._path,t,!0)}}class Xf extends $f{_apply(e){Ef(e,"orderByKey");var t=fh(e._queryParams,Nu);return Cf(t),new Tf(e._repo,e._path,t,!0)}}class Zf extends $f{_apply(e){Ef(e,"orderByPriority");var t=fh(e._queryParams,zu);return Cf(t),new Tf(e._repo,e._path,t,!0)}}class eg extends $f{_apply(e){Ef(e,"orderByValue");var t=fh(e._queryParams,rh);return Cf(t),new Tf(e._repo,e._path,t,!0)}}class tg extends $f{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){if(Ip("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Kf(this._value,this._key)._apply(new Gf(this._value,this._key)._apply(e))}}function ng(e,...t){let n=oe(e);for(const r of t)n=r._apply(n);return n}rl=kf,f(!Sd,"__referenceConstructor has already been defined"),Sd=rl,il=kf,f(!Ud,"__referenceConstructor has already been defined"),Ud=il;const rg="FIREBASE_DATABASE_EMULATOR_HOST",ig={};let sg=!1;function ag(e,t,n,r,i){let s=r||e.options.databaseURL;void 0===s&&(e.options.projectId||Tl("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Il("Using default host for project ",e.options.projectId),s=`${e.options.projectId}-default-rtdb.firebaseio.com`);let a=gf(s,i),o=a.repoInfo,c,l=void 0;"undefined"!=typeof process&&process.env&&(l=process.env[rg]),l?(c=!0,s=`http://${l}?ns=${o.namespace}`,a=gf(s,i),o=a.repoInfo):c=!a.repoInfo.secure;var u=i&&c?new ql(ql.OWNER):new Vl(e.name,e.options,t);Fp("Invalid Firebase Database URL",a),gu(a.path)||Tl("Database URL must point to the root of a Firebase Database (not including a child path).");u=function(e,t,n,r){let i=ig[t.name];i||(i={},ig[t.name]=i);var s=i[e.toURLString()];s&&Tl("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return s=new Kp(e,sg,n,r),i[e.toURLString()]=s}(o,e,u,new Ul(e.name,n));return new og(u,e)}class og{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Wp(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new kf(this._repo,ou())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function(e,t){const n=ig[t];n&&n[e.key]===e||Tl(`Database ${t}(${e.repoInfo_}) has already been deleted.`),rf(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&Tl("Cannot call "+e+" on a deleted database.")}}function cg(){tu.IS_TRANSPORT_INITIALIZED&&El("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function lg(){cg(),Jl.forceDisallow()}function ug(){cg(),eu.forceDisallow(),Jl.forceAllow()}function hg(e,t,n,r={}){(e=oe(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&Tl("Cannot call useEmulator() after instance has already been initialized.");var i,s=e._repoInternal;let a=void 0;s.repoInfo_.nodeAdmin?(r.mockUserToken&&Tl('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),a=new ql(ql.OWNER)):r.mockUserToken&&(i="string"==typeof r.mockUserToken?r.mockUserToken:w(r.mockUserToken,e.app.options.projectId),a=new ql(i)),r=s,e=t,t=n,n=a,r.repoInfo_=new $l(`${e}:${t}`,!1,r.repoInfo_.namespace,r.repoInfo_.webSocketOnly,r.repoInfo_.nodeAdmin,r.repoInfo_.persistenceKey,r.repoInfo_.includeNamespaceInQueryParams,!0),n&&(r.authTokenProvider_=n)}function dg(e){(e=oe(e))._checkNotDeleted("goOnline"),(e=e._repo).persistentConnection_&&e.persistentConnection_.resume(zp)}function pg(e,t){bl(e,t)}const fg={".sv":"timestamp"};class gg{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function mg(i,e,t){if(i=oe(i),kp("Reference.transaction",i._path),".length"===i.key||".keys"===i.key)throw"Reference.transaction failed: "+i.key+" is a read-only object.";var n=null===(r=null==t?void 0:t.applyLocally)||void 0===r||r;const s=new y;var r=Uf(i,()=>{});return function(t,n,e,r,i,s){sf(t,"transaction on "+n);const a={path:n,update:e,onComplete:r,status:null,order:hl(),applyLocally:s,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},o=of(t,n,void 0);a.currentInputSnapshot=o;var c=a.update(o.val());if(void 0===c)a.unwatcher(),a.currentOutputSnapshotRaw=null,a.currentOutputSnapshotResolved=null,a.onComplete&&a.onComplete(null,!1,a.currentInputSnapshot);else{Mp("transaction failed: Data returned ",c,a.path),a.status=0;var l=gp(t.transactionQueueTree_,n);const u=mp(l)||[];u.push(a),vp(l,u);let e;if("object"==typeof c&&null!==c&&F(c,".priority"))e=U(c,".priority"),f(Op(e),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else{const h=Hd(t.serverSyncTree_,n)||Ju.EMPTY_NODE;e=h.getPriority().val()}l=Hp(t),c=th(c,e),l=dp(c,o,l);a.currentOutputSnapshotRaw=c,a.currentOutputSnapshotResolved=l,a.currentWriteId=Xp(t);l=Bd(t.serverSyncTree_,n,l,a.currentWriteId,a.applyLocally);Bp(t.eventQueue_,n,l),cf(t,t.transactionQueueTree_)}}(i._repo,i._path,e,(e,t,n)=>{var r;e?s.reject(e):(r=new Af(n,new kf(i._repo,i._path),zu),s.resolve(new gg(t,r)))},r,n),s.promise}Eu.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},Eu.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},Jc(Je),Ge(new ce("database",(e,{instanceIdentifier:t})=>{return ag(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t)},"PUBLIC").setMultipleInstances(!0)),tt(Qc,"1.0.2",sl),tt(Qc,"1.0.2","esm2017");function vg(e){var t="FIREBASE WARNING: "+e;_g.warn(t)}const _g=new ve("@firebase/database-compat");class yg{constructor(e){this._delegate=e}cancel(t){Y("OnDisconnect.cancel",0,1,arguments.length),X("OnDisconnect.cancel","onComplete",t,!0);const e=this._delegate.cancel();return t&&e.then(()=>t(null),e=>t(e)),e}remove(t){Y("OnDisconnect.remove",0,1,arguments.length),X("OnDisconnect.remove","onComplete",t,!0);const e=this._delegate.remove();return t&&e.then(()=>t(null),e=>t(e)),e}set(e,t){Y("OnDisconnect.set",1,2,arguments.length),X("OnDisconnect.set","onComplete",t,!0);const n=this._delegate.set(e);return t&&n.then(()=>t(null),e=>t(e)),n}setWithPriority(e,t,n){Y("OnDisconnect.setWithPriority",2,3,arguments.length),X("OnDisconnect.setWithPriority","onComplete",n,!0);const r=this._delegate.setWithPriority(e,t);return n&&r.then(()=>n(null),e=>n(e)),r}update(t,n){if(Y("OnDisconnect.update",1,2,arguments.length),Array.isArray(t)){const r={};for(let e=0;e<t.length;++e)r[""+e]=t[e];t=r,vg("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}X("OnDisconnect.update","onComplete",n,!0);const e=this._delegate.update(t);return n&&e.then(()=>n(null),e=>n(e)),e}}class wg{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return Y("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}class bg{constructor(e,t){this._database=e,this._delegate=t}val(){return Y("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return Y("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return Y("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return Y("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return Y("DataSnapshot.child",0,1,arguments.length),e=String(e),Lp("DataSnapshot.child","path",e,!1),new bg(this._database,this._delegate.child(e))}hasChild(e){return Y("DataSnapshot.hasChild",1,1,arguments.length),Lp("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return Y("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(t){return Y("DataSnapshot.forEach",1,1,arguments.length),X("DataSnapshot.forEach","action",t,!1),this._delegate.forEach(e=>t(new bg(this._database,e)))}hasChildren(){return Y("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return Y("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return Y("DataSnapshot.ref",0,0,arguments.length),new Tg(this._database,this._delegate.ref)}get ref(){return this.getRef()}}class Ig{constructor(e,t){this.database=e,this._delegate=t}on(e,n,t,r){var i;Y("Query.on",2,4,arguments.length),X("Query.on","callback",n,!1);const s=Ig.getCancelAndContextArgs_("Query.on",t,r);var a=(e,t)=>{n.call(s.context,new bg(this.database,e),t)};a.userCallback=n,a.context=s.context;var o=null===(i=s.cancel)||void 0===i?void 0:i.bind(s.context);switch(e){case"value":return Uf(this._delegate,a,o),n;case"child_added":return Vf(this._delegate,a,o),n;case"child_removed":return jf(this._delegate,a,o),n;case"child_changed":return qf(this._delegate,a,o),n;case"child_moved":return Bf(this._delegate,a,o),n;default:throw new Error(J("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,n){var r;Y("Query.off",0,3,arguments.length),function(e,t,n){if(!n||void 0!==t)switch(t){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(J(e,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}("Query.off",e,!0),X("Query.off","callback",t,!0),Z("Query.off","context",n,!0),t?((r=()=>{}).userCallback=t,r.context=n,zf(this._delegate,e,r)):zf(this._delegate,e)}get(){return Of(this._delegate).then(e=>new bg(this.database,e))}once(e,r,t,n){Y("Query.once",1,4,arguments.length),X("Query.once","callback",r,!0);const i=Ig.getCancelAndContextArgs_("Query.once",t,n),s=new y;var a=(e,t)=>{var n=new bg(this.database,e);r&&r.call(i.context,n,t),s.resolve(n)};a.userCallback=r,a.context=i.context;var o=e=>{i.cancel&&i.cancel.call(i.context,e),s.reject(e)};switch(e){case"value":Uf(this._delegate,a,o,{onlyOnce:!0});break;case"child_added":Vf(this._delegate,a,o,{onlyOnce:!0});break;case"child_removed":jf(this._delegate,a,o,{onlyOnce:!0});break;case"child_changed":qf(this._delegate,a,o,{onlyOnce:!0});break;case"child_moved":Bf(this._delegate,a,o,{onlyOnce:!0});break;default:throw new Error(J("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return s.promise}limitToFirst(e){return Y("Query.limitToFirst",1,1,arguments.length),new Ig(this.database,ng(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new Qf(e)}(e)))}limitToLast(e){return Y("Query.limitToLast",1,1,arguments.length),new Ig(this.database,ng(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new Yf(e)}(e)))}orderByChild(e){return Y("Query.orderByChild",1,1,arguments.length),new Ig(this.database,ng(this._delegate,function(e){if("$key"===e)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===e)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===e)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Lp("orderByChild","path",e,!1),new Jf(e)}(e)))}orderByKey(){return Y("Query.orderByKey",0,0,arguments.length),new Ig(this.database,ng(this._delegate,new Xf))}orderByPriority(){return Y("Query.orderByPriority",0,0,arguments.length),new Ig(this.database,ng(this._delegate,new Zf))}orderByValue(){return Y("Query.orderByValue",0,0,arguments.length),new Ig(this.database,ng(this._delegate,new eg))}startAt(e=null,t){return Y("Query.startAt",0,2,arguments.length),new Ig(this.database,ng(this._delegate,([e=null,t]=[e,t],Cp("startAt","key",t,!0),new Gf(e,t))))}startAfter(e=null,t){return Y("Query.startAfter",0,2,arguments.length),new Ig(this.database,ng(this._delegate,(e=e,t=t,Cp("startAfter","key",t,!0),new Hf(e,t))))}endAt(e=null,t){return Y("Query.endAt",0,2,arguments.length),new Ig(this.database,ng(this._delegate,(e=e,t=t,Cp("endAt","key",t,!0),new Kf(e,t))))}endBefore(e=null,t){return Y("Query.endBefore",0,2,arguments.length),new Ig(this.database,ng(this._delegate,(e=e,t=t,Cp("endBefore","key",t,!0),new Wf(e,t))))}equalTo(e,t){return Y("Query.equalTo",1,2,arguments.length),new Ig(this.database,ng(this._delegate,(e=e,t=t,Cp("equalTo","key",t,!0),new tg(e,t))))}toString(){return Y("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return Y("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(Y("Query.isEqual",1,1,arguments.length),e instanceof Ig)return this._delegate.isEqual(e._delegate);throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.")}static getCancelAndContextArgs_(e,t,n){const r={cancel:void 0,context:void 0};if(t&&n)r.cancel=t,X(e,"cancel",r.cancel,!0),r.context=n,Z(e,"context",r.context,!0);else if(t)if("object"==typeof t&&null!==t)r.context=t;else{if("function"!=typeof t)throw new Error(J(e,"cancelOrContext")+" must either be a cancel callback or a context object.");r.cancel=t}return r}get ref(){return new Tg(this.database,new kf(this._delegate._repo,this._delegate._path))}}class Tg extends Ig{constructor(e,t){super(e,new Tf(t._repo,t._path,new hh,!1)),this.database=e,this._delegate=t}getKey(){return Y("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return Y("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new Tg(this.database,Pf(this._delegate,e))}getParent(){Y("Reference.parent",0,0,arguments.length);var e=this._delegate.parent;return e?new Tg(this.database,e):null}getRoot(){return Y("Reference.root",0,0,arguments.length),new Tg(this.database,this._delegate.root)}set(e,t){Y("Reference.set",1,2,arguments.length),X("Reference.set","onComplete",t,!0);const n=Df(this._delegate,e);return t&&n.then(()=>t(null),e=>t(e)),n}update(t,n){if(Y("Reference.update",1,2,arguments.length),Array.isArray(t)){const r={};for(let e=0;e<t.length;++e)r[""+e]=t[e];t=r,vg("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}kp("Reference.update",this._delegate._path),X("Reference.update","onComplete",n,!0);const e=xf(this._delegate,t);return n&&e.then(()=>n(null),e=>n(e)),e}setWithPriority(e,t,n){Y("Reference.setWithPriority",2,3,arguments.length),X("Reference.setWithPriority","onComplete",n,!0);const r=function(e,t,n){if(kp("setWithPriority",e._path),Ip("setWithPriority",t,e._path,!1),Ep("setWithPriority",n,!1),".length"===e.key||".keys"===e.key)throw"setWithPriority failed: "+e.key+" is a read-only object.";const r=new y;return Zp(e._repo,e._path,t,n,r.wrapCallback(()=>{})),r.promise}(this._delegate,e,t);return n&&r.then(()=>n(null),e=>n(e)),r}remove(t){Y("Reference.remove",0,1,arguments.length),X("Reference.remove","onComplete",t,!0);const e=(n=this._delegate,kp("remove",n._path),Df(n,null));var n;return t&&e.then(()=>t(null),e=>t(e)),e}transaction(e,t,n){Y("Reference.transaction",1,3,arguments.length),X("Reference.transaction","transactionUpdate",e,!1),X("Reference.transaction","onComplete",t,!0),function(e,t,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(J(e,t)+"must be a boolean.")}("Reference.transaction","applyLocally",n,!0);const r=mg(this._delegate,e,{applyLocally:n}).then(e=>new wg(e.committed,new bg(this.database,e.snapshot)));return t&&r.then(e=>t(null,e.committed,e.snapshot),e=>t(e,!1,null)),r}setPriority(e,t){Y("Reference.setPriority",1,2,arguments.length),X("Reference.setPriority","onComplete",t,!0);const n=function(e,t){e=oe(e),kp("setPriority",e._path),Ep("setPriority",t,!1);const n=new y;return Zp(e._repo,fu(e._path,".priority"),t,null,n.wrapCallback(()=>{})),n.promise}(this._delegate,e);return t&&n.then(()=>t(null),e=>t(e)),n}push(e,t){Y("Reference.push",0,2,arguments.length),X("Reference.push","onComplete",t,!0);const n=function(e,t){e=oe(e),kp("push",e._path),Ip("push",t,e._path,!0);var n=Gp(e._repo),n=_f(n);const r=Pf(e,n),i=Pf(e,n);let s;return s=null!=t?Df(i,t).then(()=>i):Promise.resolve(i),r.then=s.then.bind(s),r.catch=s.then.bind(s,void 0),r}(this._delegate,e),r=n.then(e=>new Tg(this.database,e));t&&r.then(()=>t(null),e=>t(e));const i=new Tg(this.database,n);return i.then=r.then.bind(r),i.catch=r.catch.bind(r,void 0),i}onDisconnect(){return kp("Reference.onDisconnect",this._delegate._path),new yg(new If(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}}class Eg{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:lg,forceLongPolling:ug}}useEmulator(e,t,n={}){hg(this._delegate,e,t,n)}ref(e){if(Y("database.ref",0,1,arguments.length),e instanceof Tg){var t=Rf(this._delegate,e.toString());return new Tg(this,t)}t=Nf(this._delegate,e);return new Tg(this,t)}refFromURL(e){Y("database.refFromURL",1,1,arguments.length);var t=Rf(this._delegate,e);return new Tg(this,t)}goOffline(){var e;Y("database.goOffline",0,0,arguments.length),(e=oe(e=this._delegate))._checkNotDeleted("goOffline"),rf(e._repo)}goOnline(){return Y("database.goOnline",0,0,arguments.length),dg(this._delegate)}}Eg.ServerValue={TIMESTAMP:fg,increment:e=>({".sv":{increment:e}})};var Cg,Sg=Object.freeze({__proto__:null,initStandalone:function({app:e,url:t,version:n,customAuthImpl:r,customAppCheckImpl:i,namespace:s,nodeAdmin:a=!1}){Jc(n);var o=new he("database-standalone");const c=new ue("auth-internal",o);c.setComponent(new ce("auth-internal",()=>r,"PRIVATE"));let l=void 0;return i&&(l=new ue("app-check-internal",o),l.setComponent(new ce("app-check-internal",()=>i,"PRIVATE"))),{instance:new Eg(ag(e,c,l,t,a),e),namespace:s}}});const kg=Eg.ServerValue;(Cg=bt).INTERNAL.registerComponent(new ce("database-compat",(e,{instanceIdentifier:t})=>{var n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("database").getImmediate({identifier:t});return new Eg(r,n)},"PUBLIC").setServiceProps({Reference:Tg,Query:Ig,Database:Eg,DataSnapshot:bg,enableLogging:pg,INTERNAL:Sg,ServerValue:kg}).setMultipleInstances(!0)),Cg.registerVersion("@firebase/database-compat","1.0.2");var yt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Ag={},Ng=yt||self;function Rg(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function Pg(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var Dg="closure_uid_"+(1e9*Math.random()>>>0),xg=0;function Og(e,t,n){return e.call.apply(e.bind,arguments)}function Mg(t,n,e){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,r),t.apply(n,e)}}return function(){return t.apply(n,arguments)}}function Lg(e,t,n){return(Lg=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Og:Mg).apply(null,arguments)}function Fg(t){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function Ug(e,s){function t(){}t.prototype=s.prototype,e.$=s.prototype,e.prototype=new t,(e.prototype.constructor=e).ac=function(e,t,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return s.prototype[t].apply(e,r)}}function Vg(){this.s=this.s,this.o=this.o}Vg.prototype.s=!1,Vg.prototype.sa=function(){var e;!this.s&&(this.s=!0,this.N(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,Dg)&&e[Dg]||(e[Dg]=++xg))},Vg.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const qg=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function Bg(t){var n=t.length;if(0<n){const r=Array(n);for(let e=0;e<n;e++)r[e]=t[e];return r}return[]}function jg(t){for(let e=1;e<arguments.length;e++){var n=arguments[e];if(Rg(n)){var r=t.length||0,i=n.length||0;t.length=r+i;for(let e=0;e<i;e++)t[r+e]=n[e]}else t.push(n)}}function zg(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}zg.prototype.h=function(){this.defaultPrevented=!0};var $g=function(){if(!Ng.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{var n=()=>{};Ng.addEventListener("test",n,t),Ng.removeEventListener("test",n,t)}catch(e){}return e}();function Kg(e){return/^[\s\xa0]*$/.test(e)}function Wg(){var e=Ng.navigator;return(e=e&&e.userAgent)?e:""}function Gg(e){return-1!=Wg().indexOf(e)}function Hg(e){return Hg[" "](e),e}Hg[" "]=function(){};var Qg,Yg=Gg("Opera"),Jg=Gg("Trident")||Gg("MSIE"),Xg=Gg("Edge"),Zg=Xg||Jg,em=Gg("Gecko")&&!(-1!=Wg().toLowerCase().indexOf("webkit")&&!Gg("Edge"))&&!(Gg("Trident")||Gg("MSIE"))&&!Gg("Edge"),tm=-1!=Wg().toLowerCase().indexOf("webkit")&&!Gg("Edge");function nm(){var e=Ng.document;return e?e.documentMode:void 0}e:{var rm="",im=(im=Wg(),em?/rv:([^\);]+)(\)|;)/.exec(im):Xg?/Edge\/([\d\.]+)/.exec(im):Jg?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(im):tm?/WebKit\/(\S+)/.exec(im):Yg?/(?:Version)[ \/]?(\S+)/.exec(im):void 0);if(im&&(rm=im?im[1]:""),Jg){im=nm();if(null!=im&&im>parseFloat(rm)){Qg=String(im);break e}}Qg=rm}var sm=Ng.document&&Jg&&(nm()||parseInt(Qg,10))||void 0;function am(e,t){if(zg.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(em){e:{try{Hg(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:om[e.pointerType]||"",this.state=e.state,(this.i=e).defaultPrevented&&am.$.h.call(this)}}Ug(am,zg);var om={2:"touch",3:"pen",4:"mouse"};am.prototype.h=function(){am.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var cm="closure_listenable_"+(1e6*Math.random()|0),lm=0;function um(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.la=i,this.key=++lm,this.fa=this.ia=!1}function hm(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function dm(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function pm(e){const t={};for(const n in e)t[n]=e[n];return t}const fm="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function gm(t){let n,r;for(let i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(let e=0;e<fm.length;e++)n=fm[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function mm(e){this.src=e,this.g={},this.h=0}function vm(e,t){var n,r,i,s=t.type;s in e.g&&(n=e.g[s],(i=0<=(r=qg(n,t)))&&Array.prototype.splice.call(n,r,1),i&&(hm(t),0==e.g[s].length&&(delete e.g[s],e.h--)))}function _m(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.fa&&s.listener==t&&s.capture==!!n&&s.la==r)return i}return-1}mm.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var a=_m(e,t,r,i);return-1<a?(t=e[a],n||(t.ia=!1)):((t=new um(t,this.src,s,!!r,i)).ia=n,e.push(t)),t};var ym="closure_lm_"+(1e6*Math.random()|0),wm={};function bm(e,t,n,r,i){if(r&&r.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}r=Am(r);return t&&t[cm]?t.P(n,r,Pg(i)?!!i.capture:!!i,s):Im(t,n,r,!0,i,s)}(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)bm(e,t[s],n,r,i);return null}return n=Am(n),e&&e[cm]?e.O(t,n,Pg(r)?!!r.capture:!!r,i):Im(e,t,n,!1,r,i)}function Im(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var a=Pg(i)?!!i.capture:!!i,o=Sm(e);if(o||(e[ym]=o=new mm(e)),(n=o.add(t,n,r,a,s)).proxy)return n;if(r=function(){const n=Cm;return function e(t){return n.call(e.src,e.listener,t)}}(),(n.proxy=r).src=e,r.listener=n,e.addEventListener)void 0===(i=!$g?a:i)&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Em(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function Tm(e){var t,n,r;"number"!=typeof e&&e&&!e.fa&&((t=e.src)&&t[cm]?vm(t.i,e):(n=e.type,r=e.proxy,t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Em(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Sm(t))?(vm(n,e),0==n.h&&(n.src=null,t[ym]=null)):hm(e)))}function Em(e){return e in wm?wm[e]:wm[e]="on"+e}function Cm(e,t){var n,r;return e=!!e.fa||(t=new am(t,this),n=e.listener,r=e.la||e.src,e.ia&&Tm(e),n.call(r,t))}function Sm(e){return(e=e[ym])instanceof mm?e:null}var km="__closure_events_fn_"+(1e9*Math.random()>>>0);function Am(t){return"function"==typeof t?t:(t[km]||(t[km]=function(e){return t.handleEvent(e)}),t[km])}function Nm(){Vg.call(this),this.i=new mm(this),(this.S=this).J=null}function Rm(e,t){var n,r=e.J;if(r)for(n=[];r;r=r.J)n.push(r);if(e=e.S,r=t.type||t,"string"==typeof t?t=new zg(t,e):t instanceof zg?t.target=t.target||e:(a=t,gm(t=new zg(r,e),a)),a=!0,n)for(var i=n.length-1;0<=i;i--)var s=t.g=n[i],a=Pm(s,r,!0,t)&&a;if(a=Pm(s=t.g=e,r,!0,t)&&a,a=Pm(s,r,!1,t)&&a,n)for(i=0;i<n.length;i++)a=Pm(s=t.g=n[i],r,!1,t)&&a}function Pm(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var a,o,c=t[s];c&&!c.fa&&c.capture==n&&(a=c.listener,o=c.la||c.src,c.ia&&vm(e.i,c),i=!1!==a.call(o,r)&&i)}return i&&!r.defaultPrevented}Ug(Nm,Vg),Nm.prototype[cm]=!0,Nm.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);else i=Pg(i)?!!i.capture:!!i,r=Am(r),t&&t[cm]?(t=t.i,(n=String(n).toString())in t.g&&-1<(r=_m(a=t.g[n],r,i,s))&&(hm(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete t.g[n],t.h--))):(t=t&&Sm(t))&&(n=t.g[n.toString()],(r=(t=-1)<(t=n?_m(n,r,i,s):t)?n[t]:null)&&Tm(r))}(this,e,t,n,r)},Nm.prototype.N=function(){if(Nm.$.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)hm(n[r]);delete t.g[e],t.h--}}this.J=null},Nm.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},Nm.prototype.P=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var Dm=Ng.JSON.stringify;var xm=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new Om,e=>e.reset());class Om{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let Mm,Lm=!1,Fm=new class{constructor(){this.h=this.g=null}add(e,t){const n=xm.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},Um=()=>{const e=Ng.Promise.resolve(void 0);Mm=()=>{e.then(Vm)}};var Vm=()=>{for(var e;e=function(){var e=Fm;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}();){try{e.h.call(e.g)}catch(e){!function(e){Ng.setTimeout(()=>{throw e},0)}(e)}var t=xm;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}Lm=!1};function qm(e,t){Nm.call(this),this.h=e||1,this.g=t||Ng,this.j=Lg(this.qb,this),this.l=Date.now()}function Bm(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}function jm(e,t,n){if("function"==typeof e)n&&(e=Lg(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=Lg(e.handleEvent,e)}return 2147483647<Number(t)?-1:Ng.setTimeout(e,t||0)}Ug(qm,Nm),(It=qm.prototype).ga=!1,It.T=null,It.qb=function(){var e;this.ga&&(0<(e=Date.now()-this.l)&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Rm(this,"tick"),this.ga&&(Bm(this),this.start())))},It.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},It.N=function(){qm.$.N.call(this),Bm(this),delete this.g};class zm extends Vg{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=jm(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.j);var n=t.h;t.h=null,t.m.apply(null,n)}(this)}N(){super.N(),this.g&&(Ng.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function $m(e){Vg.call(this),this.h=e,this.g={}}Ug($m,Vg);var Km=[];function Wm(e,t,n,r){Array.isArray(n)||(n&&(Km[0]=n.toString()),n=Km);for(var i=0;i<n.length;i++){var s=bm(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function Gm(e){dm(e.g,function(e,t){this.g.hasOwnProperty(t)&&Tm(e)},e),e.g={}}function Hm(){this.g=!0}function Qm(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<i.length;a++)i[a]=""}}}return Dm(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}$m.prototype.N=function(){$m.$.N.call(this),Gm(this)},$m.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Hm.prototype.Ea=function(){this.g=!1},Hm.prototype.info=function(){};var Ym={},Jm=null;function Xm(){return Jm=Jm||new Nm}function Zm(e){zg.call(this,Ym.Ta,e)}function ev(){var e=Xm();Rm(e,new Zm(e))}function tv(e,t){zg.call(this,Ym.STAT_EVENT,e),this.stat=t}function nv(e){var t=Xm();Rm(t,new tv(t,e))}function rv(e,t){zg.call(this,Ym.Ua,e),this.size=t}function iv(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return Ng.setTimeout(function(){e()},t)}Ym.Ta="serverreachability",Ug(Zm,zg),Ym.STAT_EVENT="statevent",Ug(tv,zg),Ym.Ua="timingevent",Ug(rv,zg);Tt={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},al={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function sv(){}function av(e){return e.h||(e.h=e.i())}function ov(){}sv.prototype.h=null;yt={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function cv(){zg.call(this,"d")}function lv(){zg.call(this,"c")}function uv(){}function hv(e,t,n,r){this.l=e,this.j=t,this.m=n,this.W=r||1,this.U=new $m(this),this.P=fv,this.V=new qm(e=Zg?125:void 0),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new dv}function dv(){this.i=null,this.g="",this.h=!1}Ug(cv,zg),Ug(lv,zg),Ug(uv,sv),uv.prototype.g=function(){return new XMLHttpRequest},uv.prototype.i=function(){return{}};var pv=new uv,fv=45e3,gv={},mv={};function vv(e,t,n){e.L=1,e.A=Mv(Rv(t)),e.u=n,e.S=!0,_v(e,null)}function _v(e,t){e.G=Date.now(),bv(e),e.B=Rv(e.A);var a,o,c,l,u,h,n=e.B,r=e.W;Array.isArray(r)||(r=[String(r)]),Hv(n.i,"t",r),e.o=0,n=e.l.J,e.h=new dv,e.g=G_(e.l,n?t:null,!e.u),0<e.O&&(e.M=new zm(Lg(e.Pa,e,e.g),e.O)),Wm(e.U,e.g,"readystatechange",e.nb),t=e.I?pm(e.I):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.B,e.v,e.u,t)):(e.v="GET",e.g.ha(e.B,e.v,null,t)),ev(),a=e.j,o=e.v,c=e.B,l=e.m,u=e.W,h=e.u,a.info(function(){if(a.g)if(h)for(var e="",t=h.split("&"),n=0;n<t.length;n++){var r,i,s=t[n].split("=");1<s.length&&(r=s[0],s=s[1],e=2<=(i=r.split("_")).length&&"type"==i[1]?e+(r+"=")+s+"&":e+(r+"=redacted&"))}else e=null;else e=h;return"XMLHTTP REQ ("+l+") [attempt "+u+"]: "+o+"\n"+c+"\n"+e})}function yv(e){return e.g&&("GET"==e.v&&2!=e.L&&e.l.Ha)}function wv(e,t,n){let r=!0,i;for(;!e.J&&e.o<n.length;){if(a=n,c=o=void 0,o=(s=e).o,(i=-1==(c=a.indexOf("\n",o))?mv:(o=Number(a.substring(o,c)),isNaN(o)?gv:(c+=1)+o>a.length?mv:(a=a.slice(c,c+o),s.o=c+o,a)))==mv){4==t&&(e.s=4,nv(14),r=!1),Qm(e.j,e.m,null,"[Incomplete Response]");break}if(i==gv){e.s=4,nv(15),Qm(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}Qm(e.j,e.m,i,null),Sv(e,i)}var s,a,o,c;yv(e)&&0!=e.o&&(e.h.g=e.h.g.slice(e.o),e.o=0),4!=t||0!=n.length||e.h.h||(e.s=1,nv(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.ba&&(e.ba=!0,(t=e.l).g==e&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),V_(t),t.M=!0,nv(11))):(Qm(e.j,e.m,n,"[Invalid Chunked Response]"),Cv(e),Ev(e))}function bv(e){e.Y=Date.now()+e.P,Iv(e,e.P)}function Iv(e,t){if(null!=e.C)throw Error("WatchDog timer not null");e.C=iv(Lg(e.lb,e),t)}function Tv(e){e.C&&(Ng.clearTimeout(e.C),e.C=null)}function Ev(e){0==e.l.H||e.J||j_(e.l,e)}function Cv(e){Tv(e);var t=e.M;t&&"function"==typeof t.sa&&t.sa(),e.M=null,Bm(e.V),Gm(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.sa())}function Sv(e,t){try{var n=e.l;if(0!=n.H&&(n.g==e||e_(n.i,e)))if(!e.K&&e_(n.i,e)&&3==n.H){try{var r=n.Ja.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.G+3e3<e.G))break e;B_(n),P_(n)}U_(n),nv(18)}}else n.Fa=i[1],0<n.Fa-n.V&&i[2]<37500&&n.G&&0==n.A&&!n.v&&(n.v=iv(Lg(n.ib,n),6e3));if(Zv(n.i)<=1&&n.oa){try{n.oa()}catch(e){}n.oa=void 0}}else $_(n,11)}else if(!e.K&&n.g!=e||B_(n),!Kg(t))for(i=n.Ja.g.parse(t),t=0;t<i.length;t++){var s=i[t];if(n.V=s[0],s=s[1],2==n.H)if("c"==s[0]){n.K=s[1],n.pa=s[2];var a=s[3];null!=a&&(n.ra=a,n.l.info("VER="+n.ra));var o=s[4];null!=o&&(n.Ga=o,n.l.info("SVER="+n.Ga));var c,l,u=s[5];null!=u&&"number"==typeof u&&0<u&&(r=1.5*u,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;const f=e.g;if(f){const g=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;g&&((c=r.i).g||-1==g.indexOf("spdy")&&-1==g.indexOf("quic")&&-1==g.indexOf("h2")||(c.j=c.l,c.g=new Set,c.h&&(t_(c,c.h),c.h=null))),!r.F||(l=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null)&&(r.Da=l,Ov(r.I,r.F,l))}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-e.G,n.l.info("Handshake RTT: "+n.S+"ms"));var h,d,p=e;(r=n).wa=W_(r,r.J?r.pa:null,r.Y),p.K?(n_(r.i,p),h=p,(d=r.L)&&h.setTimeout(d),h.C&&(Tv(h),bv(h)),r.g=p):F_(r),0<n.j.length&&x_(n)}else"stop"!=s[0]&&"close"!=s[0]||$_(n,7);else 3==n.H&&("stop"==s[0]||"close"==s[0]?"stop"==s[0]?$_(n,7):R_(n):"noop"!=s[0]&&n.h&&n.h.Aa(s),n.A=0)}ev()}catch(e){}}function kv(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(Rg(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.ta&&"function"==typeof e.ta)return e.ta();if(!e.Z||"function"!=typeof e.Z){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(Rg(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.Z&&"function"==typeof e.Z)return e.Z();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(Rg(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}(It=hv.prototype).setTimeout=function(e){this.P=e},It.nb=function(e){e=e.target;const t=this.M;t&&3==E_(e)?t.l():this.Pa(e)},It.Pa=function(e){try{if(e==this.g)e:{var t=E_(this.g),n=this.g.Ia();this.g.da();if(!(t<3)&&(3!=t||Zg||this.g&&(this.h.h||this.g.ja()||C_(this.g)))){this.J||4!=t||7==n||ev(),Tv(this);var r=this.g.da();this.ca=r;t:if(yv(this)){var i=C_(this.g);e="";var s=i.length,a=4==E_(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Cv(this),Ev(this);var o="";break t}this.h.i=new Ng.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,e+=this.h.i.decode(i[n],{stream:a&&n==s-1});i.length=0,this.h.g+=e,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=200==r,h=this.j,d=this.v,p=this.B,f=this.m,g=this.W,m=t,v=r,h.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+g+"]: "+d+"\n"+p+"\n"+m+" "+v}),this.i){if(this.aa&&!this.K){t:{if(this.g){var c,l=this.g;if((c=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Kg(c)){var u=c;break t}}u=null}if(!(r=u)){this.i=!1,this.s=3,nv(12),Cv(this),Ev(this);break e}Qm(this.j,this.m,r,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Sv(this,r)}this.S?(wv(this,t,o),Zg&&this.i&&3==t&&(Wm(this.U,this.V,"tick",this.mb),this.V.start())):(Qm(this.j,this.m,o,null),Sv(this,o)),4==t&&Cv(this),this.i&&!this.J&&(4==t?j_(this.l,this):(this.i=!1,bv(this)))}else(function(e){const t={};e=(e.g&&2<=E_(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let i=0;i<e.length;i++)if(!Kg(e[i])){var n=function(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}(e[i]),r=n[0];if("string"==typeof(n=n[1])){n=n.trim();const s=t[r]||[];t[r]=s,s.push(n)}}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,function(e){return e.join(", ")})})(this.g),400==r&&0<o.indexOf("Unknown SID")?(this.s=3,nv(12)):(this.s=0,nv(13)),Cv(this),Ev(this)}}}catch(e){}var h,d,p,f,g,m,v},It.mb=function(){var e,t;this.g&&(e=E_(this.g),t=this.g.ja(),this.o<t.length&&(Tv(this),wv(this,e,t),this.i&&4!=e&&bv(this)))},It.cancel=function(){this.J=!0,Cv(this)},It.lb=function(){this.C=null;var e,t,n=Date.now();0<=n-this.Y?(e=this.j,t=this.B,e.info(function(){return"TIMEOUT: "+t}),2!=this.L&&(ev(),nv(17)),Cv(this),this.s=2,Ev(this)):Iv(this,this.Y-n)};var Av=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Nv(e){var t,n;this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof Nv?(this.h=e.h,Pv(this,e.j),this.s=e.s,this.g=e.g,Dv(this,e.m),this.l=e.l,t=e.i,(n=new $v).i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),xv(this,n),this.o=e.o):e&&(t=String(e).match(Av))?(this.h=!1,Pv(this,t[1]||"",!0),this.s=Lv(t[2]||""),this.g=Lv(t[3]||"",!0),Dv(this,t[4]),this.l=Lv(t[5]||"",!0),xv(this,t[6]||"",!0),this.o=Lv(t[7]||"")):(this.h=!1,this.i=new $v(null,this.h))}function Rv(e){return new Nv(e)}function Pv(e,t,n){e.j=n?Lv(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Dv(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.m=t}else e.m=null}function xv(e,t,n){var r,i;t instanceof $v?(e.i=t,r=e.i,(i=e.h)&&!r.j&&(Kv(r),r.i=null,r.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(Wv(this,t),Hv(this,n,e))},r)),r.j=i):(n||(t=Fv(t,jv)),e.i=new $v(t,e.h))}function Ov(e,t,n){e.i.set(t,n)}function Mv(e){return Ov(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Lv(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Fv(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,Uv),e=n?e.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):e):null}function Uv(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Nv.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Fv(t,Vv,!0),":");var n=this.g;return!n&&"file"!=t||(e.push("//"),(t=this.s)&&e.push(Fv(t,Vv,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(Fv(n,"/"==n.charAt(0)?Bv:qv,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",Fv(n,zv)),e.join("")};var Vv=/[#\/\?@]/g,qv=/[#\?:]/g,Bv=/[#\?]/g,jv=/[#\?@]/g,zv=/#/g;function $v(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Kv(n){n.g||(n.g=new Map,n.h=0,n.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r,i=e[n].indexOf("="),s=null;0<=i?(r=e[n].substring(0,i),s=e[n].substring(i+1)):r=e[n],t(r,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function Wv(e,t){Kv(e),t=Qv(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Gv(e,t){return Kv(e),t=Qv(e,t),e.g.has(t)}function Hv(e,t,n){Wv(e,t),0<n.length&&(e.i=null,e.g.set(Qv(e,t),Bg(n)),e.h+=n.length)}function Qv(e,t){return t=String(t),t=e.j?t.toLowerCase():t}(It=$v.prototype).add=function(e,t){Kv(this),this.i=null,e=Qv(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},It.forEach=function(n,r){Kv(this),this.g.forEach(function(e,t){e.forEach(function(e){n.call(r,e,t,this)},this)},this)},It.ta=function(){Kv(this);const t=Array.from(this.g.values()),n=Array.from(this.g.keys()),r=[];for(let s=0;s<n.length;s++){var i=t[s];for(let e=0;e<i.length;e++)r.push(n[s])}return r},It.Z=function(t){Kv(this);let n=[];if("string"==typeof t)Gv(this,t)&&(n=n.concat(this.g.get(Qv(this,t))));else{t=Array.from(this.g.values());for(let e=0;e<t.length;e++)n=n.concat(t[e])}return n},It.set=function(e,t){return Kv(this),this.i=null,Gv(this,e=Qv(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},It.get=function(e,t){return e&&0<(e=this.Z(e)).length?String(e[0]):t},It.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++)for(var r=t[n],i=encodeURIComponent(String(r)),s=this.Z(r),r=0;r<s.length;r++){var a=i;""!==s[r]&&(a+="="+encodeURIComponent(String(s[r]))),e.push(a)}return this.i=e.join("&")};var Yv=class{constructor(e,t){this.g=e,this.map=t}};function Jv(e){this.l=e||10,e=Ng.PerformanceNavigationTiming?0<(e=Ng.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(Ng.g&&Ng.g.Ka&&Ng.g.Ka()&&Ng.g.Ka().dc),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Xv(e){return e.h||e.g&&e.g.size>=e.j}function Zv(e){return e.h?1:e.g?e.g.size:0}function e_(e,t){return e.h?e.h==t:e.g&&e.g.has(t)}function t_(e,t){e.g?e.g.add(t):e.h=t}function n_(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function r_(t){if(null!=t.h)return t.i.concat(t.h.F);if(null==t.g||0===t.g.size)return Bg(t.i);{let e=t.i;for(const n of t.g.values())e=e.concat(n.F);return e}}Jv.prototype.cancel=function(){if(this.i=r_(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var i_,s_=class{stringify(e){return Ng.JSON.stringify(e,void 0)}parse(e){return Ng.JSON.parse(e,void 0)}};function a_(){this.g=new s_}function o_(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function c_(e){this.l=e.ec||null,this.j=e.ob||!1}function l_(e,t){Nm.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=u_,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Ug(c_,sv),c_.prototype.g=function(){return new l_(this.l,this.j)},c_.prototype.i=(i_={},function(){return i_}),Ug(l_,Nm);var u_=0;function h_(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}function d_(e){e.readyState=4,e.l=null,e.j=null,e.A=null,p_(e)}function p_(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(It=l_.prototype).open=function(e,t){if(this.readyState!=u_)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,p_(this)},It.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||Ng).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))},It.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,d_(this)),this.readyState=u_},It.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,p_(this)),this.g&&(this.readyState=3,p_(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==Ng.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;h_(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))},It.Xa=function(e){var t;this.g&&(this.u&&e.value?this.response.push(e.value):this.u||(t=e.value||new Uint8Array(0),(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)),(e.done?d_:p_)(this),3==this.readyState&&h_(this))},It.Za=function(e){this.g&&(this.response=this.responseText=e,d_(this))},It.Ya=function(e){this.g&&(this.response=e,d_(this))},It.ka=function(){this.g&&d_(this)},It.setRequestHeader=function(e,t){this.v.append(e,t)},It.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},It.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(l_.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var f_=Ng.JSON.parse;function g_(e){Nm.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=m_,this.L=this.M=!1}Ug(g_,Nm);var m_="",v_=/^https?$/i,__=["POST","PUT"];function y_(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,w_(e),I_(e)}function w_(e){e.F||(e.F=!0,Rm(e,"complete"),Rm(e,"error"))}function b_(e){if(e.h&&void 0!==Ag&&(!e.C[1]||4!=E_(e)||2!=e.da()))if(e.v&&4==E_(e))jm(e.La,0,e);else if(Rm(e,"readystatechange"),4==E_(e)){e.h=!1;try{var t,n,r,i=e.da();e:switch(i){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break e;default:s=!1}if((t=s)||((n=0===i)&&(!(r=String(e.I).match(Av)[1]||null)&&Ng.self&&Ng.self.location&&(r=Ng.self.location.protocol.slice(0,-1)),n=!v_.test(r?r.toLowerCase():"")),t=n),t)Rm(e,"complete"),Rm(e,"success");else{e.m=6;try{var a=2<E_(e)?e.g.statusText:""}catch(e){a=""}e.j=a+" ["+e.da()+"]",w_(e)}}finally{I_(e)}}}function I_(e,t){if(e.g){T_(e);const n=e.g,r=e.C[0]?()=>{}:null;e.g=null,e.C=null,t||Rm(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function T_(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(Ng.clearTimeout(e.A),e.A=null)}function E_(e){return e.g?e.g.readyState:0}function C_(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case m_:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function S_(e){let n="";return dm(e,function(e,t){n+=t,n+=":",n+=e,n+="\r\n"}),n}function k_(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=S_(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):Ov(e,t,n))}function A_(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function N_(e){this.Ga=0,this.j=[],this.l=new Hm,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=A_("failFast",!1,e),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=A_("baseRetryDelayMs",5e3,e),this.hb=A_("retryDelaySeedMs",1e4,e),this.eb=A_("forwardChannelMaxRetries",2,e),this.xa=A_("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.i=new Jv(e&&e.concurrentRequestLimit),this.Ja=new a_,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.l.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.qa=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.qa=e.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function R_(e){if(D_(e),3==e.H){var t=e.W++,n=Rv(e.I);if(Ov(n,"SID",e.K),Ov(n,"RID",t),Ov(n,"TYPE","terminate"),M_(e,n),(t=new hv(e,e.l,t)).L=2,t.A=Mv(Rv(n)),n=!1,Ng.navigator&&Ng.navigator.sendBeacon)try{n=Ng.navigator.sendBeacon(t.A.toString(),"")}catch(e){}!n&&Ng.Image&&((new Image).src=t.A,n=!0),n||(t.g=G_(t.l,null),t.g.ha(t.A)),t.G=Date.now(),bv(t)}K_(e)}function P_(e){e.g&&(V_(e),e.g.cancel(),e.g=null)}function D_(e){P_(e),e.u&&(Ng.clearTimeout(e.u),e.u=null),B_(e),e.i.cancel(),e.m&&("number"==typeof e.m&&Ng.clearTimeout(e.m),e.m=null)}function x_(e){var t;Xv(e.i)||e.m||(e.m=!0,t=e.Na,Mm||Um(),Lm||(Mm(),Lm=!0),Fm.add(t,e),e.C=0)}function O_(e,t){var n=t?t.m:e.W++,r=Rv(e.I);Ov(r,"SID",e.K),Ov(r,"RID",n),Ov(r,"AID",e.V),M_(e,r),e.o&&e.s&&k_(r,e.o,e.s),n=new hv(e,e.l,n,e.C+1),null===e.o&&(n.I=e.s),t&&(e.j=t.F.concat(e.j)),t=L_(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),t_(e.i,n),vv(n,r,t)}function M_(e,n){e.na&&dm(e.na,function(e,t){Ov(n,t,e)}),e.h&&kv({},function(e,t){Ov(n,t,e)})}function L_(e,t,r){r=Math.min(e.j.length,r);var i=e.h?Lg(e.h.Va,e.h,e):null;e:{var s=e.j;let n=-1;for(;;){const c=["count="+r];-1==n?0<r?(n=s[0].g,c.push("ofs="+n)):n=0:c.push("ofs="+n);let e=!0;for(let t=0;t<r;t++){var a=s[t].g,o=s[t].map;if((a-=n)<0)n=Math.max(0,s[t].g-100),e=!1;else try{!function(e,r,t){const i=t||"";try{kv(e,function(e,t){let n=e;Pg(e)&&(n=Dm(e)),r.push(i+t+"="+encodeURIComponent(n))})}catch(e){throw r.push(i+"type="+encodeURIComponent("_badmap")),e}}(o,c,"req"+a+"_")}catch(e){i&&i(o)}}if(e){i=c.join("&");break e}}}return e=e.j.splice(0,r),t.F=e,i}function F_(e){var t;e.g||e.u||(e.ba=1,t=e.Ma,Mm||Um(),Lm||(Mm(),Lm=!0),Fm.add(t,e),e.A=0)}function U_(e){return!(e.g||e.u||3<=e.A)&&(e.ba++,e.u=iv(Lg(e.Ma,e),z_(e,e.A)),e.A++,1)}function V_(e){null!=e.B&&(Ng.clearTimeout(e.B),e.B=null)}function q_(e){e.g=new hv(e,e.l,"rpc",e.ba),null===e.o&&(e.g.I=e.s),e.g.O=0;var t=Rv(e.wa);Ov(t,"RID","rpc"),Ov(t,"SID",e.K),Ov(t,"AID",e.V),Ov(t,"CI",e.G?"0":"1"),!e.G&&e.qa&&Ov(t,"TO",e.qa),Ov(t,"TYPE","xmlhttp"),M_(e,t),e.o&&e.s&&k_(t,e.o,e.s),e.L&&e.g.setTimeout(e.L);var n=e.g;e=e.pa,n.L=1,n.A=Mv(Rv(t)),n.u=null,n.S=!0,_v(n,e)}function B_(e){null!=e.v&&(Ng.clearTimeout(e.v),e.v=null)}function j_(e,t){var n,r,i,s=null;if(e.g==t){B_(e),V_(e),e.g=null;var a=2}else{if(!e_(e.i,t))return;s=t.F,n_(e.i,t),a=1}if(0!=e.H)if(t.i)1==a?(s=t.u?t.u.length:0,t=Date.now()-t.G,n=e.C,Rm(a=Xm(),new rv(a,s)),x_(e)):F_(e);else if(3==(n=t.s)||0==n&&0<t.ca||(1!=a||(i=t,Zv((r=e).i)>=r.i.j-(r.m?1:0)||(r.m?(r.j=i.F.concat(r.j),0):1==r.H||2==r.H||r.C>=(r.cb?0:r.eb)||(r.m=iv(Lg(r.Na,r,i),z_(r,r.C)),r.C++,0))))&&(2!=a||!U_(e)))switch(s&&0<s.length&&(t=e.i,t.i=t.i.concat(s)),n){case 1:$_(e,5);break;case 4:$_(e,10);break;case 3:$_(e,6);break;default:$_(e,2)}}function z_(e,t){let n=e.ab+Math.floor(Math.random()*e.hb);return e.isActive()||(n*=2),n*t}function $_(e,t){var n,r;e.l.info("Error code "+t),2==t?(n=null,e.h&&(n=null),r=Lg(e.pb,e),n||(n=new Nv("//www.google.com/images/cleardot.gif"),Ng.location&&"http"==Ng.location.protocol||Pv(n,"https"),Mv(n)),function(e,t){var n=new Hm;if(Ng.Image){const r=new Image;r.onload=Fg(o_,n,r,"TestLoadImage: loaded",!0,t),r.onerror=Fg(o_,n,r,"TestLoadImage: error",!1,t),r.onabort=Fg(o_,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=Fg(o_,n,r,"TestLoadImage: timeout",!1,t),Ng.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(n.toString(),r)):nv(2),e.H=0,e.h&&e.h.za(t),K_(e),D_(e)}function K_(e){var t;e.H=0,e.ma=[],e.h&&(0==(t=r_(e.i)).length&&0==e.j.length||(jg(e.ma,t),jg(e.ma,e.j),e.i.i.length=0,Bg(e.j),e.j.length=0),e.h.ya())}function W_(e,t,n){var r,i,s=n instanceof Nv?Rv(n):new Nv(n);return""!=s.g?(t&&(s.g=t+"."+s.g),Dv(s,s.m)):(s=(r=Ng.location).protocol,t=t?t+"."+r.hostname:r.hostname,r=+r.port,i=new Nv(null),s&&Pv(i,s),t&&(i.g=t),r&&Dv(i,r),n&&(i.l=n),s=i),n=e.F,t=e.Da,n&&t&&Ov(s,n,t),Ov(s,"VER",e.ra),M_(e,s),s}function G_(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ha&&!e.va?new g_(new c_({ob:n})):new g_(e.va)).Oa(e.J),t}function H_(){}function Q_(){if(Jg&&!(10<=Number(sm)))throw Error("Environmental error: no available transport.")}function Y_(e,t){Nm.call(this),this.g=new N_(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!Kg(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Kg(t)&&(this.g.F=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new Z_(this)}function J_(e){cv.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function X_(){lv.call(this),this.status=1}function Z_(e){this.g=e}function ey(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function ty(e,t,n){n=n||0;var r=Array(16);if("string"==typeof t)for(var i=0;i<16;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;i<16;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1];var i=e.g[2],s=e.g[3],a=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=n+((a=t+(s^n&(i^s))+r[0]+3614090360&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|a>>>20))+((a=i+(n^s&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^i&(s^t))+r[3]+3250441966&4294967295)<<22&4294967295|a>>>10))+((a=t+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|a>>>20))+((a=i+(n^s&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^i&(s^t))+r[7]+4249261313&4294967295)<<22&4294967295|a>>>10))+((a=t+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|a>>>20))+((a=i+(n^s&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^i&(s^t))+r[11]+2304563134&4294967295)<<22&4294967295|a>>>10))+((a=t+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|a>>>20))+((a=i+(n^s&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^i&(s^t))+r[15]+1236535329&4294967295)<<22&4294967295|a>>>10))+((a=t+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|a>>>27))+((a=s+(n^i&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^n&(s^t))+r[11]+643717713&4294967295)<<14&4294967295|a>>>18))+((a=n+(s^t&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|a>>>12))+((a=t+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|a>>>27))+((a=s+(n^i&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^n&(s^t))+r[15]+3634488961&4294967295)<<14&4294967295|a>>>18))+((a=n+(s^t&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|a>>>12))+((a=t+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|a>>>27))+((a=s+(n^i&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^n&(s^t))+r[3]+4107603335&4294967295)<<14&4294967295|a>>>18))+((a=n+(s^t&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|a>>>12))+((a=t+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|a>>>27))+((a=s+(n^i&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^n&(s^t))+r[7]+1735328473&4294967295)<<14&4294967295|a>>>18))+((a=n+(s^t&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|a>>>12))+((a=t+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|a>>>16))+((a=n+(i^s^t)+r[14]+4259657740&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|a>>>16))+((a=n+(i^s^t)+r[10]+3200236656&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|a>>>16))+((a=n+(i^s^t)+r[6]+76029189&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^n)+r[15]+530742520&4294967295)<<16&4294967295|a>>>16))+((a=n+(i^s^t)+r[2]+3299628645&4294967295)<<23&4294967295|a>>>9))+((a=t+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|a>>>26))+((a=s+(n^(t|~i))+r[7]+1126891415&4294967295)<<10&4294967295|a>>>22))+((a=i+(t^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|a>>>17))+((a=n+(s^(i|~t))+r[5]+4237533241&4294967295)<<21&4294967295|a>>>11))+((a=t+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|a>>>26))+((a=s+(n^(t|~i))+r[3]+2399980690&4294967295)<<10&4294967295|a>>>22))+((a=i+(t^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|a>>>17))+((a=n+(s^(i|~t))+r[1]+2240044497&4294967295)<<21&4294967295|a>>>11))+((a=t+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|a>>>26))+((a=s+(n^(t|~i))+r[15]+4264355552&4294967295)<<10&4294967295|a>>>22))+((a=i+(t^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|a>>>17))+((a=n+(s^(i|~t))+r[13]+1309151649&4294967295)<<21&4294967295|a>>>11))+((s=(t=n+((a=t+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|a>>>26))+((a=s+(n^(t|~i))+r[11]+3174756917&4294967295)<<10&4294967295|a>>>22))^((i=s+((a=i+(t^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|a>>>17))|~t))+r[9]+3951481745&4294967295;e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(a<<21&4294967295|a>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}function ny(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}(It=g_.prototype).Oa=function(e){this.M=e},It.ha=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=(this.u||pv).g(),this.C=this.u?av(this.u):av(pv),this.g.onreadystatechange=Lg(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(e){return void y_(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const c of r.keys())n.set(c,r.get(c))}r=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),i=Ng.FormData&&e instanceof Ng.FormData,0<=qg(__,t)&&!r&&!i&&n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(var[s,a]of n)this.g.setRequestHeader(s,a);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{T_(this),0<this.B&&((this.L=(o=this.g,Jg&&"number"==typeof o.timeout&&void 0!==o.ontimeout))?(this.g.timeout=this.B,this.g.ontimeout=Lg(this.ua,this)):this.A=jm(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){y_(this,e)}var o},It.ua=function(){void 0!==Ag&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Rm(this,"timeout"),this.abort(8))},It.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,Rm(this,"complete"),Rm(this,"abort"),I_(this))},It.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),I_(this,!0)),g_.$.N.call(this)},It.La=function(){this.s||(this.G||this.v||this.l?b_(this):this.kb())},It.kb=function(){b_(this)},It.isActive=function(){return!!this.g},It.da=function(){try{return 2<E_(this)?this.g.status:-1}catch(e){return-1}},It.ja=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},It.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),f_(t)}},It.Ia=function(){return this.m},It.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(It=N_.prototype).ra=8,It.H=1,It.Na=function(t){if(this.m)if(this.m=null,1==this.H){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;const s=new hv(this,this.l,t);let e=this.s;if(this.U&&(e?(e=pm(e),gm(e,this.U)):e=this.U),null!==this.o||this.O||(s.I=e,e=null),this.P)e:{for(var n=0,r=0;r<this.j.length;r++){var i=this.j[r];if("__data__"in i.map&&"string"==typeof(i=i.map.__data__)?i=i.length:i=void 0,void 0===i)break;if(4096<(n+=i)){n=r;break e}if(4096===n||r===this.j.length-1){n=r+1;break e}}n=1e3}else n=1e3;n=L_(this,s,n),Ov(r=Rv(this.I),"RID",t),Ov(r,"CVER",22),this.F&&Ov(r,"X-HTTP-Session-Id",this.F),M_(this,r),e&&(this.O?n="headers="+encodeURIComponent(String(S_(e)))+"&"+n:this.o&&k_(r,this.o,e)),t_(this.i,s),this.bb&&Ov(r,"TYPE","init"),this.P?(Ov(r,"$req",n),Ov(r,"SID","null"),s.aa=!0,vv(s,r,null)):vv(s,r,n),this.H=2}}else 3==this.H&&(t?O_(this,t):0==this.j.length||Xv(this.i)||O_(this))},It.Ma=function(){var e;this.u=null,q_(this),this.ca&&!(this.M||null==this.g||this.S<=0)&&(e=2*this.S,this.l.info("BP detection timer enabled: "+e),this.B=iv(Lg(this.jb,this),e))},It.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,nv(10),P_(this),q_(this))},It.ib=function(){null!=this.v&&(this.v=null,P_(this),U_(this),nv(19))},It.pb=function(e){e?(this.l.info("Successfully pinged google.com"),nv(2)):(this.l.info("Failed to ping google.com"),nv(1))},It.isActive=function(){return!!this.h&&this.h.isActive(this)},(It=H_.prototype).Ba=function(){},It.Aa=function(){},It.za=function(){},It.ya=function(){},It.isActive=function(){return!0},It.Va=function(){},Q_.prototype.g=function(e,t){return new Y_(e,t)},Ug(Y_,Nm),Y_.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var e=this.g,t=this.l,n=this.h||void 0;nv(0),e.Y=t,e.na=n||{},e.G=e.aa,e.I=W_(e,null,e.Y),x_(e)},Y_.prototype.close=function(){R_(this.g)},Y_.prototype.u=function(e){var t,n=this.g;"string"==typeof e?((t={}).__data__=e,e=t):this.v&&((t={}).__data__=Dm(e),e=t),n.j.push(new Yv(n.fb++,e)),3==n.H&&x_(n)},Y_.prototype.N=function(){this.g.h=null,delete this.j,R_(this.g),delete this.g,Y_.$.N.call(this)},Ug(J_,cv),Ug(X_,lv),Ug(Z_,H_),Z_.prototype.Ba=function(){Rm(this.g,"a")},Z_.prototype.Aa=function(e){Rm(this.g,new J_(e))},Z_.prototype.za=function(e){Rm(this.g,new X_)},Z_.prototype.ya=function(){Rm(this.g,"b")},Ug(ey,function(){this.blockSize=-1}),ey.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},ey.prototype.j=function(e,t){for(var n=(t=void 0===t?e.length:t)-this.blockSize,r=this.m,i=this.h,s=0;s<t;){if(0==i)for(;s<=n;)ty(this,e,s),s+=this.blockSize;if("string"==typeof e){for(;s<t;)if(r[i++]=e.charCodeAt(s++),i==this.blockSize){ty(this,r),i=0;break}}else for(;s<t;)if(r[i++]=e[s++],i==this.blockSize){ty(this,r),i=0;break}}this.h=i,this.i+=t},ey.prototype.l=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;for(var n=8*this.i,t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.j(e),e=Array(16),t=n=0;t<4;++t)for(var r=0;r<32;r+=8)e[n++]=this.g[t]>>>r&255;return e};var ry={};function iy(e){return-128<=e&&e<128?(t=e,n=function(e){return new ny([0|e],e<0?-1:0)},r=ry,Object.prototype.hasOwnProperty.call(r,t)?r[t]:r[t]=n(t)):new ny([0|e],e<0?-1:0);var t,n,r}function sy(e){if(isNaN(e)||!isFinite(e))return oy;if(e<0)return dy(sy(-e));for(var t=[],n=1,r=0;n<=e;r++)t[r]=e/n|0,n*=ay;return new ny(t,0)}var ay=4294967296,oy=iy(0),cy=iy(1),ly=iy(16777216);function uy(e){if(0==e.h){for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return;return 1}}function hy(e){return-1==e.h}function dy(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new ny(n,~e.h).add(cy)}function py(e,t){return e.add(dy(t))}function fy(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function gy(e,t){this.g=e,this.h=t}function my(e,t){if(uy(t))throw Error("division by zero");if(uy(e))return new gy(oy,oy);if(hy(e))return t=my(dy(e),t),new gy(dy(t.g),dy(t.h));if(hy(t))return t=my(e,dy(t)),new gy(dy(t.g),t.h);if(30<e.g.length){if(hy(e)||hy(t))throw Error("slowDivide_ only works with positive integers.");for(var n=cy,r=t;r.X(e)<=0;)n=vy(n),r=vy(r);for(var i=_y(n,1),s=_y(r,1),r=_y(r,2),n=_y(n,2);!uy(r);){var a=s.add(r);a.X(e)<=0&&(i=i.add(n),s=a),r=_y(r,1),n=_y(n,1)}return t=py(e,i.R(t)),new gy(i,t)}for(i=oy;0<=e.X(t);){for(n=Math.max(1,Math.floor(e.ea()/t.ea())),r=(r=Math.ceil(Math.log(n)/Math.LN2))<=48?1:Math.pow(2,r-48),a=(s=sy(n)).R(t);hy(a)||0<a.X(e);)a=(s=sy(n-=r)).R(t);uy(s)&&(s=cy),i=i.add(s),e=py(e,a)}return new gy(i,e)}function vy(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.D(r)<<1|e.D(r-1)>>>31;return new ny(n,e.h)}function _y(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],s=0;s<r;s++)i[s]=0<t?e.D(s+n)>>>t|e.D(s+n+1)<<32-t:e.D(s+n);return new ny(i,e.h)}(It=ny.prototype).ea=function(){if(hy(this))return-dy(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.D(n);e+=(0<=r?r:ay+r)*t,t*=ay}return e},It.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(uy(this))return"0";if(hy(this))return"-"+dy(this).toString(e);for(var t=sy(Math.pow(e,6)),n=this,r="";;){var i=my(n,t).g,s=((0<(n=py(n,i.R(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(uy(n=i))return s+r;for(;s.length<6;)s="0"+s;r=s+r}},It.D=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},It.X=function(e){return hy(e=py(this,e))?-1:uy(e)?0:1},It.abs=function(){return hy(this)?dy(this):this},It.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var s=r+(65535&this.D(i))+(65535&e.D(i)),a=(s>>>16)+(this.D(i)>>>16)+(e.D(i)>>>16),r=a>>>16;s&=65535,a&=65535,n[i]=a<<16|s}return new ny(n,-2147483648&n[n.length-1]?-1:0)},It.R=function(e){if(uy(this)||uy(e))return oy;if(hy(this))return hy(e)?dy(this).R(dy(e)):dy(dy(this).R(e));if(hy(e))return dy(this.R(dy(e)));if(this.X(ly)<0&&e.X(ly)<0)return sy(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var s=this.D(r)>>>16,a=65535&this.D(r),o=e.D(i)>>>16,c=65535&e.D(i);n[2*r+2*i]+=a*c,fy(n,2*r+2*i),n[2*r+2*i+1]+=s*c,fy(n,2*r+2*i+1),n[2*r+2*i+1]+=a*o,fy(n,2*r+2*i+1),n[2*r+2*i+2]+=s*o,fy(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new ny(n,0)},It.gb=function(e){return my(this,e).h},It.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)&e.D(r);return new ny(n,this.h&e.h)},It.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)|e.D(r);return new ny(n,this.h|e.h)},It.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)^e.D(r);return new ny(n,this.h^e.h)},Q_.prototype.createWebChannel=Q_.prototype.g,Y_.prototype.send=Y_.prototype.u,Y_.prototype.open=Y_.prototype.m,Tt.NO_ERROR=0,Tt.TIMEOUT=8,Tt.HTTP_ERROR=6,al.COMPLETE="complete",(ov.EventType=yt).OPEN="a",yt.CLOSE="b",yt.ERROR="c",yt.MESSAGE="d",Nm.prototype.listen=Nm.prototype.O,g_.prototype.listenOnce=g_.prototype.P,g_.prototype.getLastError=g_.prototype.Sa,g_.prototype.getLastErrorCode=g_.prototype.Ia,g_.prototype.getStatus=g_.prototype.da,g_.prototype.getResponseJson=g_.prototype.Wa,g_.prototype.getResponseText=g_.prototype.ja,g_.prototype.send=g_.prototype.ha,g_.prototype.setWithCredentials=g_.prototype.Oa,ey.prototype.digest=ey.prototype.l,ey.prototype.update=ey.prototype.j,ny.prototype.multiply=ny.prototype.R,ny.prototype.modulo=ny.prototype.gb,ny.prototype.compare=ny.prototype.X,ny.prototype.toNumber=ny.prototype.ea,ny.prototype.getBits=ny.prototype.D,ny.fromNumber=sy,ny.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if((n=n||10)<2||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return dy(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=sy(Math.pow(n,8)),i=oy,s=0;s<t.length;s+=8)var a=Math.min(8,t.length-s),o=parseInt(t.substring(s,s+a),n),i=a<8?(a=sy(Math.pow(n,a)),i.R(a).add(sy(o))):(i=i.R(r)).add(sy(o));return i};var yy,wy=Xm,by=Tt,Iy=al,Ty=Ym,Ey=10,Cy=11,Sy=ov,ky=g_,Ay=ey,Ny=ny;const Ry="@firebase/firestore";class Py{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Py.UNAUTHENTICATED=new Py(null),Py.GOOGLE_CREDENTIALS=new Py("google-credentials-uid"),Py.FIRST_PARTY=new Py("first-party-uid"),Py.MOCK_USER=new Py("mock-user");let Dy="10.7.1";const xy=new ve("@firebase/firestore");function Oy(){return xy.logLevel}function My(e,...t){var n;xy.logLevel<=m.DEBUG&&(n=t.map(Uy),xy.debug(`Firestore (${Dy}): ${e}`,...n))}function Ly(e,...t){var n;xy.logLevel<=m.ERROR&&(n=t.map(Uy),xy.error(`Firestore (${Dy}): ${e}`,...n))}function Fy(e,...t){var n;xy.logLevel<=m.WARN&&(n=t.map(Uy),xy.warn(`Firestore (${Dy}): ${e}`,...n))}function Uy(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}}function Vy(e="Unexpected state"){var t=`FIRESTORE (${Dy}) INTERNAL ASSERTION FAILED: `+e;throw Ly(t),new Error(t)}function qy(e){e||Vy()}const By={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class jy extends P{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class zy{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class $y{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Ky{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Py.UNAUTHENTICATED))}shutdown(){}}class Wy{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Gy{constructor(e){this.t=e,this.currentUser=Py.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,n){let r=this.i;const i=e=>this.i!==r?(r=this.i,n(e)):Promise.resolve();let s=new zy;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new zy,t.enqueueRetryable(()=>i(this.currentUser))};const a=()=>{const e=s;t.enqueueRetryable(async()=>{await e.promise,await i(this.currentUser)})},o=e=>{My("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(e=>o(e)),setTimeout(()=>{var e;this.auth||((e=this.t.getImmediate({optional:!0}))?o(e):(My("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new zy))},0),a()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.i!==t?(My("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(qy("string"==typeof e.accessToken),new $y(e.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){var e=this.auth&&this.auth.getUid();return qy(null===e||"string"==typeof e),new Py(e)}}class Hy{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Py.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);var e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Qy{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new Hy(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Py.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Yy{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&0<e.length&&this.headers.set("x-firebase-appcheck",this.value)}}class Jy{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,n){const r=e=>{null!=e.error&&My("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);var t=e.token!==this.R;return this.R=e.token,My("FirebaseAppCheckTokenProvider",`Received ${t?"new":"existing"} token.`),t?n(e.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable(()=>r(e))};const i=e=>{My("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.A.onInit(e=>i(e)),setTimeout(()=>{var e;this.appCheck||((e=this.A.getImmediate({optional:!0}))?i(e):My("FirebaseAppCheckTokenProvider","AppCheck not yet detected"))},0)}getToken(){var e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(qy("string"==typeof e.token),this.R=e.token,new Yy(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class Xy{static newId(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/t.length)*t.length;let r="";for(;r.length<20;){var i=function(t){const n="undefined"!=typeof self&&(self.crypto||self.msCrypto),r=new Uint8Array(t);if(n&&"function"==typeof n.getRandomValues)n.getRandomValues(r);else for(let e=0;e<t;e++)r[e]=Math.floor(256*Math.random());return r}(40);for(let e=0;e<i.length;++e)r.length<20&&i[e]<n&&(r+=t.charAt(i[e]%t.length))}return r}}function Zy(e,t){return e<t?-1:t<e?1:0}function ew(e,n,r){return e.length===n.length&&e.every((e,t)=>r(e,n[t]))}function tw(e){return e+"\0"}class nw{constructor(e,t){if(this.seconds=e,(this.nanoseconds=t)<0)throw new jy(By.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(1e9<=t)throw new jy(By.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new jy(By.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(253402300800<=e)throw new jy(By.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return nw.fromMillis(Date.now())}static fromDate(e){return nw.fromMillis(e.getTime())}static fromMillis(e){var t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new nw(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Zy(this.nanoseconds,e.nanoseconds):Zy(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class rw{constructor(e){this.timestamp=e}static fromTimestamp(e){return new rw(e)}static min(){return new rw(new nw(0,0))}static max(){return new rw(new nw(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class iw{constructor(e,t,n){void 0===t?t=0:t>e.length&&Vy(),void 0===n?n=e.length-t:n>e.length-t&&Vy(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===iw.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof iw?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class sw extends iw{construct(e,t,n){return new sw(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(0<=n.indexOf("//"))throw new jy(By.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>0<e.length))}return new sw(t)}static emptyPath(){return new sw([])}}const aw=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ow extends iw{construct(e,t,n){return new ow(e,t,n)}static isValidIdentifier(e){return aw.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e=!ow.isValidIdentifier(e)?"`"+e+"`":e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ow(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;var i=()=>{if(0===n.length)throw new jy(By.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new jy(By.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new jy(By.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new jy(By.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ow(t)}static emptyPath(){return new ow([])}}class cw{constructor(e){this.path=e}static fromPath(e){return new cw(sw.fromString(e))}static fromName(e){return new cw(sw.fromString(e).popFirst(5))}static empty(){return new cw(sw.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return 2<=this.path.length&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===sw.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return sw.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new cw(new sw(e.slice()))}}class lw{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function uw(e){return e.fields.find(e=>2===e.kind)}function hw(e){return e.fields.filter(e=>2!==e.kind)}lw.UNKNOWN_ID=-1;class dw{constructor(e,t){this.fieldPath=e,this.kind=t}}class pw{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new pw(0,mw.min())}}function fw(e,t){var n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,r=rw.fromTimestamp(1e9===r?new nw(n+1,0):new nw(n,r));return new mw(r,cw.empty(),t)}function gw(e){return new mw(e.readTime,e.key,-1)}class mw{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new mw(rw.min(),cw.empty(),-1)}static max(){return new mw(rw.max(),cw.empty(),-1)}}function vw(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=cw.comparator(e.documentKey,t.documentKey),0!==n?n:Zy(e.largestBatchId,t.largestBatchId))}const _w="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class yw{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function ww(e){if(e.code!==By.FAILED_PRECONDITION||e.message!==_w)throw e;My("LocalStore","Unexpectedly lost primary lease")}class bw{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(r,i){return this.callbackAttached&&Vy(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new bw((t,n)=>{this.nextCallback=e=>{this.wrapSuccess(r,e).next(t,n)},this.catchCallback=e=>{this.wrapFailure(i,e).next(t,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{var t=e();return t instanceof bw?t:bw.resolve(t)}catch(e){return bw.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):bw.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):bw.reject(t)}static resolve(n){return new bw((e,t)=>{e(n)})}static reject(n){return new bw((e,t)=>{t(n)})}static waitFor(e){return new bw((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=bw.resolve(!1);for(const n of e)t=t.next(e=>e?bw.resolve(e):n());return t}static forEach(e,n){const r=[];return e.forEach((e,t)=>{r.push(n.call(this,e,t))}),this.waitFor(r)}static mapArray(o,c){return new bw((t,n)=>{const r=o.length,i=new Array(r);let s=0;for(let e=0;e<r;e++){const a=e;c(o[a]).next(e=>{i[a]=e,++s,s===r&&t(i)},e=>n(e))}})}static doWhile(r,i){return new bw((e,t)=>{const n=()=>{!0===r()?i().next(()=>{n()},t):e()};n()})}}class Iw{constructor(n,e){this.action=n,this.transaction=e,this.aborted=!1,this.V=new zy,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{e.error?this.V.reject(new Cw(n,e.error)):this.V.resolve()},this.transaction.onerror=e=>{var t=Rw(e.target.error);this.V.reject(new Cw(n,t))}}static open(e,t,n,r){try{return new Iw(t,e.transaction(r,n))}catch(e){throw new Cw(t,e)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(My("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){var t=this.transaction.objectStore(e);return new kw(t)}}class Tw{constructor(e,t,n){this.name=e,this.version=t,this.p=n,12.2===Tw.S(b())&&Ly("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return My("SimpleDb","Removing database:",e),Aw(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!A())return!1;if(Tw.C())return!0;const e=b(),t=Tw.S(e),n=0<t&&t<10,r=Tw.v(e),i=0<r&&r<4.5;return!(0<e.indexOf("MSIE ")||0<e.indexOf("Trident/")||0<e.indexOf("Edge/")||n||i)}static C(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.F)}static M(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static v(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async O(s){return this.db||(My("SimpleDb","Opening database:",this.name),this.db=await new Promise((n,r)=>{const i=indexedDB.open(this.name,this.version);i.onsuccess=e=>{var t=e.target.result;n(t)},i.onblocked=()=>{r(new Cw(s,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=e=>{var t=e.target.error;"VersionError"===t.name?r(new jy(By.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===t.name?r(new jy(By.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+t)):r(new Cw(s,t))},i.onupgradeneeded=e=>{My("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;this.p.N(t,i.transaction,e.oldVersion,this.version).next(()=>{My("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.B&&(this.db.onversionchange=e=>this.B(e)),this.db}L(t){this.B=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(e,t,n,r){var i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.O(e);const t=Iw.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next(e=>(t.g(),e)).catch(e=>(t.abort(e),bw.reject(e))).toPromise();return s.catch(()=>{}),await t.m,s}catch(e){const t=e,n="FirebaseError"!==t.name&&s<3;if(My("SimpleDb","Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class Ew{constructor(e){this.k=e,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(e){this.k=e}done(){this.q=!0}U(e){this.K=e}delete(){return Aw(this.k.delete())}}class Cw extends jy{constructor(e,t){super(By.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Sw(e){return"IndexedDbTransactionError"===e.name}class kw{constructor(e){this.store=e}put(e,t){let n;return n=void 0!==t?(My("SimpleDb","PUT",this.store.name,e,t),this.store.put(t,e)):(My("SimpleDb","PUT",this.store.name,"<auto-key>",e),this.store.put(e)),Aw(n)}add(e){return My("SimpleDb","ADD",this.store.name,e,e),Aw(this.store.add(e))}get(t){return Aw(this.store.get(t)).next(e=>(My("SimpleDb","GET",this.store.name,t,e=void 0===e?null:e),e))}delete(e){return My("SimpleDb","DELETE",this.store.name,e),Aw(this.store.delete(e))}count(){return My("SimpleDb","COUNT",this.store.name),Aw(this.store.count())}W(e,n){var t=this.options(e,n);if(t.index||"function"!=typeof this.store.getAll){const e=this.cursor(t),n=[];return this.G(e,(e,t)=>{n.push(t)}).next(()=>n)}{const e=this.store.getAll(t.range);return new bw((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}}j(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new bw((t,n)=>{r.onerror=e=>{n(e.target.error)},r.onsuccess=e=>{t(e.target.result)}})}H(e,t){My("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.J=!1;var r=this.cursor(n);return this.G(r,(e,t,n)=>n.delete())}Y(e,t){let n;t?n=e:(n={},t=e);var r=this.cursor(n);return this.G(r,t)}Z(i){const e=this.cursor({});return new bw((n,r)=>{e.onerror=e=>{var t=Rw(e.target.error);r(t)},e.onsuccess=e=>{const t=e.target.result;t?i(t.primaryKey,t.value).next(e=>{e?t.continue():n()}):n()}})}G(e,s){const a=[];return new bw((i,t)=>{e.onerror=e=>{t(e.target.error)},e.onsuccess=e=>{const t=e.target.result;if(t){const n=new Ew(t),r=s(t.primaryKey,t.value,n);if(r instanceof bw){const e=r.catch(e=>(n.done(),bw.reject(e)));a.push(e)}n.isDone?i():null===n.$?t.continue():t.continue(n.$)}else i()}}).next(()=>bw.waitFor(a))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.J?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Aw(e){return new bw((n,r)=>{e.onsuccess=e=>{var t=e.target.result;n(t)},e.onerror=e=>{var t=Rw(e.target.error);r(t)}})}let Nw=!1;function Rw(e){const t=Tw.S(b());if(12.2<=t&&t<13){const t="An internal error was encountered in the Indexed Database server";if(0<=e.message.indexOf(t)){const e=new jy("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Nw||(Nw=!0,setTimeout(()=>{throw e},0)),e}}return e}class Pw{constructor(e,t){this.asyncQueue=e,this.X=t,this.task=null}start(){this.ee(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}ee(e){My("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{My("IndexBackiller",`Documents written: ${await this.X.te()}`)}catch(e){Sw(e)?My("IndexBackiller","Ignoring IndexedDB error during index backfill: ",e):await ww(e)}await this.ee(6e4)})}}class Dw{constructor(e,t){this.localStore=e,this.persistence=t}async te(t=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.ne(e,t))}ne(e,t){const n=new Set;let r=t,i=!0;return bw.doWhile(()=>!0===i&&0<r,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>null===t||n.has(t)?void(i=!1):(My("IndexBackiller",`Processing collection: ${t}`),this.re(e,t,r).next(e=>{r-=e,n.add(t)})))).next(()=>t-r)}re(r,i,e){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(r,i).next(n=>this.localStore.localDocuments.getNextDocuments(r,i,n,e).next(e=>{const t=e.changes;return this.localStore.indexManager.updateIndexEntries(r,t).next(()=>this.ie(n,e)).next(e=>(My("IndexBackiller",`Updating offset: ${e}`),this.localStore.indexManager.updateCollectionGroup(r,i,e))).next(()=>t.size)}))}ie(e,t){let r=e;return t.changes.forEach((e,t)=>{var n=gw(t);0<vw(n,r)&&(r=n)}),new mw(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class xw{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.se(e),this.oe=e=>t.writeSequenceNumber(e))}se(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){var e=++this.previousValue;return this.oe&&this.oe(e),e}}function Ow(e){return null==e}function Mw(e){return 0===e&&1/e==-1/0}function Lw(e){return"number"==typeof e&&Number.isInteger(e)&&!Mw(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function Fw(e){let t="";for(let n=0;n<e.length;n++)0<t.length&&(t=Uw(t)),t=function(e,t){let n=t;const r=e.length;for(let i=0;i<r;i++){const r=e.charAt(i);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}(e.get(n),t);return Uw(t)}function Uw(e){return e+""}function Vw(t){const n=t.length;if(qy(2<=n),2===n)return qy(""===t.charAt(0)&&""===t.charAt(1)),sw.emptyPath();const __PRIVATE_lastReasonableEscapeIndex=n-2,r=[];let i="";for(let a=0;a<n;){const n=t.indexOf("",a);switch((n<0||n>__PRIVATE_lastReasonableEscapeIndex)&&Vy(),t.charAt(n+1)){case"":var s=t.substring(a,n);let e;0===i.length?e=s:(i+=s,e=i,i=""),r.push(e);break;case"":i+=t.substring(a,n),i+="\0";break;case"":i+=t.substring(a,n+1);break;default:Vy()}a=n+2}return new sw(r)}xw._e=-1;const qw=["userId","batchId"];function Bw(e,t){return[e,Fw(t)]}function jw(e,t,n){return[e,Fw(t),n]}const zw={},$w=["prefixPath","collectionGroup","readTime","documentId"],Kw=["prefixPath","collectionGroup","documentId"],Ww=["collectionGroup","readTime","prefixPath","documentId"],Gw=["canonicalId","targetId"],Hw=["targetId","path"],Qw=["path","targetId"],Yw=["collectionId","parent"],Jw=["indexId","uid"],Xw=["uid","sequenceNumber"],Zw=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],eb=["indexId","uid","orderedDocumentKey"],tb=["userId","collectionPath","documentId"],nb=["userId","collectionPath","largestBatchId"],rb=["userId","collectionGroup","largestBatchId"],ib=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],sb=[...ib,"documentOverlays"],ab=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],ob=ab,cb=[...ob,"indexConfiguration","indexState","indexEntries"];class lb extends yw{constructor(e,t){super(),this.ae=e,this.currentSequenceNumber=t}}function ub(e,t){var n=e;return Tw.M(n.ae,t)}function hb(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function db(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function pb(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class fb{constructor(e,t){this.comparator=e,this.root=t||mb.EMPTY}insert(e,t){return new fb(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,mb.BLACK,null,null))}remove(e){return new fb(this.comparator,this.root.remove(e,this.comparator).copy(null,null,mb.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:0<n&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;n=r<0?n.left:(t+=n.left.size+1,n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(n){this.inorderTraversal((e,t)=>(n(e,t),!1))}toString(){const n=[];return this.inorderTraversal((e,t)=>(n.push(`${e}:${t}`),!1)),`{${n.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new gb(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new gb(this.root,e,this.comparator,!1)}getReverseIterator(){return new gb(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new gb(this.root,e,this.comparator,!0)}}class gb{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();var t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack.length}peek(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class mb{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:mb.RED,this.left=null!=r?r:mb.EMPTY,this.right=null!=i?i:mb.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new mb(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;var i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return mb.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return mb.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){var e=this.copy(null,null,mb.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){var e=this.copy(null,null,mb.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){var e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Vy();if(this.right.isRed())throw Vy();var e=this.left.check();if(e!==this.right.check())throw Vy();return e+(this.isRed()?0:1)}}mb.EMPTY=null,mb.RED=!0,mb.BLACK=!1,mb.EMPTY=new class{constructor(){this.size=0}get key(){throw Vy()}get value(){throw Vy()}get color(){throw Vy()}get left(){throw Vy()}get right(){throw Vy()}copy(e,t,n,r,i){return this}insert(e,t,n){return new mb(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class vb{constructor(e){this.comparator=e,this.data=new fb(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(n){this.data.inorderTraversal((e,t)=>(n(e),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,e[1]))return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new _b(this.data.getIterator())}getIteratorFrom(e){return new _b(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof vb))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(e){const t=new vb(this.comparator);return t.data=e,t}}class _b{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function yb(e){return e.hasNext()?e.getNext():void 0}class wb{constructor(e){(this.fields=e).sort(ow.comparator)}static empty(){return new wb([])}unionWith(e){let t=new vb(ow.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new wb(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ew(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class bb extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Ib{constructor(e){this.binaryString=e}static fromBase64String(e){var t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new bb("Invalid base64 string: "+e):e}}(e);return new Ib(t)}static fromUint8Array(e){var t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Ib(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Zy(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ib.EMPTY_BYTE_STRING=new Ib("");const Tb=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Eb(t){if(qy(!!t),"string"!=typeof t)return{seconds:Cb(t.seconds),nanos:Cb(t.nanos)};{let e=0;var n=Tb.exec(t);qy(!!n),n[1]&&(n=((n=n[1])+"000000000").substr(0,9),e=Number(n));const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}}function Cb(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Sb(e){return"string"==typeof e?Ib.fromBase64String(e):Ib.fromUint8Array(e)}function kb(e){var t;return"server_timestamp"===(null===(t=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Ab(e){var t=e.mapValue.fields.__previous_value__;return kb(t)?Ab(t):t}function Nb(e){var t=Eb(e.mapValue.fields.__local_write_time__.timestampValue);return new nw(t.seconds,t.nanos)}class Rb{constructor(e,t,n,r,i,s,a,o,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=c}}class Pb{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Pb("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Pb&&e.projectId===this.projectId&&e.database===this.database}}const Db={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},xb={nullValue:"NULL_VALUE"};function Ob(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?kb(e)?4:Gb(e)?9007199254740991:10:Vy()}function Mb(e,t){if(e===t)return!0;var n,r,i=Ob(e);if(i!==Ob(t))return!1;switch(i){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Nb(e).isEqual(Nb(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;var n=Eb(e.timestampValue),r=Eb(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return r=t,Sb(e.bytesValue).isEqual(Sb(r.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return n=t,Cb((r=e).geoPointValue.latitude)===Cb(n.geoPointValue.latitude)&&Cb(r.geoPointValue.longitude)===Cb(n.geoPointValue.longitude);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Cb(e.integerValue)===Cb(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){var n=Cb(e.doubleValue),r=Cb(t.doubleValue);return n===r?Mw(n)===Mw(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return ew(e.arrayValue.values||[],t.arrayValue.values||[],Mb);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(hb(n)!==hb(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!Mb(n[e],r[e])))return!1;return!0}(e,t);default:return Vy()}}function Lb(e,t){return void 0!==(e.values||[]).find(e=>Mb(e,t))}function Fb(e,t){if(e===t)return 0;var n,r,i,s,a=Ob(e),o=Ob(t);if(a!==o)return Zy(a,o);switch(a){case 0:case 9007199254740991:return 0;case 1:return Zy(e.booleanValue,t.booleanValue);case 2:return r=t,i=Cb((n=e).integerValue||n.doubleValue),s=Cb(r.integerValue||r.doubleValue),i<s?-1:s<i?1:i===s?0:isNaN(i)?isNaN(s)?0:-1:1;case 3:return Ub(e.timestampValue,t.timestampValue);case 4:return Ub(Nb(e),Nb(t));case 5:return Zy(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Sb(e),r=Sb(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){var n=e.split("/"),r=t.split("/");for(let i=0;i<n.length&&i<r.length;i++){const t=Zy(n[i],r[i]);if(0!==t)return t}return Zy(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return n=e.geoPointValue,r=t.geoPointValue,0!==(s=Zy(Cb(n.latitude),Cb(r.latitude)))?s:Zy(Cb(n.longitude),Cb(r.longitude));case 9:return function(e,t){var n=e.values||[],r=t.values||[];for(let i=0;i<n.length&&i<r.length;++i){const t=Fb(n[i],r[i]);if(t)return t}return Zy(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===Db.mapValue&&t===Db.mapValue)return 0;if(e===Db.mapValue)return 1;if(t===Db.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){const t=Zy(r[o],s[o]);if(0!==t)return t;var a=Fb(n[r[o]],i[s[o]]);if(0!==a)return a}return Zy(r.length,s.length)}(e.mapValue,t.mapValue);default:throw Vy()}}function Ub(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Zy(e,t);var n=Eb(e),r=Eb(t),i=Zy(n.seconds,r.seconds);return 0!==i?i:Zy(n.nanos,r.nanos)}function Vb(e){return function s(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Eb(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return Sb(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return cw.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=s(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${s(e.fields[i])}`;return n+"}"}(e.mapValue):Vy()}(e)}function qb(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Bb(e){return!!e&&"integerValue"in e}function jb(e){return!!e&&"arrayValue"in e}function zb(e){return e&&"nullValue"in e}function $b(e){return e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Kb(e){return e&&"mapValue"in e}function Wb(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const n={mapValue:{fields:{}}};return db(t.mapValue.fields,(e,t)=>n.mapValue.fields[e]=Wb(t)),n}if(t.arrayValue){const r={arrayValue:{values:[]}};for(let e=0;e<(t.arrayValue.values||[]).length;++e)r.arrayValue.values[e]=Wb(t.arrayValue.values[e]);return r}return Object.assign({},t)}function Gb(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function Hb(e,t){var n=Fb(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function Qb(e,t){var n=Fb(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class Yb{constructor(e){this.value=e}static empty(){return new Yb({mapValue:{}})}field(n){if(n.isEmpty())return this.value;{let e=this.value;for(let t=0;t<n.length-1;++t)if(e=(e.mapValue.fields||{})[n.get(t)],!Kb(e))return null;return e=(e.mapValue.fields||{})[n.lastSegment()],e||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Wb(t)}setAll(e){let n=ow.emptyPath(),r={},i=[];e.forEach((e,t)=>{if(!n.isImmediateParentOf(t)){const e=this.getFieldsMap(n);this.applyChanges(e,r,i),r={},i=[],n=t.popLast()}e?r[t.lastSegment()]=Wb(e):i.push(t.lastSegment())});var t=this.getFieldsMap(n);this.applyChanges(t,r,i)}delete(e){const t=this.field(e.popLast());Kb(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Mb(this.value,e.value)}getFieldsMap(t){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<t.length;++r){let e=n.mapValue.fields[t.get(r)];Kb(e)&&e.mapValue.fields||(e={mapValue:{fields:{}}},n.mapValue.fields[t.get(r)]=e),n=e}return n.mapValue.fields}applyChanges(n,e,t){db(e,(e,t)=>n[e]=t);for(const e of t)delete n[e]}clone(){return new Yb(Wb(this.value))}}class Jb{constructor(e,t,n,r,i,s,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new Jb(e,0,rw.min(),rw.min(),rw.min(),Yb.empty(),0)}static newFoundDocument(e,t,n,r){return new Jb(e,1,t,rw.min(),n,r,0)}static newNoDocument(e,t){return new Jb(e,2,t,rw.min(),rw.min(),Yb.empty(),0)}static newUnknownDocument(e,t){return new Jb(e,3,t,rw.min(),rw.min(),Yb.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(rw.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Yb.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Yb.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=rw.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Jb&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Jb(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Xb{constructor(e,t){this.position=e,this.inclusive=t}}function Zb(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],a=e.position[i];if(r=s.field.isKeyField()?cw.comparator(cw.fromName(a.referenceValue),n.key):Fb(a,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function eI(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Mb(e.position[n],t.position[n]))return!1;return!0}class tI{constructor(e,t="asc"){this.field=e,this.dir=t}}class nI{}class rI extends nI{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new hI(e,t,n):"array-contains"===t?new gI(e,n):"in"===t?new mI(e,n):"not-in"===t?new vI(e,n):"array-contains-any"===t?new _I(e,n):new rI(e,t,n)}static createKeyFieldInFilter(e,t,n){return new("in"===t?dI:pI)(e,n)}matches(e){var t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Fb(t,this.value)):null!==t&&Ob(this.value)===Ob(t)&&this.matchesComparison(Fb(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return 0<e;case">=":return 0<=e;default:return Vy()}}isInequality(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class iI extends nI{constructor(e,t){super(),this.filters=e,this.op=t,this.ue=null}static create(e,t){return new iI(e,t)}matches(t){return sI(this)?void 0===this.filters.find(e=>!e.matches(t)):void 0!==this.filters.find(e=>e.matches(t))}getFlattenedFilters(){return null!==this.ue||(this.ue=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function sI(e){return"and"===e.op}function aI(e){return"or"===e.op}function oI(e){return cI(e)&&sI(e)}function cI(e){for(const t of e.filters)if(t instanceof iI)return!1;return!0}function lI(e,t){var n=e.filters.concat(t);return iI.create(n,e.op)}function uI(e){return e instanceof rI?`${(t=e).field.canonicalString()} ${t.op} ${Vb(t.value)}`:e instanceof iI?(e=e).op.toString()+" {"+e.getFilters().map(uI).join(" ,")+"}":"Filter";var t}class hI extends rI{constructor(e,t,n){super(e,t,n),this.key=cw.fromName(n.referenceValue)}matches(e){var t=cw.comparator(e.key,this.key);return this.matchesComparison(t)}}class dI extends rI{constructor(e,t){super(e,"in",t),this.keys=fI(0,t)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class pI extends rI{constructor(e,t){super(e,"not-in",t),this.keys=fI(0,t)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function fI(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>cw.fromName(e.referenceValue))}class gI extends rI{constructor(e,t){super(e,"array-contains",t)}matches(e){var t=e.data.field(this.field);return jb(t)&&Lb(t.arrayValue,this.value)}}class mI extends rI{constructor(e,t){super(e,"in",t)}matches(e){var t=e.data.field(this.field);return null!==t&&Lb(this.value.arrayValue,t)}}class vI extends rI{constructor(e,t){super(e,"not-in",t)}matches(e){if(Lb(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var t=e.data.field(this.field);return null!==t&&!Lb(this.value.arrayValue,t)}}class _I extends rI{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!jb(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>Lb(this.value.arrayValue,e))}}class yI{constructor(e,t=null,n=[],r=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=a,this.ce=null}}function wI(e,t=null,n=[],r=[],i=null,s=null,a=null){return new yI(e,t,n,r,i,s,a)}function bI(e){const t=e;if(null===t.ce){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>function t(e){if(e instanceof rI)return e.field.canonicalString()+e.op.toString()+Vb(e.value);if(oI(e))return e.filters.map(e=>t(e)).join(",");var n=e.filters.map(e=>t(e)).join(",");return`${e.op}(${n})`}(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),Ow(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>Vb(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>Vb(e)).join(",")),t.ce=e}return t.ce}function II(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++)if(n=e.orderBy[i],r=t.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;var n,r;if(e.filters.length!==t.filters.length)return!1;for(let s=0;s<e.filters.length;s++)if(!function r(e,t){return e instanceof rI?(n=e,(s=t)instanceof rI&&n.op===s.op&&n.field.isEqual(s.field)&&Mb(n.value,s.value)):e instanceof iI?(i=t)instanceof iI&&e.op===i.op&&e.filters.length===i.filters.length&&e.filters.reduce((e,t,n)=>e&&r(t,i.filters[n]),!0):void Vy();var i,n,s}(e.filters[s],t.filters[s]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!eI(e.startAt,t.startAt)&&eI(e.endAt,t.endAt)}function TI(e){return cw.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function EI(e,t){return e.filters.filter(e=>e instanceof rI&&e.field.isEqual(t))}function CI(t,n,r){let i=xb,s=!0;for(const r of EI(t,n)){let e=xb,t=!0;switch(r.op){case"<":case"<=":e="nullValue"in(a=r.value)?xb:"booleanValue"in a?{booleanValue:!1}:"integerValue"in a||"doubleValue"in a?{doubleValue:NaN}:"timestampValue"in a?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in a?{stringValue:""}:"bytesValue"in a?{bytesValue:""}:"referenceValue"in a?qb(Pb.empty(),cw.empty()):"geoPointValue"in a?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in a?{arrayValue:{}}:"mapValue"in a?{mapValue:{}}:Vy();break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=xb}Hb({value:i,inclusive:s},{value:e,inclusive:t})<0&&(i=e,s=t)}var a;if(null!==r)for(let e=0;e<t.orderBy.length;++e)if(t.orderBy[e].field.isEqual(n)){const t=r.position[e];Hb({value:i,inclusive:s},{value:t,inclusive:r.inclusive})<0&&(i=t,s=r.inclusive);break}return{value:i,inclusive:s}}function SI(t,n,r){let i=Db,s=!0;for(const r of EI(t,n)){let e=Db,t=!0;switch(r.op){case">=":case">":e="nullValue"in(a=r.value)?{booleanValue:!1}:"booleanValue"in a?{doubleValue:NaN}:"integerValue"in a||"doubleValue"in a?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in a?{stringValue:""}:"stringValue"in a?{bytesValue:""}:"bytesValue"in a?qb(Pb.empty(),cw.empty()):"referenceValue"in a?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in a?{arrayValue:{}}:"arrayValue"in a?{mapValue:{}}:"mapValue"in a?Db:Vy(),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=Db}0<Qb({value:i,inclusive:s},{value:e,inclusive:t})&&(i=e,s=t)}var a;if(null!==r)for(let e=0;e<t.orderBy.length;++e)if(t.orderBy[e].field.isEqual(n)){const t=r.position[e];0<Qb({value:i,inclusive:s},{value:t,inclusive:r.inclusive})&&(i=t,s=r.inclusive);break}return{value:i,inclusive:s}}class kI{constructor(e,t=null,n=[],r=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}}function AI(e,t,n,r,i,s,a,o){return new kI(e,t,n,r,i,s,a,o)}function NI(e){return new kI(e)}function RI(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function PI(e){return null!==e.collectionGroup}function DI(t){const n=t;if(null===n.le){n.le=[];const t=new Set;for(const i of n.explicitOrderBy)n.le.push(i),t.add(i.field.canonicalString());const r=0<n.explicitOrderBy.length?n.explicitOrderBy[n.explicitOrderBy.length-1].dir:"asc",e=function(e){let t=new vb(ow.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}(n);e.forEach(e=>{t.has(e.canonicalString())||e.isKeyField()||n.le.push(new tI(e,r))}),t.has(ow.keyField().canonicalString())||n.le.push(new tI(ow.keyField(),r))}return n.le}function xI(e){const t=e;return t.he||(t.he=function(e,t){if("F"===e.limitType)return wI(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{var t="desc"===e.dir?"asc":"desc";return new tI(e.field,t)});var n=e.endAt?new Xb(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new Xb(e.startAt.position,e.startAt.inclusive):null;return wI(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}(t,DI(e))),t.he}function OI(e,t){var n=e.filters.concat([t]);return new kI(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function MI(e,t,n){return new kI(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function LI(e,t){return II(xI(e),xI(t))&&e.limitType===t.limitType}function FI(e){return`${bI(xI(e))}|lt:${e.limitType}`}function UI(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(t+=`, filters: [${e.filters.map(e=>uI(e)).join(", ")}]`),Ow(e.limit)||(t+=", limit: "+e.limit),0<e.orderBy.length&&(t+=`, orderBy: [${e.orderBy.map(e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e)).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>Vb(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>Vb(e)).join(",")),`Target(${t})`}(xI(e))}; limitType=${e.limitType})`}function VI(e,t){return t.isFoundDocument()&&(i=e,a=(s=t).key.path,null!==i.collectionGroup?s.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(a):cw.isDocumentKey(i.path)?i.path.isEqual(a):i.path.isImmediateParentOf(a))&&function(e,t){for(const n of DI(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return;return 1}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return;return 1}(e,t)&&(i=t,(!(t=e).startAt||(n=t.startAt,e=DI(t),r=Zb(n,e,i),n.inclusive?r<=0:r<0))&&(!t.endAt||(n=t.endAt,t=DI(t),r=Zb(n,t,i),n.inclusive?0<=r:0<r)));var n,r,i,s,a}function qI(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function BI(i){return(e,t)=>{let n=!1;for(const r of DI(i)){const i=function(e,t,n){var r=e.field.isKeyField()?cw.comparator(t.key,n.key):function(e,t,n){var r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?Fb(r,i):Vy()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return Vy()}}(r,e,t);if(0!==i)return i;n=n||r.field.isKeyField()}return 0}}class jI{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(r){db(this.inner,(e,t)=>{for(const[e,n]of t)r(e,n)})}isEmpty(){return pb(this.inner)}size(){return this.innerSize}}const zI=new fb(cw.comparator);const $I=new fb(cw.comparator);function KI(...e){let t=$I;for(const n of e)t=t.insert(n.key,n);return t}function WI(e){let n=$I;return e.forEach((e,t)=>n=n.insert(e,t.overlayedDocument)),n}function GI(){return new jI(e=>e.toString(),(e,t)=>e.isEqual(t))}const HI=new fb(cw.comparator),QI=new vb(cw.comparator);function YI(...e){let t=QI;for(const n of e)t=t.add(n);return t}const JI=new vb(Zy);function XI(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Mw(t)?"-0":t}}function ZI(e){return{integerValue:""+e}}function eT(e,t){return Lw(t)?ZI(t):XI(e,t)}class tT{constructor(){this._=void 0}}function nT(e,t){return e instanceof cT?Bb(e=t)||(e=e)&&"doubleValue"in e?t:{integerValue:0}:null}class rT extends tT{}class iT extends tT{constructor(e){super(),this.elements=e}}function sT(e,t){const n=uT(t);for(const t of e.elements)n.some(e=>Mb(e,t))||n.push(t);return{arrayValue:{values:n}}}class aT extends tT{constructor(e){super(),this.elements=e}}function oT(e,t){let n=uT(t);for(const t of e.elements)n=n.filter(e=>!Mb(e,t));return{arrayValue:{values:n}}}class cT extends tT{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function lT(e){return Cb(e.integerValue||e.doubleValue)}function uT(e){return jb(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class hT{constructor(e,t){this.field=e,this.transform=t}}class dT{constructor(e,t){this.version=e,this.transformResults=t}}class pT{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new pT}static exists(e){return new pT(void 0,e)}static updateTime(e){return new pT(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function fT(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class gT{}function mT(e,n){if(!e.hasLocalMutations||n&&0===n.fields.length)return null;if(null===n)return e.isNoDocument()?new CT(e.key,pT.none()):new wT(e.key,e.data,pT.none());{const i=e.data,s=Yb.empty();let t=new vb(ow.comparator);for(var r of n.fields)if(!t.has(r)){let e=i.field(r);null===e&&1<r.length&&(r=r.popLast(),e=i.field(r)),null===e?s.delete(r):s.set(r,e),t=t.add(r)}return new bT(e.key,s,new wb(t.toArray()),pT.none())}}function vT(e,t,n){e instanceof wT?function(e,t,n){const r=e.value.clone(),i=TT(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof bT?function(e,t,n){if(!fT(e.precondition,t))return t.convertToUnknownDocument(n.version);const r=TT(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(IT(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}function _T(e,t,n,r){return e instanceof wT?function(e,t,n,r){if(!fT(e.precondition,t))return n;const i=e.value.clone(),s=ET(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof bT?function(e,t,n,r){if(!fT(e.precondition,t))return n;const i=ET(e.fieldTransforms,r,t),s=t.data;return s.setAll(IT(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):(t=t,n=n,fT(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n)}function yT(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&ew(n,r,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&(e=e.transform,t=t.transform,e instanceof iT&&t instanceof iT||e instanceof aT&&t instanceof aT?ew(e.elements,t.elements,Mb):e instanceof cT&&t instanceof cT?Mb(e.Ie,t.Ie):e instanceof rT&&t instanceof rT)}(e,t)))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask)));var n,r}class wT extends gT{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class bT extends gT{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function IT(n){const r=new Map;return n.fieldMask.fields.forEach(e=>{var t;e.isEmpty()||(t=n.data.field(e),r.set(e,t))}),r}function TT(e,t,n){const r=new Map;qy(e.length===n.length);for(let u=0;u<n.length;u++){var i=e[u],s=i.transform,a=t.data.field(i.field);r.set(i.field,(o=s,c=a,l=n[u],o instanceof iT?sT(o,c):o instanceof aT?oT(o,c):l))}var o,c,l;return r}function ET(e,t,n){const r=new Map;for(const l of e){const e=l.transform,u=n.data.field(l.field);r.set(l.field,(i=e,s=u,a=t,c=o=void 0,i instanceof rT?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return(t=t&&kb(t)?Ab(t):t)&&(n.fields.__previous_value__=t),{mapValue:n}}(a,s):i instanceof iT?sT(i,s):i instanceof aT?oT(i,s):(o=nT(i=i,s),c=lT(o)+lT(i.Ie),Bb(o)&&Bb(i.Ie)?ZI(c):XI(i.serializer,c))))}var i,s,a,o,c;return r}class CT extends gT{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ST extends gT{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class kT{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){var n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const i=this.mutations[r];i.key.isEqual(e.key)&&vT(i,e,n[r])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=_T(n,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=_T(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(s,a){const o=GI();return this.mutations.forEach(e=>{const t=s.get(e.key),n=t.overlayedDocument;let r=this.applyToLocalView(n,t.mutatedFields);r=a.has(e.key)?null:r;var i=mT(n,r);null!==i&&o.set(e.key,i),n.isValidDocument()||n.convertToNoDocument(rw.min())}),o}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),YI())}isEqual(e){return this.batchId===e.batchId&&ew(this.mutations,e.mutations,(e,t)=>yT(e,t))&&ew(this.baseMutations,e.baseMutations,(e,t)=>yT(e,t))}}class AT{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){qy(e.mutations.length===n.length);let r=HI;var i=e.mutations;for(let s=0;s<i.length;s++)r=r.insert(i[s].key,n[s].version);return new AT(e,t,n,r)}}class NT{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class RT{constructor(e,t){this.count=e,this.unchangedNames=t}}function PT(e){switch(e){default:return Vy();case By.CANCELLED:case By.UNKNOWN:case By.DEADLINE_EXCEEDED:case By.RESOURCE_EXHAUSTED:case By.INTERNAL:case By.UNAVAILABLE:case By.UNAUTHENTICATED:return!1;case By.INVALID_ARGUMENT:case By.NOT_FOUND:case By.ALREADY_EXISTS:case By.PERMISSION_DENIED:case By.FAILED_PRECONDITION:case By.ABORTED:case By.OUT_OF_RANGE:case By.UNIMPLEMENTED:case By.DATA_LOSS:return!0}}function DT(e){if(void 0===e)return Ly("GRPC error has no .code"),By.UNKNOWN;switch(e){case yy.OK:return By.OK;case yy.CANCELLED:return By.CANCELLED;case yy.UNKNOWN:return By.UNKNOWN;case yy.DEADLINE_EXCEEDED:return By.DEADLINE_EXCEEDED;case yy.RESOURCE_EXHAUSTED:return By.RESOURCE_EXHAUSTED;case yy.INTERNAL:return By.INTERNAL;case yy.UNAVAILABLE:return By.UNAVAILABLE;case yy.UNAUTHENTICATED:return By.UNAUTHENTICATED;case yy.INVALID_ARGUMENT:return By.INVALID_ARGUMENT;case yy.NOT_FOUND:return By.NOT_FOUND;case yy.ALREADY_EXISTS:return By.ALREADY_EXISTS;case yy.PERMISSION_DENIED:return By.PERMISSION_DENIED;case yy.FAILED_PRECONDITION:return By.FAILED_PRECONDITION;case yy.ABORTED:return By.ABORTED;case yy.OUT_OF_RANGE:return By.OUT_OF_RANGE;case yy.UNIMPLEMENTED:return By.UNIMPLEMENTED;case yy.DATA_LOSS:return By.DATA_LOSS;default:return Vy()}}function xT(){return new TextEncoder}(Tt=yy=yy||{})[Tt.OK=0]="OK",Tt[Tt.CANCELLED=1]="CANCELLED",Tt[Tt.UNKNOWN=2]="UNKNOWN",Tt[Tt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Tt[Tt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Tt[Tt.NOT_FOUND=5]="NOT_FOUND",Tt[Tt.ALREADY_EXISTS=6]="ALREADY_EXISTS",Tt[Tt.PERMISSION_DENIED=7]="PERMISSION_DENIED",Tt[Tt.UNAUTHENTICATED=16]="UNAUTHENTICATED",Tt[Tt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Tt[Tt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Tt[Tt.ABORTED=10]="ABORTED",Tt[Tt.OUT_OF_RANGE=11]="OUT_OF_RANGE",Tt[Tt.UNIMPLEMENTED=12]="UNIMPLEMENTED",Tt[Tt.INTERNAL=13]="INTERNAL",Tt[Tt.UNAVAILABLE=14]="UNAVAILABLE",Tt[Tt.DATA_LOSS=15]="DATA_LOSS";const OT=new Ny([4294967295,4294967295],0);function MT(e){const t=xT().encode(e),n=new Ay;return n.update(t),new Uint8Array(n.digest())}function LT(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new Ny([n,r],0),new Ny([i,s],0)]}class FT{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||8<=t)throw new UT(`Invalid padding: ${t}`);if(n<0)throw new UT(`Invalid hash count: ${n}`);if(0<e.length&&0===this.hashCount)throw new UT(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new UT(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ee=Ny.fromNumber(this.Te)}de(e,t,n){let r=e.add(t.multiply(Ny.fromNumber(n)));return 1===r.compare(OT)&&(r=new Ny([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Ee).toNumber()}Ae(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Te)return!1;const t=MT(e),[n,r]=LT(t);for(let i=0;i<this.hashCount;i++){const t=this.de(n,r,i);if(!this.Ae(t))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new FT(i,r,t);return n.forEach(e=>s.insert(e)),s}insert(t){if(0!==this.Te){const n=MT(t),[r,i]=LT(n);for(let e=0;e<this.hashCount;e++){const n=this.de(r,i,e);this.Re(n)}}}Re(e){var t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class UT extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class VT{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,qT.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new VT(rw.min(),r,new fb(Zy),zI,YI())}}class qT{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new qT(n,t,YI(),YI(),YI())}}class BT{constructor(e,t,n,r){this.Ve=e,this.removedTargetIds=t,this.key=n,this.me=r}}class jT{constructor(e,t){this.targetId=e,this.fe=t}}class zT{constructor(e,t,n=Ib.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class $T{constructor(){this.ge=0,this.pe=GT(),this.ye=Ib.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return 0!==this.ge}get De(){return this.Se}Ce(e){0<e.approximateByteSize()&&(this.Se=!0,this.ye=e)}ve(){let n=YI(),r=YI(),i=YI();return this.pe.forEach((e,t)=>{switch(t){case 0:n=n.add(e);break;case 2:r=r.add(e);break;case 1:i=i.add(e);break;default:Vy()}}),new qT(this.ye,this.we,n,r,i)}Fe(){this.Se=!1,this.pe=GT()}Me(e,t){this.Se=!0,this.pe=this.pe.insert(e,t)}xe(e){this.Se=!0,this.pe=this.pe.remove(e)}Oe(){this.ge+=1}Ne(){--this.ge,qy(0<=this.ge)}Be(){this.Se=!0,this.we=!0}}class KT{constructor(e){this.Le=e,this.ke=new Map,this.qe=zI,this.Qe=WT(),this.Ke=new fb(Zy)}$e(e){for(const t of e.Ve)e.me&&e.me.isFoundDocument()?this.Ue(t,e.me):this.We(t,e.key,e.me);for(const n of e.removedTargetIds)this.We(n,e.key,e.me)}Ge(n){this.forEachTarget(n,e=>{const t=this.ze(e);switch(n.state){case 0:this.je(e)&&t.Ce(n.resumeToken);break;case 1:t.Ne(),t.be||t.Fe(),t.Ce(n.resumeToken);break;case 2:t.Ne(),t.be||this.removeTarget(e);break;case 3:this.je(e)&&(t.Be(),t.Ce(n.resumeToken));break;case 4:this.je(e)&&(this.He(e),t.Ce(n.resumeToken));break;default:Vy()}})}forEachTarget(e,n){0<e.targetIds.length?e.targetIds.forEach(n):this.ke.forEach((e,t)=>{this.je(t)&&n(t)})}Je(e){const t=e.targetId,n=e.fe.count,r=this.Ye(t);if(r){var i=r.target;if(TI(i))if(0===n){const e=new cw(i.path);this.We(t,e,Jb.newNoDocument(e,rw.min()))}else qy(1===n);else{const r=this.Ze(t);if(r!==n){const n=this.Xe(e),s=n?this.et(n,e,r):1;if(0!==s){this.He(t);const e=2===s?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(t,e)}}}}}Xe(e){var t=e.fe.unchangedNames;if(!t||!t.bits)return null;var{bits:{bitmap:n="",padding:r=0},hashCount:t=0}=t;let i,s;try{i=Sb(n).toUint8Array()}catch(e){if(e instanceof bb)return Fy("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{s=new FT(i,r,t)}catch(e){return Fy(e instanceof UT?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===s.Te?null:s}et(e,t,n){return t.fe.count===n-this.rt(e,t.targetId)?0:2}rt(n,r){const e=this.Le.getRemoteKeysForTarget(r);let i=0;return e.forEach(e=>{var t=this.Le.nt(),t=`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`;n.mightContain(t)||(this.We(r,e,null),i++)}),i}it(r){const i=new Map;this.ke.forEach((e,t)=>{var n=this.Ye(t);if(n){if(e.current&&TI(n.target)){const i=new cw(n.target.path);null!==this.qe.get(i)||this.st(t,i)||this.We(t,i,Jb.newNoDocument(i,r))}e.De&&(i.set(t,e.ve()),e.Fe())}});let s=YI();this.Qe.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{var t=this.Ye(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(n=!1)}),n&&(s=s.add(e))}),this.qe.forEach((e,t)=>t.setReadTime(r));var e=new VT(r,i,this.Ke,this.qe,s);return this.qe=zI,this.Qe=WT(),this.Ke=new fb(Zy),e}Ue(e,t){var n;this.je(e)&&(n=this.st(e,t.key)?2:0,this.ze(e).Me(t.key,n),this.qe=this.qe.insert(t.key,t),this.Qe=this.Qe.insert(t.key,this.ot(t.key).add(e)))}We(e,t,n){if(this.je(e)){const r=this.ze(e);this.st(e,t)?r.Me(t,1):r.xe(t),this.Qe=this.Qe.insert(t,this.ot(t).delete(e)),n&&(this.qe=this.qe.insert(t,n))}}removeTarget(e){this.ke.delete(e)}Ze(e){var t=this.ze(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Oe(e){this.ze(e).Oe()}ze(e){let t=this.ke.get(e);return t||(t=new $T,this.ke.set(e,t)),t}ot(e){let t=this.Qe.get(e);return t||(t=new vb(Zy),this.Qe=this.Qe.insert(e,t)),t}je(e){var t=null!==this.Ye(e);return t||My("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){var t=this.ke.get(e);return t&&t.be?null:this.Le._t(e)}He(t){this.ke.set(t,new $T),this.Le.getRemoteKeysForTarget(t).forEach(e=>{this.We(t,e,null)})}st(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function WT(){return new fb(cw.comparator)}function GT(){return new fb(cw.comparator)}const HT={asc:"ASCENDING",desc:"DESCENDING"},QT={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},YT={and:"AND",or:"OR"};class JT{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function XT(e,t){return e.useProto3Json||Ow(t)?t:{value:t}}function ZT(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function e0(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function t0(e){return qy(!!e),rw.fromTimestamp((t=Eb(e),new nw(t.seconds,t.nanos)));var t}function n0(e,t){return e=e,new sw(["projects",e.projectId,"databases",e.database]).child("documents").child(t).canonicalString()}function r0(e){var t=sw.fromString(e);return qy(b0(t)),t}function i0(e,t){return n0(e.databaseId,t.path)}function s0(e,t){const n=r0(t);if(n.get(1)!==e.databaseId.projectId)throw new jy(By.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new jy(By.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new cw(l0(n))}function a0(e,t){return n0(e.databaseId,t)}function o0(e){var t=r0(e);return 4===t.length?sw.emptyPath():l0(t)}function c0(e){return new sw(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function l0(e){return qy(4<e.length&&"documents"===e.get(4)),e.popFirst(5)}function u0(e,t,n){return{name:i0(e,t),fields:n.value.mapValue.fields}}function h0(e,t,n){const r=s0(e,t.name),i=t0(t.updateTime),s=t.createTime?t0(t.createTime):rw.min(),a=new Yb({mapValue:{fields:t.fields}}),o=Jb.newFoundDocument(r,i,s,a);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function d0(e,t){let n;if(t instanceof wT)n={update:u0(e,t.key,t.value)};else if(t instanceof CT)n={delete:i0(e,t.key)};else if(t instanceof bT)n={update:u0(e,t.key,t.data),updateMask:function(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof ST))return Vy();n={verify:i0(e,t.key)}}return 0<t.fieldTransforms.length&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e){var t=e.transform;if(t instanceof rT)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof iT)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof aT)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof cT)return{fieldPath:e.field.canonicalString(),increment:t.Ie};throw Vy()}(e))),t.precondition.isNone||(n.currentDocument=(r=e,void 0!==(e=t.precondition).updateTime?{updateTime:(t=e.updateTime,ZT(r,t.toTimestamp()))}:void 0!==e.exists?{exists:e.exists}:Vy())),n;var r}function p0(t,e){const n=e.currentDocument?void 0!==(i=e.currentDocument).updateTime?pT.updateTime(t0(i.updateTime)):void 0!==i.exists?pT.exists(i.exists):pT.none():pT.none(),r=e.updateTransforms?e.updateTransforms.map(e=>function(e,t){let n=null;if("setToServerValue"in t)qy("REQUEST_TIME"===t.setToServerValue),n=new rT;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new iT(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new aT(e)}else"increment"in t?n=new cT(e,t.increment):Vy();var r=ow.fromServerFormat(t.fieldPath);return new hT(r,n)}(t,e)):[];var i;if(e.update){e.update.name;var s=s0(t,e.update.name),a=new Yb({mapValue:{fields:e.update.fields}});if(e.updateMask){const t=function(e){const t=e.fieldPaths||[];return new wb(t.map(e=>ow.fromServerFormat(e)))}(e.updateMask);return new bT(s,a,t,n,r)}return new wT(s,a,n,r)}if(e.delete){const r=s0(t,e.delete);return new CT(r,n)}if(e.verify){const r=s0(t,e.verify);return new ST(r,n)}return Vy()}function f0(e,t){return{documents:[a0(e,t.path)]}}function g0(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=a0(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=a0(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(e){if(0!==e.length)return function n(e){return e instanceof rI?function(e){if("=="===e.op){if($b(e.value))return{unaryFilter:{field:y0(e.field),op:"IS_NAN"}};if(zb(e.value))return{unaryFilter:{field:y0(e.field),op:"IS_NULL"}}}else if("!="===e.op){if($b(e.value))return{unaryFilter:{field:y0(e.field),op:"IS_NOT_NAN"}};if(zb(e.value))return{unaryFilter:{field:y0(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:y0(e.field),op:v0(e.op),value:e.value}}}(e):e instanceof iI?function(e){const t=e.getFilters().map(e=>n(e));return 1===t.length?t[0]:{compositeFilter:{op:_0(e.op),filters:t}}}(e):Vy()}(iI.create(e,"and"))}(t.filters);i&&(n.structuredQuery.where=i);i=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:y0(e.field),direction:(e=e.dir,HT[e])}}(e))}(t.orderBy);i&&(n.structuredQuery.orderBy=i);i=XT(e,t.limit);return null!==i&&(n.structuredQuery.limit=i),t.startAt&&(n.structuredQuery.startAt={before:(e=t.startAt).inclusive,values:e.position}),t.endAt&&(n.structuredQuery.endAt={before:!(t=t.endAt).inclusive,values:t.position}),n}function m0(e){let t=o0(e.parent);var n,r,i,s=e.structuredQuery,a=s.from?s.from.length:0;let o=null;if(0<a){qy(1===a);const p=s.from[0];p.allDescendants?o=p.collectionId:t=t.child(p.collectionId)}let c=[];s.where&&(c=function(e){const t=function t(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=w0(e.unaryFilter.field);return rI.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=w0(e.unaryFilter.field);return rI.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=w0(e.unaryFilter.field);return rI.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=w0(e.unaryFilter.field);return rI.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Vy()}}(e):void 0!==e.fieldFilter?function(e){return rI.create(w0(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Vy()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return iI.create(e.compositeFilter.filters.map(e=>t(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return Vy()}}(e.compositeFilter.op))}(e):Vy()}(e);return t instanceof iI&&oI(t)?t.getFilters():[t]}(s.where));let l=[];s.orderBy&&(l=s.orderBy.map(e=>function(e){return new tI(w0(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)));let u=null;s.limit&&(u=(e=s.limit,Ow(n="object"==typeof e?e.value:e)?null:n));let h=null;s.startAt&&(h=(r=s.startAt,i=!!r.before,n=r.values||[],new Xb(n,i)));let d=null;return s.endAt&&(d=(r=s.endAt,i=!r.before,s=r.values||[],new Xb(s,i))),AI(t,o,l,c,u,"F",h,d)}function v0(e){return QT[e]}function _0(e){return YT[e]}function y0(e){return{fieldPath:e.canonicalString()}}function w0(e){return ow.fromServerFormat(e.fieldPath)}function b0(e){return 4<=e.length&&"projects"===e.get(0)&&"databases"===e.get(2)}class I0{constructor(e,t,n,r,i=rw.min(),s=rw.min(),a=Ib.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new I0(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new I0(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new I0(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new I0(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class T0{constructor(e){this.ut=e}}function E0(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:C0(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document={name:i0(i=e.ut,(e=t).key),fields:e.data.value.mapValue.fields,updateTime:ZT(i,e.version.toTimestamp()),createTime:ZT(i,e.createTime.toTimestamp())};else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:S0(t.version)};else{if(!t.isUnknownDocument())return Vy();r.unknownDocument={path:n.path.toArray(),version:S0(t.version)}}var i;return r}function C0(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function S0(e){var t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function k0(e){var t=new nw(e.seconds,e.nanoseconds);return rw.fromTimestamp(t)}function A0(t,e){const n=(e.baseMutations||[]).map(e=>p0(t.ut,e));for(let s=0;s<e.mutations.length-1;++s){const n=e.mutations[s];if(s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform){const r=e.mutations[s+1];n.updateTransforms=r.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}const r=e.mutations.map(e=>p0(t.ut,e)),i=nw.fromMillis(e.localWriteTimeMs);return new kT(e.batchId,i,n,r)}function N0(e){var t,n=k0(e.readTime),r=void 0!==e.lastLimboFreeSnapshotVersion?k0(e.lastLimboFreeSnapshotVersion):rw.min(),i=void 0!==e.query.documents?(qy(1===(t=e.query).documents.length),xI(NI(o0(t.documents[0])))):xI(m0(e.query));return new I0(i,e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,n,r,Ib.fromBase64String(e.resumeToken))}function R0(e,t){var n=S0(t.snapshotVersion),r=S0(t.lastLimboFreeSnapshotVersion),i=(TI(t.target)?f0:g0)(e.ut,t.target),s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:bI(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function P0(e){var t=m0({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?MI(t,t.limit,"L"):t}function D0(e,t){return new NT(t.largestBatchId,p0(e.ut,t.overlayMutation))}function x0(e,t){var n=t.path.lastSegment();return[e,Fw(t.path.popLast()),n]}function O0(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:S0(r.readTime),documentKey:Fw(r.documentKey.path),largestBatchId:r.largestBatchId}}class M0{getBundleMetadata(e,t){return L0(e).get(t).next(e=>{if(e)return{id:(e=e).bundleId,createTime:k0(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return L0(e).put({bundleId:(t=t).id,createTime:S0(t0(t.createTime)),version:t.version})}getNamedQuery(e,t){return F0(e).get(t).next(e=>{if(e)return{name:(e=e).name,query:P0(e.bundledQuery),readTime:k0(e.readTime)}})}saveNamedQuery(e,t){return F0(e).put({name:(t=t).name,readTime:S0(t0(t.readTime)),bundledQuery:t.bundledQuery})}}function L0(e){return ub(e,"bundles")}function F0(e){return ub(e,"namedQueries")}class U0{constructor(e,t){this.serializer=e,this.userId=t}static ct(e,t){var n=t.uid||"";return new U0(e,n)}getOverlay(e,t){return V0(e).get(x0(this.userId,t)).next(e=>e?D0(this.serializer,e):null)}getOverlays(e,t){const n=GI();return bw.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(r,i,e){const s=[];return e.forEach((e,t)=>{var n=new NT(i,t);s.push(this.lt(r,n))}),bw.waitFor(s)}removeOverlaysForBatchId(n,e,r){const t=new Set;e.forEach(e=>t.add(Fw(e.getCollectionPath())));const i=[];return t.forEach(e=>{var t=IDBKeyRange.bound([this.userId,e,r],[this.userId,e,r+1],!1,!0);i.push(V0(n).H("collectionPathOverlayIndex",t))}),bw.waitFor(i)}getOverlaysForCollection(e,t,n){const r=GI(),i=Fw(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return V0(e).W("collectionPathOverlayIndex",s).next(e=>{for(const t of e){const e=D0(this.serializer,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,i){const s=GI();let a;var r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return V0(e).Y({index:"collectionGroupOverlayIndex",range:r},(e,t,n)=>{const r=D0(this.serializer,t);s.size()<i||r.largestBatchId===a?(s.set(r.getKey(),r),a=r.largestBatchId):n.done()}).next(()=>s)}lt(e,t){return V0(e).put(function(e,t,n){var[,r,i]=x0(t,n.mutation.key);return{userId:t,collectionPath:r,documentId:i,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:d0(e.ut,n.mutation)}}(this.serializer,this.userId,t))}}function V0(e){return ub(e,"documentOverlays")}class q0{constructor(){}ht(e,t){this.Pt(e,t),t.It()}Pt(e,t){var n,r;"nullValue"in e?this.Tt(t,5):"booleanValue"in e?(this.Tt(t,10),t.Et(e.booleanValue?1:0)):"integerValue"in e?(this.Tt(t,15),t.Et(Cb(e.integerValue))):"doubleValue"in e?(n=Cb(e.doubleValue),isNaN(n)?this.Tt(t,13):(this.Tt(t,15),Mw(n)?t.Et(0):t.Et(n))):"timestampValue"in e?(r=e.timestampValue,this.Tt(t,20),"string"==typeof r?t.dt(r):(t.dt(`${r.seconds||""}`),t.Et(r.nanos||0))):"stringValue"in e?(this.At(e.stringValue,t),this.Rt(t)):"bytesValue"in e?(this.Tt(t,30),t.Vt(Sb(e.bytesValue)),this.Rt(t)):"referenceValue"in e?this.ft(e.referenceValue,t):"geoPointValue"in e?(r=e.geoPointValue,this.Tt(t,45),t.Et(r.latitude||0),t.Et(r.longitude||0)):"mapValue"in e?Gb(e)?this.Tt(t,Number.MAX_SAFE_INTEGER):(this.gt(e.mapValue,t),this.Rt(t)):"arrayValue"in e?(this.yt(e.arrayValue,t),this.Rt(t)):Vy()}At(e,t){this.Tt(t,25),this.wt(e,t)}wt(e,t){t.dt(e)}gt(e,t){var n=e.fields||{};this.Tt(t,55);for(const e of Object.keys(n))this.At(e,t),this.Pt(n[e],t)}yt(e,t){var n=e.values||[];this.Tt(t,50);for(const e of n)this.Pt(e,t)}ft(e,t){this.Tt(t,37),cw.fromName(e).path.forEach(e=>{this.Tt(t,60),this.wt(e,t)})}Tt(e,t){e.Et(t)}Rt(e){e.Et(2)}}function B0(e){var t=64-function(e){let t=0;for(let r=0;r<8;++r){var n=function(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}(255&e[r]);if(t+=n,8!==n)break}return t}(e);return Math.ceil(t/8)}q0.St=new q0;class j0{constructor(){this.buffer=new Uint8Array(1024),this.position=0}bt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Dt(n.value),n=t.next();this.Ct()}vt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ft(n.value),n=t.next();this.Mt()}xt(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Dt(e);else if(e<2048)this.Dt(960|e>>>6),this.Dt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Dt(480|e>>>12),this.Dt(128|63&e>>>6),this.Dt(128|63&e);else{const e=t.codePointAt(0);this.Dt(240|e>>>18),this.Dt(128|63&e>>>12),this.Dt(128|63&e>>>6),this.Dt(128|63&e)}}this.Ct()}Ot(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Ft(e);else if(e<2048)this.Ft(960|e>>>6),this.Ft(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ft(480|e>>>12),this.Ft(128|63&e>>>6),this.Ft(128|63&e);else{const e=t.codePointAt(0);this.Ft(240|e>>>18),this.Ft(128|63&e>>>12),this.Ft(128|63&e>>>6),this.Ft(128|63&e)}}this.Mt()}Nt(e){var t=this.Bt(e),n=B0(t);this.Lt(1+n),this.buffer[this.position++]=255&n;for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=255&t[r]}kt(e){var t=this.Bt(e),n=B0(t);this.Lt(1+n),this.buffer[this.position++]=~(255&n);for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}qt(){this.Qt(255),this.Qt(255)}Kt(){this.$t(255),this.$t(255)}reset(){this.position=0}seed(e){this.Lt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Ut(){return this.buffer.slice(0,this.position)}Bt(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let r=1;r<t.length;++r)t[r]^=n?255:0;return t}Dt(e){var t=255&e;0==t?(this.Qt(0),this.Qt(255)):255==t?(this.Qt(255),this.Qt(0)):this.Qt(t)}Ft(e){var t=255&e;0==t?(this.$t(0),this.$t(255)):255==t?(this.$t(255),this.$t(0)):this.$t(e)}Ct(){this.Qt(0),this.Qt(1)}Mt(){this.$t(0),this.$t(1)}Qt(e){this.Lt(1),this.buffer[this.position++]=e}$t(e){this.Lt(1),this.buffer[this.position++]=~e}Lt(e){var t=e+this.position;if(!(t<=this.buffer.length)){let e=2*this.buffer.length;e<t&&(e=t);const n=new Uint8Array(e);n.set(this.buffer),this.buffer=n}}}class z0{constructor(e){this.Wt=e}Vt(e){this.Wt.bt(e)}dt(e){this.Wt.xt(e)}Et(e){this.Wt.Nt(e)}It(){this.Wt.qt()}}class $0{constructor(e){this.Wt=e}Vt(e){this.Wt.vt(e)}dt(e){this.Wt.Ot(e)}Et(e){this.Wt.kt(e)}It(){this.Wt.Kt()}}class K0{constructor(){this.Wt=new j0,this.Gt=new z0(this.Wt),this.zt=new $0(this.Wt)}seed(e){this.Wt.seed(e)}jt(e){return 0===e?this.Gt:this.zt}Ut(){return this.Wt.Ut()}reset(){this.Wt.reset()}}class W0{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Ht(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new W0(this.indexId,this.documentKey,this.arrayValue,n)}}function G0(e,t){let n=e.indexId-t.indexId;return 0!==n?n:(n=H0(e.arrayValue,t.arrayValue),0!==n?n:(n=H0(e.directionalValue,t.directionalValue),0!==n?n:cw.comparator(e.documentKey,t.documentKey)))}function H0(e,t){for(let r=0;r<e.length&&r<t.length;++r){var n=e[r]-t[r];if(0!=n)return n}return e.length-t.length}class Q0{constructor(e){this.Jt=new vb((e,t)=>ow.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Yt=e.orderBy,this.Zt=[];for(const t of e.filters){const e=t;e.isInequality()?this.Jt=this.Jt.add(e):this.Zt.push(e)}}get Xt(){return 1<this.Jt.size}en(e){if(qy(e.collectionGroup===this.collectionId),this.Xt)return!1;const t=uw(e);if(void 0!==t&&!this.tn(t))return!1;const n=hw(e);let r=new Set,i=0,s=0;for(;i<n.length&&this.tn(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(0<this.Jt.size){const e=this.Jt.getIterator().getNext();if(!r.has(e.field.canonicalString())){const t=n[i];if(!this.nn(e,t)||!this.rn(this.Yt[s++],t))return!1}++i}for(;i<n.length;++i){const e=n[i];if(s>=this.Yt.length||!this.rn(this.Yt[s++],e))return!1}return!0}sn(){if(this.Xt)return null;let e=new vb(ow.comparator);const t=[];for(const n of this.Zt)n.field.isKeyField()||("array-contains"===n.op||"array-contains-any"===n.op?t.push(new dw(n.field,2)):e.has(n.field)||(e=e.add(n.field),t.push(new dw(n.field,0))));for(const r of this.Yt)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new dw(r.field,"asc"===r.dir?0:1)));return new lw(lw.UNKNOWN_ID,this.collectionId,t,pw.empty())}tn(e){for(const t of this.Zt)if(this.nn(t,e))return!0;return!1}nn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;var n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind==n}rn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function Y0(e){if(0===e.getFilters().length)return[];const t=function t(e){if(qy(e instanceof rI||e instanceof iI),e instanceof rI)return e;if(1===e.filters.length)return t(e.filters[0]);const n=e.filters.map(e=>t(e));let r=iI.create(n,e.op);return r=nE(r),Z0(r)?r:(qy(r instanceof iI),qy(sI(r)),qy(1<r.filters.length),r.filters.reduce((e,t)=>eE(e,t)))}(function t(n){var e;if(qy(n instanceof rI||n instanceof iI),n instanceof rI){if(n instanceof mI){const r=(null===(e=null===(e=n.value.arrayValue)||void 0===e?void 0:e.values)||void 0===e?void 0:e.map(e=>rI.create(n.field,"==",e)))||[];return iI.create(r,"or")}return n}const r=n.filters.map(e=>t(e));return iI.create(r,n.op)}(e));return qy(Z0(t)),J0(t)||X0(t)?[t]:t.getFilters()}function J0(e){return e instanceof rI}function X0(e){return e instanceof iI&&oI(e)}function Z0(e){return J0(e)||X0(e)||function(e){if(e instanceof iI&&aI(e)){for(const t of e.getFilters())if(!J0(t)&&!X0(t))return!1;return!0}return!1}(e)}function eE(e,t){var n,r;return qy(e instanceof rI||e instanceof iI),qy(t instanceof rI||t instanceof iI),nE(e instanceof rI?t instanceof rI?(n=e,r=t,iI.create([n,r],"and")):tE(e,t):t instanceof rI?tE(t,e):function(e,t){if(qy(0<e.filters.length&&0<t.filters.length),sI(e)&&sI(t))return lI(e,t.getFilters());const n=aI(e)?e:t,r=aI(e)?t:e,i=n.filters.map(e=>eE(e,r));return iI.create(i,"or")}(e,t))}function tE(t,e){if(sI(e))return lI(e,t.getFilters());var n=e.filters.map(e=>eE(t,e));return iI.create(n,"or")}function nE(t){if(qy(t instanceof rI||t instanceof iI),t instanceof rI)return t;const e=t.getFilters();if(1===e.length)return nE(e[0]);if(cI(t))return t;const n=e.map(e=>nE(e)),r=[];return n.forEach(e=>{e instanceof rI?r.push(e):e instanceof iI&&(e.op===t.op?r.push(...e.filters):r.push(e))}),1===r.length?r[0]:iI.create(r,t.op)}class rE{constructor(){this.on=new iE}addToCollectionParentIndex(e,t){return this.on.add(t),bw.resolve()}getCollectionParents(e,t){return bw.resolve(this.on.getEntries(t))}addFieldIndex(e,t){return bw.resolve()}deleteFieldIndex(e,t){return bw.resolve()}deleteAllFieldIndexes(e){return bw.resolve()}createTargetIndexes(e,t){return bw.resolve()}getDocumentsMatchingTarget(e,t){return bw.resolve(null)}getIndexType(e,t){return bw.resolve(0)}getFieldIndexes(e,t){return bw.resolve([])}getNextCollectionGroupToUpdate(e){return bw.resolve(null)}getMinOffset(e,t){return bw.resolve(mw.min())}getMinOffsetFromCollectionGroup(e,t){return bw.resolve(mw.min())}updateCollectionGroup(e,t,n){return bw.resolve()}updateIndexEntries(e,t){return bw.resolve()}}class iE{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new vb(sw.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new vb(sw.comparator)).toArray()}}const sE=new Uint8Array(0);class aE{constructor(e,t){this.user=e,this.databaseId=t,this._n=new iE,this.an=new jI(e=>bI(e),(e,t)=>II(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(this._n.has(t))return bw.resolve();var n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this._n.add(t)});r={collectionId:n,parent:Fw(r)};return oE(e).put(r)}getCollectionParents(e,n){const r=[],t=IDBKeyRange.bound([n,""],[tw(n),""],!1,!0);return oE(e).W(t).next(e=>{for(const t of e){if(t.collectionId!==n)break;r.push(Vw(t.parent))}return r})}addFieldIndex(e,t){const n=lE(e),r={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete r.indexId;const i=n.add(r);if(t.indexState){const n=uE(e);return i.next(e=>{n.put(O0(e,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const n=lE(e),r=uE(e),i=cE(e);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=lE(e),n=cE(e),r=uE(e);return t.H().next(()=>n.H()).next(()=>r.H())}createTargetIndexes(n,e){return bw.forEach(this.un(e),t=>this.getIndexType(n,t).next(e=>{if(0===e||1===e){const e=new Q0(t).sn();if(null!=e)return this.addFieldIndex(n,e)}}))}getDocumentsMatchingTarget(e,u){const h=cE(e);let d=!0;const n=new Map;return bw.forEach(this.un(u),t=>this.cn(e,t).next(e=>{d=d&&!!e,n.set(t,e)})).next(()=>{if(d){let l=YI();const d=[];return bw.forEach(n,(e,t)=>{var n;My("IndexedDbIndexManager",`Using index ${n=e,`id=${n.indexId}|cg=${n.collectionGroup}|f=${n.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`} to execute ${bI(u)}`);var r=function(e,t){var n=uw(t);if(void 0===n)return null;for(const t of EI(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(t,e),i=function(e,t){const n=new Map;for(const r of hw(t))for(const t of EI(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(t,e),s=function(e,t){const n=[];let r=!0;for(const i of hw(t)){const t=(0===i.kind?CI:SI)(e,i.fieldPath,e.startAt);n.push(t.value),r=r&&t.inclusive}return new Xb(n,r)}(t,e),a=function(e,t){const n=[];let r=!0;for(const i of hw(t)){const t=(0===i.kind?SI:CI)(e,i.fieldPath,e.endAt);n.push(t.value),r=r&&t.inclusive}return new Xb(n,r)}(t,e),o=this.ln(e,t,s),c=this.ln(e,t,a),i=this.hn(e,t,i),i=this.Pn(e.indexId,r,o,s.inclusive,c,a.inclusive,i);return bw.forEach(i,e=>h.j(e,u.limit).next(e=>{e.forEach(e=>{var t=cw.fromSegments(e.documentKey);l.has(t)||(l=l.add(t),d.push(t))})}))}).next(()=>d)}return bw.resolve(null)})}un(t){let e=this.an.get(t);return e||(e=0===t.filters.length?[t]:Y0(iI.create(t.filters,"and")).map(e=>wI(t.path,t.collectionGroup,t.orderBy,e.getFilters(),t.limit,t.startAt,t.endAt)),this.an.set(t,e),e)}Pn(t,e,n,r,i,s,a){const o=(null!=e?e.length:1)*Math.max(n.length,i.length),c=o/(null!=e?e.length:1),l=[];for(let u=0;u<o;++u){const o=e?this.In(e[u/c]):sE,h=this.Tn(t,o,n[u%c],r),d=this.En(t,o,i[u%c],s),p=a.map(e=>this.Tn(t,o,e,!0));l.push(...this.createRange(h,d,p))}return l}Tn(e,t,n,r){const i=new W0(e,cw.empty(),t,n);return r?i:i.Ht()}En(e,t,n,r){const i=new W0(e,cw.empty(),t,n);return r?i.Ht():i}cn(e,t){const r=new Q0(t),n=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,n).next(e=>{let t=null;for(const n of e)r.en(n)&&(!t||n.fields.length>t.fields.length)&&(t=n);return t})}getIndexType(e,t){let n=2;const r=this.un(t);return bw.forEach(r,t=>this.cn(e,t).next(e=>{e?0!==n&&e.fields.length<function(e){let t=new vb(ow.comparator),n=!1;for(const r of e.filters)for(const e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(const n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})).next(()=>function(e){return null!==e.limit}(t)&&1<r.length&&2===n?1:n)}dn(e,t){const n=new K0;for(const i of hw(e)){const e=t.data.field(i.fieldPath);if(null==e)return null;var r=n.jt(i.kind);q0.St.ht(e,r)}return n.Ut()}In(e){const t=new K0;return q0.St.ht(e,t.jt(0)),t.Ut()}An(e,t){const n=new K0;return q0.St.ht(qb(this.databaseId,t),n.jt(0===(r=hw(e)).length?0:r[r.length-1].kind)),n.Ut();var r}hn(e,t,n){if(null===n)return[];let r=[];r.push(new K0);let i=0;for(const s of hw(e)){const e=n[i++];for(const n of r)if(this.Rn(t,s.fieldPath)&&jb(e))r=this.Vn(r,s,e);else{const t=n.jt(s.kind);q0.St.ht(e,t)}}return this.mn(r)}ln(e,t,n){return this.hn(e,t,n.position)}mn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Ut();return t}Vn(e,t,n){const r=[...e],i=[];for(const e of n.arrayValue.values||[])for(const n of r){const r=new K0;r.seed(n.Ut()),q0.St.ht(e,r.jt(t.kind)),i.push(r)}return i}Rn(e,t){return!!e.filters.find(e=>e instanceof rI&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){const n=lE(e),r=uE(e);return(t?n.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.W()).next(e=>{const s=[];return bw.forEach(e,i=>r.get([i.indexId,this.uid]).next(e=>{var t,n,r;s.push((t=i,n=(e=e)?new pw(e.sequenceNumber,new mw(k0(e.readTime),new cw(Vw(e.documentKey)),e.largestBatchId)):pw.empty(),r=t.fields.map(([e,t])=>new dw(ow.fromServerFormat(e),t)),new lw(t.indexId,t.collectionGroup,r,n)))})).next(()=>s)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{var n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!=n?n:Zy(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,n,r){const i=lE(e),s=uE(e);return this.fn(e).next(t=>i.W("collectionGroupIndex",IDBKeyRange.bound(n,n)).next(e=>bw.forEach(e,e=>s.put(O0(e.indexId,this.user,t,r)))))}updateIndexEntries(i,e){const n=new Map;return bw.forEach(e,(t,r)=>{var e=n.get(t.collectionGroup);return(e?bw.resolve(e):this.getFieldIndexes(i,t.collectionGroup)).next(e=>(n.set(t.collectionGroup,e),bw.forEach(e,n=>this.gn(i,t,n).next(e=>{var t=this.pn(r,n);return e.isEqual(t)?bw.resolve():this.yn(i,r,n,e,t)}))))})}wn(e,t,n,r){return cE(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.An(n,t.key),documentKey:t.key.path.toArray()})}Sn(e,t,n,r){return cE(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.An(n,t.key),t.key.path.toArray()])}gn(e,n,r){const t=cE(e);let i=new vb(G0);return t.Y({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.An(r,n)])},(e,t)=>{i=i.add(new W0(r.indexId,n,t.arrayValue,t.directionalValue))}).next(()=>i)}pn(e,t){let n=new vb(G0);var r=this.dn(t,e);if(null==r)return n;const i=uw(t);if(null!=i){var s=e.data.field(i.fieldPath);if(jb(s))for(const i of s.arrayValue.values||[])n=n.add(new W0(t.indexId,e.key,this.In(i),r))}else n=n.add(new W0(t.indexId,e.key,sE,r));return n}yn(t,n,r,e,i){My("IndexedDbIndexManager","Updating index entries for document '%s'",n.key);const s=[];return function(e,t,n,r,i){var s=e.getIterator(),a=t.getIterator();let o=yb(s),c=yb(a);for(;o||c;){let e=!1,t=!1;if(o&&c){const r=n(o,c);r<0?t=!0:0<r&&(e=!0)}else null!=o?t=!0:e=!0;e?(r(c),c=yb(a)):t?(i(o),o=yb(s)):(o=yb(s),c=yb(a))}}(e,i,G0,e=>{s.push(this.wn(t,n,r,e))},e=>{s.push(this.Sn(t,n,r,e))}),bw.waitFor(s)}fn(e){let r=1;return uE(e).Y({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,t,n)=>{n.done(),r=t.sequenceNumber+1}).next(()=>r)}createRange(e,t,n){n=n.sort((e,t)=>G0(e,t)).filter((e,t,n)=>!t||0!==G0(e,n[t-1]));const r=[];r.push(e);for(const i of n){const n=G0(i,e),s=G0(i,t);if(0===n)r[0]=e.Ht();else if(0<n&&s<0)r.push(i),r.push(i.Ht());else if(0<s)break}r.push(t);const i=[];for(let a=0;a<r.length;a+=2){if(this.bn(r[a],r[a+1]))return[];const t=[r[a].indexId,this.uid,r[a].arrayValue,r[a].directionalValue,sE,[]],n=[r[a+1].indexId,this.uid,r[a+1].arrayValue,r[a+1].directionalValue,sE,[]];i.push(IDBKeyRange.bound(t,n))}return i}bn(e,t){return 0<G0(e,t)}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(hE)}getMinOffset(t,e){return bw.mapArray(this.un(e),e=>this.cn(t,e).next(e=>e||Vy())).next(hE)}}function oE(e){return ub(e,"collectionParents")}function cE(e){return ub(e,"indexEntries")}function lE(e){return ub(e,"indexConfiguration")}function uE(e){return ub(e,"indexState")}function hE(e){qy(0!==e.length);let t=e[0].indexState.offset,n=t.largestBatchId;for(let i=1;i<e.length;i++){var r=e[i].indexState.offset;vw(r,t)<0&&(t=r),n<r.largestBatchId&&(n=r.largestBatchId)}return new mw(t.readTime,t.documentKey,n)}const dE={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class pE{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new pE(e,pE.DEFAULT_COLLECTION_PERCENTILE,pE.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function fE(e,t,n){const r=e.store("mutations"),i=e.store("documentMutations"),s=[],a=IDBKeyRange.only(n.batchId);let o=0;const c=r.Y({range:a},(e,t,n)=>(o++,n.delete()));s.push(c.next(()=>{qy(1===o)}));const l=[];for(const e of n.mutations){const r=jw(t,e.key.path,n.batchId);s.push(i.delete(r)),l.push(e.key)}return bw.waitFor(s).next(()=>l)}function gE(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw Vy();t=e.noDocument}return JSON.stringify(t).length}pE.DEFAULT_COLLECTION_PERCENTILE=10,pE.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,pE.DEFAULT=new pE(41943040,pE.DEFAULT_COLLECTION_PERCENTILE,pE.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),pE.DISABLED=new pE(-1,0,0);class mE{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Dn={}}static ct(e,t,n,r){qy(""!==e.uid);var i=e.isAuthenticated()?e.uid:"";return new mE(i,t,n,r)}checkEmpty(e){let r=!0;var t=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return _E(e).Y({index:"userMutationsIndex",range:t},(e,t,n)=>{r=!1,n.done()}).next(()=>r)}addMutationBatch(u,h,d,p){const f=yE(u),g=_E(u);return g.add({}).next(e=>{qy("number"==typeof e);const t=new kT(e,h,d,p),n=(i=this.serializer,s=this.userId,a=t,o=a.baseMutations.map(e=>d0(i.ut,e)),c=a.mutations.map(e=>d0(i.ut,e)),{userId:s,batchId:a.batchId,localWriteTimeMs:a.localWriteTime.toMillis(),baseMutations:o,mutations:c}),r=[];var i,s,a,o,c;let l=new vb((e,t)=>Zy(e.canonicalString(),t.canonicalString()));for(const u of p){const h=jw(this.userId,u.key.path,e);l=l.add(u.key.path.popLast()),r.push(g.put(n)),r.push(f.put(h,zw))}return l.forEach(e=>{r.push(this.indexManager.addToCollectionParentIndex(u,e))}),u.addOnCommittedListener(()=>{this.Dn[e]=t.keys()}),bw.waitFor(r).next(()=>t)})}lookupMutationBatch(e,t){return _E(e).get(t).next(e=>e?(qy(e.userId===this.userId),A0(this.serializer,e)):null)}Cn(e,n){return this.Dn[n]?bw.resolve(this.Dn[n]):this.lookupMutationBatch(e,n).next(e=>{if(e){var t=e.keys();return this.Dn[n]=t}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return _E(e).Y({index:"userMutationsIndex",range:n},(e,t,n)=>{t.userId===this.userId&&(qy(t.batchId>=r),i=A0(this.serializer,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return _E(e).Y({index:"userMutationsIndex",range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){var t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return _E(e).W("userMutationsIndex",t).next(e=>e.map(e=>A0(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(a,o){const e=Bw(this.userId,o.path),t=IDBKeyRange.lowerBound(e),c=[];return yE(a).Y({range:t},(e,t,n)=>{var[r,i,s]=e,i=Vw(i);if(r===this.userId&&o.path.isEqual(i))return _E(a).get(s).next(e=>{if(!e)throw Vy();qy(e.userId===this.userId),c.push(A0(this.serializer,e))});n.done()}).next(()=>c)}getAllMutationBatchesAffectingDocumentKeys(t,e){let o=new vb(Zy);const n=[];return e.forEach(a=>{var e=Bw(this.userId,a.path),e=IDBKeyRange.lowerBound(e),e=yE(t).Y({range:e},(e,t,n)=>{var[r,i,s]=e,i=Vw(i);r===this.userId&&a.path.isEqual(i)?o=o.add(s):n.done()});n.push(e)}),bw.waitFor(n).next(()=>this.vn(t,o))}getAllMutationBatchesAffectingQuery(e,t){const a=t.path,o=a.length+1,n=Bw(this.userId,a),r=IDBKeyRange.lowerBound(n);let c=new vb(Zy);return yE(e).Y({range:r},(e,t,n)=>{var[r,i,s]=e,i=Vw(i);r===this.userId&&a.isPrefixOf(i)?i.length===o&&(c=c.add(s)):n.done()}).next(()=>this.vn(e,c))}vn(t,e){const n=[],r=[];return e.forEach(e=>{r.push(_E(t).get(e).next(e=>{if(null===e)throw Vy();qy(e.userId===this.userId),n.push(A0(this.serializer,e))}))}),bw.waitFor(r).next(()=>n)}removeMutationBatch(t,n){return fE(t.ae,this.userId,n).next(e=>(t.addOnCommittedListener(()=>{this.Fn(n.batchId)}),bw.forEach(e,e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))}Fn(e){delete this.Dn[e]}performConsistencyCheck(n){return this.checkEmpty(n).next(e=>{if(!e)return bw.resolve();const t=IDBKeyRange.lowerBound([this.userId]),r=[];return yE(n).Y({range:t},(e,t,n)=>{if(e[0]===this.userId){const t=Vw(e[1]);r.push(t)}else n.done()}).next(()=>{qy(0===r.length)})})}containsKey(e,t){return vE(e,this.userId,t)}Mn(e){return wE(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function vE(e,s,t){const n=Bw(s,t.path),a=n[1],r=IDBKeyRange.lowerBound(n);let o=!1;return yE(e).Y({range:r,J:!0},(e,t,n)=>{var[r,i]=e;r===s&&i===a&&(o=!0),n.done()}).next(()=>o)}function _E(e){return ub(e,"mutations")}function yE(e){return ub(e,"documentMutations")}function wE(e){return ub(e,"mutationQueues")}class bE{constructor(e){this.xn=e}next(){return this.xn+=2,this.xn}static On(){return new bE(0)}static Nn(){return new bE(-1)}}class IE{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(n){return this.Bn(n).next(e=>{const t=new bE(e.highestTargetId);return e.highestTargetId=t.next(),this.Ln(n,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Bn(e).next(e=>rw.fromTimestamp(new nw(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Bn(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,n,r){return this.Bn(t).next(e=>(e.highestListenSequenceNumber=n,r&&(e.lastRemoteSnapshotVersion=r.toTimestamp()),n>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=n),this.Ln(t,e)))}addTargetData(t,n){return this.kn(t,n).next(()=>this.Bn(t).next(e=>(e.targetCount+=1,this.qn(n,e),this.Ln(t,e))))}updateTargetData(e,t){return this.kn(e,t)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>TE(t).delete(e.targetId)).next(()=>this.Bn(t)).next(e=>(qy(0<e.targetCount),--e.targetCount,this.Ln(t,e)))}removeTargets(r,i,s){let a=0;const o=[];return TE(r).Y((e,t)=>{var n=N0(t);n.sequenceNumber<=i&&null===s.get(n.targetId)&&(a++,o.push(this.removeTargetData(r,n)))}).next(()=>bw.waitFor(o)).next(()=>a)}forEachTarget(e,r){return TE(e).Y((e,t)=>{var n=N0(t);r(n)})}Bn(e){return EE(e).get("targetGlobalKey").next(e=>(qy(null!==e),e))}Ln(e,t){return EE(e).put("targetGlobalKey",t)}kn(e,t){return TE(e).put(R0(this.serializer,t))}qn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Bn(e).next(e=>e.targetCount)}getTargetData(e,i){var t=bI(i),t=IDBKeyRange.bound([t,Number.NEGATIVE_INFINITY],[t,Number.POSITIVE_INFINITY]);let s=null;return TE(e).Y({range:t,index:"queryTargetsIndex"},(e,t,n)=>{var r=N0(t);II(i,r.target)&&(s=r,n.done())}).next(()=>s)}addMatchingKeys(n,e,r){const i=[],s=CE(n);return e.forEach(e=>{var t=Fw(e.path);i.push(s.put({targetId:r,path:t})),i.push(this.referenceDelegate.addReference(n,r,e))}),bw.waitFor(i)}removeMatchingKeys(n,e,r){const i=CE(n);return bw.forEach(e,e=>{var t=Fw(e.path);return bw.waitFor([i.delete([r,t]),this.referenceDelegate.removeReference(n,r,e)])})}removeMatchingKeysForTargetId(e,t){const n=CE(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=CE(e);let i=YI();return r.Y({range:n,J:!0},(e,t,n)=>{var r=Vw(e[1]),r=new cw(r);i=i.add(r)}).next(()=>i)}containsKey(e,t){var n=Fw(t.path),n=IDBKeyRange.bound([n],[tw(n)],!1,!0);let r=0;return CE(e).Y({index:"documentTargetsIndex",J:!0,range:n},([e],t,n)=>{0!==e&&(r++,n.done())}).next(()=>0<r)}_t(e,t){return TE(e).get(t).next(e=>e?N0(e):null)}}function TE(e){return ub(e,"targets")}function EE(e){return ub(e,"targetGlobal")}function CE(e){return ub(e,"targetDocuments")}function SE([e,t],[n,r]){var i=Zy(e,n);return 0===i?Zy(t,r):i}class kE{constructor(e){this.Qn=e,this.buffer=new vb(SE),this.Kn=0}$n(){return++this.Kn}Un(e){var t=[e,this.$n()];if(this.buffer.size<this.Qn)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();SE(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class AE{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Wn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Gn(6e4)}stop(){this.Wn&&(this.Wn.cancel(),this.Wn=null)}get started(){return null!==this.Wn}Gn(e){My("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Wn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Wn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Sw(e)?My("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await ww(e)}await this.Gn(3e5)})}}class NE{constructor(e,t){this.zn=e,this.params=t}calculateTargetCount(e,t){return this.zn.jn(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return bw.resolve(xw._e);const n=new kE(t);return this.zn.forEachTarget(e,e=>n.Un(e.sequenceNumber)).next(()=>this.zn.Hn(e,e=>n.Un(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.zn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.zn.removeOrphanedDocuments(e,t)}collect(t,n){return-1===this.params.cacheSizeCollectionThreshold?(My("LruGarbageCollector","Garbage collection skipped; disabled"),bw.resolve(dE)):this.getCacheSize(t).next(e=>e<this.params.cacheSizeCollectionThreshold?(My("LruGarbageCollector",`Garbage collection skipped; Cache size ${e} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),dE):this.Jn(t,n))}getCacheSize(e){return this.zn.getCacheSize(e)}Jn(t,n){let r,i,s,a,o,c,l;const u=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(e=>(i=e>this.params.maximumSequenceNumbersToCollect?(My("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),this.params.maximumSequenceNumbersToCollect):e,a=Date.now(),this.nthSequenceNumber(t,i))).next(e=>(r=e,o=Date.now(),this.removeTargets(t,r,n))).next(e=>(s=e,c=Date.now(),this.removeOrphanedDocuments(t,r))).next(e=>(l=Date.now(),Oy()<=m.DEBUG&&My("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${a-u}ms\n\tDetermined least recently used ${i} in `+(o-a)+"ms\n"+`\tRemoved ${s} targets in `+(c-o)+"ms\n"+`\tRemoved ${e} documents in `+(l-c)+"ms\n"+`Total Duration: ${l-u}ms`),bw.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:e})))}}class RE{constructor(e,t){this.db=e,this.garbageCollector=(e=this,t=t,new NE(e,t))}jn(e){const n=this.Yn(e);return this.db.getTargetCache().getTargetCount(e).next(t=>n.next(e=>t+e))}Yn(e){let t=0;return this.Hn(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Hn(e,n){return this.Zn(e,(e,t)=>n(t))}addReference(e,t,n){return PE(e,n)}removeReference(e,t,n){return PE(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return PE(e,t)}Xn(t,n){let r=!1;return wE(t).Z(e=>vE(t,e,n).next(e=>(e&&(r=!0),bw.resolve(!e)))).next(()=>r)}removeOrphanedDocuments(n,r){const i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let a=0;return this.Zn(n,(t,e)=>{if(e<=r){const r=this.Xn(n,t).next(e=>{if(!e)return a++,i.getEntry(n,t).next(()=>(i.removeEntry(t,rw.min()),CE(n).delete(function(e){return[0,Fw(e.path)]}(t))))});s.push(r)}}).next(()=>bw.waitFor(s)).next(()=>i.apply(n)).next(()=>a)}removeTarget(e,t){var n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return PE(e,t)}Zn(e,r){const t=CE(e);let i,s=xw._e;return t.Y({index:"documentTargetsIndex"},([e],{path:t,sequenceNumber:n})=>{0===e?(s!==xw._e&&r(new cw(Vw(i)),s),s=n,i=t):s=xw._e}).next(()=>{s!==xw._e&&r(new cw(Vw(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function PE(e,t){return CE(e).put((e=e.currentSequenceNumber,{targetId:0,path:Fw(t.path),sequenceNumber:e}))}class DE{constructor(){this.changes=new jI(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Jb.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?bw.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class xE{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return FE(e).put(n)}removeEntry(e,t,n){return FE(e).delete(function(e,t){const n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],C0(t),n[n.length-1]]}(t,n))}updateMetadata(t,n){return this.getMetadata(t).next(e=>(e.byteSize+=n,this.er(t,e)))}getEntry(e,n){let r=Jb.newInvalidDocument(n);return FE(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(UE(n))},(e,t)=>{r=this.tr(n,t)}).next(()=>r)}nr(e,n){let r={size:0,document:Jb.newInvalidDocument(n)};return FE(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(UE(n))},(e,t)=>{r={document:this.tr(n,t),size:gE(t)}}).next(()=>r)}getEntries(e,t){let r=zI;return this.rr(e,t,(e,t)=>{var n=this.tr(e,t);r=r.insert(e,n)}).next(()=>r)}ir(e,t){let r=zI,i=new fb(cw.comparator);return this.rr(e,t,(e,t)=>{var n=this.tr(e,t);r=r.insert(e,n),i=i.insert(e,gE(t))}).next(()=>({documents:r,sr:i}))}rr(e,t,i){if(t.isEmpty())return bw.resolve();let n=new vb(qE);t.forEach(e=>n=n.add(e));const r=IDBKeyRange.bound(UE(n.first()),UE(n.last())),s=n.getIterator();let a=s.getNext();return FE(e).Y({index:"documentKeyIndex",range:r},(e,t,n)=>{for(var r=cw.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);a&&qE(a,r)<0;)i(a,null),a=s.getNext();a&&a.isEqual(r)&&(i(a,t),a=s.hasNext()?s.getNext():null),a?n.U(UE(a)):n.done()}).next(()=>{for(;a;)i(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,n,t,r,i){const s=n.path,a=[s.popLast().toArray(),s.lastSegment(),C0(t.readTime),t.documentKey.path.isEmpty()?"":t.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return FE(e).W(IDBKeyRange.bound(a,o,!0)).next(e=>{null==i||i.incrementDocumentReadCount(e.length);let t=zI;for(const i of e){const e=this.tr(cw.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(VI(n,e)||r.has(e.key))&&(t=t.insert(e.key,e))}return t})}getAllFromCollectionGroup(e,t,n,i){let s=zI;var r=VE(t,n),a=VE(t,mw.max());return FE(e).Y({index:"collectionGroupIndex",range:IDBKeyRange.bound(r,a,!0)},(e,t,n)=>{var r=this.tr(cw.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);s=s.insert(r.key,r),s.size===i&&n.done()}).next(()=>s)}newChangeBuffer(e){return new ME(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return LE(e).get("remoteDocumentGlobalKey").next(e=>(qy(!!e),e))}er(e,t){return LE(e).put("remoteDocumentGlobalKey",t)}tr(e,t){if(t){const e=function(e,t){let n;if(t.document)n=h0(e.ut,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=cw.fromSegments(t.noDocument.path),i=k0(t.noDocument.readTime);n=Jb.newNoDocument(e,i),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return Vy();{const e=cw.fromSegments(t.unknownDocument.path),s=k0(t.unknownDocument.version);n=Jb.newUnknownDocument(e,s)}}return t.readTime&&n.setReadTime((t=t.readTime,r=new nw(t[0],t[1]),rw.fromTimestamp(r))),n;var r}(this.serializer,t);if(!e.isNoDocument()||!e.version.isEqual(rw.min()))return e}return Jb.newInvalidDocument(e)}}function OE(e){return new xE(e)}class ME extends DE{constructor(e,t){super(),this._r=e,this.trackRemovals=t,this.ar=new jI(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(s){const a=[];let o=0,c=new vb((e,t)=>Zy(e.canonicalString(),t.canonicalString()));return this.changes.forEach((e,t)=>{var n=this.ar.get(e);if(a.push(this._r.removeEntry(s,e,n.readTime)),t.isValidDocument()){var r=E0(this._r.serializer,t);c=c.add(e.path.popLast());var i=gE(r);o+=i-n.size,a.push(this._r.addEntry(s,e,r))}else if(o-=n.size,this.trackRemovals){const o=E0(this._r.serializer,t.convertToNoDocument(rw.min()));a.push(this._r.addEntry(s,e,o))}}),c.forEach(e=>{a.push(this._r.indexManager.addToCollectionParentIndex(s,e))}),a.push(this._r.updateMetadata(s,o)),bw.waitFor(a)}getFromCache(e,t){return this._r.nr(e,t).next(e=>(this.ar.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this._r.ir(e,t).next(({documents:n,sr:e})=>(e.forEach((e,t)=>{this.ar.set(e,{size:t,readTime:n.get(e).readTime})}),n))}}function LE(e){return ub(e,"remoteDocumentGlobal")}function FE(e){return ub(e,"remoteDocumentsV14")}function UE(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function VE(e,t){const n=t.documentKey.path.toArray();return[e,C0(t.readTime),n.slice(0,n.length-2),0<n.length?n[n.length-1]:""]}function qE(e,t){var n=e.path.toArray(),r=t.path.toArray();let i=0;for(let s=0;s<n.length-2&&s<r.length-2;++s)if(i=Zy(n[s],r[s]),i)return i;return i=Zy(n.length,r.length),i||(i=Zy(n[n.length-2],r[r.length-2]),i||Zy(n[n.length-1],r[r.length-1]))}class BE{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class jE{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,n){let r=null;return this.documentOverlayCache.getOverlay(t,n).next(e=>(r=e,this.remoteDocumentCache.getEntry(t,n))).next(e=>(null!==r&&_T(r.mutation,e,wb.empty(),nw.now()),e))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.getLocalViewOfDocuments(t,e,YI()).next(()=>e))}getLocalViewOfDocuments(e,t,n=YI()){const r=GI();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let n=KI();return e.forEach((e,t)=>{n=n.insert(e,t.overlayedDocument)}),n}))}getOverlayedDocuments(e,t){const n=GI();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,YI()))}populateOverlays(e,n,t){const r=[];return t.forEach(e=>{n.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,t)=>{n.set(e,t)})})}computeViews(e,t,r,i){let s=zI;const a=GI(),o=GI();return t.forEach((e,t)=>{const n=r.get(t.key);i.has(t.key)&&(void 0===n||n.mutation instanceof bT)?s=s.insert(t.key,t):void 0!==n?(a.set(t.key,n.mutation.getFieldMask()),_T(n.mutation,t,n.mutation.getFieldMask(),nw.now())):a.set(t.key,wb.empty())}),this.recalculateAndSaveOverlays(e,s).next(e=>(e.forEach((e,t)=>a.set(e,t)),t.forEach((e,t)=>{var n;return o.set(e,new BE(t,null!==(n=a.get(e))&&void 0!==n?n:null))}),o))}recalculateAndSaveOverlays(s,a){const o=GI();let c=new fb((e,t)=>e-t),l=YI();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(s,a).next(e=>{for(const r of e)r.keys().forEach(e=>{var t,n=a.get(e);null!==n&&(t=o.get(e)||wb.empty(),t=r.applyToLocalView(n,t),o.set(e,t),t=(c.get(r.batchId)||YI()).add(e),c=c.insert(r.batchId,t))})}).next(()=>{const e=[],t=c.getReverseIterator();for(;t.hasNext();){const c=t.getNext(),n=c.key,r=c.value,i=GI();r.forEach(e=>{var t;l.has(e)||(null!==(t=mT(a.get(e),o.get(e)))&&i.set(e,t),l=l.add(e))}),e.push(this.documentOverlayCache.saveOverlays(s,n,i))}return bw.waitFor(e)}).next(()=>o)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.recalculateAndSaveOverlays(t,e))}getDocumentsMatchingQuery(e,t,n,r){return i=t,cw.isDocumentKey(i.path)&&null===i.collectionGroup&&0===i.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):PI(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r);var i}getNextDocuments(s,t,a,o){return this.remoteDocumentCache.getAllFromCollectionGroup(s,t,a,o).next(n=>{const e=0<o-n.size?this.documentOverlayCache.getOverlaysForCollectionGroup(s,t,a.largestBatchId,o-n.size):bw.resolve(GI());let r=-1,i=n;return e.next(e=>bw.forEach(e,(t,e)=>(r<e.largestBatchId&&(r=e.largestBatchId),n.get(t)?bw.resolve():this.remoteDocumentCache.getEntry(s,t).next(e=>{i=i.insert(t,e)}))).next(()=>this.populateOverlays(s,e,n)).next(()=>this.computeViews(s,i,e,YI())).next(e=>({batchId:r,changes:WI(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new cw(t)).next(e=>{let t=KI();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(r,i,s,a){const o=i.collectionGroup;let c=KI();return this.indexManager.getCollectionParents(r,o).next(e=>bw.forEach(e,e=>{var t,n=(t=i,e=e.child(o),new kI(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt));return this.getDocumentsMatchingCollectionQuery(r,n,s,a).next(e=>{e.forEach((e,t)=>{c=c.insert(e,t)})})}).next(()=>c))}getDocumentsMatchingCollectionQuery(t,s,n,r){let a;return this.documentOverlayCache.getOverlaysForCollection(t,s.path,n.largestBatchId).next(e=>(a=e,this.remoteDocumentCache.getDocumentsMatchingQuery(t,s,n,a,r))).next(r=>{a.forEach((e,t)=>{var n=t.getKey();null===r.get(n)&&(r=r.insert(n,Jb.newInvalidDocument(n)))});let i=KI();return r.forEach((e,t)=>{var n=a.get(e);void 0!==n&&_T(n.mutation,t,wb.empty(),nw.now()),VI(s,t)&&(i=i.insert(e,t))}),i})}}class zE{constructor(e){this.serializer=e,this.ur=new Map,this.cr=new Map}getBundleMetadata(e,t){return bw.resolve(this.ur.get(t))}saveBundleMetadata(e,t){return this.ur.set(t.id,{id:t.id,version:t.version,createTime:t0(t.createTime)}),bw.resolve()}getNamedQuery(e,t){return bw.resolve(this.cr.get(t))}saveNamedQuery(e,t){return this.cr.set(t.name,{name:(t=t).name,query:P0(t.bundledQuery),readTime:t0(t.readTime)}),bw.resolve()}}class $E{constructor(){this.overlays=new fb(cw.comparator),this.lr=new Map}getOverlay(e,t){return bw.resolve(this.overlays.get(t))}getOverlays(e,t){const n=GI();return bw.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(n,r,e){return e.forEach((e,t)=>{this.lt(n,r,t)}),bw.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.lr.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.lr.delete(n)),bw.resolve()}getOverlaysForCollection(e,t,n){const r=GI(),i=t.length+1,s=new cw(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){const e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return bw.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let i=new fb((e,t)=>e-t);const s=this.overlays.getIterator();for(;s.hasNext();){const t=s.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=GI(),i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const a=GI(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return bw.resolve(a)}lt(e,t,n){var r=this.overlays.get(n.key);if(null!==r){const e=this.lr.get(r.largestBatchId).delete(n.key);this.lr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new NT(t,n));let i=this.lr.get(t);void 0===i&&(i=YI(),this.lr.set(t,i)),this.lr.set(t,i.add(n.key))}}class KE{constructor(){this.hr=new vb(WE.Pr),this.Ir=new vb(WE.Tr)}isEmpty(){return this.hr.isEmpty()}addReference(e,t){var n=new WE(e,t);this.hr=this.hr.add(n),this.Ir=this.Ir.add(n)}Er(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.dr(new WE(e,t))}Ar(e,t){e.forEach(e=>this.removeReference(e,t))}Rr(e){const t=new cw(new sw([])),n=new WE(t,e),r=new WE(t,e+1),i=[];return this.Ir.forEachInRange([n,r],e=>{this.dr(e),i.push(e.key)}),i}Vr(){this.hr.forEach(e=>this.dr(e))}dr(e){this.hr=this.hr.delete(e),this.Ir=this.Ir.delete(e)}mr(e){var t=new cw(new sw([])),n=new WE(t,e),t=new WE(t,e+1);let r=YI();return this.Ir.forEachInRange([n,t],e=>{r=r.add(e.key)}),r}containsKey(e){var t=new WE(e,0),t=this.hr.firstAfterOrEqual(t);return null!==t&&e.isEqual(t.key)}}class WE{constructor(e,t){this.key=e,this.gr=t}static Pr(e,t){return cw.comparator(e.key,t.key)||Zy(e.gr,t.gr)}static Tr(e,t){return Zy(e.gr,t.gr)||cw.comparator(e.key,t.key)}}class GE{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.pr=1,this.yr=new vb(WE.Pr)}checkEmpty(e){return bw.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){var i=this.pr;this.pr++,0<this.mutationQueue.length&&this.mutationQueue[this.mutationQueue.length-1];var s=new kT(i,t,n,r);this.mutationQueue.push(s);for(const t of r)this.yr=this.yr.add(new WE(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return bw.resolve(s)}lookupMutationBatch(e,t){return bw.resolve(this.wr(t))}getNextMutationBatchAfterBatchId(e,t){var n=this.Sr(t+1),n=n<0?0:n;return bw.resolve(this.mutationQueue.length>n?this.mutationQueue[n]:null)}getHighestUnacknowledgedBatchId(){return bw.resolve(0===this.mutationQueue.length?-1:this.pr-1)}getAllMutationBatches(e){return bw.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new WE(t,0),r=new WE(t,Number.POSITIVE_INFINITY),i=[];return this.yr.forEachInRange([n,r],e=>{var t=this.wr(e.gr);i.push(t)}),bw.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new vb(Zy);return t.forEach(e=>{var t=new WE(e,0),n=new WE(e,Number.POSITIVE_INFINITY);this.yr.forEachInRange([t,n],e=>{r=r.add(e.gr)})}),bw.resolve(this.br(r))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;cw.isDocumentKey(i)||(i=i.child(""));var s=new WE(new cw(i),0);let a=new vb(Zy);return this.yr.forEachWhile(e=>{var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e.gr)),!0)},s),bw.resolve(this.br(a))}br(e){const n=[];return e.forEach(e=>{var t=this.wr(e);null!==t&&n.push(t)}),n}removeMutationBatch(n,r){qy(0===this.Dr(r.batchId,"removed")),this.mutationQueue.shift();let i=this.yr;return bw.forEach(r.mutations,e=>{var t=new WE(e.key,r.batchId);return i=i.delete(t),this.referenceDelegate.markPotentiallyOrphaned(n,e.key)}).next(()=>{this.yr=i})}Fn(e){}containsKey(e,t){var n=new WE(t,0),n=this.yr.firstAfterOrEqual(n);return bw.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,bw.resolve()}Dr(e,t){return this.Sr(e)}Sr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}wr(e){var t=this.Sr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class HE{constructor(e){this.Cr=e,this.docs=new fb(cw.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.Cr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return bw.resolve(n?n.document.mutableCopy():Jb.newInvalidDocument(t))}getEntries(e,t){let n=zI;return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Jb.newInvalidDocument(e))}),bw.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=zI;const s=t.path,a=new cw(s.child("")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){const{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||vw(gw(a),n)<=0||(r.has(a.key)||VI(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return bw.resolve(i)}getAllFromCollectionGroup(e,t,n,r){Vy()}vr(e,t){return bw.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new QE(this)}getSize(e){return bw.resolve(this.size)}}class QE extends DE{constructor(e){super(),this._r=e}applyChanges(n){const r=[];return this.changes.forEach((e,t)=>{t.isValidDocument()?r.push(this._r.addEntry(n,t)):this._r.removeEntry(e)}),bw.waitFor(r)}getFromCache(e,t){return this._r.getEntry(e,t)}getAllFromCache(e,t){return this._r.getEntries(e,t)}}class YE{constructor(e){this.persistence=e,this.Fr=new jI(e=>bI(e),II),this.lastRemoteSnapshotVersion=rw.min(),this.highestTargetId=0,this.Mr=0,this.Or=new KE,this.targetCount=0,this.Nr=bE.On()}forEachTarget(e,n){return this.Fr.forEach((e,t)=>n(t)),bw.resolve()}getLastRemoteSnapshotVersion(e){return bw.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return bw.resolve(this.Mr)}allocateTargetId(e){return this.highestTargetId=this.Nr.next(),bw.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Mr&&(this.Mr=t),bw.resolve()}kn(e){this.Fr.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.Nr=new bE(t),this.highestTargetId=t),e.sequenceNumber>this.Mr&&(this.Mr=e.sequenceNumber)}addTargetData(e,t){return this.kn(t),this.targetCount+=1,bw.resolve()}updateTargetData(e,t){return this.kn(t),bw.resolve()}removeTargetData(e,t){return this.Fr.delete(t.target),this.Or.Rr(t.targetId),--this.targetCount,bw.resolve()}removeTargets(n,r,i){let s=0;const a=[];return this.Fr.forEach((e,t)=>{t.sequenceNumber<=r&&null===i.get(t.targetId)&&(this.Fr.delete(e),a.push(this.removeMatchingKeysForTargetId(n,t.targetId)),s++)}),bw.waitFor(a).next(()=>s)}getTargetCount(e){return bw.resolve(this.targetCount)}getTargetData(e,t){var n=this.Fr.get(t)||null;return bw.resolve(n)}addMatchingKeys(e,t,n){return this.Or.Er(t,n),bw.resolve()}removeMatchingKeys(t,e,n){this.Or.Ar(e,n);const r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(e=>{i.push(r.markPotentiallyOrphaned(t,e))}),bw.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Or.Rr(t),bw.resolve()}getMatchingKeysForTargetId(e,t){var n=this.Or.mr(t);return bw.resolve(n)}containsKey(e,t){return bw.resolve(this.Or.containsKey(t))}}class JE{constructor(e,t){this.Br={},this.overlays={},this.Lr=new xw(0),this.kr=!1,this.kr=!0,this.referenceDelegate=e(this),this.qr=new YE(this),this.indexManager=new rE,this.remoteDocumentCache=(e=e=>this.referenceDelegate.Qr(e),new HE(e)),this.serializer=new T0(t),this.Kr=new zE(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.kr=!1,Promise.resolve()}get started(){return this.kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new $E,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Br[e.toKey()];return n||(n=new GE(t,this.referenceDelegate),this.Br[e.toKey()]=n),n}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Kr}runTransaction(e,t,n){My("MemoryPersistence","Starting transaction:",e);const r=new XE(this.Lr.next());return this.referenceDelegate.$r(),n(r).next(e=>this.referenceDelegate.Ur(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Wr(t,n){return bw.or(Object.values(this.Br).map(e=>()=>e.containsKey(t,n)))}}class XE extends yw{constructor(e){super(),this.currentSequenceNumber=e}}class ZE{constructor(e){this.persistence=e,this.Gr=new KE,this.zr=null}static jr(e){return new ZE(e)}get Hr(){if(this.zr)return this.zr;throw Vy()}addReference(e,t,n){return this.Gr.addReference(n,t),this.Hr.delete(n.toString()),bw.resolve()}removeReference(e,t,n){return this.Gr.removeReference(n,t),this.Hr.add(n.toString()),bw.resolve()}markPotentiallyOrphaned(e,t){return this.Hr.add(t.toString()),bw.resolve()}removeTarget(e,t){this.Gr.Rr(t.targetId).forEach(e=>this.Hr.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.Hr.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}$r(){this.zr=new Set}Ur(n){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return bw.forEach(this.Hr,e=>{const t=cw.fromPath(e);return this.Jr(n,t).next(e=>{e||r.removeEntry(t,rw.min())})}).next(()=>(this.zr=null,r.apply(n)))}updateLimboDocument(e,t){return this.Jr(e,t).next(e=>{e?this.Hr.delete(t.toString()):this.Hr.add(t.toString())})}Qr(e){return 0}Jr(e,t){return bw.or([()=>bw.resolve(this.Gr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Wr(e,t)])}}class eC{constructor(e){this.serializer=e}N(t,e,n,r){const i=new Iw("createOrUpgrade",e);var s;n<1&&1<=r&&(t.createObjectStore("owner"),(s=t).createObjectStore("mutationQueues",{keyPath:"userId"}),s.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",qw,{unique:!0}),s.createObjectStore("documentMutations"),tC(t),t.createObjectStore("remoteDocuments"));let a=bw.resolve();return n<3&&3<=r&&(0!==n&&((s=t).deleteObjectStore("targetDocuments"),s.deleteObjectStore("targets"),s.deleteObjectStore("targetGlobal"),tC(t)),a=a.next(()=>function(e){const t=e.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:rw.min().toTimestamp(),targetCount:0};return t.put("targetGlobalKey",n)}(i))),n<4&&4<=r&&(0!==n&&(a=a.next(()=>function(r,i){return i.store("mutations").W().next(e=>{r.deleteObjectStore("mutations"),r.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",qw,{unique:!0});const t=i.store("mutations"),n=e.map(e=>t.put(e));return bw.waitFor(n)})}(t,i))),a=a.next(()=>{t.createObjectStore("clientMetadata",{keyPath:"clientId"})})),n<5&&5<=r&&(a=a.next(()=>this.Zr(i))),n<6&&6<=r&&(a=a.next(()=>(function(e){e.createObjectStore("remoteDocumentGlobal")}(t),this.Xr(i)))),n<7&&7<=r&&(a=a.next(()=>this.ei(i))),n<8&&8<=r&&(a=a.next(()=>this.ti(t,i))),n<9&&9<=r&&(a=a.next(()=>{var e;(e=t).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),n<10&&10<=r&&(a=a.next(()=>this.ni(i))),n<11&&11<=r&&(a=a.next(()=>{t.createObjectStore("bundles",{keyPath:"bundleId"}),t.createObjectStore("namedQueries",{keyPath:"name"})})),n<12&&12<=r&&(a=a.next(()=>{!function(e){const t=e.createObjectStore("documentOverlays",{keyPath:tb});t.createIndex("collectionPathOverlayIndex",nb,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",rb,{unique:!1})}(t)})),n<13&&13<=r&&(a=a.next(()=>function(e){const t=e.createObjectStore("remoteDocumentsV14",{keyPath:$w});t.createIndex("documentKeyIndex",Kw),t.createIndex("collectionGroupIndex",Ww)}(t)).next(()=>this.ri(t,i)).next(()=>t.deleteObjectStore("remoteDocuments"))),n<14&&14<=r&&(a=a.next(()=>this.ii(t,i))),n<15&&15<=r&&(a=a.next(()=>function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:Jw}).createIndex("sequenceNumberIndex",Xw,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:Zw}).createIndex("documentKeyIndex",eb,{unique:!1})}(t))),a}Xr(t){let n=0;return t.store("remoteDocuments").Y((e,t)=>{n+=gE(t)}).next(()=>{var e={byteSize:n};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",e)})}Zr(r){const e=r.store("mutationQueues"),t=r.store("mutations");return e.W().next(e=>bw.forEach(e,n=>{var e=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return t.W("userMutationsIndex",e).next(e=>bw.forEach(e,e=>{qy(e.userId===n.userId);var t=A0(this.serializer,e);return fE(r,n.userId,t).next(()=>{})}))}))}ei(e){const a=e.store("targetDocuments"),t=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return t.Y((e,t)=>{const n=new sw(e),r=[0,Fw(n)];s.push(a.get(r).next(e=>e?bw.resolve():(e=>a.put({targetId:0,path:Fw(e),sequenceNumber:i.highestListenSequenceNumber}))(n)))}).next(()=>bw.waitFor(s))})}ti(e,t){e.createObjectStore("collectionParents",{keyPath:Yw});const n=t.store("collectionParents"),r=new iE,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:Fw(r)})}};return t.store("remoteDocuments").Y({J:!0},(e,t)=>{const n=new sw(e);return i(n.popLast())}).next(()=>t.store("documentMutations").Y({J:!0},([,e],t)=>{const n=Vw(e);return i(n.popLast())}))}ni(e){const r=e.store("targets");return r.Y((e,t)=>{var n=N0(t),n=R0(this.serializer,n);return r.put(n)})}ri(e,a){const t=a.store("remoteDocuments"),o=[];return t.Y((e,t)=>{const n=a.store("remoteDocumentsV14"),r=((s=t).document?new cw(sw.fromString(s.document.name).popFirst(5)):s.noDocument?cw.fromSegments(s.noDocument.path):s.unknownDocument?cw.fromSegments(s.unknownDocument.path):Vy()).path.toArray(),i={prefixPath:r.slice(0,r.length-2),collectionGroup:r[r.length-2],documentId:r[r.length-1],readTime:t.readTime||[0,0],unknownDocument:t.unknownDocument,noDocument:t.noDocument,document:t.document,hasCommittedMutations:!!t.hasCommittedMutations};var s;o.push(n.put(i))}).next(()=>bw.waitFor(o))}ii(e,s){const t=s.store("mutations"),a=OE(this.serializer),o=new JE(ZE.jr,this.serializer.ut);return t.W().next(e=>{const r=new Map;return e.forEach(e=>{var t;let n=null!==(t=r.get(e.userId))&&void 0!==t?t:YI();A0(this.serializer,e).keys().forEach(e=>n=n.add(e)),r.set(e.userId,n)}),bw.forEach(r,(e,t)=>{var n=new Py(t),r=U0.ct(this.serializer,n),i=o.getIndexManager(n),n=mE.ct(n,this.serializer,i,o.referenceDelegate);return new jE(a,n,r,i).recalculateAndSaveOverlaysForDocumentKeys(new lb(s,xw._e),e).next()})})}}function tC(e){e.createObjectStore("targetDocuments",{keyPath:Hw}).createIndex("documentTargetsIndex",Qw,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Gw,{unique:!0}),e.createObjectStore("targetGlobal")}const nC="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class rC{constructor(e,t,n,r,i,s,a,o,c,l,u=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.si=i,this.window=s,this.document=a,this.oi=c,this._i=l,this.ai=u,this.Lr=null,this.kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ui=null,this.inForeground=!1,this.ci=null,this.li=null,this.hi=Number.NEGATIVE_INFINITY,this.Pi=e=>Promise.resolve(),!rC.D())throw new jy(By.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new RE(this,r),this.Ii=t+"main",this.serializer=new T0(o),this.Ti=new Tw(this.Ii,this.ai,new eC(this.serializer)),this.qr=new IE(this.referenceDelegate,this.serializer),this.remoteDocumentCache=OE(this.serializer),this.Kr=new M0,this.window&&this.window.localStorage?this.Ei=this.window.localStorage:(this.Ei=null,!1===l&&Ly("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.di().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new jy(By.FAILED_PRECONDITION,nC);return this.Ai(),this.Ri(),this.Vi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.qr.getHighestSequenceNumber(e))}).then(e=>{this.Lr=new xw(e,this.oi)}).then(()=>{this.kr=!0}).catch(e=>(this.Ti&&this.Ti.close(),Promise.reject(e)))}mi(t){return this.Pi=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.Ti.L(async e=>{null===e.newVersion&&await t()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.si.enqueueAndForget(async()=>{this.started&&await this.di()}))}di(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>sC(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(t).next(e=>{e||(this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)))})}).next(()=>this.gi(t)).next(e=>this.isPrimary&&!e?this.pi(t).next(()=>!1):!!e&&this.yi(t).next(()=>!0))).catch(e=>{if(Sw(e))return My("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return My("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.si.enqueueRetryable(()=>this.Pi(e)),this.isPrimary=e})}fi(e){return iC(e).get("owner").next(e=>bw.resolve(this.wi(e)))}Si(e){return sC(e).delete(this.clientId)}async bi(){if(this.isPrimary&&!this.Di(this.hi,18e5)){this.hi=Date.now();var e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{const r=ub(e,"clientMetadata");return r.W().next(e=>{const t=this.Ci(e,18e5),n=e.filter(e=>-1===t.indexOf(e));return bw.forEach(n,e=>r.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.Ei)for(const t of e)this.Ei.removeItem(this.vi(t.clientId))}}Vi(){this.li=this.si.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.di().then(()=>this.bi()).then(()=>this.Vi()))}wi(e){return!!e&&e.ownerId===this.clientId}gi(t){return this._i?bw.resolve(!0):iC(t).get("owner").next(e=>{if(null!==e&&this.Di(e.leaseTimestampMs,5e3)&&!this.Fi(e.ownerId)){if(this.wi(e)&&this.networkEnabled)return!0;if(!this.wi(e)){if(!e.allowTabSynchronization)throw new jy(By.FAILED_PRECONDITION,nC);return!1}}return!(!this.networkEnabled||!this.inForeground)||sC(t).W().next(e=>void 0===this.Ci(e,5e3).find(e=>{if(this.clientId!==e.clientId){var t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&My("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.kr=!1,this.Mi(),this.li&&(this.li.cancel(),this.li=null),this.xi(),this.Oi(),await this.Ti.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new lb(e,xw._e);return this.pi(t).next(()=>this.Si(t))}),this.Ti.close(),this.Ni()}Ci(e,t){return e.filter(e=>this.Di(e.updateTimeMs,t)&&!this.Fi(e.clientId))}Bi(){return this.runTransaction("getActiveClients","readonly",e=>sC(e).W().next(e=>this.Ci(e,18e5).map(e=>e.clientId)))}get started(){return this.kr}getMutationQueue(e,t){return mE.ct(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new aE(e,this.serializer.ut.databaseId)}getDocumentOverlayCache(e){return U0.ct(this.serializer,e)}getBundleCache(){return this.Kr}runTransaction(t,n,r){My("IndexedDbPersistence","Starting transaction:",t);var e,i="readonly"===n?"readonly":"readwrite",s=15===(e=this.ai)?cb:14===e?ob:13===e?ab:12===e?sb:11===e?ib:void Vy();let a;return this.Ti.runTransaction(t,i,s,e=>(a=new lb(e,this.Lr?this.Lr.next():xw._e),"readwrite-primary"===n?this.fi(a).next(e=>!!e||this.gi(a)).next(e=>{if(!e)throw Ly(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)),new jy(By.FAILED_PRECONDITION,_w);return r(a)}).next(e=>this.yi(a).next(()=>e)):this.Li(a).next(()=>r(a)))).then(e=>(a.raiseOnCommittedEvent(),e))}Li(e){return iC(e).get("owner").next(e=>{if(null!==e&&this.Di(e.leaseTimestampMs,5e3)&&!this.Fi(e.ownerId)&&!this.wi(e)&&!(this._i||this.allowTabSynchronization&&e.allowTabSynchronization))throw new jy(By.FAILED_PRECONDITION,nC)})}yi(e){var t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return iC(e).put("owner",t)}static D(){return Tw.D()}pi(e){const t=iC(e);return t.get("owner").next(e=>this.wi(e)?(My("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):bw.resolve())}Di(e,t){var n=Date.now();return!(e<n-t||n<e&&(Ly(`Detected an update time that is in the future: ${e} > ${n}`),1))}Ai(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ci=()=>{this.si.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.di()))},this.document.addEventListener("visibilitychange",this.ci),this.inForeground="visible"===this.document.visibilityState)}xi(){this.ci&&(this.document.removeEventListener("visibilitychange",this.ci),this.ci=null)}Ri(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ui=()=>{this.Mi();var e=/(?:Version|Mobile)\/1[456]/;T()||!navigator.userAgent.includes("Safari")||navigator.userAgent.includes("Chrome")||!navigator.appVersion.match(e)&&!navigator.userAgent.match(e)||this.si.enterRestrictedMode(!0),this.si.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ui))}Oi(){this.ui&&(this.window.removeEventListener("pagehide",this.ui),this.ui=null)}Fi(e){var t;try{var n=null!==(null===(t=this.Ei)||void 0===t?void 0:t.getItem(this.vi(e)));return My("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return Ly("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}Mi(){if(this.Ei)try{this.Ei.setItem(this.vi(this.clientId),String(Date.now()))}catch(e){Ly("Failed to set zombie client id.",e)}}Ni(){if(this.Ei)try{this.Ei.removeItem(this.vi(this.clientId))}catch(e){}}vi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function iC(e){return ub(e,"owner")}function sC(e){return ub(e,"clientMetadata")}function aC(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class oC{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.ki=n,this.qi=r}static Qi(e,t){let n=YI(),r=YI();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new oC(e,t.fromCache,n,r)}}class cC{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class lC{constructor(){this.Ki=!1,this.$i=!1,this.Ui=100,this.Wi=8}initialize(e,t){this.Gi=e,this.indexManager=t,this.Ki=!0}getDocumentsMatchingQuery(n,r,e,t){const i={result:null};return this.zi(n,r).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.ji(n,r,t,e).next(e=>{i.result=e})}).next(()=>{if(!i.result){const t=new cC;return this.Hi(n,r,t).next(e=>{if(i.result=e,this.$i)return this.Ji(n,r,t,e.size)})}}).next(()=>i.result)}Ji(e,t,n,r){return n.documentReadCount<this.Ui?(Oy()<=m.DEBUG&&My("QueryEngine","SDK will not create cache indexes for query:",UI(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Ui,"documents"),bw.resolve()):(Oy()<=m.DEBUG&&My("QueryEngine","Query:",UI(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Wi*r?(Oy()<=m.DEBUG&&My("QueryEngine","The SDK decides to create cache indexes for query:",UI(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,xI(t))):bw.resolve())}zi(i,s){if(RI(s))return bw.resolve(null);let t=xI(s);return this.indexManager.getIndexType(i,t).next(e=>0===e?null:(null!==s.limit&&1===e&&(s=MI(s,null,"F"),t=xI(s)),this.indexManager.getDocumentsMatchingTarget(i,t).next(e=>{const r=YI(...e);return this.Gi.getDocuments(i,r).next(n=>this.indexManager.getMinOffset(i,t).next(e=>{var t=this.Yi(s,n);return this.Zi(s,t,r,e.readTime)?this.zi(i,MI(s,null,"F")):this.Xi(i,t,s,e)}))})))}ji(n,r,i,s){return RI(r)||s.isEqual(rw.min())?bw.resolve(null):this.Gi.getDocuments(n,i).next(e=>{var t=this.Yi(r,e);return this.Zi(r,t,i,s)?bw.resolve(null):(Oy()<=m.DEBUG&&My("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),UI(r)),this.Xi(n,t,r,fw(s,-1)).next(e=>e))})}Yi(n,e){let r=new vb(BI(n));return e.forEach((e,t)=>{VI(n,t)&&(r=r.add(t))}),r}Zi(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||0<i.version.compareTo(r))}Hi(e,t,n){return Oy()<=m.DEBUG&&My("QueryEngine","Using full collection scan to execute query:",UI(t)),this.Gi.getDocumentsMatchingQuery(e,t,mw.min(),n)}Xi(e,n,t,r){return this.Gi.getDocumentsMatchingQuery(e,t,r).next(t=>(n.forEach(e=>{t=t.insert(e.key,e)}),t))}}class uC{constructor(e,t,n,r){this.persistence=e,this.es=t,this.serializer=r,this.ts=new fb(Zy),this.ns=new jI(e=>bI(e),II),this.rs=new Map,this.ss=e.getRemoteDocumentCache(),this.qr=e.getTargetCache(),this.Kr=e.getBundleCache(),this.os(n)}os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new jE(this.ss,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ss.setIndexManager(this.indexManager),this.es.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.ts))}}function hC(e,t,n,r){return new uC(e,t,n,r)}async function dC(e,t){const a=e;return a.persistence.runTransaction("Handle user change","readonly",i=>{let s;return a.mutationQueue.getAllMutationBatches(i).next(e=>(s=e,a.os(t),a.mutationQueue.getAllMutationBatches(i))).next(e=>{const t=[],n=[];let r=YI();for(const i of s){t.push(i.batchId);for(const e of i.mutations)r=r.add(e.key)}for(const i of e){n.push(i.batchId);for(const e of i.mutations)r=r.add(e.key)}return a.localDocuments.getDocuments(i,r).next(e=>({_s:e,removedBatchIds:t,addedBatchIds:n}))})})}function pC(e){const t=e;return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.qr.getLastRemoteSnapshotVersion(e))}function fC(e,l){const u=e,h=l.snapshotVersion;let d=u.ts;return u.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{const e=u.ss.newChangeBuffer({trackRemovals:!0});d=u.ts;const c=[];l.targetChanges.forEach((t,n)=>{const r=d.get(n);if(r){c.push(u.qr.removeMatchingKeys(o,t.removedDocuments,n).next(()=>u.qr.addMatchingKeys(o,t.addedDocuments,n)));let e=r.withSequenceNumber(o.currentSequenceNumber);var i,s,a;null!==l.targetMismatches.get(n)?e=e.withResumeToken(Ib.EMPTY_BYTE_STRING,rw.min()).withLastLimboFreeSnapshotVersion(rw.min()):0<t.resumeToken.approximateByteSize()&&(e=e.withResumeToken(t.resumeToken,h)),d=d.insert(n,e),i=r,s=e,a=t,0!==i.resumeToken.approximateByteSize()&&!(3e8<=s.snapshotVersion.toMicroseconds()-i.snapshotVersion.toMicroseconds()||0<a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size)||c.push(u.qr.updateTargetData(o,e))}});let t=zI,n=YI();if(l.documentUpdates.forEach(e=>{l.resolvedLimboDocuments.has(e)&&c.push(u.persistence.referenceDelegate.updateLimboDocument(o,e))}),c.push(gC(o,e,l.documentUpdates).next(e=>{t=e.us,n=e.cs})),!h.isEqual(rw.min())){const l=u.qr.getLastRemoteSnapshotVersion(o).next(e=>u.qr.setTargetsMetadata(o,o.currentSequenceNumber,h));c.push(l)}return bw.waitFor(c).next(()=>e.apply(o)).next(()=>u.localDocuments.getLocalViewOfDocuments(o,t,n)).next(()=>t)}).then(e=>(u.ts=d,e))}function gC(e,s,t){let n=YI(),a=YI();return t.forEach(e=>n=n.add(e)),s.getEntries(e,n).next(r=>{let i=zI;return t.forEach((e,t)=>{const n=r.get(e);t.isFoundDocument()!==n.isFoundDocument()&&(a=a.add(e)),t.isNoDocument()&&t.version.isEqual(rw.min())?(s.removeEntry(e,t.readTime),i=i.insert(e,t)):!n.isValidDocument()||0<t.version.compareTo(n.version)||0===t.version.compareTo(n.version)&&n.hasPendingWrites?(s.addEntry(t),i=i.insert(e,t)):My("LocalStore","Ignoring outdated watch update for ",e,". Current version:",n.version," Watch version:",t.version)}),{us:i,cs:a}})}function mC(e,r){const i=e;return i.persistence.runTransaction("Allocate target","readwrite",t=>{let n;return i.qr.getTargetData(t,r).next(e=>e?(n=e,bw.resolve(n)):i.qr.allocateTargetId(t).next(e=>(n=new I0(r,e,"TargetPurposeListen",t.currentSequenceNumber),i.qr.addTargetData(t,n).next(()=>n))))}).then(e=>{var t=i.ts.get(e.targetId);return(null===t||0<e.snapshotVersion.compareTo(t.snapshotVersion))&&(i.ts=i.ts.insert(e.targetId,e),i.ns.set(r,e.targetId)),e})}async function vC(e,t,n){const r=e,i=r.ts.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,e=>r.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(!Sw(e))throw e;My("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.ts=r.ts.remove(t),r.ns.delete(i.target)}function _C(e,n,r){const i=e;let s=rw.min(),a=YI();return i.persistence.runTransaction("Execute query","readwrite",t=>function(e,t,n){const r=e,i=r.ns.get(n);return void 0!==i?bw.resolve(r.ts.get(i)):r.qr.getTargetData(t,n)}(i,t,xI(n)).next(e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,i.qr.getMatchingKeysForTargetId(t,e.targetId).next(e=>{a=e})}).next(()=>i.es.getDocumentsMatchingQuery(t,n,r?s:rw.min(),r?a:YI())).next(e=>(bC(i,qI(n),e),{documents:e,ls:a})))}function yC(e,t){const n=e,r=n.qr,i=n.ts.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",e=>r._t(e,t).next(e=>e?e.target:null))}function wC(e,t){const n=e,r=n.rs.get(t)||rw.min();return n.persistence.runTransaction("Get new document changes","readonly",e=>n.ss.getAllFromCollectionGroup(e,t,fw(r,-1),Number.MAX_SAFE_INTEGER)).then(e=>(bC(n,t,e),e))}function bC(e,t,n){let r=e.rs.get(t)||rw.min();n.forEach((e,t)=>{0<t.readTime.compareTo(r)&&(r=t.readTime)}),e.rs.set(t,r)}function IC(e,t){return`firestore_clients_${e}_${t}`}function TC(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function EC(e,t){return`firestore_targets_${e}_${t}`}class CC{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Ts(e,t,n){var r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new jy(r.error.code,r.error.message))),s?new CC(e,t,r.state,i):(Ly("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Es(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class SC{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Ts(e,t){var n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(r=new jy(n.error.code,n.error.message))),i?new SC(e,n.state,r):(Ly("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Es(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class kC{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ts(e,t){var n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=JI;for(let s=0;r&&s<n.activeTargetIds.length;++s)r=Lw(n.activeTargetIds[s]),i=i.add(n.activeTargetIds[s]);return r?new kC(e,i):(Ly("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class AC{constructor(e,t){this.clientId=e,this.onlineState=t}static Ts(e){var t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new AC(t.clientId,t.onlineState):(Ly("SharedClientState",`Failed to parse online state: ${e}`),null)}}class NC{constructor(){this.activeTargetIds=JI}ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}As(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Es(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class RC{constructor(e,t,n,r,i){this.window=e,this.si=t,this.persistenceKey=n,this.Rs=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Vs=this.fs.bind(this),this.gs=new fb(Zy),this.started=!1,this.ps=[];var s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.ys=IC(this.persistenceKey,this.Rs),this.ws=`firestore_sequence_number_${this.persistenceKey}`,this.gs=this.gs.insert(this.Rs,new NC),this.Ss=new RegExp(`^firestore_clients_${s}_([^_]*)$`),this.bs=new RegExp(`^firestore_mutations_${s}_(\\d+)(?:_(.*))?$`),this.Ds=new RegExp(`^firestore_targets_${s}_(\\d+)$`),this.Cs=`firestore_online_state_${this.persistenceKey}`,this.vs=`firestore_bundle_loaded_v2_${this.persistenceKey}`,this.window.addEventListener("storage",this.Vs)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Bi();for(const n of e)if(n!==this.Rs){const e=this.getItem(IC(this.persistenceKey,n));var t;!e||(t=kC.Ts(n,e))&&(this.gs=this.gs.insert(t.clientId,t))}this.Fs();const n=this.storage.getItem(this.Cs);if(n){const e=this.Ms(n);e&&this.xs(e)}for(const e of this.ps)this.fs(e);this.ps=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.ws,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Os(this.gs)}isActiveQueryTarget(n){let r=!1;return this.gs.forEach((e,t)=>{t.activeTargetIds.has(n)&&(r=!0)}),r}addPendingMutation(e){this.Ns(e,"pending")}updateMutationState(e,t,n){this.Ns(e,t,n),this.Bs(e)}addLocalQueryTarget(e){let t="not-current";var n;return this.isActiveQueryTarget(e)&&(!(n=this.storage.getItem(EC(this.persistenceKey,e)))||(n=SC.Ts(e,n))&&(t=n.state)),this.Ls.ds(e),this.Fs(),t}removeLocalQueryTarget(e){this.Ls.As(e),this.Fs()}isLocalQueryTarget(e){return this.Ls.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(EC(this.persistenceKey,e))}updateQueryState(e,t,n){this.ks(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.Bs(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.qs(e)}notifyBundleLoaded(e){this.Qs(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Vs),this.removeItem(this.ys),this.started=!1)}getItem(e){var t=this.storage.getItem(e);return My("SharedClientState","READ",e,t),t}setItem(e,t){My("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){My("SharedClientState","REMOVE",e),this.storage.removeItem(e)}fs(e){const i=e;i.storageArea===this.storage&&(My("SharedClientState","EVENT",i.key,i.newValue),i.key!==this.ys?this.si.enqueueRetryable(async()=>{if(this.started){if(null!==i.key)if(this.Ss.test(i.key)){if(null==i.newValue){var e=this.Ks(i.key);return this.$s(e,null)}e=this.Us(i.key,i.newValue);if(e)return this.$s(e.clientId,e)}else if(this.bs.test(i.key)){if(null!==i.newValue){var t=this.Ws(i.key,i.newValue);if(t)return this.Gs(t)}}else if(this.Ds.test(i.key)){if(null!==i.newValue){t=this.zs(i.key,i.newValue);if(t)return this.js(t)}}else if(i.key===this.Cs){if(null!==i.newValue){var n=this.Ms(i.newValue);if(n)return this.xs(n)}}else if(i.key===this.ws){n=function(e){let t=xw._e;if(null!=e)try{var n=JSON.parse(e);qy("number"==typeof n),t=n}catch(e){Ly("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(i.newValue);n!==xw._e&&this.sequenceNumberHandler(n)}else if(i.key===this.vs){const r=this.Hs(i.newValue);await Promise.all(r.map(e=>this.syncEngine.Js(e)))}}else this.ps.push(i)}):Ly("Received WebStorage notification for local change. Another client might have garbage-collected our state"))}get Ls(){return this.gs.get(this.Rs)}Fs(){this.setItem(this.ys,this.Ls.Es())}Ns(e,t,n){const r=new CC(this.currentUser,e,t,n),i=TC(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Es())}Bs(e){var t=TC(this.persistenceKey,this.currentUser,e);this.removeItem(t)}qs(e){var t={clientId:this.Rs,onlineState:e};this.storage.setItem(this.Cs,JSON.stringify(t))}ks(e,t,n){const r=EC(this.persistenceKey,e),i=new SC(e,t,n);this.setItem(r,i.Es())}Qs(e){var t=JSON.stringify(Array.from(e));this.setItem(this.vs,t)}Ks(e){var t=this.Ss.exec(e);return t?t[1]:null}Us(e,t){var n=this.Ks(e);return kC.Ts(n,t)}Ws(e,t){var n=this.bs.exec(e),r=Number(n[1]),n=void 0!==n[2]?n[2]:null;return CC.Ts(new Py(n),r,t)}zs(e,t){var n=this.Ds.exec(e),n=Number(n[1]);return SC.Ts(n,t)}Ms(e){return AC.Ts(e)}Hs(e){return JSON.parse(e)}async Gs(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Ys(e.batchId,e.state,e.error);My("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}js(e){return this.syncEngine.Zs(e.targetId,e.state,e.error)}$s(e,t){const n=t?this.gs.insert(e,t):this.gs.remove(e),r=this.Os(this.gs),i=this.Os(n),s=[],a=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.Xs(s,a).then(()=>{this.gs=n})}xs(e){this.gs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Os(e){let n=JI;return e.forEach((e,t)=>{n=n.unionWith(t.activeTargetIds)}),n}}class PC{constructor(){this.eo=new NC,this.no={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.eo.ds(e),this.no[e]||"not-current"}updateQueryState(e,t,n){this.no[e]=t}removeLocalQueryTarget(e){this.eo.As(e)}isLocalQueryTarget(e){return this.eo.activeTargetIds.has(e)}clearQueryState(e){delete this.no[e]}getAllActiveQueryTargets(){return this.eo.activeTargetIds}isActiveQueryTarget(e){return this.eo.activeTargetIds.has(e)}start(){return this.eo=new NC,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class DC{ro(e){}shutdown(){}}class xC{constructor(){this.io=()=>this.so(),this.oo=()=>this._o(),this.ao=[],this.uo()}ro(e){this.ao.push(e)}shutdown(){window.removeEventListener("online",this.io),window.removeEventListener("offline",this.oo)}uo(){window.addEventListener("online",this.io),window.addEventListener("offline",this.oo)}so(){My("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ao)e(0)}_o(){My("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ao)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let OC=null;function MC(){return null===OC?OC=268435456+Math.round(2147483648*Math.random()):OC++,"0x"+OC.toString(16)}const LC={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class FC{constructor(e){this.co=e.co,this.lo=e.lo}ho(e){this.Po=e}Io(e){this.To=e}onMessage(e){this.Eo=e}close(){this.lo()}send(e){this.co(e)}Ao(){this.Po()}Ro(e){this.To(e)}Vo(e){this.Eo(e)}}const UC="WebChannelConnection";class VC extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;var t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.mo=t+"://"+e.host,this.fo=`projects/${n}/databases/${r}`,this.po="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}get yo(){return!1}wo(t,e,n,r,i){const s=MC(),a=this.So(t,e);My("RestConnection",`Sending RPC '${t}' ${s}:`,a,n);var o={"google-cloud-resource-prefix":this.fo,"x-goog-request-params":this.po};return this.bo(o,r,i),this.Do(t,a,o,n).then(e=>(My("RestConnection",`Received RPC '${t}' ${s}: `,e),e),e=>{throw Fy("RestConnection",`RPC '${t}' ${s} failed with error: `,e,"url: ",a,"request:",n),e})}Co(e,t,n,r,i,s){return this.wo(e,t,n,r,i)}bo(n,e,t){n["X-Goog-Api-Client"]="gl-js/ fire/"+Dy,n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((e,t)=>n[t]=e),t&&t.headers.forEach((e,t)=>n[t]=e)}So(e,t){var n=LC[e];return`${this.mo}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Do(c,t,n,r){const l=MC();return new Promise((s,a)=>{const o=new ky;o.setWithCredentials(!0),o.listenOnce(Iy.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case by.NO_ERROR:var e=o.getResponseJson();My(UC,`XHR for RPC '${c}' ${l} received:`,JSON.stringify(e)),s(e);break;case by.TIMEOUT:My(UC,`RPC '${c}' ${l} timed out`),a(new jy(By.DEADLINE_EXCEEDED,"Request time out"));break;case by.HTTP_ERROR:var t=o.getStatus();if(My(UC,`RPC '${c}' ${l} failed with status:`,t,"response text:",o.getResponseText()),0<t){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);var n=null==e?void 0:e.error;if(n&&n.status&&n.message){const c=(r=n.status,i=r.toLowerCase().replace(/_/g,"-"),0<=Object.values(By).indexOf(i)?i:By.UNKNOWN);a(new jy(c,n.message))}else a(new jy(By.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new jy(By.UNAVAILABLE,"Connection failed."));break;default:Vy()}}finally{My(UC,`RPC '${c}' ${l} completed.`)}var r,i});var e=JSON.stringify(r);My(UC,`RPC '${c}' ${l} sending request:`,r),o.send(t,"POST",e,n,15)})}vo(i,e,t){const s=MC(),n=[this.mo,"/","google.firestore.v1.Firestore","/",i,"/channel"],r=new Q_,a=wy(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(o.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(o.useFetchStreams=!0),this.bo(o.initMessageHeaders,e,t),o.encodeInitMessageHeaders=!0;var l=n.join("");My(UC,`Creating RPC '${i}' stream ${s}: ${l}`,o);const u=r.createWebChannel(l,o);let h=!1,d=!1;const p=new FC({co:e=>{d?My(UC,`Not sending because RPC '${i}' stream ${s} is closed:`,e):(h||(My(UC,`Opening RPC '${i}' stream ${s} transport.`),u.open(),h=!0),My(UC,`RPC '${i}' stream ${s} sending:`,e),u.send(e))},lo:()=>u.close()}),f=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return f(u,Sy.EventType.OPEN,()=>{d||My(UC,`RPC '${i}' stream ${s} transport opened.`)}),f(u,Sy.EventType.CLOSE,()=>{d||(d=!0,My(UC,`RPC '${i}' stream ${s} transport closed`),p.Ro())}),f(u,Sy.EventType.ERROR,e=>{d||(d=!0,Fy(UC,`RPC '${i}' stream ${s} transport errored:`,e),p.Ro(new jy(By.UNAVAILABLE,"The operation could not be completed")))}),f(u,Sy.EventType.MESSAGE,n=>{if(!d){var e=n.data[0];qy(!!e);var r=e.error||(null===(r=e[0])||void 0===r?void 0:r.error);if(r){My(UC,`RPC '${i}' stream ${s} received error:`,r);const n=r.status;let e=function(e){var t=yy[e];if(void 0!==t)return DT(t)}(n),t=r.message;void 0===e&&(e=By.INTERNAL,t="Unknown error status: "+n+" with message "+r.message),d=!0,p.Ro(new jy(e,t)),u.close()}else My(UC,`RPC '${i}' stream ${s} received:`,e),p.Vo(e)}}),f(a,Ty.STAT_EVENT,e=>{e.stat===Ey?My(UC,`RPC '${i}' stream ${s} detected buffering proxy`):e.stat===Cy&&My(UC,`RPC '${i}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{p.Ao()},0),p}}function qC(){return"undefined"!=typeof window?window:null}function BC(){return"undefined"!=typeof document?document:null}function jC(e){return new JT(e,!0)}class zC{constructor(e,t,n=1e3,r=1.5,i=6e4){this.si=e,this.timerId=t,this.Fo=n,this.Mo=r,this.xo=i,this.Oo=0,this.No=null,this.Bo=Date.now(),this.reset()}reset(){this.Oo=0}Lo(){this.Oo=this.xo}ko(e){this.cancel();var t=Math.floor(this.Oo+this.qo()),n=Math.max(0,Date.now()-this.Bo),r=Math.max(0,t-n);0<r&&My("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Oo} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.No=this.si.enqueueAfterDelay(this.timerId,r,()=>(this.Bo=Date.now(),e())),this.Oo*=this.Mo,this.Oo<this.Fo&&(this.Oo=this.Fo),this.Oo>this.xo&&(this.Oo=this.xo)}Qo(){null!==this.No&&(this.No.skipDelay(),this.No=null)}cancel(){null!==this.No&&(this.No.cancel(),this.No=null)}qo(){return(Math.random()-.5)*this.Oo}}class $C{constructor(e,t,n,r,i,s,a,o){this.si=e,this.Ko=n,this.$o=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.Uo=0,this.Wo=null,this.Go=null,this.stream=null,this.zo=new zC(e,t)}jo(){return 1===this.state||5===this.state||this.Ho()}Ho(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Jo()}async stop(){this.jo()&&await this.close(0)}Yo(){this.state=0,this.zo.reset()}Zo(){this.Ho()&&null===this.Wo&&(this.Wo=this.si.enqueueAfterDelay(this.Ko,6e4,()=>this.Xo()))}e_(e){this.t_(),this.stream.send(e)}async Xo(){if(this.Ho())return this.close(0)}t_(){this.Wo&&(this.Wo.cancel(),this.Wo=null)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}async close(e,t){this.t_(),this.n_(),this.zo.cancel(),this.Uo++,4!==e?this.zo.reset():t&&t.code===By.RESOURCE_EXHAUSTED?(Ly(t.toString()),Ly("Using maximum backoff delay to prevent overloading the backend."),this.zo.Lo()):t&&t.code===By.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.r_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Io(t)}r_(){}auth(){this.state=1;const e=this.i_(this.Uo),n=this.Uo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,t])=>{this.Uo===n&&this.s_(e,t)},t=>{e(()=>{var e=new jy(By.UNKNOWN,"Fetching auth token failed: "+t.message);return this.o_(e)})})}s_(e,t){const n=this.i_(this.Uo);this.stream=this.__(e,t),this.stream.ho(()=>{n(()=>(this.state=2,this.Go=this.si.enqueueAfterDelay(this.$o,1e4,()=>(this.Ho()&&(this.state=3),Promise.resolve())),this.listener.ho()))}),this.stream.Io(e=>{n(()=>this.o_(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}Jo(){this.state=5,this.zo.ko(async()=>{this.state=0,this.start()})}o_(e){return My("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}i_(t){return e=>{this.si.enqueueAndForget(()=>this.Uo===t?e():(My("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class KC extends $C{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}__(e,t){return this.connection.vo("Listen",e,t)}onMessage(e){this.zo.reset();var t=function(e,t){let n;if("targetChange"in t){t.targetChange;var r="NO_CHANGE"===(p=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===p?1:"REMOVE"===p?2:"CURRENT"===p?3:"RESET"===p?4:Vy(),i=t.targetChange.targetIds||[],s=(p=t.targetChange.resumeToken,e.useProto3Json?(qy(void 0===p||"string"==typeof p),Ib.fromBase64String(p||"")):(qy(void 0===p||p instanceof Uint8Array),Ib.fromUint8Array(p||new Uint8Array))),a=t.targetChange.cause,o=a&&(o=void 0===(p=a).code?By.UNKNOWN:DT(p.code),new jy(o,p.message||""));n=new zT(r,i,s,o||null)}else if("documentChange"in t){t.documentChange;var c=t.documentChange;c.document,c.document.name,c.document.updateTime;var s=s0(e,c.document.name),o=t0(c.document.updateTime),l=c.document.createTime?t0(c.document.createTime):rw.min(),u=new Yb({mapValue:{fields:c.document.fields}}),l=Jb.newFoundDocument(s,o,l,u),u=c.targetIds||[],c=c.removedTargetIds||[];n=new BT(u,c,l.key,l)}else if("documentDelete"in t){t.documentDelete;u=t.documentDelete;u.document;c=s0(e,u.document),l=u.readTime?t0(u.readTime):rw.min(),l=Jb.newNoDocument(c,l),u=u.removedTargetIds||[];n=new BT([],u,l.key,l)}else if("documentRemove"in t){t.documentRemove;var h=t.documentRemove;h.document;var d=s0(e,h.document),h=h.removedTargetIds||[];n=new BT([],h,d,null)}else{if(!("filter"in t))return Vy();{t.filter;const e=t.filter;e.targetId;var{count:h=0,unchangedNames:d}=e,h=new RT(h,d),d=e.targetId;n=new jT(d,h)}}var o,p;return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return rw.min();var t=e.targetChange;return(!t.targetIds||!t.targetIds.length)&&t.readTime?t0(t.readTime):rw.min()}(e);return this.listener.a_(t,n)}u_(e){const t={};t.database=c0(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=TI(r)?{documents:f0(e,r)}:{query:g0(e,r)},n.targetId=t.targetId,0<t.resumeToken.approximateByteSize()){n.resumeToken=e0(e,t.resumeToken);const r=XT(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(0<t.snapshotVersion.compareTo(rw.min())){n.readTime=ZT(e,t.snapshotVersion.toTimestamp());const r=XT(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);var n,n=(this.serializer,e,null==(n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Vy()}}(e.purpose))?null:{"goog-listen-tags":n});n&&(t.labels=n),this.e_(t)}c_(e){const t={};t.database=c0(this.serializer),t.removeTarget=e,this.e_(t)}}class WC extends $C{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i,this.l_=!1}get h_(){return this.l_}start(){this.l_=!1,this.lastStreamToken=void 0,super.start()}r_(){this.l_&&this.P_([])}__(e,t){return this.connection.vo("Write",e,t)}onMessage(e){if(qy(!!e.streamToken),this.lastStreamToken=e.streamToken,this.l_){this.zo.reset();var t=(r=e.writeResults,i=e.commitTime,r&&0<r.length?(qy(void 0!==i),r.map(e=>function(e,t){let n=e.updateTime?t0(e.updateTime):t0(t);return n.isEqual(rw.min())&&(n=t0(t)),new dT(n,e.transformResults||[])}(e,i))):[]),n=t0(e.commitTime);return this.listener.I_(n,t)}var r,i;return qy(!e.writeResults||0===e.writeResults.length),this.l_=!0,this.listener.T_()}E_(){const e={};e.database=c0(this.serializer),this.e_(e)}P_(e){var t={streamToken:this.lastStreamToken,writes:e.map(e=>d0(this.serializer,e))};this.e_(t)}}class GC extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.d_=!1}A_(){if(this.d_)throw new jy(By.FAILED_PRECONDITION,"The client has already been terminated.")}wo(n,r,i){return this.A_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.connection.wo(n,r,i,e,t)).catch(e=>{throw"FirebaseError"===e.name?(e.code===By.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new jy(By.UNKNOWN,e.toString())})}Co(n,r,i,s){return this.A_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.connection.Co(n,r,i,e,t,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===By.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new jy(By.UNKNOWN,e.toString())})}terminate(){this.d_=!0}}class HC{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.V_=0,this.m_=null,this.f_=!0}g_(){0===this.V_&&(this.p_("Unknown"),this.m_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.m_=null,this.y_("Backend didn't respond within 10 seconds."),this.p_("Offline"),Promise.resolve())))}w_(e){"Online"===this.state?this.p_("Unknown"):(this.V_++,1<=this.V_&&(this.S_(),this.y_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.p_("Offline")))}set(e){this.S_(),this.V_=0,"Online"===e&&(this.f_=!1),this.p_(e)}p_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}y_(e){var t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.f_?(Ly(t),this.f_=!1):My("OnlineStateTracker",t)}S_(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}}class QC{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.b_=[],this.D_=new Map,this.C_=new Set,this.v_=[],this.F_=i,this.F_.ro(e=>{n.enqueueAndForget(async()=>{iS(this)&&(My("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=e;t.C_.add(4),await JC(t),t.M_.set("Unknown"),t.C_.delete(4),await YC(t)}(this))})}),this.M_=new HC(n,r)}}async function YC(e){if(iS(e))for(const t of e.v_)await t(!0)}async function JC(e){for(const t of e.v_)await t(!1)}function XC(e,t){const n=e;n.D_.has(t.targetId)||(n.D_.set(t.targetId,t),rS(n)?nS(n):fS(n).Ho()&&eS(n,t))}function ZC(e,t){const n=e,r=fS(n);n.D_.delete(t),r.Ho()&&tS(n,t),0===n.D_.size&&(r.Ho()?r.Zo():iS(n)&&n.M_.set("Unknown"))}function eS(e,t){var n;e.x_.Oe(t.targetId),(0<t.resumeToken.approximateByteSize()||0<t.snapshotVersion.compareTo(rw.min()))&&(n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size,t=t.withExpectedCount(n)),fS(e).u_(t)}function tS(e,t){e.x_.Oe(t),fS(e).c_(t)}function nS(t){t.x_=new KT({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>t.D_.get(e)||null,nt:()=>t.datastore.serializer.databaseId}),fS(t).start(),t.M_.g_()}function rS(e){return iS(e)&&!fS(e).jo()&&0<e.D_.size}function iS(e){return 0===e.C_.size}function sS(e){e.x_=void 0}async function aS(e,t,n){if(!Sw(t))throw t;e.C_.add(1),await JC(e),e.M_.set("Offline"),n=n||(()=>pC(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{My("RemoteStore","Retrying IndexedDB access"),await n(),e.C_.delete(1),await YC(e)})}function oS(t,n){return n().catch(e=>aS(t,e,n))}async function cS(e){const t=e,n=gS(t);let r=0<t.b_.length?t.b_[t.b_.length-1].batchId:-1;for(;iS(i=t)&&i.b_.length<10;)try{const e=await function(e,t){const n=e;return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}(t.localStore,r);if(null===e){0===t.b_.length&&n.Zo();break}r=e.batchId,function(e,t){e.b_.push(t);const n=gS(e);n.Ho()&&n.h_&&n.P_(t.mutations)}(t,e)}catch(e){await aS(t,e)}var i;lS(t)&&uS(t)}function lS(e){return iS(e)&&!gS(e).jo()&&0<e.b_.length}function uS(e){gS(e).start()}async function hS(e,t){t&&gS(e).h_&&await async function(e,t){if(PT(n=t.code)&&n!==By.ABORTED){const r=e.b_.shift();gS(e).Yo(),await oS(e,()=>e.remoteSyncer.rejectFailedWrite(r.batchId,t)),await cS(e)}var n}(e,t),lS(e)&&uS(e)}async function dS(e,t){const n=e;n.asyncQueue.verifyOperationInProgress(),My("RemoteStore","RemoteStore received new credentials");var r=iS(n);n.C_.add(3),await JC(n),r&&n.M_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.C_.delete(3),await YC(n)}async function pS(e,t){const n=e;t?(n.C_.delete(2),await YC(n)):(n.C_.add(2),await JC(n),n.M_.set("Unknown"))}function fS(t){return t.O_||(t.O_=function(e,t,n){const r=e;return r.A_(),new KC(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{ho:(async function(n){n.D_.forEach((e,t)=>{eS(n,e)})}).bind(null,t),Io:(async function(e,t){sS(e),rS(e)?(e.M_.w_(t),nS(e)):e.M_.set("Unknown")}).bind(null,t),a_:(async function(e,t,n){if(e.M_.set("Online"),t instanceof zT&&2===t.state&&t.cause)try{await async function(e,t){var n=t.cause;for(const r of t.targetIds)e.D_.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.D_.delete(r),e.x_.removeTarget(r))}(e,t)}catch(n){My("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await aS(e,n)}else if(t instanceof BT?e.x_.$e(t):t instanceof jT?e.x_.Je(t):e.x_.Ge(t),!n.isEqual(rw.min()))try{const t=await pC(e.localStore);0<=n.compareTo(t)&&await function(i,r){const e=i.x_.it(r);return e.targetChanges.forEach((e,t)=>{if(0<e.resumeToken.approximateByteSize()){const n=i.D_.get(t);n&&i.D_.set(t,n.withResumeToken(e.resumeToken,r))}}),e.targetMismatches.forEach((e,t)=>{const n=i.D_.get(e);var r;n&&(i.D_.set(e,n.withResumeToken(Ib.EMPTY_BYTE_STRING,n.snapshotVersion)),tS(i,e),r=new I0(n.target,e,t,n.sequenceNumber),eS(i,r))}),i.remoteSyncer.applyRemoteEvent(e)}(e,n)}catch(t){My("RemoteStore","Failed to raise snapshot:",t),await aS(e,t)}}).bind(null,t)}),t.v_.push(async e=>{e?(t.O_.Yo(),rS(t)?nS(t):t.M_.set("Unknown")):(await t.O_.stop(),sS(t))})),t.O_}function gS(t){return t.N_||(t.N_=function(e,t,n){const r=e;return r.A_(),new WC(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{ho:(async function(e){gS(e).E_()}).bind(null,t),Io:hS.bind(null,t),T_:(async function(e){const t=gS(e);for(const n of e.b_)t.P_(n.mutations)}).bind(null,t),I_:(async function(e,t,n){const r=e.b_.shift(),i=AT.from(r,t,n);await oS(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await cS(e)}).bind(null,t)}),t.v_.push(async e=>{e?(t.N_.Yo(),await cS(t)):(await t.N_.stop(),0<t.b_.length&&(My("RemoteStore",`Stopping write stream with ${t.b_.length} pending writes`),t.b_=[]))})),t.N_}class mS{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new zy,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,a=new mS(e,t,s,r,i);return a.start(n),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new jy(By.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function vS(e,t){if(Ly("AsyncQueue",`${t}: ${e}`),Sw(e))return new jy(By.UNAVAILABLE,`${t}: ${e}`);throw e}class _S{constructor(n){this.comparator=n?(e,t)=>n(e,t)||cw.comparator(e.key,t.key):(e,t)=>cw.comparator(e.key,t.key),this.keyedMap=KI(),this.sortedSet=new fb(this.comparator)}static emptySet(e){return new _S(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){var t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(n){this.sortedSet.inorderTraversal((e,t)=>(n(e),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof _S))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(e,t){const n=new _S;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class yS{constructor(){this.B_=new fb(cw.comparator)}track(e){var t=e.doc.key,n=this.B_.get(t);!n||0!==e.type&&3===n.type?this.B_=this.B_.insert(t,e):3===e.type&&1!==n.type?this.B_=this.B_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.B_=this.B_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.B_=this.B_.remove(t):1===e.type&&2===n.type?this.B_=this.B_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):Vy()}L_(){const n=[];return this.B_.inorderTraversal((e,t)=>{n.push(t)}),n}}class wS{constructor(e,t,n,r,i,s,a,o,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new wS(e,t,_S.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&LI(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class bS{constructor(){this.k_=void 0,this.listeners=[]}}class IS{constructor(){this.queries=new jI(e=>FI(e),LI),this.onlineState="Unknown",this.q_=new Set}}async function TS(e,t){const n=e,r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new bS),i)try{s.k_=await n.onListen(r)}catch(e){const n=vS(e,`Initialization of query '${UI(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.listeners.push(t),t.Q_(n.onlineState),!s.k_||t.K_(s.k_)&&CS(n)}async function ES(e,t){const n=e,r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);0<=e&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function CS(e){e.q_.forEach(e=>{e.next()})}class SS{constructor(e,t,n){this.query=e,this.U_=t,this.W_=!1,this.G_=null,this.onlineState="Unknown",this.options=n||{}}K_(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new wS(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.W_?this.z_(e)&&(this.U_.next(e),t=!0):this.j_(e,this.onlineState)&&(this.H_(e),t=!0),this.G_=e,t}onError(e){this.U_.error(e)}Q_(e){this.onlineState=e;let t=!1;return this.G_&&!this.W_&&this.j_(this.G_,e)&&(this.H_(this.G_),t=!0),t}j_(e,t){return!e.fromCache||(!this.options.J_||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}z_(e){if(0<e.docChanges.length)return!0;var t=this.G_&&this.G_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}H_(e){e=wS.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.W_=!0,this.U_.next(e)}}class kS{constructor(e,t){this.Y_=e,this.byteLength=t}Z_(){return"metadata"in this.Y_}}class AS{constructor(e){this.serializer=e}hs(e){return s0(this.serializer,e)}Ps(e){return e.metadata.exists?h0(this.serializer,e.document,!1):Jb.newNoDocument(this.hs(e.metadata.name),this.Is(e.metadata.readTime))}Is(e){return t0(e)}}class NS{constructor(e,t,n){this.X_=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=RS(e)}ea(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Y_.namedQuery)this.queries.push(e.Y_.namedQuery);else if(e.Y_.documentMetadata){this.documents.push({metadata:e.Y_.documentMetadata}),e.Y_.documentMetadata.exists||++t;const n=sw.fromString(e.Y_.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.Y_.document&&(this.documents[this.documents.length-1].document=e.Y_.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ta(e){const t=new Map,n=new AS(this.serializer);for(const i of e)if(i.metadata.queries){const e=n.hs(i.metadata.name);for(const n of i.metadata.queries){var r=(t.get(n)||YI()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const i=e;let s=YI(),a=zI;for(const e of n){const n=t.hs(e.metadata.name);e.document&&(s=s.add(n));const l=t.Ps(e);l.setReadTime(t.Is(e.metadata.readTime)),a=a.insert(n,l)}const o=i.ss.newChangeBuffer({trackRemovals:!0}),c=await mC(i,(r=r,xI(NI(sw.fromString(`__bundle__/docs/${r}`)))));return i.persistence.runTransaction("Apply bundle documents","readwrite",t=>gC(t,o,a).next(e=>(o.apply(t),e)).next(e=>i.qr.removeMatchingKeysForTargetId(t,c.targetId).next(()=>i.qr.addMatchingKeys(t,s,c.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(t,e.us,e.cs)).next(()=>e.us)))}(this.localStore,new AS(this.serializer),this.documents,this.X_.id),t=this.ta(this.documents);for(const e of this.queries)await async function(e,n,r=YI()){const i=await mC(e,xI(P0(n.bundledQuery))),s=e;return s.persistence.runTransaction("Save named query","readwrite",e=>{var t=t0(n.readTime);if(0<=i.snapshotVersion.compareTo(t))return s.Kr.saveNamedQuery(e,n);t=i.withResumeToken(Ib.EMPTY_BYTE_STRING,t);return s.ts=s.ts.insert(t.targetId,t),s.qr.updateTargetData(e,t).next(()=>s.qr.removeMatchingKeysForTargetId(e,i.targetId)).next(()=>s.qr.addMatchingKeys(e,r,i.targetId)).next(()=>s.Kr.saveNamedQuery(e,n))})}(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,na:this.collectionGroups,ra:e}}}function RS(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class PS{constructor(e){this.key=e}}class DS{constructor(e){this.key=e}}class xS{constructor(e,t){this.query=e,this.ia=t,this.sa=null,this.hasCachedResults=!1,this.current=!1,this.oa=YI(),this.mutatedKeys=YI(),this._a=BI(e),this.aa=new _S(this._a)}get ua(){return this.ia}ca(e,t){const o=t?t.la:new yS,c=(t||this).aa;let l=(t||this).mutatedKeys,u=c,h=!1;const d="F"===this.query.limitType&&c.size===this.query.limit?c.last():null,p="L"===this.query.limitType&&c.size===this.query.limit?c.first():null;if(e.inorderTraversal((e,t)=>{const n=c.get(e),r=VI(this.query,t)?t:null,i=!!n&&this.mutatedKeys.has(n.key),s=!!r&&(r.hasLocalMutations||this.mutatedKeys.has(r.key)&&r.hasCommittedMutations);let a=!1;n&&r?n.data.isEqual(r.data)?i!==s&&(o.track({type:3,doc:r}),a=!0):this.ha(n,r)||(o.track({type:2,doc:r}),a=!0,(d&&0<this._a(r,d)||p&&this._a(r,p)<0)&&(h=!0)):!n&&r?(o.track({type:0,doc:r}),a=!0):n&&!r&&(o.track({type:1,doc:n}),a=!0,(d||p)&&(h=!0)),a&&(l=r?(u=u.add(r),s?l.add(e):l.delete(e)):(u=u.delete(e),l.delete(e)))}),null!==this.query.limit)for(;u.size>this.query.limit;){const e="F"===this.query.limitType?u.last():u.first();u=u.delete(e.key),l=l.delete(e.key),o.track({type:1,doc:e})}return{aa:u,la:o,Zi:h,mutatedKeys:l}}ha(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){var i=this.aa;this.aa=e.aa,this.mutatedKeys=e.mutatedKeys;const s=e.la.L_();s.sort((e,t)=>function(e,t){var n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Vy()}};return n(e)-n(t)}(e.type,t.type)||this._a(e.doc,t.doc)),this.Pa(n),r=null!=r&&r;var a=t&&!r?this.Ia():[],o=0===this.oa.size&&this.current&&!r?1:0,c=o!==this.sa;return this.sa=o,0!==s.length||c?{snapshot:new wS(this.query,e.aa,i,s,e.mutatedKeys,0==o,c,!1,!!n&&0<n.resumeToken.approximateByteSize()),Ta:a}:{Ta:a}}Q_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({aa:this.aa,la:new yS,mutatedKeys:this.mutatedKeys,Zi:!1},!1)):{Ta:[]}}Ea(e){return!this.ia.has(e)&&!!this.aa.has(e)&&!this.aa.get(e).hasLocalMutations}Pa(e){e&&(e.addedDocuments.forEach(e=>this.ia=this.ia.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.ia=this.ia.delete(e)),this.current=e.current)}Ia(){if(!this.current)return[];const t=this.oa;this.oa=YI(),this.aa.forEach(e=>{this.Ea(e.key)&&(this.oa=this.oa.add(e.key))});const n=[];return t.forEach(e=>{this.oa.has(e)||n.push(new DS(e))}),this.oa.forEach(e=>{t.has(e)||n.push(new PS(e))}),n}da(e){this.ia=e.ls,this.oa=YI();var t=this.ca(e.documents);return this.applyChanges(t,!0)}Aa(){return wS.fromInitialDocuments(this.query,this.aa,this.mutatedKeys,0===this.sa,this.hasCachedResults)}}class OS{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class MS{constructor(e){this.key=e,this.Ra=!1}}class LS{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Va={},this.ma=new jI(e=>FI(e),LI),this.fa=new Map,this.ga=new Set,this.pa=new fb(cw.comparator),this.ya=new Map,this.wa=new KE,this.Sa={},this.ba=new Map,this.Da=bE.Nn(),this.onlineState="Unknown",this.Ca=void 0}get isPrimaryClient(){return!0===this.Ca}}async function FS(r,e,t,n,i){r.va=(e,t,n)=>async function(e,t,n,r){let i=t.view.ca(n);i.Zi&&(i=await _C(e.localStore,t.query,!1).then(({documents:e})=>t.view.ca(e,i)));var s=r&&r.targetChanges.get(t.targetId),a=r&&null!=r.targetMismatches.get(t.targetId),a=t.view.applyChanges(i,e.isPrimaryClient,s,a);return WS(e,t.targetId,a.Ta),a.snapshot}(r,e,t,n);const s=await _C(r.localStore,e,!0),a=new xS(e,s.ls),o=a.ca(s.documents),c=qT.createSynthesizedTargetChangeForCurrentChange(t,n&&"Offline"!==r.onlineState,i),l=a.applyChanges(o,r.isPrimaryClient,c);WS(r,t,l.Ta);var u=new OS(e,t,a);return r.ma.set(e,u),r.fa.has(t)?r.fa.get(t).push(e):r.fa.set(t,[e]),l.snapshot}async function US(e,t,n){const r=ZS(e);try{const e=await function(e,i){const s=e,a=nw.now(),o=i.reduce((e,t)=>e.add(t.key),YI());let c,l;return s.persistence.runTransaction("Locally write mutations","readwrite",n=>{let t=zI,r=YI();return s.ss.getEntries(n,o).next(e=>{t=e,t.forEach((e,t)=>{t.isValidDocument()||(r=r.add(e))})}).next(()=>s.localDocuments.getOverlayedDocuments(n,t)).next(e=>{c=e;const t=[];for(const n of i){const i=function(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=nT(r.transform,e||null);null!=i&&(null===n&&(n=Yb.empty()),n.set(r.field,i))}return n||null}(n,c.get(n.key).overlayedDocument);null!=i&&t.push(new bT(n.key,i,function r(e){const i=[];return db(e.fields,(e,t)=>{const n=new ow([e]);if(Kb(t)){const e=r(t.mapValue).fields;if(0===e.length)i.push(n);else for(const t of e)i.push(n.child(t))}else i.push(n)}),new wb(i)}(i.value.mapValue),pT.exists(!0)))}return s.mutationQueue.addMutationBatch(n,a,t,i)}).next(e=>{var t=(l=e).applyToLocalDocumentSet(c,r);return s.documentOverlayCache.saveOverlays(n,e.batchId,t)})}).then(()=>({batchId:l.batchId,changes:WI(c)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Sa[e.currentUser.toKey()];r=r||new fb(Zy),r=r.insert(t,n),e.Sa[e.currentUser.toKey()]=r}(r,e.batchId,n),await HS(r,e.changes),await cS(r.remoteStore)}catch(e){const t=vS(e,"Failed to persist write");n.reject(t)}}async function VS(e,t){const r=e;try{const e=await fC(r.localStore,t);t.targetChanges.forEach((e,t)=>{const n=r.ya.get(t);n&&(qy(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),0<e.addedDocuments.size?n.Ra=!0:0<e.modifiedDocuments.size?qy(n.Ra):0<e.removedDocuments.size&&(qy(n.Ra),n.Ra=!1))}),await HS(r,e,t)}catch(e){await ww(e)}}function qS(r,i,e){const t=r;if(t.isPrimaryClient&&0===e||!t.isPrimaryClient&&1===e){const r=[];t.ma.forEach((e,t)=>{var n=t.view.Q_(i);n.snapshot&&r.push(n.snapshot)}),function(e,n){const t=e;t.onlineState=n;let r=!1;t.queries.forEach((e,t)=>{for(const e of t.listeners)e.Q_(n)&&(r=!0)}),r&&CS(t)}(t.eventManager,i),r.length&&t.Va.a_(r),t.onlineState=i,t.isPrimaryClient&&t.sharedClientState.setOnlineState(i)}}async function BS(e,t){const n=e,r=t.batch.batchId;try{const e=await function(e,r){const i=e;return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const t=r.batch.keys(),n=i.ss.newChangeBuffer({trackRemovals:!0});return function(e,t,r,i){const s=r.batch,n=s.keys();let a=bw.resolve();return n.forEach(n=>{a=a.next(()=>i.getEntry(t,n)).next(e=>{var t=r.docVersions.get(n);qy(null!==t),e.version.compareTo(t)<0&&(s.applyToRemoteDocument(e,r),e.isValidDocument()&&(e.setReadTime(r.commitVersion),i.addEntry(e)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,s))}(i,e,r,n).next(()=>n.apply(e)).next(()=>i.mutationQueue.performConsistencyCheck(e)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(e,t,r.batch.batchId)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=YI();for(let n=0;n<e.mutationResults.length;++n)0<e.mutationResults[n].transformResults.length&&(t=t.add(e.batch.mutations[n].key));return t}(r))).next(()=>i.localDocuments.getDocuments(e,t))})}(n.localStore,t);zS(n,r,null),jS(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await HS(n,e)}catch(e){await ww(e)}}function jS(e,t){(e.ba.get(t)||[]).forEach(e=>{e.resolve()}),e.ba.delete(t)}function zS(e,t,n){const r=e;let i=r.Sa[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Sa[r.currentUser.toKey()]=i}}function $S(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.fa.get(e))t.ma.delete(r),n&&t.Va.Fa(r,n);t.fa.delete(e),t.isPrimaryClient&&t.wa.Rr(e).forEach(e=>{t.wa.containsKey(e)||KS(t,e)})}function KS(e,t){e.ga.delete(t.path.canonicalString());var n=e.pa.get(t);null!==n&&(ZC(e.remoteStore,n),e.pa=e.pa.remove(t),e.ya.delete(n),GS(e))}function WS(e,t,n){for(const r of n)r instanceof PS?(e.wa.addReference(r.key,t),function(e,t){const n=t.key,r=n.path.canonicalString();e.pa.get(n)||e.ga.has(r)||(My("SyncEngine","New document in limbo: "+n),e.ga.add(r),GS(e))}(e,r)):r instanceof DS?(My("SyncEngine","Document no longer in limbo: "+r.key),e.wa.removeReference(r.key,t),e.wa.containsKey(r.key)||KS(e,r.key)):Vy()}function GS(e){for(;0<e.ga.size&&e.pa.size<e.maxConcurrentLimboResolutions;){var t=e.ga.values().next().value;e.ga.delete(t);var n=new cw(sw.fromString(t)),t=e.Da.next();e.ya.set(t,new MS(n)),e.pa=e.pa.insert(n,t),XC(e.remoteStore,new I0(xI(NI(n.path)),t,"TargetPurposeLimboResolution",xw._e))}}async function HS(e,t,r){const i=e,s=[],a=[],o=[];i.ma.isEmpty()||(i.ma.forEach((e,n)=>{o.push(i.va(n,t,r).then(e=>{var t;(e||r)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(n.targetId,null!=e&&e.fromCache?"not-current":"current"),e&&(s.push(e),t=oC.Qi(n.targetId,e),a.push(t))}))}),await Promise.all(o),i.Va.a_(s),await async function(e,t){const r=e;try{await r.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>bw.forEach(t,t=>bw.forEach(t.ki,e=>r.persistence.referenceDelegate.addReference(n,t.targetId,e)).next(()=>bw.forEach(t.qi,e=>r.persistence.referenceDelegate.removeReference(n,t.targetId,e)))))}catch(e){if(!Sw(e))throw e;My("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=r.ts.get(t),n=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(n);r.ts=r.ts.insert(t,i)}}}(i.localStore,a))}async function QS(r,e){const i=r;if(XS(i),ZS(i),!0===e&&!0!==i.Ca){const r=i.sharedClientState.getAllActiveQueryTargets(),e=await YS(i,r.toArray());i.Ca=!0,await pS(i.remoteStore,!0);for(const r of e)XC(i.remoteStore,r)}else if(!1===e&&!1!==i.Ca){const r=[];let n=Promise.resolve();i.fa.forEach((e,t)=>{i.sharedClientState.isLocalQueryTarget(t)?r.push(t):n=n.then(()=>($S(i,t),vC(i.localStore,t,!0))),ZC(i.remoteStore,t)}),await n,await YS(i,r),function(e){const n=e;n.ya.forEach((e,t)=>{ZC(n.remoteStore,t)}),n.wa.Vr(),n.ya=new Map,n.pa=new fb(cw.comparator)}(i),i.Ca=!1,await pS(i.remoteStore,!1)}}async function YS(t,n){const r=t,i=[],s=[];for(const t of n){let e;const u=r.fa.get(t);if(u&&0!==u.length){e=await mC(r.localStore,xI(u[0]));for(const t of u){const n=r.ma.get(t),u=(a=r,o=n,l=c=void 0,l=await _C((c=a).localStore,o.query,!0),l=o.view.da(l),c.isPrimaryClient&&WS(c,o.targetId,l.Ta),await l);u.snapshot&&s.push(u.snapshot)}}else{const u=await yC(r.localStore,t);e=await mC(r.localStore,u),await FS(r,JS(u),t,!1,e.resumeToken)}i.push(e)}var a,o,c,l;return r.Va.a_(s),i}function JS(e){return AI(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function XS(e){const t=e;return t.remoteStore.remoteSyncer.applyRemoteEvent=VS.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=(function(e,t){const n=e,r=n.ya.get(t);if(r&&r.Ra)return YI().add(r.key);{let e=YI();const r=n.fa.get(t);if(!r)return e;for(const t of r){const r=n.ma.get(t);e=e.unionWith(r.view.ua)}return e}}).bind(null,t),t.remoteStore.remoteSyncer.rejectListen=(async function(e,t,n){const r=e;r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.ya.get(t),s=i&&i.key;if(s){let e=new fb(cw.comparator);e=e.insert(s,Jb.newNoDocument(s,rw.min()));const n=YI().add(s),i=new VT(rw.min(),new Map,new fb(Zy),e,n);await VS(r,i),r.pa=r.pa.remove(s),r.ya.delete(t),GS(r)}else await vC(r.localStore,t,!1).then(()=>$S(r,t,n)).catch(ww)}).bind(null,t),t.Va.a_=(function(e,t){const n=e;let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.listeners)t.K_(e)&&(r=!0);i.k_=e}}r&&CS(n)}).bind(null,t.eventManager),t.Va.Fa=(function(e,t,n){const r=e,i=r.queries.get(t);if(i)for(const e of i.listeners)e.onError(n);r.queries.delete(t)}).bind(null,t.eventManager),t}function ZS(e){const t=e;return t.remoteStore.remoteSyncer.applySuccessfulWrite=BS.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=(async function(e,t,n){const r=e;try{const e=await function(e,r){const i=e;return i.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let n;return i.mutationQueue.lookupMutationBatch(t,r).next(e=>(qy(null!==e),n=e.keys(),i.mutationQueue.removeMutationBatch(t,e))).next(()=>i.mutationQueue.performConsistencyCheck(t)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(t,n,r)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,n)).next(()=>i.localDocuments.getDocuments(t,n))})}(r.localStore,t);zS(r,t,n),jS(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await HS(r,e)}catch(n){await ww(n)}}).bind(null,t),t}class ek{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=jC(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return hC(this.persistence,new lC,e.initialUser,this.serializer)}createPersistence(e){return new JE(ZE.jr,this.serializer)}createSharedClientState(e){return new PC}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class tk extends ek{constructor(e,t,n){super(),this.xa=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xa.initialize(this,e),await ZS(this.xa.syncEngine),await cS(this.xa.remoteStore),await this.persistence.mi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}createLocalStore(e){return hC(this.persistence,new lC,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){var n=this.persistence.referenceDelegate.garbageCollector;return new AE(n,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){var n=new Dw(t,this.persistence);return new Pw(e.asyncQueue,n)}createPersistence(e){var t=aC(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?pE.withCacheSize(this.cacheSizeBytes):pE.DEFAULT;return new rC(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,qC(),BC(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new PC}}class nk extends tk{constructor(e,t){super(e,t,!1),this.xa=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);var t=this.xa.syncEngine;this.sharedClientState instanceof RC&&(this.sharedClientState.syncEngine={Ys:(async function(e,t,n,r){var i=e,s=await function(e,n){const r=e,i=r.mutationQueue;return r.persistence.runTransaction("Lookup mutation documents","readonly",t=>i.Cn(t,n).next(e=>e?r.localDocuments.getDocuments(t,e):bw.resolve(null)))}(i.localStore,t);null!==s?("pending"===n?await cS(i.remoteStore):"acknowledged"===n||"rejected"===n?(zS(i,t,r||null),jS(i,t),i.localStore.mutationQueue.Fn(t)):Vy(),await HS(i,s)):My("SyncEngine","Cannot apply mutation batch with id: "+t)}).bind(null,t),Zs:(async function(e,t,n,r){const i=e;if(i.Ca)My("SyncEngine","Ignoring unexpected query state notification.");else{var s=i.fa.get(t);if(s&&0<s.length)switch(n){case"current":case"not-current":{const e=await wC(i.localStore,qI(s[0])),r=VT.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,Ib.EMPTY_BYTE_STRING);await HS(i,e,r);break}case"rejected":await vC(i.localStore,t,!0),$S(i,t,r);break;default:Vy()}}}).bind(null,t),Xs:(async function(e,t,n){const r=XS(e);if(r.Ca){for(const e of t)if(r.fa.has(e))My("SyncEngine","Adding an already active target "+e);else{const t=await yC(r.localStore,e),n=await mC(r.localStore,t);await FS(r,JS(t),n.targetId,!1,n.resumeToken),XC(r.remoteStore,n)}for(const e of n)r.fa.has(e)&&await vC(r.localStore,e,!1).then(()=>{ZC(r.remoteStore,e),$S(r,e)}).catch(ww)}}).bind(null,t),Bi:(function(e){return e.localStore.persistence.Bi()}).bind(null,t),Js:(async function(e,t){const n=e;return wC(n.localStore,t).then(e=>HS(n,e))}).bind(null,t)},await this.sharedClientState.start()),await this.persistence.mi(async e=>{await QS(this.xa.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}createSharedClientState(e){var t=qC();if(!RC.D(t))throw new jy(By.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=aC(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new RC(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class rk{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>qS(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=(async function(e,t){const n=e;if(!n.currentUser.isEqual(t)){My("SyncEngine","User change. New user:",t.toKey());const i=await dC(n.localStore,t);n.currentUser=t,e=n,r="'waitForPendingWrites' promise is rejected due to a user change.",e.ba.forEach(e=>{e.forEach(e=>{e.reject(new jy(By.CANCELLED,r))})}),e.ba.clear(),n.sharedClientState.handleUserChange(t,i.removedBatchIds,i.addedBatchIds),await HS(n,i._s)}var r}).bind(null,this.syncEngine),await pS(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new IS}createDatastore(e){var t,n,r,i=jC(e.databaseInfo.databaseId),s=(r=e.databaseInfo,new VC(r));return t=e.authCredentials,n=e.appCheckCredentials,r=s,e=i,new GC(t,n,r,e)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>qS(this.syncEngine,e,0),e=new(xC.D()?xC:DC),new QC(t,n,r,i,e);var t,n,r,i}createSyncEngine(e,t){return function(e,t,n,r,i,s,a){const o=new LS(e,t,n,r,i,s);return a&&(o.Ca=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=e;My("RemoteStore","RemoteStore shutting down."),t.C_.add(5),await JC(t),t.F_.shutdown(),t.M_.set("Unknown")}(this.remoteStore)}}function ik(t,n=10240){let r=0;return{async read(){if(r<t.byteLength){var e={value:t.slice(r,r+n),done:!1};return r+=n,e}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}class sk{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Oa(this.observer.next,e)}error(e){this.observer.error?this.Oa(this.observer.error,e):Ly("Uncaught Error in snapshot listener:",e.toString())}Na(){this.muted=!0}Oa(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class ak{constructor(e,t){this.Ba=e,this.serializer=t,this.metadata=new zy,this.buffer=new Uint8Array,this.La=new TextDecoder("utf-8"),this.ka().then(e=>{e&&e.Z_()?this.metadata.resolve(e.Y_.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.Y_)}`))},e=>this.metadata.reject(e))}close(){return this.Ba.cancel()}async getMetadata(){return this.metadata.promise}async Ma(){return await this.getMetadata(),this.ka()}async ka(){var e=await this.qa();if(null===e)return null;var t=this.La.decode(e),n=Number(t);isNaN(n)&&this.Qa(`length string (${t}) is not valid number`);t=await this.Ka(n);return new kS(JSON.parse(t),e.length+n)}$a(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async qa(){for(;this.$a()<0&&!await this.Ua(););if(0===this.buffer.length)return null;var e=this.$a();e<0&&this.Qa("Reached the end of bundle when a length string is expected.");var t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Ka(e){for(;this.buffer.length<e;)await this.Ua()&&this.Qa("Reached the end of bundle when more is expected.");var t=this.La.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Qa(e){throw this.Ba.cancel(),new Error(`Invalid bundle format: ${e}`)}async Ua(){var e=await this.Ba.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class ok{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new jy(By.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const r=e,n=c0(r.serializer)+"/documents",i={documents:t.map(e=>i0(r.serializer,e))},s=await r.Co("BatchGetDocuments",n,i,t.length),a=new Map;s.forEach(e=>{const t=(n=r.serializer,"found"in(e=e)?function(e,t){qy(!!t.found),t.found.name,t.found.updateTime;var n=s0(e,t.found.name),r=t0(t.found.updateTime),i=t.found.createTime?t0(t.found.createTime):rw.min(),s=new Yb({mapValue:{fields:t.found.fields}});return Jb.newFoundDocument(n,r,i,s)}(n,e):"missing"in e?function(e,t){qy(!!t.missing),qy(!!t.readTime);var n=s0(e,t.missing),r=t0(t.readTime);return Jb.newNoDocument(n,r)}(n,e):Vy());var n;a.set(t.key.toString(),t)});const o=[];return t.forEach(e=>{var t=a.get(e.toString());qy(!!t),o.push(t)}),o}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new CT(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,t)=>{var n=cw.fromPath(t);this.mutations.push(new ST(n,this.precondition(n)))}),await async function(e,t){const n=e,r=c0(n.serializer)+"/documents",i={writes:t.map(e=>d0(n.serializer,e))};await n.wo("Commit",r,i)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Vy();t=rw.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new jy(By.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(rw.min())?pT.exists(!1):pT.updateTime(t):pT.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return pT.exists(!0);if(t.isEqual(rw.min()))throw new jy(By.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return pT.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class ck{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.Wa=n.maxAttempts,this.zo=new zC(this.asyncQueue,"transaction_retry")}run(){--this.Wa,this.Ga()}Ga(){this.zo.ko(async()=>{const t=new ok(this.datastore),e=this.za(t);e&&e.then(e=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(e)}).catch(e=>{this.ja(e)}))}).catch(e=>{this.ja(e)})})}za(e){try{var t=this.updateFunction(e);return!Ow(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}ja(e){0<this.Wa&&this.Ha(e)?(--this.Wa,this.asyncQueue.enqueueAndForget(()=>(this.Ga(),Promise.resolve()))):this.deferred.reject(e)}Ha(e){if("FirebaseError"!==e.name)return!1;var t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!PT(t)}}class lk{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=Py.UNAUTHENTICATED,this.clientId=Xy.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async e=>{My("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(My("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new jy(By.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const n=new zy;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),n.resolve()}catch(e){var t=vS(e,"Failed to shutdown persistence");n.reject(t)}}),n.promise}}async function uk(e,t){e.asyncQueue.verifyOperationInProgress(),My("FirestoreClient","Initializing OfflineComponentProvider");var n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await dC(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function hk(e,n){e.asyncQueue.verifyOperationInProgress();var t=await pk(e);My("FirestoreClient","Initializing OnlineComponentProvider");var r=await e.getConfiguration();await n.initialize(t,r),e.setCredentialChangeListener(e=>dS(n.remoteStore,e)),e.setAppCheckTokenChangeListener((e,t)=>dS(n.remoteStore,t)),e._onlineComponents=n}function dk(e){return"FirebaseError"===e.name?e.code===By.FAILED_PRECONDITION||e.code===By.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}async function pk(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){My("FirestoreClient","Using user provided OfflineComponentProvider");try{await uk(t,t._uninitializedComponentsProvider._offline)}catch(e){var n=e;if(!dk(n))throw n;Fy("Error using user provided cache. Falling back to memory cache: "+n),await uk(t,new ek)}}else My("FirestoreClient","Using default OfflineComponentProvider"),await uk(t,new ek);return t._offlineComponents}async function fk(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(My("FirestoreClient","Using user provided OnlineComponentProvider"),await hk(e,e._uninitializedComponentsProvider._online)):(My("FirestoreClient","Using default OnlineComponentProvider"),await hk(e,new rk))),e._onlineComponents}function gk(e){return pk(e).then(e=>e.persistence)}function mk(e){return pk(e).then(e=>e.localStore)}function vk(e){return fk(e).then(e=>e.remoteStore)}function _k(e){return fk(e).then(e=>e.syncEngine)}async function yk(e){const t=await fk(e),n=t.eventManager;return n.onListen=(async function(e,t){const n=XS(e);let r,i;const s=n.ma.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.Aa();else{const e=await mC(n.localStore,xI(t)),s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await FS(n,t,r,"current"===s,e.resumeToken),n.isPrimaryClient&&XC(n.remoteStore,e)}return i}).bind(null,t.syncEngine),n.onUnlisten=(async function(e,t){const n=e,r=n.ma.get(t),i=n.fa.get(r.targetId);if(1<i.length)return n.fa.set(r.targetId,i.filter(e=>!LI(e,t))),void n.ma.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await vC(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),ZC(n.remoteStore,r.targetId),$S(n,r.targetId)}).catch(ww)):($S(n,r.targetId),await vC(n.localStore,r.targetId,!0))}).bind(null,t.syncEngine),n}function wk(e,t,n={}){const r=new zy;return e.asyncQueue.enqueueAndForget(async()=>function(n,r,i,s,a){const e=new sk({next:e=>{r.enqueueAndForget(()=>ES(n,o));var t=e.docs.has(i);!t&&e.fromCache?a.reject(new jy(By.UNAVAILABLE,"Failed to get document because the client is offline.")):t&&e.fromCache&&s&&"server"===s.source?a.reject(new jy(By.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):a.resolve(e)},error:e=>a.reject(e)}),o=new SS(NI(i.path),e,{includeMetadataChanges:!0,J_:!0});return TS(n,o)}(await yk(e),e.asyncQueue,t,n,r)),r.promise}function bk(e,t,n={}){const r=new zy;return e.asyncQueue.enqueueAndForget(async()=>function(t,n,e,r,i){const s=new sk({next:e=>{n.enqueueAndForget(()=>ES(t,a)),e.fromCache&&"server"===r.source?i.reject(new jy(By.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(e)},error:e=>i.reject(e)}),a=new SS(e,s,{includeMetadataChanges:!0,J_:!0});return TS(t,a)}(await yk(e),e.asyncQueue,t,n,r)),r.promise}function Ik(e,t,n,r){const i=(n=n,t=jC(t),s="string"==typeof n?xT().encode(n):n,n=function(e,t){if(e instanceof Uint8Array)return ik(e,t);if(e instanceof ArrayBuffer)return ik(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(s),t=t,new ak(n,t));var s;e.asyncQueue.enqueueAndForget(async()=>{!function(e,t,n){const r=e;!async function(t,n,r){try{var i=await n.getMetadata();if(await function(e,t){const n=e,r=t0(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Kr.getBundleMetadata(e,t.id)).then(e=>!!e&&0<=e.createTime.compareTo(r))}(t.localStore,i))return await n.close(),r._completeWith({taskState:"Success",documentsLoaded:i.totalDocuments,bytesLoaded:i.totalBytes,totalDocuments:i.totalDocuments,totalBytes:i.totalBytes}),Promise.resolve(new Set);r._updateProgress(RS(i));const a=new NS(i,t.localStore,n.serializer);let e=await n.Ma();for(;e;){const t=await a.ea(e);t&&r._updateProgress(t),e=await n.Ma()}var s=await a.complete();return await HS(t,s.ra,void 0),await function(e,t){const n=e;return n.persistence.runTransaction("Save bundle","readwrite",e=>n.Kr.saveBundleMetadata(e,t))}(t.localStore,i),r._completeWith(s.progress),Promise.resolve(s.na)}catch(t){return Fy("SyncEngine",`Loading bundle failed with ${t}`),r._failWith(t),Promise.resolve(new Set)}}(r,t,n).then(e=>{r.sharedClientState.notifyBundleLoaded(e)})}(await _k(e),i,r)})}function Tk(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const Ek=new Map;function Ck(e,t,n){if(!n)throw new jy(By.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Sk(e,t,n,r){if(!0===t&&!0===r)throw new jy(By.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function kk(e){if(!cw.isDocumentKey(e))throw new jy(By.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Ak(e){if(cw.isDocumentKey(e))throw new jy(By.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Nk(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":Vy();if(e instanceof Array)return"an array";var t=(e=e).constructor?e.constructor.name:null;return t?`a custom ${t} object`:"an object"}function Rk(e,t){if((e="_delegate"in e?e._delegate:e)instanceof t)return e;if(t.name===e.constructor.name)throw new jy(By.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=Nk(e);throw new jy(By.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}function Pk(e,t){if(t<=0)throw new jy(By.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class Dk{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new jy(By.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new jy(By.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Sk("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Tk(null!==(t=e.experimentalLongPollingOptions)&&void 0!==t?t:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new jy(By.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new jy(By.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(30<e.timeoutSeconds)throw new jy(By.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams;var t,n}}class xk{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Dk({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new jy(By.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new jy(By.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Dk(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Ky;switch(e.type){case"firstParty":return new Qy(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new jy(By.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Ek.get(e);t&&(My("ComponentProvider","Removing Datastore"),Ek.delete(e),t.terminate())}(this),Promise.resolve()}}class Ok{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Ok(this.firestore,e,this._query)}}class Mk{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Lk(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Mk(this.firestore,e,this._key)}}class Lk extends Ok{constructor(e,t,n){super(e,t,NI(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Mk(this.firestore,null,new cw(e))}withConverter(e){return new Lk(this.firestore,e,this._path)}}function Fk(e,t,...n){if(e=oe(e),Ck("collection","path",t),e instanceof xk){var r=sw.fromString(t,...n);return Ak(r),new Lk(e,null,r)}if(!(e instanceof Mk||e instanceof Lk))throw new jy(By.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");r=e._path.child(sw.fromString(t,...n));return Ak(r),new Lk(e.firestore,null,r)}function Uk(e,t,...n){if(e=oe(e),Ck("doc","path",t=1===arguments.length?Xy.newId():t),e instanceof xk){var r=sw.fromString(t,...n);return kk(r),new Mk(e,null,new cw(r))}if(!(e instanceof Mk||e instanceof Lk))throw new jy(By.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");r=e._path.child(sw.fromString(t,...n));return kk(r),new Mk(e.firestore,e instanceof Lk?e.converter:null,new cw(r))}function Vk(e,t){return e=oe(e),t=oe(t),(e instanceof Mk||e instanceof Lk)&&(t instanceof Mk||t instanceof Lk)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function qk(e,t){return e=oe(e),t=oe(t),e instanceof Ok&&t instanceof Ok&&e.firestore===t.firestore&&LI(e._query,t._query)&&e.converter===t.converter}class Bk{constructor(){this.Ja=Promise.resolve(),this.Ya=[],this.Za=!1,this.Xa=[],this.eu=null,this.tu=!1,this.nu=!1,this.ru=[],this.zo=new zC(this,"async_queue_retry"),this.iu=()=>{var e=BC();e&&My("AsyncQueue","Visibility state changed to "+e.visibilityState),this.zo.Qo()};const e=BC();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.iu)}get isShuttingDown(){return this.Za}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.su(),this.ou(e)}enterRestrictedMode(e){if(!this.Za){this.Za=!0,this.nu=e||!1;const t=BC();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.iu)}}enqueue(e){if(this.su(),this.Za)return new Promise(()=>{});const t=new zy;return this.ou(()=>this.Za&&this.nu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Ya.push(e),this._u()))}async _u(){if(0!==this.Ya.length){try{await this.Ya[0](),this.Ya.shift(),this.zo.reset()}catch(e){if(!Sw(e))throw e;My("AsyncQueue","Operation failed with retryable error: "+e)}0<this.Ya.length&&this.zo.ko(()=>this._u())}}ou(e){var t=this.Ja.then(()=>(this.tu=!0,e().catch(e=>{throw this.eu=e,this.tu=!1,Ly("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e}).then(e=>(this.tu=!1,e))));return this.Ja=t}enqueueAfterDelay(e,t,n){this.su(),-1<this.ru.indexOf(e)&&(t=0);var r=mS.createAndSchedule(this,e,t,n,e=>this.au(e));return this.Xa.push(r),r}su(){this.eu&&Vy()}verifyOperationInProgress(){}async uu(){for(var e;await(e=this.Ja),e!==this.Ja;);}cu(e){for(const t of this.Xa)if(t.timerId===e)return!0;return!1}lu(t){return this.uu().then(()=>{this.Xa.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const e of this.Xa)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.uu()})}hu(e){this.ru.push(e)}au(e){var t=this.Xa.indexOf(e);this.Xa.splice(t,1)}}function jk(e){return function(e,t){if("object"==typeof e&&null!==e){var n=e;for(const e of t)if(e in n&&"function"==typeof n[e])return 1}}(e,["next","error","complete"])}class zk{constructor(){this._progressObserver={},this._taskCompletionResolver=new zy,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}var $k,Kk,Wk,Gk,Hk,Qk;class Yk extends xk{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new Bk,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Xk(this),this._firestoreClient.terminate()}}function Jk(e){return e._firestoreClient||Xk(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function Xk(e){var t,n,r,i,s,a=e._freezeSettings(),o=(n=e._databaseId,r=(null===(o=e._app)||void 0===o?void 0:o.options.appId)||"",i=e._persistenceKey,s=a,new Rb(n,r,i,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,Tk(s.experimentalLongPollingOptions),s.useFetchStreams));e._firestoreClient=new lk(e._authCredentials,e._appCheckCredentials,e._queue,o),null!==(o=a.localCache)&&void 0!==o&&o._offlineComponentProvider&&null!==(t=a.localCache)&&void 0!==t&&t._onlineComponentProvider&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:a.localCache.kind,_offline:a.localCache._offlineComponentProvider,_online:a.localCache._onlineComponentProvider})}function Zk(e,t,n){const r=new zy;return e.asyncQueue.enqueue(async()=>{try{await uk(e,n),await hk(e,t),r.resolve()}catch(e){const t=e;if(!dk(t))throw t;Fy("Error enabling indexeddb cache. Falling back to memory cache: "+t),r.reject(t)}}).then(()=>r.promise)}function eA(e){return function(e){const t=new zy;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t){const n=e;iS(n.remoteStore)||My("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(e){const t=e;return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e))}(n.localStore);if(-1===e)return void t.resolve();const r=n.ba.get(e)||[];r.push(t),n.ba.set(e,r)}catch(e){const n=vS(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await _k(e),t)),t.promise}(Jk(e=Rk(e,Yk)))}function tA(e){return(n=Jk(e=Rk(e,Yk))).asyncQueue.enqueue(async()=>{const e=await gk(n),t=await vk(n);return e.setNetworkEnabled(!0),function(e){const t=e;return t.C_.delete(0),YC(t)}(t)});var n}function nA(e){return(n=Jk(e=Rk(e,Yk))).asyncQueue.enqueue(async()=>{const e=await gk(n),t=await vk(n);return e.setNetworkEnabled(!1),async function(e){const t=e;t.C_.add(0),await JC(t),t.M_.set("Offline")}(t)});var n}function rA(t,e){return n=Jk(t=Rk(t,Yk)),r=e,n.asyncQueue.enqueue(async()=>function(e,t){const n=e;return n.persistence.runTransaction("Get named query","readonly",e=>n.Kr.getNamedQuery(e,t))}(await mk(n),r)).then(e=>e?new Ok(t,null,e.query):null);var n,r}function iA(e){if(e._initialized||e._terminated)throw new jy(By.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class sA{constructor(e){this._byteString=e}static fromBase64String(e){try{return new sA(Ib.fromBase64String(e))}catch(e){throw new jy(By.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new sA(Ib.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class aA{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new jy(By.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ow(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class oA{constructor(e){this._methodName=e}}class cA{constructor(e,t){if(!isFinite(e)||e<-90||90<e)throw new jy(By.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||180<t)throw new jy(By.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Zy(this._lat,e._lat)||Zy(this._long,e._long)}}const lA=/^__.*__$/;class uA{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new bT(e,this.data,this.fieldMask,t,this.fieldTransforms):new wT(e,this.data,t,this.fieldTransforms)}}class hA{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new bT(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function dA(e){switch(e){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw Vy()}}class pA{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Pu(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Iu(){return this.settings.Iu}Tu(e){return new pA(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Eu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Tu({path:n,du:!1});return r.Au(e),r}Ru(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Tu({path:n,du:!1});return r.Pu(),r}Vu(e){return this.Tu({path:void 0,du:!0})}mu(e){return xA(e,this.settings.methodName,this.settings.fu||!1,this.path,this.settings.gu)}contains(t){return void 0!==this.fieldMask.find(e=>t.isPrefixOf(e))||void 0!==this.fieldTransforms.find(e=>t.isPrefixOf(e.field))}Pu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Au(this.path.get(e))}Au(e){if(0===e.length)throw this.mu("Document fields must not be empty");if(dA(this.Iu)&&lA.test(e))throw this.mu('Document fields cannot begin and end with "__"')}}class fA{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||jC(e)}pu(e,t,n,r=!1){return new pA({Iu:e,methodName:t,gu:n,path:ow.emptyPath(),du:!1,fu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function gA(e){var t=e._freezeSettings(),n=jC(e._databaseId);return new fA(e._databaseId,!!t.ignoreUndefinedProperties,n)}function mA(e,t,n,r,i,s={}){const a=e.pu(s.merge||s.mergeFields?2:0,t,n,i);NA("Data must be an object, but it was:",a,r);var o=kA(r,a);let c,l;if(s.merge)c=new wb(a.fieldMask),l=a.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=RA(t,r,n);if(!a.contains(i))throw new jy(By.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);OA(e,i)||e.push(i)}c=new wb(e),l=a.fieldTransforms.filter(e=>c.covers(e.field))}else c=null,l=a.fieldTransforms;return new uA(new Yb(o),c,l)}class vA extends oA{_toFieldTransform(e){if(2!==e.Iu)throw 1===e.Iu?e.mu(`${this._methodName}() can only appear at the top level of your update data`):e.mu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof vA}}function _A(e,t,n){return new pA({Iu:3,gu:t.settings.gu,methodName:e._methodName,du:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class yA extends oA{_toFieldTransform(e){return new hT(e.path,new rT)}isEqual(e){return e instanceof yA}}class wA extends oA{constructor(e,t){super(e),this.yu=t}_toFieldTransform(e){const t=_A(this,e,!0),n=this.yu.map(e=>SA(e,t)),r=new iT(n);return new hT(e.path,r)}isEqual(e){return this===e}}class bA extends oA{constructor(e,t){super(e),this.yu=t}_toFieldTransform(e){const t=_A(this,e,!0),n=this.yu.map(e=>SA(e,t)),r=new aT(n);return new hT(e.path,r)}isEqual(e){return this===e}}class IA extends oA{constructor(e,t){super(e),this.wu=t}_toFieldTransform(e){var t=new cT(e.serializer,eT(e.serializer,this.wu));return new hT(e.path,t)}isEqual(e){return this===e}}function TA(e,i,s,t){const a=e.pu(1,i,s);NA("Data must be an object, but it was:",a,t);const o=[],c=Yb.empty();db(t,(e,t)=>{var n=DA(i,e,s);t=oe(t);var r=a.Ru(n);if(t instanceof vA)o.push(n);else{const e=SA(t,r);null!=e&&(o.push(n),c.set(n,e))}});var n=new wb(o);return new hA(c,n,a.fieldTransforms)}function EA(e,t,n,r,i,s){const a=e.pu(1,t,n),o=[RA(t,r,n)],c=[i];if(s.length%2!=0)throw new jy(By.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<s.length;p+=2)o.push(RA(t,s[p])),c.push(s[p+1]);const l=[],u=Yb.empty();for(let f=o.length-1;0<=f;--f)if(!OA(l,o[f])){const t=o[f];var h=oe(h=c[f]);const r=a.Ru(t);if(h instanceof vA)l.push(t);else{const e=SA(h,r);null!=e&&(l.push(t),u.set(t,e))}}var d=new wb(l);return new hA(u,d,a.fieldTransforms)}function CA(e,t,n,r=!1){return SA(n,e.pu(r?4:3,t))}function SA(e,t){if(AA(e=oe(e)))return NA("Unsupported field value:",t,e),kA(e,t);if(e instanceof oA)return function(e,t){if(!dA(t.Iu))throw t.mu(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.mu(`${e._methodName}() is not currently supported inside arrays`);var n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.du&&4!==t.Iu)throw t.mu("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=SA(i,t.Vu(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=oe(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return eT(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=nw.fromDate(e);return{timestampValue:ZT(t.serializer,n)}}if(e instanceof nw){n=new nw(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:ZT(t.serializer,n)}}if(e instanceof cA)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof sA)return{bytesValue:e0(t.serializer,e._byteString)};if(e instanceof Mk){const r=t.databaseId,i=e.firestore._databaseId;if(!i.isEqual(r))throw t.mu(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:n0(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.mu(`Unsupported field value: ${Nk(e)}`)}(e,t)}function kA(e,r){const i={};return pb(e)?r.path&&0<r.path.length&&r.fieldMask.push(r.path):db(e,(e,t)=>{var n=SA(t,r.Eu(e));null!=n&&(i[e]=n)}),{mapValue:{fields:i}}}function AA(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof nw||e instanceof cA||e instanceof sA||e instanceof Mk||e instanceof oA)}function NA(e,t,n){if(!AA(n)||("object"!=typeof(i=n)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i))){var r=Nk(n);throw"an object"===r?t.mu(e+" a custom object"):t.mu(e+" "+r)}var i}function RA(e,t,n){if((t=oe(t))instanceof aA)return t._internalPath;if("string"==typeof t)return DA(e,t);throw xA("Field path arguments must be of type string or ",e,!1,void 0,n)}const PA=new RegExp("[~\\*/\\[\\]]");function DA(t,n,r){if(0<=n.search(PA))throw xA(`Invalid field path (${n}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,r);try{return new aA(...n.split("."))._internalPath}catch(e){throw xA(`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,r)}}function xA(e,t,n,r,i){var s=r&&!r.isEmpty(),a=void 0!==i;let o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let c="";return(s||a)&&(c+=" (found",s&&(c+=` in field ${r}`),a&&(c+=` in document ${i}`),c+=")"),new jy(By.INVALID_ARGUMENT,o+e+c)}function OA(e,t){return e.some(e=>e.isEqual(t))}class MA{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Mk(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){var e=new LA(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){var t=this._document.data.field(FA("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class LA extends MA{data(){return super.data()}}function FA(e,t){return"string"==typeof t?DA(e,t):(t instanceof aA?t:t._delegate)._internalPath}function UA(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new jy(By.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class VA{}class qA extends VA{}function BA(e,t,...n){let r=[];t instanceof VA&&r.push(t),r=r.concat(n),function(e){var t=e.filter(e=>e instanceof zA).length,n=e.filter(e=>e instanceof jA).length;if(1<t||0<t&&0<n)throw new jy(By.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const t of r)e=t._apply(e);return e}class jA extends qA{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new jA(e,t,n)}_apply(e){var t=this._parse(e);return JA(e._query,t),new Ok(e.firestore,e.converter,OI(e._query,t))}_parse(e){var t=gA(e.firestore);return function(e,t,n,r,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new jy(By.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){YA(a,s);const t=[];for(const n of a)t.push(QA(r,e,n));o={arrayValue:{values:t}}}else o=QA(r,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||YA(a,s),o=CA(n,t,a,"in"===s||"not-in"===s);return rI.create(i,s,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}class zA extends VA{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new zA(e,t)}_parse(t){var e=this._queryConstraints.map(e=>e._parse(t)).filter(e=>0<e.getFilters().length);return 1===e.length?e[0]:iI.create(e,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;for(const e of t.getFlattenedFilters())JA(n,e),n=OI(n,e)}(e._query,t),new Ok(e.firestore,e.converter,OI(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class $A extends qA{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new $A(e,t)}_apply(e){var t=function(e,t,n){if(null!==e.startAt)throw new jy(By.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new jy(By.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new tI(t,n)}(e._query,this._field,this._direction);return new Ok(e.firestore,e.converter,(e=e._query,t=e.explicitOrderBy.concat([t]),new kI(e.path,e.collectionGroup,t,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)))}}class KA extends qA{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new KA(e,t,n)}_apply(e){return new Ok(e.firestore,e.converter,MI(e._query,this._limit,this._limitType))}}class WA extends qA{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new WA(e,t,n)}_apply(e){var t,n=HA(e,this.type,this._docOrFields,this._inclusive);return new Ok(e.firestore,e.converter,(t=e._query,e=n,new kI(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)))}}class GA extends qA{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new GA(e,t,n)}_apply(e){var t,n=HA(e,this.type,this._docOrFields,this._inclusive);return new Ok(e.firestore,e.converter,(t=e._query,e=n,new kI(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)))}}function HA(e,t,n,r){if(n[0]=oe(n[0]),n[0]instanceof MA)return function(e,t,n,r,i){if(!r)throw new jy(By.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const n of DI(e))if(n.field.isKeyField())s.push(qb(t,r.key));else{const e=r.data.field(n.field);if(kb(e))throw new jy(By.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new jy(By.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new Xb(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var i=gA(e.firestore);return function(e,t,n,r,i,s){const a=e.explicitOrderBy;if(i.length>a.length)throw new jy(By.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const o=[];for(let c=0;c<i.length;c++){const l=i[c];if(a[c].field.isKeyField()){if("string"!=typeof l)throw new jy(By.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof l}`);if(!PI(e)&&-1!==l.indexOf("/"))throw new jy(By.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${l}' contains a slash.`);const n=e.path.child(sw.fromString(l));if(!cw.isDocumentKey(n))throw new jy(By.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new cw(n);o.push(qb(t,i))}else{const e=CA(n,r,l);o.push(e)}}return new Xb(o,s)}(e._query,e.firestore._databaseId,i,t,n,r)}function QA(e,t,n){if("string"==typeof(n=oe(n))){if(""===n)throw new jy(By.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!PI(t)&&-1!==n.indexOf("/"))throw new jy(By.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);var r=t.path.child(sw.fromString(n));if(!cw.isDocumentKey(r))throw new jy(By.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return qb(e,new cw(r))}if(n instanceof Mk)return qb(e,n._key);throw new jy(By.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Nk(n)}.`)}function YA(e,t){if(!Array.isArray(e)||0===e.length)throw new jy(By.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function JA(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(0<=t.indexOf(e.op))return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new jy(By.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new jy(By.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class XA{convertValue(e,t="none"){switch(Ob(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Cb(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Sb(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Vy()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,n="none"){const r={};return db(e,(e,t)=>{r[e]=this.convertValue(t,n)}),r}convertGeoPoint(e){return new cA(Cb(e.latitude),Cb(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":var n=Ab(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Nb(e));default:return null}}convertTimestamp(e){var t=Eb(e);return new nw(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=sw.fromString(e);qy(b0(n));const r=new Pb(n.get(1),n.get(3)),i=new cw(n.popFirst(5));return r.isEqual(t)||Ly(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function ZA(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class eN extends XA{constructor(e){super(),this.firestore=e}convertBytes(e){return new sA(e)}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new Mk(this.firestore,null,t)}}class tN{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class nN extends MA{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){var t=new rN(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){var n=this._document.data.field(FA("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class rN extends nN{data(e={}){return super.data(e)}}class iN{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new tN(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,n){this._snapshot.docs.forEach(e=>{t.call(n,new rN(this._firestore,this._userDataWriter,e.key,e,new tN(this._snapshot.mutatedKeys.has(e.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){var t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new jy(By.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,t){if(s._snapshot.oldDocs.isEmpty()){let n=0;return s._snapshot.docChanges.map(e=>{var t=new rN(s._firestore,s._userDataWriter,e.doc.key,e.doc,new tN(s._snapshot.mutatedKeys.has(e.doc.key),s._snapshot.fromCache),s.query.converter);return e.doc,{type:"added",doc:t,oldIndex:-1,newIndex:n++}})}{let i=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(e=>t||3!==e.type).map(e=>{var t=new rN(s._firestore,s._userDataWriter,e.doc.key,e.doc,new tN(s._snapshot.mutatedKeys.has(e.doc.key),s._snapshot.fromCache),s.query.converter);let n=-1,r=-1;return 0!==e.type&&(n=i.indexOf(e.doc.key),i=i.delete(e.doc.key)),1!==e.type&&(i=i.add(e.doc),r=i.indexOf(e.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Vy()}}(e.type),doc:t,oldIndex:n,newIndex:r}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function sN(e,t){return e instanceof nN&&t instanceof nN?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof iN&&t instanceof iN&&e._firestore===t._firestore&&qk(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}class aN extends XA{constructor(e){super(),this.firestore=e}convertBytes(e){return new sA(e)}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new Mk(this.firestore,null,t)}}function oN(t){t=Rk(t,Mk);const n=Rk(t.firestore,Yk),e=Jk(n),r=new aN(n);return function(e,t){const n=new zy;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const i=await function(e,t){const n=e;return n.persistence.runTransaction("read document","readonly",e=>n.localDocuments.getDocument(e,t))}(e,t);i.isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new jy(By.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){var r=vS(e,`Failed to get document '${t} from cache`);n.reject(r)}}(await mk(e),t,n)),n.promise}(e,t._key).then(e=>new nN(n,r,t._key,e,new tN(null!==e&&e.hasLocalMutations,!0),t.converter))}function cN(t){t=Rk(t,Ok);const n=Rk(t.firestore,Yk),e=Jk(n),r=new aN(n);return function(e,t){const n=new zy;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const i=await _C(e,t,!0),s=new xS(t,i.ls),a=s.ca(i.documents),o=s.applyChanges(a,!1);n.resolve(o.snapshot)}catch(e){var r=vS(e,`Failed to execute query '${t} against cache`);n.reject(r)}}(await mk(e),t,n)),n.promise}(e,t._query).then(e=>new iN(n,r,t,e))}function lN(e,t,n){e=Rk(e,Mk);var r=Rk(e.firestore,Yk),i=ZA(e.converter,t,n);return pN(r,[mA(gA(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,pT.none())])}function uN(e,t,n,...r){e=Rk(e,Mk);var i=Rk(e.firestore,Yk),s=gA(i);let a;return a="string"==typeof(t=oe(t))||t instanceof aA?EA(s,"updateDoc",e._key,t,n,r):TA(s,"updateDoc",e._key,t),pN(i,[a.toMutation(e._key,pT.exists(!0))])}function hN(t,...n){var e;t=oe(t);let r={includeMetadataChanges:!1},i=0;"object"!=typeof n[i]||jk(n[i])||(r=n[i],i++);var s={includeMetadataChanges:r.includeMetadataChanges};if(jk(n[i])){const t=n[i];n[i]=null===(e=t.next)||void 0===e?void 0:e.bind(t),n[i+1]=null===(e=t.error)||void 0===e?void 0:e.bind(t),n[i+2]=null===(e=t.complete)||void 0===e?void 0:e.bind(t)}let a,o,c;if(t instanceof Mk)o=Rk(t.firestore,Yk),c=NI(t._key.path),a={next:e=>{n[i]&&n[i](fN(o,t,e))},error:n[i+1],complete:n[i+2]};else{const l=Rk(t,Ok);o=Rk(l.firestore,Yk),c=l._query;const u=new aN(o);a={next:e=>{n[i]&&n[i](new iN(o,u,l,e))},error:n[i+1],complete:n[i+2]},UA(t._query)}return function(e,t,n,r){const i=new sk(r),s=new SS(t,i,n);return e.asyncQueue.enqueueAndForget(async()=>TS(await yk(e),s)),()=>{i.Na(),e.asyncQueue.enqueueAndForget(async()=>ES(await yk(e),s))}}(Jk(o),c,s,a)}function dN(e,t){return function(e,t){const n=new sk(t);return e.asyncQueue.enqueueAndForget(async()=>function(e,t){e.q_.add(t),t.next()}(await yk(e),n)),()=>{n.Na(),e.asyncQueue.enqueueAndForget(async()=>function(e,t){e.q_.delete(t)}(await yk(e),n))}}(Jk(e=Rk(e,Yk)),jk(t)?t:{next:t})}function pN(e,t){return function(e,t){const n=new zy;return e.asyncQueue.enqueueAndForget(async()=>US(await _k(e),t,n)),n.promise}(Jk(e),t)}function fN(e,t,n){var r=n.docs.get(t._key),i=new aN(e);return new nN(e,i,t._key,r,new tN(n.hasPendingWrites,n.fromCache),t.converter)}const gN={maxAttempts:5};class mN{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=gA(e)}set(e,t,n){this._verifyNotCommitted();const r=vN(e,this._firestore),i=ZA(r.converter,t,n),s=mA(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,pT.none())),this}update(e,t,n,...r){this._verifyNotCommitted();var i=vN(e,this._firestore);let s;return s="string"==typeof(t=oe(t))||t instanceof aA?EA(this._dataReader,"WriteBatch.update",i._key,t,n,r):TA(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(s.toMutation(i._key,pT.exists(!0))),this}delete(e){this._verifyNotCommitted();var t=vN(e,this._firestore);return this._mutations=this._mutations.concat(new CT(t._key,pT.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new jy(By.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function vN(e,t){if((e=oe(e)).firestore!==t)throw new jy(By.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class _N extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=gA(e)}get(e){const n=vN(e,this._firestore),r=new eN(this._firestore);return this._transaction.lookup([n._key]).then(e=>{if(!e||1!==e.length)return Vy();const t=e[0];if(t.isFoundDocument())return new MA(this._firestore,r,t.key,t,n.converter);if(t.isNoDocument())return new MA(this._firestore,r,n._key,null,n.converter);throw Vy()})}set(e,t,n){var r=vN(e,this._firestore),i=ZA(r.converter,t,n),i=mA(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,i),this}update(e,t,n,...r){var i=vN(e,this._firestore),s="string"==typeof(t=oe(t))||t instanceof aA?EA(this._dataReader,"Transaction.update",i._key,t,n,r):TA(this._dataReader,"Transaction.update",i._key,t);return this._transaction.update(i._key,s),this}delete(e){var t=vN(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=vN(e,this._firestore),n=new aN(this._firestore);return super.get(e).then(e=>new nN(this._firestore,n,t._key,e._document,new tN(!1,!1),t.converter))}}function yN(t,n,e){t=Rk(t,Yk);var r=Object.assign(Object.assign({},gN),e);return function(e){if(e.maxAttempts<1)throw new jy(By.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(t,n,r){const i=new zy;return t.asyncQueue.enqueueAndForget(async()=>{var e=await fk(t).then(e=>e.datastore);new ck(t.asyncQueue,e,r,n,i).run()}),i.promise}(Jk(t),e=>n(new _N(t,e)),r)}$k=!0,Kk=Je,Dy=Kk,Ge(new ce("firestore",(e,{instanceIdentifier:t,options:n})=>{const r=e.getProvider("app").getImmediate(),i=new Yk(new Gy(e.getProvider("auth-internal")),new Jy(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new jy(By.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Pb(e.options.projectId,t)}(r,t),r);return n=Object.assign({useFetchStreams:$k},n),i._setSettings(n),i},"PUBLIC").setMultipleInstances(!0)),tt(Ry,"4.4.0",aR),tt(Ry,"4.4.0","esm2017");function wN(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new jy("invalid-argument",`Invalid options passed to function ${e}(): You cannot `+'specify both "merge" and "mergeFields".');return t}function bN(){if("undefined"==typeof Uint8Array)throw new jy("unimplemented","Uint8Arrays are not available in this environment.")}function IN(){if("undefined"==typeof atob)throw new jy("unimplemented","Blobs are unavailable in Firestore in this environment.")}class TN{constructor(e){this._delegate=e}static fromBase64String(e){return IN(),new TN(sA.fromBase64String(e))}static fromUint8Array(e){return bN(),new TN(sA.fromUint8Array(e))}toBase64(){return IN(),this._delegate.toBase64()}toUint8Array(){return bN(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function EN(e){return function(e,t){if("object"!=typeof e||null===e)return;var n=e;for(const r of t)if(r in n&&"function"==typeof n[r])return 1;return}(e,["next","error","complete"])}class CN{enableIndexedDbPersistence(e,t){return function(e,t){iA(e=Rk(e,Yk));var n=Jk(e);if(n._uninitializedComponentsProvider)throw new jy(By.FAILED_PRECONDITION,"SDK cache is already specified.");Fy("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");var r=e._freezeSettings(),i=new rk;return Zk(n,i,new tk(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(e){iA(e=Rk(e,Yk));var t=Jk(e);if(t._uninitializedComponentsProvider)throw new jy(By.FAILED_PRECONDITION,"SDK cache is already specified.");Fy("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");var n=e._freezeSettings(),r=new rk;return Zk(t,r,new nk(r,n.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function(e){if(e._initialized&&!e._terminated)throw new jy(By.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new zy;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!Tw.D())return Promise.resolve();var t=e+"main";await Tw.delete(t)}(aC(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise}(e._delegate)}}class SN{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof Pb||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){var t=this._delegate._getSettings();e.merge||t.host===e.host||Fy("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){!function(n,e,t,r={}){var i;const s=(n=Rk(n,xk))._getSettings(),a=`${e}:${t}`;if("firestore.googleapis.com"!==s.host&&s.host!==a&&Fy("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),r.mockUserToken){let e,t;if("string"==typeof r.mockUserToken)e=r.mockUserToken,t=Py.MOCK_USER;else{e=w(r.mockUserToken,null===(i=n._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new jy(By.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t=new Py(s)}n._authCredentials=new Wy(new $y(e,t))}}(this._delegate,e,t,n)}enableNetwork(){return tA(this._delegate)}disableNetwork(){return nA(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,Sk("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return eA(this._delegate)}onSnapshotsInSync(e){return dN(this._delegate,e)}get app(){if(!this._appCompat)throw new jy("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new qN(this,Fk(this._delegate,e))}catch(e){throw DN(e,"collection()","Firestore.collection()")}}doc(e){try{return new PN(this,Uk(this._delegate,e))}catch(e){throw DN(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new FN(this,function(e,t){if(e=Rk(e,xk),Ck("collectionGroup","collection id",t),0<=t.indexOf("/"))throw new jy(By.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Ok(e,null,(t=t,new kI(sw.emptyPath(),t)))}(this._delegate,e))}catch(e){throw DN(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){return yN(this._delegate,e=>t(new AN(this,e)))}batch(){return Jk(this._delegate),new NN(new mN(this._delegate,e=>pN(this._delegate,e)))}loadBundle(e){return t=this._delegate,e=e,n=Jk(t=Rk(t,Yk)),r=new zk,Ik(n,t._databaseId,e,r),r;var t,n,r}namedQuery(e){return rA(this._delegate,e).then(e=>e?new FN(this,e):null)}}class kN extends XA{constructor(e){super(),this.firestore=e}convertBytes(e){return new TN(new sA(e))}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return PN.forKey(t,this.firestore,null)}}class AN{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new kN(e)}get(e){const t=BN(e);return this._delegate.get(t).then(e=>new MN(this._firestore,new nN(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter)))}set(e,t,n){var r=BN(e);return n?(wN("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){var i=BN(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){var t=BN(e);return this._delegate.delete(t),this}}class NN{constructor(e){this._delegate=e}set(e,t,n){var r=BN(e);return n?(wN("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){var i=BN(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){var t=BN(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class RN{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){var n=new rN(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new LN(this._firestore,n),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=RN.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let i=r.get(t);return i||(i=new RN(e,new kN(e),t),r.set(t,i)),i}}RN.INSTANCES=new WeakMap;class PN{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new kN(e)}static forPath(e,t,n){if(e.length%2!=0)throw new jy("invalid-argument","Invalid document reference. Document references must have an even number of segments, but "+`${e.canonicalString()} has ${e.length}`);return new PN(t,new Mk(t._delegate,n,new cw(e)))}static forKey(e,t,n){return new PN(t,new Mk(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new qN(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new qN(this.firestore,Fk(this._delegate,e))}catch(e){throw DN(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=oe(e))instanceof Mk&&Vk(this._delegate,e)}set(e,t){t=wN("DocumentReference.set",t);try{return t?lN(this._delegate,e,t):lN(this._delegate,e)}catch(e){throw DN(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?uN(this._delegate,e):uN(this._delegate,e,t,...n)}catch(e){throw DN(e,"updateDoc()","DocumentReference.update()")}}delete(){return pN(Rk((e=this._delegate).firestore,Yk),[new CT(e._key,pT.none())]);var e}onSnapshot(...e){var t=xN(e),n=ON(e,e=>new MN(this.firestore,new nN(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)));return hN(this._delegate,t,n)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?oN:"server"===(null==e?void 0:e.source)?function(t){t=Rk(t,Mk);const n=Rk(t.firestore,Yk);return wk(Jk(n),t._key,{source:"server"}).then(e=>fN(n,t,e))}:function(t){t=Rk(t,Mk);const n=Rk(t.firestore,Yk);return wk(Jk(n),t._key).then(e=>fN(n,t,e))})(this._delegate),t.then(e=>new MN(this.firestore,new nN(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)))}withConverter(e){return new PN(this.firestore,e?this._delegate.withConverter(RN.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function DN(e,t,n){return e.message=e.message.replace(t,n),e}function xN(e){for(const t of e)if("object"==typeof t&&!EN(t))return t;return{}}function ON(e,t){var n;let r;return r=EN(e[0])?e[0]:EN(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{r.next&&r.next(t(e))},error:null===(n=r.error)||void 0===n?void 0:n.bind(r),complete:null===(n=r.complete)||void 0===n?void 0:n.bind(r)}}class MN{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new PN(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return sN(this._delegate,e._delegate)}}class LN extends MN{data(e){var t=this._delegate.data(e);return this._delegate._converter||void 0!==t||Vy(),t}}class FN{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new kN(e)}where(e,t,n){try{return new FN(this.firestore,BA(this._delegate,(r=n,i=t,s=FA("where",e),jA._create(s,i,r))))}catch(e){throw DN(e,/(orderBy|where)\(\)/,"Query.$1()")}var r,i,s}orderBy(e,t){try{return new FN(this.firestore,BA(this._delegate,([n,r="asc"]=[e,t],i=r,s=FA("orderBy",n),$A._create(s,i))))}catch(e){throw DN(e,/(orderBy|where)\(\)/,"Query.$1()")}var n,r,i,s}limit(e){try{return new FN(this.firestore,BA(this._delegate,(Pk("limit",t=e),KA._create("limit",t,"F"))))}catch(e){throw DN(e,"limit()","Query.limit()")}var t}limitToLast(e){try{return new FN(this.firestore,BA(this._delegate,(Pk("limitToLast",t=e),KA._create("limitToLast",t,"L"))))}catch(e){throw DN(e,"limitToLast()","Query.limitToLast()")}var t}startAt(...e){try{return new FN(this.firestore,BA(this._delegate,function(...e){return WA._create("startAt",e,!0)}(...e)))}catch(e){throw DN(e,"startAt()","Query.startAt()")}}startAfter(...e){try{return new FN(this.firestore,BA(this._delegate,function(...e){return WA._create("startAfter",e,!1)}(...e)))}catch(e){throw DN(e,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new FN(this.firestore,BA(this._delegate,function(...e){return GA._create("endBefore",e,!1)}(...e)))}catch(e){throw DN(e,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new FN(this.firestore,BA(this._delegate,function(...e){return GA._create("endAt",e,!0)}(...e)))}catch(e){throw DN(e,"endAt()","Query.endAt()")}}isEqual(e){return qk(this._delegate,e._delegate)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?cN:"server"===(null==e?void 0:e.source)?function(t){t=Rk(t,Ok);const n=Rk(t.firestore,Yk),e=Jk(n),r=new aN(n);return bk(e,t._query,{source:"server"}).then(e=>new iN(n,r,t,e))}:function(t){t=Rk(t,Ok);const n=Rk(t.firestore,Yk),e=Jk(n),r=new aN(n);return UA(t._query),bk(e,t._query).then(e=>new iN(n,r,t,e))})(this._delegate),t.then(e=>new VN(this.firestore,new iN(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)))}onSnapshot(...e){var t=xN(e),n=ON(e,e=>new VN(this.firestore,new iN(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)));return hN(this._delegate,t,n)}withConverter(e){return new FN(this.firestore,e?this._delegate.withConverter(RN.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class UN{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new LN(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class VN{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new FN(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new LN(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(e=>new UN(this._firestore,e))}forEach(t,n){this._delegate.forEach(e=>{t.call(n,new LN(this._firestore,e))})}isEqual(e){return sN(this._delegate,e._delegate)}}class qN extends FN{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){var e=this._delegate.parent;return e?new PN(this.firestore,e):null}doc(e){try{return void 0===e?new PN(this.firestore,Uk(this._delegate)):new PN(this.firestore,Uk(this._delegate,e))}catch(e){throw DN(e,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=Rk(e.firestore,Yk),r=Uk(e),i=ZA(e.converter,t);return pN(n,[mA(gA(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,pT.exists(!1))]).then(()=>r)}(this._delegate,e).then(e=>new PN(this.firestore,e))}isEqual(e){return Vk(this._delegate,e._delegate)}withConverter(e){return new qN(this.firestore,e?this._delegate.withConverter(RN.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function BN(e){return Rk(e,Mk)}const jN={Firestore:SN,GeoPoint:cA,Timestamp:nw,Blob:TN,Transaction:AN,WriteBatch:NN,DocumentReference:PN,DocumentSnapshot:MN,Query:FN,QueryDocumentSnapshot:LN,QuerySnapshot:VN,CollectionReference:qN,FieldPath:class J1{constructor(...e){this._delegate=new aA(...e)}static documentId(){return new J1(ow.keyField().canonicalString())}isEqual(e){return(e=oe(e))instanceof aA&&this._delegate._internalPath.isEqual(e._internalPath)}},FieldValue:class X1{constructor(e){this._delegate=e}static serverTimestamp(){const e=new yA("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new X1(e)}static delete(){const e=new vA("deleteField");return e._methodName="FieldValue.delete",new X1(e)}static arrayUnion(...e){const t=function(...e){return new wA("arrayUnion",e)}(...e);return t._methodName="FieldValue.arrayUnion",new X1(t)}static arrayRemove(...e){const t=function(...e){return new bA("arrayRemove",e)}(...e);return t._methodName="FieldValue.arrayRemove",new X1(t)}static increment(e){const t=new IA("increment",e);return t._methodName="FieldValue.increment",new X1(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}},setLogLevel:function(e){e=e,xy.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};Wk=bt,Gk=(e,t)=>new SN(e,t,new CN),Wk.INTERNAL.registerComponent(new ce("firestore-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("firestore").getImmediate();return Gk(t,n)},"PUBLIC").setServiceProps(Object.assign({},jN))),Wk.registerVersion("@firebase/firestore-compat","0.3.23");const zN="type.googleapis.com/google.protobuf.Int64Value",$N="type.googleapis.com/google.protobuf.UInt64Value";function KN(e,t){const n={};for(const r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r]));return n}function WN(e){if(null==e)return e;if(e["@type"])switch(e["@type"]){case zN:case $N:var t=Number(e.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+e);return t;default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(e=>WN(e)):"function"==typeof e||"object"==typeof e?KN(e,e=>WN(e)):e}const GN="functions",HN={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class QN extends P{constructor(e,t,n){super(`${GN}/${e}`,t||""),this.details=n}}function YN(e,t){let n=function(e){if(200<=e&&e<300)return"ok";switch(e){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(e),r=n,i=void 0;try{var s=t&&t.error;if(s){const e=s.status;if("string"==typeof e){if(!HN[e])return new QN("internal","internal");n=HN[e],r=e}var a=s.message;"string"==typeof a&&(r=a),i=s.details,void 0!==i&&(i=WN(i))}}catch(e){}return"ok"===n?null:new QN(n,r,i)}class JN{constructor(e,t,n){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||e.get().then(e=>this.auth=e,()=>{}),this.messaging||t.get().then(e=>this.messaging=e,()=>{}),this.appCheck||n.get().then(e=>this.appCheck=e,()=>{})}async getAuthToken(){if(this.auth)try{var e=await this.auth.getToken();return null==e?void 0:e.accessToken}catch(e){return}}async getMessagingToken(){if(this.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return this.messaging.getToken()}catch(e){return}}async getAppCheckToken(e){if(this.appCheck){var t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){return{authToken:await this.getAuthToken(),messagingToken:await this.getMessagingToken(),appCheckToken:await this.getAppCheckToken(e)}}}const XN="us-central1";class ZN{constructor(e,t,n,r,i=XN,s){this.app=e,this.fetchImpl=s,this.emulatorOrigin=null,this.contextProvider=new JN(t,n,r),this.cancelAllRequests=new Promise(e=>{this.deleteService=()=>Promise.resolve(e())});try{var a=new URL(i);this.customDomain=a.origin,this.region=XN}catch(e){this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(e){var t=this.app.options.projectId;return null===this.emulatorOrigin?null!==this.customDomain?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`:`${this.emulatorOrigin}/${t}/${this.region}/${e}`}}function eR(i,s,a){return e=>{return t=e,n=a||{},r=(e=i)._url(s),tR(e,r,t,n);var t,n,r}}async function tR(e,t,n,r){var i={data:n=function t(e){if(null==e)return null;if("number"==typeof(e=e instanceof Number?e.valueOf():e)&&isFinite(e))return e;if(!0===e||!1===e)return e;if("[object String]"===Object.prototype.toString.call(e))return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(e=>t(e));if("function"==typeof e||"object"==typeof e)return KN(e,e=>t(e));throw new Error("Data cannot be encoded in JSON: "+e)}(n)};const s={};var a=await e.contextProvider.getContext(r.limitedUseAppCheckTokens);a.authToken&&(s.Authorization="Bearer "+a.authToken),a.messagingToken&&(s["Firebase-Instance-ID-Token"]=a.messagingToken),null!==a.appCheckToken&&(s["X-Firebase-AppCheck"]=a.appCheckToken);const o=function(n){let r=null;return{promise:new Promise((e,t)=>{r=setTimeout(()=>{t(new QN("deadline-exceeded","deadline-exceeded"))},n)}),cancel:()=>{r&&clearTimeout(r)}}}(r.timeout||7e4);a=await Promise.race([async function(e,t,n,r){n["Content-Type"]="application/json";let i;try{i=await r(e,{method:"POST",body:JSON.stringify(t),headers:n})}catch(e){return{status:0,json:null}}let s=null;try{s=await i.json()}catch(e){}return{status:i.status,json:s}}(t,i,s,e.fetchImpl),o.promise,e.cancelAllRequests]);if(o.cancel(),!a)throw new QN("cancelled","Firebase Functions instance was deleted.");i=YN(a.status,a.json);if(i)throw i;if(!a.json)throw new QN("internal","Response is not valid JSON object.");let c=a.json.data;if(void 0===c&&(c=a.json.result),void 0===c)throw new QN("internal","Response is missing data field.");return{data:WN(c)}}const nR="@firebase/functions";function rR(e,t,n){oe(e).emulatorOrigin=`http://${t}:${n}`}function iR(e,t,n){return r=oe(e),i=t,s=n,e=>tR(r,i,e,s||{});var r,i,s}Hk=fetch.bind(self),Ge(new ce(GN,(e,{instanceIdentifier:t})=>{var n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("messaging-internal"),s=e.getProvider("app-check-internal");return new ZN(n,r,i,s,t,Hk)},"PUBLIC").setMultipleInstances(!0)),tt(nR,"0.11.0",Qk),tt(nR,"0.11.0","esm2017");var sR,aR,oR,cR,lR;class uR{constructor(e,t){this.app=e,this._delegate=t,this._region=this._delegate.region,this._customDomain=this._delegate.customDomain}httpsCallable(e,t){return eR(oe(this._delegate),e,t)}httpsCallableFromURL(e,t){return iR(this._delegate,e,t)}useFunctionsEmulator(e){var t=e.match("[a-zA-Z]+://([a-zA-Z0-9.-]+)(?::([0-9]+))?");if(null==t)throw new P("functions","No origin provided to useFunctionsEmulator()");if(null==t[2])throw new P("functions","Port missing in origin provided to useFunctionsEmulator()");return rR(this._delegate,t[1],Number(t[2]))}useEmulator(e,t){return rR(this._delegate,e,t)}}const hR="us-central1",dR=(e,{instanceIdentifier:t})=>{var n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("functions").getImmediate({identifier:null!=t?t:hR});return new uR(n,r)};sR={Functions:uR},bt.INTERNAL.registerComponent(new ce("functions-compat",dR,"PUBLIC").setServiceProps(sR).setMultipleInstances(!0)),bt.registerVersion("@firebase/functions-compat","0.3.6");const pR="/firebase-messaging-sw.js",fR="/firebase-cloud-messaging-push-scope",gR="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",mR="https://fcmregistrations.googleapis.com/v1",vR="google.c.a.c_id",_R="google.c.a.e";function yR(e){var t=new Uint8Array(e);const n=btoa(String.fromCharCode(...t));return n.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(aR=xx=xx||{})[aR.DATA_MESSAGE=1]="DATA_MESSAGE",aR[aR.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION",(al=oR=oR||{}).PUSH_RECEIVED="push-received",al.NOTIFICATION_CLICKED="notification-clicked";const wR="fcm_token_details_db",bR="fcm_token_object_Store";async function IR(c){if("databases"in indexedDB){const t=await indexedDB.databases(),n=t.map(e=>e.name);if(!n.includes(wR))return null}let l=null;const e=await Pe(wR,5,{upgrade:async(e,t,n,r)=>{var i;if(!(t<2)&&e.objectStoreNames.contains(bR)){const o=r.objectStore(bR);var s,a=await o.index("fcmSenderId").get(c);await o.clear(),a&&(2===t?(s=a).auth&&s.p256dh&&s.endpoint&&(l={token:s.fcmToken,createTime:null!==(i=s.createTime)&&void 0!==i?i:Date.now(),subscriptionOptions:{auth:s.auth,p256dh:s.p256dh,endpoint:s.endpoint,swScope:s.swScope,vapidKey:"string"==typeof s.vapidKey?s.vapidKey:yR(s.vapidKey)}}):3===t?(s=a,l={token:s.fcmToken,createTime:s.createTime,subscriptionOptions:{auth:yR(s.auth),p256dh:yR(s.p256dh),endpoint:s.endpoint,swScope:s.swScope,vapidKey:yR(s.vapidKey)}}):4===t&&(a=a,l={token:a.fcmToken,createTime:a.createTime,subscriptionOptions:{auth:yR(a.auth),p256dh:yR(a.p256dh),endpoint:a.endpoint,swScope:a.swScope,vapidKey:yR(a.vapidKey)}}))}}});return e.close(),await De(wR),await De("fcm_vapid_details_db"),await De("undefined"),function(e){if(!e||!e.subscriptionOptions)return!1;var t=e["subscriptionOptions"];return"number"==typeof e.createTime&&0<e.createTime&&"string"==typeof e.token&&0<e.token.length&&"string"==typeof t.auth&&0<t.auth.length&&"string"==typeof t.p256dh&&0<t.p256dh.length&&"string"==typeof t.endpoint&&0<t.endpoint.length&&"string"==typeof t.swScope&&0<t.swScope.length&&"string"==typeof t.vapidKey&&0<t.vapidKey.length}(l)?l:null}const TR="firebase-messaging-database",ER=1,CR="firebase-messaging-store";let SR=null;function kR(){return SR=SR||Pe(TR,ER,{upgrade:(e,t)=>{0===t&&e.createObjectStore(CR)}}),SR}async function AR(e){var t=RR(e);const n=await kR();t=await n.transaction(CR).objectStore(CR).get(t);if(t)return t;t=await IR(e.appConfig.senderId);return t?(await NR(e,t),t):void 0}async function NR(e,t){var n=RR(e);const r=await kR(),i=r.transaction(CR,"readwrite");return await i.objectStore(CR).put(t,n),await i.done,t}function RR({appConfig:e}){return e.appId}const PR=new D("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});async function DR(e,t){var n={method:"DELETE",headers:await OR(e)};try{const s=await fetch(`${xR(e.appConfig)}/${t}`,n);var r=await s.json();if(r.error){var i=r.error.message;throw PR.create("token-unsubscribe-failed",{errorInfo:i})}}catch(e){throw PR.create("token-unsubscribe-failed",{errorInfo:null==e?void 0:e.toString()})}}function xR({projectId:e}){return`${mR}/projects/${e}/registrations`}async function OR({appConfig:e,installations:t}){var n=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${n}`})}function MR({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const i={web:{endpoint:n,auth:t,p256dh:e}};return r!==gR&&(i.web.applicationPubKey=r),i}const LR=6048e5;async function FR(e){const t=await async function(e,t){var n=await e.pushManager.getSubscription();if(n)return n;return e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/");const n=atob(t),r=new Uint8Array(n.length);for(let i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}(t)})}(e.swRegistration,e.vapidKey);var n,r,i,s,a,o={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:yR(t.getKey("auth")),p256dh:yR(t.getKey("p256dh"))},c=await AR(e.firebaseDependencies);if(c){if(n=c.subscriptionOptions,r=o.vapidKey===n.vapidKey,i=o.endpoint===n.endpoint,s=o.auth===n.auth,a=o.p256dh===n.p256dh,r&&i&&s&&a)return Date.now()>=c.createTime+LR?async function(t,e){try{var n=await async function(e,t){var n=await OR(e),r=MR(t.subscriptionOptions),r={method:"PATCH",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(`${xR(e.appConfig)}/${t.token}`,r);i=await s.json()}catch(e){throw PR.create("token-update-failed",{errorInfo:null==e?void 0:e.toString()})}if(i.error){r=i.error.message;throw PR.create("token-update-failed",{errorInfo:r})}if(!i.token)throw PR.create("token-update-no-token");return i.token}(t.firebaseDependencies,e),r=Object.assign(Object.assign({},e),{token:n,createTime:Date.now()});return await NR(t.firebaseDependencies,r),n}catch(e){throw await UR(t),e}}(e,{token:c.token,createTime:Date.now(),subscriptionOptions:o}):c.token;try{await DR(e.firebaseDependencies,c.token)}catch(e){console.warn(e)}return VR(e.firebaseDependencies,o)}return VR(e.firebaseDependencies,o)}async function UR(e){var t=await AR(e.firebaseDependencies);t&&(await DR(e.firebaseDependencies,t.token),await async function(e){var t=RR(e);const n=await kR(),r=n.transaction(CR,"readwrite");await r.objectStore(CR).delete(t),await r.done}(e.firebaseDependencies));const n=await e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()}async function VR(e,t){var n={token:await async function(e,t){var n=await OR(e),r=MR(t),r={method:"POST",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(xR(e.appConfig),r);i=await s.json()}catch(e){throw PR.create("token-subscribe-failed",{errorInfo:null==e?void 0:e.toString()})}if(i.error){r=i.error.message;throw PR.create("token-subscribe-failed",{errorInfo:r})}if(!i.token)throw PR.create("token-subscribe-no-token");return i.token}(e,t),createTime:Date.now(),subscriptionOptions:t};return await NR(e,n),n.token}function qR(e){var t,n,r,i,s,a={from:e.from,collapseKey:e.collapse_key,messageId:e.fcmMessageId};return r=a,(n=e).notification&&(r.notification={},(t=n.notification.title)&&(r.notification.title=t),(t=n.notification.body)&&(r.notification.body=t),(t=n.notification.image)&&(r.notification.image=t),(t=n.notification.icon)&&(r.notification.icon=t)),n=a,(r=e).data&&(n.data=r.data),r=a,((e=e).fcmOptions||null!==(i=e.notification)&&void 0!==i&&i.click_action)&&(r.fcmOptions={},(s=null!==(i=null===(i=e.fcmOptions)||void 0===i?void 0:i.link)&&void 0!==i?i:null===(s=e.notification)||void 0===s?void 0:s.click_action)&&(r.fcmOptions.link=s),(s=null===(s=e.fcmOptions)||void 0===s?void 0:s.analytics_label)&&(r.fcmOptions.analyticsLabel=s)),a}function BR(e,t){const n=[];for(let r=0;r<e.length;r++)n.push(e.charAt(r)),r<t.length&&n.push(t.charAt(r));return n.join("")}function jR(e){return PR.create("missing-app-config-values",{valueName:e})}BR("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),BR("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class zR{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;var r=function(e){if(!e||!e.options)throw jR("App Configuration Object");if(!e.name)throw jR("App Name");var t=e["options"];for(const n of["projectId","apiKey","appId","messagingSenderId"])if(!t[n])throw jR(n);return{appName:e.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}async function $R(e){try{e.swRegistration=await navigator.serviceWorker.register(pR,{scope:fR}),e.swRegistration.update().catch(()=>{})}catch(e){throw PR.create("failed-service-worker-registration",{browserErrorMessage:null==e?void 0:e.message})}}async function KR(e,t){if(!navigator)throw PR.create("only-available-in-window");if("default"===Notification.permission&&await Notification.requestPermission(),"granted"!==Notification.permission)throw PR.create("permission-blocked");var n,r;return n=e,await((r=null==t?void 0:t.vapidKey)?n.vapidKey=r:n.vapidKey||(n.vapidKey=gR)),await async function(e,t){if(t||e.swRegistration||await $R(e),t||!e.swRegistration){if(!(t instanceof ServiceWorkerRegistration))throw PR.create("invalid-sw-registration");e.swRegistration=t}}(e,null==t?void 0:t.serviceWorkerRegistration),FR(e)}async function WR(e,t,n){var r=function(e){switch(e){case oR.NOTIFICATION_CLICKED:return"notification_open";case oR.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}(t);const i=await e.firebaseDependencies.analyticsProvider.get();i.logEvent(r,{message_id:n[vR],message_name:n["google.c.a.c_l"],message_time:n["google.c.a.ts"],message_device_time:Math.floor(Date.now()/1e3)})}async function GR(e,t){var n,r=t.data;r.isFirebaseMessaging&&(e.onMessageHandler&&r.messageType===oR.PUSH_RECEIVED&&("function"==typeof e.onMessageHandler?e.onMessageHandler(qR(r)):e.onMessageHandler.next(qR(r))),n=r.data,"object"==typeof(t=n)&&t&&vR in t&&"1"===n[_R]&&await WR(e,r.messageType,n))}const HR="@firebase/messaging",QR=e=>{const t=new zR(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",e=>GR(t,e)),t},YR=e=>{const t=e.getProvider("messaging").getImmediate();return{getToken:e=>KR(t,e)}};function JR(e){return async function(e){if(!navigator)throw PR.create("only-available-in-window");return e.swRegistration||await $R(e),UR(e)}(e=oe(e))}function XR(e,t){return function(e,t){if(!navigator)throw PR.create("only-available-in-window");return e.onMessageHandler=t,()=>{e.onMessageHandler=null}}(e=oe(e),t)}Ge(new ce("messaging",QR,"PUBLIC")),Ge(new ce("messaging-internal",YR,"PRIVATE")),tt(HR,"0.12.5"),tt(HR,"0.12.5","esm2017");const ZR="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",eP="https://fcmregistrations.googleapis.com/v1",tP="FCM_MSG",nP="google.c.a.c_id",rP=3,iP=1;function sP(e){var t=new Uint8Array(e);const n=btoa(String.fromCharCode(...t));return n.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(al=cR=cR||{})[al.DATA_MESSAGE=1]="DATA_MESSAGE",al[al.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION",(al=lR=lR||{}).PUSH_RECEIVED="push-received",al.NOTIFICATION_CLICKED="notification-clicked";const aP="fcm_token_details_db",oP="fcm_token_object_Store";async function cP(c){if("databases"in indexedDB){const t=await indexedDB.databases(),n=t.map(e=>e.name);if(!n.includes(aP))return null}let l=null;const e=await Pe(aP,5,{upgrade:async(e,t,n,r)=>{var i;if(!(t<2)&&e.objectStoreNames.contains(oP)){const o=r.objectStore(oP);var s,a=await o.index("fcmSenderId").get(c);await o.clear(),a&&(2===t?(s=a).auth&&s.p256dh&&s.endpoint&&(l={token:s.fcmToken,createTime:null!==(i=s.createTime)&&void 0!==i?i:Date.now(),subscriptionOptions:{auth:s.auth,p256dh:s.p256dh,endpoint:s.endpoint,swScope:s.swScope,vapidKey:"string"==typeof s.vapidKey?s.vapidKey:sP(s.vapidKey)}}):3===t?(s=a,l={token:s.fcmToken,createTime:s.createTime,subscriptionOptions:{auth:sP(s.auth),p256dh:sP(s.p256dh),endpoint:s.endpoint,swScope:s.swScope,vapidKey:sP(s.vapidKey)}}):4===t&&(a=a,l={token:a.fcmToken,createTime:a.createTime,subscriptionOptions:{auth:sP(a.auth),p256dh:sP(a.p256dh),endpoint:a.endpoint,swScope:a.swScope,vapidKey:sP(a.vapidKey)}}))}}});return e.close(),await De(aP),await De("fcm_vapid_details_db"),await De("undefined"),function(e){if(!e||!e.subscriptionOptions)return!1;var t=e["subscriptionOptions"];return"number"==typeof e.createTime&&0<e.createTime&&"string"==typeof e.token&&0<e.token.length&&"string"==typeof t.auth&&0<t.auth.length&&"string"==typeof t.p256dh&&0<t.p256dh.length&&"string"==typeof t.endpoint&&0<t.endpoint.length&&"string"==typeof t.swScope&&0<t.swScope.length&&"string"==typeof t.vapidKey&&0<t.vapidKey.length}(l)?l:null}const lP="firebase-messaging-database",uP=1,hP="firebase-messaging-store";let dP=null;function pP(){return dP=dP||Pe(lP,uP,{upgrade:(e,t)=>{0===t&&e.createObjectStore(hP)}}),dP}async function fP(e){var t=mP(e);const n=await pP();t=await n.transaction(hP).objectStore(hP).get(t);if(t)return t;t=await cP(e.appConfig.senderId);return t?(await gP(e,t),t):void 0}async function gP(e,t){var n=mP(e);const r=await pP(),i=r.transaction(hP,"readwrite");return await i.objectStore(hP).put(t,n),await i.done,t}function mP({appConfig:e}){return e.appId}const vP=new D("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});async function _P(e,t){var n={method:"DELETE",headers:await wP(e)};try{const s=await fetch(`${yP(e.appConfig)}/${t}`,n);var r=await s.json();if(r.error){var i=r.error.message;throw vP.create("token-unsubscribe-failed",{errorInfo:i})}}catch(e){throw vP.create("token-unsubscribe-failed",{errorInfo:null==e?void 0:e.toString()})}}function yP({projectId:e}){return`${eP}/projects/${e}/registrations`}async function wP({appConfig:e,installations:t}){var n=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${n}`})}function bP({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const i={web:{endpoint:n,auth:t,p256dh:e}};return r!==ZR&&(i.web.applicationPubKey=r),i}async function IP(e){const t=await async function(e,t){var n=await e.pushManager.getSubscription();if(n)return n;return e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/");const n=atob(t),r=new Uint8Array(n.length);for(let i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}(t)})}(e.swRegistration,e.vapidKey);var n,r,i,s,a,o={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:sP(t.getKey("auth")),p256dh:sP(t.getKey("p256dh"))},c=await fP(e.firebaseDependencies);if(c){if(n=c.subscriptionOptions,r=o.vapidKey===n.vapidKey,i=o.endpoint===n.endpoint,s=o.auth===n.auth,a=o.p256dh===n.p256dh,r&&i&&s&&a)return Date.now()>=c.createTime+6048e5?async function(t,e){try{var n=await async function(e,t){var n=await wP(e),r=bP(t.subscriptionOptions),r={method:"PATCH",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(`${yP(e.appConfig)}/${t.token}`,r);i=await s.json()}catch(e){throw vP.create("token-update-failed",{errorInfo:null==e?void 0:e.toString()})}if(i.error){r=i.error.message;throw vP.create("token-update-failed",{errorInfo:r})}if(!i.token)throw vP.create("token-update-no-token");return i.token}(t.firebaseDependencies,e),r=Object.assign(Object.assign({},e),{token:n,createTime:Date.now()});return await gP(t.firebaseDependencies,r),n}catch(e){throw await TP(t),e}}(e,{token:c.token,createTime:Date.now(),subscriptionOptions:o}):c.token;try{await _P(e.firebaseDependencies,c.token)}catch(e){console.warn(e)}return EP(e.firebaseDependencies,o)}return EP(e.firebaseDependencies,o)}async function TP(e){var t=await fP(e.firebaseDependencies);t&&(await _P(e.firebaseDependencies,t.token),await async function(e){var t=mP(e);const n=await pP(),r=n.transaction(hP,"readwrite");await r.objectStore(hP).delete(t),await r.done}(e.firebaseDependencies));const n=await e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()}async function EP(e,t){var n={token:await async function(e,t){var n=await wP(e),r=bP(t),r={method:"POST",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(yP(e.appConfig),r);i=await s.json()}catch(e){throw vP.create("token-subscribe-failed",{errorInfo:null==e?void 0:e.toString()})}if(i.error){r=i.error.message;throw vP.create("token-subscribe-failed",{errorInfo:r})}if(!i.token)throw vP.create("token-subscribe-no-token");return i.token}(e,t),createTime:Date.now(),subscriptionOptions:t};return await gP(e,n),n.token}async function CP(e,t){var n=function(e,t){var n;const r={};e.from&&(r.project_number=e.from);e.fcmMessageId&&(r.message_id=e.fcmMessageId);r.instance_id=t,e.notification?r.message_type=cR.DISPLAY_NOTIFICATION.toString():r.message_type=cR.DATA_MESSAGE.toString();r.sdk_platform=rP.toString(),r.package_name=self.origin.replace(/(^\w+:|^)\/\//,""),e.collapse_key&&(r.collapse_key=e.collapse_key);r.event=iP.toString(),null!==(n=e.fcmOptions)&&void 0!==n&&n.analytics_label&&(r.analytics_label=null===(n=e.fcmOptions)||void 0===n?void 0:n.analytics_label);return r}(t,await e.firebaseDependencies.installations.getId());!function(e,t,n){const r={};r.event_time_ms=Math.floor(Date.now()).toString(),r.source_extension_json_proto3=JSON.stringify(t),n&&(r.compliance_data=function(e){var t={privacy_context:{prequest:{origin_associated_product_id:e}}};return t}(n));e.logEvents.push(r)}(e,n,t.productId)}function SP(e,t){const n=[];for(let r=0;r<e.length;r++)n.push(e.charAt(r)),r<t.length&&n.push(t.charAt(r));return n.join("")}async function kP(e,t){var n=function({data:e}){if(!e)return null;try{return e.json()}catch(e){return null}}(e);if(n){t.deliveryMetricsExportedToBigQueryEnabled&&await CP(t,n);var r,i,s,a,o=await NP();if(o.some(e=>"visible"===e.visibilityState&&!e.url.startsWith("chrome-extension://")))return function(e,t){t.isFirebaseMessaging=!0,t.messageType=lR.PUSH_RECEIVED;for(const n of e)n.postMessage(t)}(o,n);n.notification&&await function(e){var t=e["actions"],n=Notification["maxActions"];t&&n&&t.length>n&&console.warn(`This browser only supports ${n} actions. The remaining actions will not be displayed.`);return self.registration.showNotification(null!==(n=e.title)&&void 0!==n?n:"",e)}(function(e){const t=Object.assign({},e.notification);return t.data={[tP]:e},t}(n)),t&&t.onBackgroundMessageHandler&&(a={from:(r=n).from,collapseKey:r.collapse_key,messageId:r.fcmMessageId},o=a,(e=r).notification&&(o.notification={},(n=e.notification.title)&&(o.notification.title=n),(n=e.notification.body)&&(o.notification.body=n),(n=e.notification.image)&&(o.notification.image=n),(n=e.notification.icon)&&(o.notification.icon=n)),e=a,(o=r).data&&(e.data=o.data),o=a,((r=r).fcmOptions||null!==(i=r.notification)&&void 0!==i&&i.click_action)&&(o.fcmOptions={},(s=null!==(i=null===(i=r.fcmOptions)||void 0===i?void 0:i.link)&&void 0!==i?i:null===(s=r.notification)||void 0===s?void 0:s.click_action)&&(o.fcmOptions.link=s),(s=null===(s=r.fcmOptions)||void 0===s?void 0:s.analytics_label)&&(o.fcmOptions.analyticsLabel=s)),a=a,"function"==typeof t.onBackgroundMessageHandler?await t.onBackgroundMessageHandler(a):t.onBackgroundMessageHandler.next(a))}}async function AP(e){const t=null===(s=null===(i=e.notification)||void 0===i?void 0:i.data)||void 0===s?void 0:s[tP];if(t&&!e.action){e.stopImmediatePropagation(),e.notification.close();var n=function(e){var t;var n=null!==(t=null===(t=e.fcmOptions)||void 0===t?void 0:t.link)&&void 0!==t?t:null===(n=e.notification)||void 0===n?void 0:n.click_action;if(n)return n;return function(e){return"object"==typeof e&&e&&nP in e}(e.data)?self.location.origin:null}(t);if(n){var r,i=new URL(n,self.location.href),s=new URL(self.location.origin);if(i.host===s.host){let e=await async function(e){var t=await NP();for(const r of t){var n=new URL(r.url,self.location.href);if(e.host===n.host)return r}return null}(i);if(e?e=await e.focus():(e=await self.clients.openWindow(n),r=3e3,await new Promise(e=>{setTimeout(e,r)})),e)return t.messageType=lR.NOTIFICATION_CLICKED,t.isFirebaseMessaging=!0,e.postMessage(t)}}}}function NP(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function RP(e){return vP.create("missing-app-config-values",{valueName:e})}SP("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),SP("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class PP{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;var r=function(e){if(!e||!e.options)throw RP("App Configuration Object");if(!e.name)throw RP("App Name");var t=e["options"];for(const n of["projectId","apiKey","appId","messagingSenderId"])if(!t[n])throw RP(n);return{appName:e.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}const DP=e=>{const t=new PP(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return self.addEventListener("push",e=>{e.waitUntil(kP(e,t))}),self.addEventListener("pushsubscriptionchange",e=>{e.waitUntil(async function(e,t){var n;(n=e["newSubscription"])?(n=await fP(t.firebaseDependencies),await TP(t),t.vapidKey=null!==(n=null===(n=null==n?void 0:n.subscriptionOptions)||void 0===n?void 0:n.vapidKey)&&void 0!==n?n:ZR,await IP(t)):await TP(t)}(e,t))}),self.addEventListener("notificationclick",e=>{e.waitUntil(AP(e))}),t};function xP(e,t){return function(e,t){if(void 0!==self.document)throw vP.create("only-available-in-sw");return e.onBackgroundMessageHandler=t,()=>{e.onBackgroundMessageHandler=null}}(e=oe(e),t)}Ge(new ce("messaging-sw",DP,"PUBLIC"));var OP,MP,LP,FP;class UP{constructor(e,t){this.app=e,this._delegate=t,this.app=e,this._delegate=t}async getToken(e){return async function(e,t){return KR(e=oe(e),t)}(this._delegate,e)}async deleteToken(){return JR(this._delegate)}onMessage(e){return XR(this._delegate,e)}onBackgroundMessage(e){return xP(this._delegate,e)}}const VP=e=>self&&"ServiceWorkerGlobalScope"in self?new UP(e.getProvider("app-compat").getImmediate(),e.getProvider("messaging-sw").getImmediate()):new UP(e.getProvider("app-compat").getImmediate(),e.getProvider("messaging").getImmediate()),qP={isSupported:function(){return self&&"ServiceWorkerGlobalScope"in self?A()&&"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):"undefined"!=typeof window&&A()&&R()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}};bt.INTERNAL.registerComponent(new ce("messaging-compat",VP,"PUBLIC").setServiceProps(qP)),bt.registerVersion("@firebase/messaging-compat","0.2.5");const BP="firebasestorage.googleapis.com",jP="storageBucket";class zP extends P{constructor(e,t,n=0){super($P(e),`Firebase Storage: ${t} (${$P(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,zP.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return $P(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}function $P(e){return"storage/"+e}function KP(){return new zP(OP.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function WP(){return new zP(OP.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function GP(){return new zP(OP.CANCELED,"User canceled the upload/download.")}function HP(){return new zP(OP.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function QP(e){return new zP(OP.INVALID_ARGUMENT,e)}function YP(){return new zP(OP.APP_DELETED,"The Firebase app was deleted.")}function JP(e){return new zP(OP.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function XP(e,t){return new zP(OP.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function ZP(e){throw new zP(OP.INTERNAL_ERROR,"Internal error: "+e)}(Tt=OP=OP||{}).UNKNOWN="unknown",Tt.OBJECT_NOT_FOUND="object-not-found",Tt.BUCKET_NOT_FOUND="bucket-not-found",Tt.PROJECT_NOT_FOUND="project-not-found",Tt.QUOTA_EXCEEDED="quota-exceeded",Tt.UNAUTHENTICATED="unauthenticated",Tt.UNAUTHORIZED="unauthorized",Tt.UNAUTHORIZED_APP="unauthorized-app",Tt.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",Tt.INVALID_CHECKSUM="invalid-checksum",Tt.CANCELED="canceled",Tt.INVALID_EVENT_NAME="invalid-event-name",Tt.INVALID_URL="invalid-url",Tt.INVALID_DEFAULT_BUCKET="invalid-default-bucket",Tt.NO_DEFAULT_BUCKET="no-default-bucket",Tt.CANNOT_SLICE_BLOB="cannot-slice-blob",Tt.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",Tt.NO_DOWNLOAD_URL="no-download-url",Tt.INVALID_ARGUMENT="invalid-argument",Tt.INVALID_ARGUMENT_COUNT="invalid-argument-count",Tt.APP_DELETED="app-deleted",Tt.INVALID_ROOT_OPERATION="invalid-root-operation",Tt.INVALID_FORMAT="invalid-format",Tt.INTERNAL_ERROR="internal-error",Tt.UNSUPPORTED_ENVIRONMENT="unsupported-environment";class eD{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o"}static makeFromBucketSpec(t,e){let n;try{n=eD.makeFromUrl(t,e)}catch(e){return new eD(t,"")}if(""===n.path)return n;throw t=t,new zP(OP.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}static makeFromUrl(e,t){let n=null;var r="([A-Za-z0-9.\\-_]+)";var i=new RegExp("^gs://"+r+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}var a=t.replace(/[.]/g,"\\."),o=new RegExp(`^https?://${a}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),a=t===BP?"(?:storage.googleapis.com|storage.cloud.google.com)":t,c=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:o,indices:{bucket:1,path:3},postModify:s},{regex:new RegExp(`^https?://${a}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let h=0;h<c.length;h++){const d=c[h];var l=d.regex.exec(e);if(l){var u=l[d.indices.bucket];let e=l[d.indices.path];e=e||"",n=new eD(u,e),d.postModify(n);break}}if(null==n)throw t=e,new zP(OP.INVALID_URL,"Invalid URL '"+t+"'.");return n}}class tD{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=0){}}function nD(e){return"string"==typeof e||e instanceof String}function rD(e){return iD()&&e instanceof Blob}function iD(){return"undefined"!=typeof Blob}function sD(e,t,n,r){if(r<t)throw QP(`Invalid value for '${e}'. Expected ${t} or greater.`);if(n<r)throw QP(`Invalid value for '${e}'. Expected ${n} or less.`)}function aD(e,t,n){let r=null==n?`https://${t}`:t;return`${n}://${r}/v0${e}`}function oD(e){const t=encodeURIComponent;let n="?";for(const i in e){var r;e.hasOwnProperty(i)&&(r=t(i)+"="+t(e[i]),n=n+r+"&")}return n=n.slice(0,-1),n}function cD(e,t){var n=500<=e&&e<600,r=-1!==[408,429].indexOf(e),i=-1!==t.indexOf(e);return n||r||i}(Tt=MP=MP||{})[Tt.NO_ERROR=0]="NO_ERROR",Tt[Tt.NETWORK_ERROR=1]="NETWORK_ERROR",Tt[Tt.ABORT=2]="ABORT";class lD{constructor(e,t,n,r,i,s,a,o,c,l,u,h=!0){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=a,this.errorCallback_=o,this.timeout_=c,this.progressCallback_=l,this.connectionFactory_=u,this.retry=h,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){var e=(n,e)=>{if(e)n(!1,new uD(!1,null,!0));else{const r=this.connectionFactory_();this.pendingConnection_=r;const i=e=>{var t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&r.addUploadProgressListener(i),r.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&r.removeUploadProgressListener(i),this.pendingConnection_=null;var e=r.getErrorCode()===MP.NO_ERROR,t=r.getStatus();!e||cD(t,this.additionalRetryCodes_)&&this.retry?(e=r.getErrorCode()===MP.ABORT,n(!1,new uD(!1,null,e))):(t=-1!==this.successCodes_.indexOf(t),n(!0,new uD(t,r)))})}},t=(e,t)=>{const n=this.resolve_,r=this.reject_,i=t.connection;if(t.wasSuccessCode)try{var s=this.callback_(i,i.getResponse());void 0!==s?n(s):n()}catch(e){r(e)}else if(null!==i){const o=KP();o.serverResponse=i.getErrorText(),this.errorCallback_?r(this.errorCallback_(i,o)):r(o)}else{var a;t.canceled?(a=(this.appDelete_?YP:GP)(),r(a)):(a=WP(),r(a))}};this.canceled_?t(0,new uD(!1,null,!0)):this.backoffId_=function(t,n,e){let r=1,i=null,s=null,a=!1,o=0;function c(){return 2===o}let l=!1;function u(...e){l||(l=!0,n.apply(null,e))}function h(e){i=setTimeout(()=>{i=null,t(p,c())},e)}function d(){s&&clearTimeout(s)}function p(t,...n){if(l)d();else{if(t)return d(),void u.call(null,t,...n);if(c()||a)return d(),void u.call(null,t,...n);r<64&&(r*=2);let e;e=1===o?(o=2,0):1e3*(r+Math.random()),h(e)}}let f=!1;function g(e){f||(f=!0,d(),l||(null!==i?(e||(o=2),clearTimeout(i),h(0)):e||(o=1)))}return h(0),s=setTimeout(()=>{g(a=!0)},e),g}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class uD{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function hD(...t){const n="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==n){const r=new n;for(let e=0;e<t.length;e++)r.append(t[e]);return r.getBlob()}if(iD())return new Blob(t);throw new zP(OP.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}function dD(e){if("undefined"==typeof atob)throw new zP(OP.UNSUPPORTED_ENVIRONMENT,"base-64 is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.");return atob(e)}const pD={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class fD{constructor(e,t){this.data=e,this.contentType=t||null}}function gD(e,t){switch(e){case pD.RAW:return new fD(mD(t));case pD.BASE64:case pD.BASE64URL:return new fD(vD(e,t));case pD.DATA_URL:return new fD((n=t,(r=new _D(n)).base64?vD(pD.BASE64,r.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(e){throw XP(pD.DATA_URL,"Malformed data URL.")}return mD(t)}(r.rest)),(n=t,new _D(n).contentType))}var n,r;throw KP()}function mD(t){const n=[];for(let s=0;s<t.length;s++){let e=t.charCodeAt(s);var r,i;e<=127?n.push(e):e<=2047?n.push(192|e>>6,128|63&e):55296==(64512&e)?s<t.length-1&&56320==(64512&t.charCodeAt(s+1))?(r=e,i=t.charCodeAt(++s),e=65536|(1023&r)<<10|1023&i,n.push(240|e>>18,128|e>>12&63,128|e>>6&63,128|63&e)):n.push(239,191,189):56320==(64512&e)?n.push(239,191,189):n.push(224|e>>12,128|e>>6&63,128|63&e)}return new Uint8Array(n)}function vD(t,e){switch(t){case pD.BASE64:var n=-1!==e.indexOf("-"),r=-1!==e.indexOf("_");if(n||r)throw XP(t,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case pD.BASE64URL:r=-1!==e.indexOf("+"),n=-1!==e.indexOf("/");if(r||n)throw XP(t,"Invalid character '"+(r?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/")}let i;try{i=dD(e)}catch(e){if(e.message.includes("polyfill"))throw e;throw XP(t,"Invalid character found")}const s=new Uint8Array(i.length);for(let a=0;a<i.length;a++)s[a]=i.charCodeAt(a);return s}class _D{constructor(e){this.base64=!1,this.contentType=null;var t,n,r=e.match(/^data:([^,]+)?,/);if(null===r)throw XP(pD.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const i=r[1]||null;null!=i&&(this.base64=(t=i,n=";base64",t.length>=n.length&&t.substring(t.length-n.length)===n),this.contentType=this.base64?i.substring(0,i.length-";base64".length):i),this.rest=e.substring(e.indexOf(",")+1)}}class yD{constructor(e,t){let n=0,r="";rD(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(rD(this.data_)){var n=this.data_,n=(i=e,s=t,(r=n).webkitSlice?r.webkitSlice(i,s):r.mozSlice?r.mozSlice(i,s):r.slice?r.slice(i,s):null);return null===n?null:new yD(n)}var r,i,s,n=new Uint8Array(this.data_.buffer,e,t-e);return new yD(n,!0)}static getBlob(...e){if(iD()){var t=e.map(e=>e instanceof yD?e.data_:e);return new yD(hD.apply(null,t))}{const r=e.map(e=>nD(e)?gD(pD.RAW,e).data:e.data_);let t=0;r.forEach(e=>{t+=e.byteLength});const i=new Uint8Array(t);let n=0;return r.forEach(e=>{for(let t=0;t<e.length;t++)i[n++]=e[t]}),new yD(i,!0)}}uploadData(){return this.data_}}function wD(e){let t;try{t=JSON.parse(e)}catch(e){return null}return"object"!=typeof(e=t)||Array.isArray(e)?null:t}function bD(e){var t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function ID(e,t){return t}class TD{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||ID}}let ED=null;function CD(){if(ED)return ED;const e=[];e.push(new TD("bucket")),e.push(new TD("generation")),e.push(new TD("metageneration")),e.push(new TD("name","fullPath",!0));const t=new TD("name");t.xform=function(e,t){return!nD(t=t)||t.length<2?t:bD(t)},e.push(t);const n=new TD("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new TD("timeCreated")),e.push(new TD("updated")),e.push(new TD("md5Hash",null,!0)),e.push(new TD("cacheControl",null,!0)),e.push(new TD("contentDisposition",null,!0)),e.push(new TD("contentEncoding",null,!0)),e.push(new TD("contentLanguage",null,!0)),e.push(new TD("contentType",null,!0)),e.push(new TD("metadata","customMetadata",!0)),ED=e,ED}function SD(n,r){Object.defineProperty(n,"ref",{get:function(){var e=n.bucket,t=n.fullPath,t=new eD(e,t);return r._makeStorageReference(t)}})}function kD(e,t,n){var r=wD(t);return null===r?null:function(e,t,n){const r={type:"file"};var i=n.length;for(let s=0;s<i;s++){const a=n[s];r[a.local]=a.xform(r,t[a.server])}return SD(r,e),r}(e,r,n)}function AD(e,t){const n={};var r=t.length;for(let s=0;s<r;s++){var i=t[s];i.writable&&(n[i.server]=e[i.local])}return JSON.stringify(n)}const ND="prefixes";function RD(e,t,n){var r=wD(n);return null===r?null:function(e,t,n){const r={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n[ND])for(const a of n[ND]){var i=a.replace(/\/$/,""),i=e._makeStorageReference(new eD(t,i));r.prefixes.push(i)}if(n.items)for(const o of n.items){var s=e._makeStorageReference(new eD(t,o.name));r.items.push(s)}return r}(e,t,r)}class PD{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function DD(e){if(!e)throw KP()}function xD(r,i){return function(e,t){var n=kD(r,t,i);return DD(null!==n),n}}function OD(r,i){return function(e,t){var n=RD(r,i,t);return DD(null!==n),n}}function MD(r,i){return function(e,t){var n=kD(r,t,i);return DD(null!==n),function(r,e,i,s){var t=wD(e);if(null===t)return null;if(!nD(t.downloadTokens))return null;const n=t.downloadTokens;if(0===n.length)return null;const a=encodeURIComponent,o=n.split(",");return o.map(e=>{var t=r.bucket,n=r.fullPath;return aD("/b/"+a(t)+"/o/"+a(n),i,s)+oD({alt:"media",token:e})})[0]}(n,t,r.host,r._protocol)}}function LD(i){return function(e,t){let n;var r;return n=401===e.getStatus()?e.getErrorText().includes("Firebase App Check token is invalid")?new zP(OP.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new zP(OP.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?(r=i.bucket,new zP(OP.QUOTA_EXCEEDED,"Quota for bucket '"+r+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===e.getStatus()?(r=i.path,new zP(OP.UNAUTHORIZED,"User does not have permission to access '"+r+"'.")):t,n.status=e.getStatus(),n.serverResponse=t.serverResponse,n}}function FD(r){const i=LD(r);return function(e,t){let n=i(e,t);return 404===e.getStatus()&&(n=(e=r.path,new zP(OP.OBJECT_NOT_FOUND,"Object '"+e+"' does not exist."))),n.serverResponse=t.serverResponse,n}}function UD(e,t,n){var r=aD(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime;const s=new PD(r,"GET",xD(e,n),i);return s.errorHandler=FD(t),s}function VD(e,t,n){const r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=(e=t,(t=null)&&t.contentType||e&&e.type()||"application/octet-stream")),r}function qD(e,t,n,r,i){var s=t.bucketOnlyServerUrl();const a={"X-Goog-Upload-Protocol":"multipart"};var o=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();a["Content-Type"]="multipart/related; boundary="+o;var c=VD(t,r,i),l="--"+o+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+AD(c,n)+"\r\n--"+o+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",o="\r\n--"+o+"--";const u=yD.getBlob(l,r,o);if(null===u)throw HP();o={name:c.fullPath},c=aD(s,e.host,e._protocol),s=e.maxUploadRetryTime;const h=new PD(c,"POST",xD(e,n),s);return h.urlParams=o,h.headers=a,h.body=u.uploadData(),h.errorHandler=LD(t),h}class BD{constructor(e,t,n,r){this.current=e,this.total=t,this.finalized=!!n,this.metadata=r||null}}function jD(e,t){let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Status")}catch(e){DD(!1)}const r=t||["active"];return DD(!!n&&-1!==r.indexOf(n)),n}function zD(e,t,n,r,i){var s=t.bucketOnlyServerUrl(),a=VD(t,r,i),o={name:a.fullPath},c=aD(s,e.host,e._protocol),l={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":a.contentType,"Content-Type":"application/json; charset=utf-8"},s=AD(a,n),a=e.maxUploadRetryTime;const u=new PD(c,"POST",function(e){jD(e);let t;try{t=e.getResponseHeader("X-Goog-Upload-URL")}catch(e){DD(!1)}return DD(nD(t)),t},a);return u.urlParams=o,u.headers=l,u.body=s,u.errorHandler=LD(t),u}function $D(e,t,n,i){var r=e.maxUploadRetryTime;const s=new PD(n,"POST",function(e){var t=jD(e,["active","final"]);let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(e){DD(!1)}n||DD(!1);var r=Number(n);return DD(!isNaN(r)),new BD(r,i.size(),"final"===t)},r);return s.headers={"X-Goog-Upload-Command":"query"},s.errorHandler=LD(t),s}function KD(e,a,t,o,n,c,r,i){const l=new BD(0,0);if(r?(l.current=r.current,l.total=r.total):(l.current=0,l.total=o.size()),o.size()!==l.total)throw new zP(OP.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");var s=l.total-l.current;let u=s;0<n&&(u=Math.min(u,n));var h=l.current,d=h+u;let p="";p=0===u?"finalize":s===u?"upload, finalize":"upload";s={"X-Goog-Upload-Command":p,"X-Goog-Upload-Offset":`${l.current}`};const f=o.slice(h,d);if(null===f)throw HP();d=a.maxUploadRetryTime;const g=new PD(t,"POST",function(e,t){var n=jD(e,["active","final"]),r=l.current+u,i=o.size();let s;return s="final"===n?xD(a,c)(e,t):null,new BD(r,i,"final"===n,s)},d);return g.headers=s,g.body=f.uploadData(),g.progressCallback=i||null,g.errorHandler=LD(e),g}const WD={STATE_CHANGED:"state_changed"},GD={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function HD(e){switch(e){case"running":case"pausing":case"canceling":return GD.RUNNING;case"paused":return GD.PAUSED;case"success":return GD.SUCCESS;case"canceled":return GD.CANCELED;default:return GD.ERROR}}class QD{constructor(e,t,n){var r;"function"==typeof e||null!=t||null!=n?(this.next=e,this.error=null!=t?t:void 0,this.complete=null!=n?n:void 0):(this.next=(r=e).next,this.error=r.error,this.complete=r.complete)}}function YD(t){return(...e)=>{Promise.resolve().then(()=>t(...e))}}class JD extends class{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=MP.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=MP.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=MP.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,n,r){if(this.sent_)throw ZP("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==r)for(const i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw ZP("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw ZP("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponse(){if(!this.sent_)throw ZP("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw ZP("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}{initXhr(){this.xhr_.responseType="text"}}function XD(){return new JD}class ZD{constructor(e,t,n=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=n,this._mappings=CD(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=e=>{if(this._request=void 0,this._chunkMultiplier=1,e._codeEquals(OP.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{var t=this.isExponentialBackoffExpired();if(cD(e.status,[])){if(!t)return this.sleepTime=Math.max(2*this.sleepTime,1e3),this._needToFetchStatus=!0,void this.completeTransitions_();e=WP()}this._error=e,this._transition("error")}},this._metadataErrorHandler=e=>{this._request=void 0,e._codeEquals(OP.CANCELED)?this.completeTransitions_():(this._error=e,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t,this._start()}),this._promise.then(null,()=>{})}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){const t=this._transferred;return e=>this._updateProgress(t+e)}_shouldDoResumable(e){return 262144<e.size()}_start(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(n){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([e,t])=>{switch(this._state){case"running":n(e,t);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused")}})}_createResumable(){this._resolveToken((e,t)=>{var n=zD(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata);const r=this._ref.storage._makeRequest(n,XD,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._uploadUrl=e,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const i=this._uploadUrl;this._resolveToken((e,t)=>{var n=$D(this._ref.storage,this._ref._location,i,this._blob);const r=this._ref.storage._makeRequest(n,XD,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._updateProgress(e.current),this._needToFetchStatus=!1,e.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const i=262144*this._chunkMultiplier,s=new BD(this._transferred,this._blob.size()),a=this._uploadUrl;this._resolveToken((e,t)=>{let n;try{n=KD(this._ref._location,this._ref.storage,a,this._blob,i,this._mappings,s,this._makeProgressCallback())}catch(e){return this._error=e,void this._transition("error")}const r=this._ref.storage._makeRequest(n,XD,e,t,!1);this._request=r,r.getPromise().then(e=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(e.current),e.finalized?(this._metadata=e.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){2*(262144*this._chunkMultiplier)<33554432&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,t)=>{var n=UD(this._ref.storage,this._ref._location,this._mappings);const r=this._ref.storage._makeRequest(n,XD,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._metadata=e,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,t)=>{var n=qD(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata);const r=this._ref.storage._makeRequest(n,XD,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._metadata=e,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){var t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,void 0!==this._request?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":var t="paused"===this._state;this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=GP(),this._state=e,this._notifyObservers();break;case"error":case"success":this._state=e,this._notifyObservers()}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}}get snapshot(){var e=HD(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,n,r){const i=new QD(t||void 0,n||void 0,r||void 0);return this._addObserver(i),()=>{this._removeObserver(i)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){var t=this._observers.indexOf(e);-1!==t&&this._observers.splice(t,1)}_notifyObservers(){this._finishPromise();const e=this._observers.slice();e.forEach(e=>{this._notifyObserver(e)})}_finishPromise(){if(void 0!==this._resolve){let e=!0;switch(HD(this._state)){case GD.SUCCESS:YD(this._resolve.bind(null,this.snapshot))();break;case GD.CANCELED:case GD.ERROR:const t=this._reject;YD(t.bind(null,this._error))();break;default:e=!1}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(HD(this._state)){case GD.RUNNING:case GD.PAUSED:e.next&&YD(e.next.bind(e,this.snapshot))();break;case GD.SUCCESS:e.complete&&YD(e.complete.bind(e))();break;case GD.CANCELED:case GD.ERROR:default:e.error&&YD(e.error.bind(e,this._error))()}}resume(){var e="paused"===this._state||"pausing"===this._state;return e&&this._transition("running"),e}pause(){var e="running"===this._state;return e&&this._transition("pausing"),e}cancel(){var e="running"===this._state||"pausing"===this._state;return e&&this._transition("canceling"),e}}class ex{constructor(e,t){this._service=e,t instanceof eD?this._location=t:this._location=eD.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new ex(e,t)}get root(){var e=new eD(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return bD(this._location.path)}get storage(){return this._service}get parent(){var e=function(e){if(0===e.length)return null;var t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;e=new eD(this._location.bucket,e);return new ex(this._service,e)}_throwIfRoot(e){if(""===this._location.path)throw JP(e)}}function tx(e){const t={prefixes:[],items:[]};return async function e(t,n,r){const i={pageToken:r};const s=await nx(t,i);n.prefixes.push(...s.prefixes);n.items.push(...s.items);null!=s.nextPageToken&&await e(t,n,s.nextPageToken)}(e,t).then(()=>t)}function nx(e,t){null!=t&&"number"==typeof t.maxResults&&sD("options.maxResults",1,1e3,t.maxResults);var n=t||{},n=function(e,t,n,r,i){const s={};t.isRoot?s.prefix="":s.prefix=t.path+"/",n&&0<n.length&&(s.delimiter=n),r&&(s.pageToken=r),i&&(s.maxResults=i);var a=aD(t.bucketOnlyServerUrl(),e.host,e._protocol),o=e.maxOperationRetryTime;const c=new PD(a,"GET",OD(e,t.bucket),o);return c.urlParams=s,c.errorHandler=LD(t),c}(e.storage,e._location,"/",n.pageToken,n.maxResults);return e.storage.makeRequestWithTokens(n,XD)}function rx(e,t){e._throwIfRoot("updateMetadata");var n=function(e,t,n,r){var i=aD(t.fullServerUrl(),e.host,e._protocol),s=AD(n,r),a=e.maxOperationRetryTime;const o=new PD(i,"PATCH",xD(e,r),a);return o.headers={"Content-Type":"application/json; charset=utf-8"},o.body=s,o.errorHandler=FD(t),o}(e.storage,e._location,t,CD());return e.storage.makeRequestWithTokens(n,XD)}function ix(e){e._throwIfRoot("getDownloadURL");var t=function(e,t,n){var r=aD(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime;const s=new PD(r,"GET",MD(e,n),i);return s.errorHandler=FD(t),s}(e.storage,e._location,CD());return e.storage.makeRequestWithTokens(t,XD).then(e=>{if(null===e)throw new zP(OP.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return e})}function sx(e){e._throwIfRoot("deleteObject");var t=function(e,t){var n=aD(t.fullServerUrl(),e.host,e._protocol),r=e.maxOperationRetryTime;const i=new PD(n,"DELETE",function(e,t){},r);return i.successCodes=[200,204],i.errorHandler=FD(t),i}(e.storage,e._location);return e.storage.makeRequestWithTokens(t,XD)}function ax(e,t){var n,r=(n=e._location.path,r=t.split("/").filter(e=>0<e.length).join("/"),0===n.length?r:n+"/"+r),r=new eD(e._location.bucket,r);return new ex(e.storage,r)}function ox(e,t){if(e instanceof ux){var n=e;if(null==n._bucket)throw new zP(OP.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+jP+"' property when initializing the app?");n=new ex(n,n._bucket);return null!=t?ox(n,t):n}return void 0!==t?ax(e,t):e}function cx(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof ux)return n=e,r=t,new ex(n,r);throw QP("To use ref(service, url), the first argument must be a Storage instance.")}return ox(e,t);var n,r}function lx(e,t){var n=null==t?void 0:t[jP];return null==n?null:eD.makeFromBucketSpec(n,e)}class ux{constructor(e,t,n,r,i){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=i,this._bucket=null,this._host=BP,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?eD.makeFromBucketSpec(r,this._host):lx(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=eD.makeFromBucketSpec(this._url,e):this._bucket=lx(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){sD("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){sD("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){var t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new ex(this,e)}_makeRequest(e,t,n,r,i=!0){if(this._deleted)return new tD(YP());{const u=([s,a,o,e,n,r,t=!0]=[e,this._appId,n,r,t,this._firebaseVersion,i],c=oD(s.urlParams),l=s.url+c,c=Object.assign({},s.headers),i=c,(a=a)&&(i["X-Firebase-GMPID"]=a),a=c,null!==(o=o)&&0<o.length&&(a.Authorization="Firebase "+o),r=r,c["X-Firebase-Storage-Version"]="webjs/"+(null!=r?r:"AppManager"),r=c,null!==(e=e)&&(r["X-Firebase-AppCheck"]=e),new lD(l,s.method,c,s.body,s.successCodes,s.additionalRetryCodes,s.handler,s.errorHandler,s.timeout,s.progressCallback,n,t));return this._requests.add(u),u.getPromise().then(()=>this._requests.delete(u),()=>this._requests.delete(u)),u}var s,a,o,c,l}async makeRequestWithTokens(e,t){var[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}const hx="@firebase/storage";function dx(e,t,n){return e=oe(e),t=t,n=n,(e=e)._throwIfRoot("uploadBytesResumable"),new ZD(e,new yD(t),n)}function px(e){return function(e){e._throwIfRoot("getMetadata");var t=UD(e.storage,e._location,CD());return e.storage.makeRequestWithTokens(t,XD)}(e=oe(e))}function fx(e,t){return cx(e=oe(e),t)}function gx(e,t,n,r={}){!function(e,t,n,r={}){e.host=`${t}:${n}`,e._protocol="http";var i=r["mockUserToken"];i&&(e._overrideAuthToken="string"==typeof i?i:w(i,e.app.options.projectId))}(e,t,n,r)}function mx(e,{instanceIdentifier:t}){var n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return new ux(n,r,i,t,Je)}Ge(new ce("storage",mx,"PUBLIC").setMultipleInstances(!0)),tt(hx,"0.12.0",""),tt(hx,"0.12.0","esm2017");class vx{constructor(e,t,n){this._delegate=e,this.task=t,this.ref=n}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}}class _x{constructor(e,t){this._delegate=e,this._ref=t,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new vx(this._delegate.snapshot,this,this._ref)}then(t,e){return this._delegate.then(e=>{if(t)return t(new vx(e,this,this._ref))},e)}on(e,t,n,r){let i=void 0;return t&&(i="function"==typeof t?e=>t(new vx(e,this,this._ref)):{next:t.next?e=>t.next(new vx(e,this,this._ref)):void 0,complete:t.complete||void 0,error:t.error||void 0}),this._delegate.on(e,i,n||void 0,r||void 0)}}class yx{constructor(e,t){this._delegate=e,this._service=t}get prefixes(){return this._delegate.prefixes.map(e=>new wx(e,this._service))}get items(){return this._delegate.items.map(e=>new wx(e,this._service))}get nextPageToken(){return this._delegate.nextPageToken||null}}class wx{constructor(e,t){this._delegate=e,this.storage=t}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(e){var t=ax(this._delegate,e);return new wx(t,this.storage)}get root(){return new wx(this._delegate.root,this.storage)}get parent(){var e=this._delegate.parent;return null==e?null:new wx(e,this.storage)}put(e,t){return this._throwIfRoot("put"),new _x(dx(this._delegate,e,t),this)}putString(e,t=pD.RAW,n){this._throwIfRoot("putString");var r=gD(t,e);const i=Object.assign({},n);return null==i.contentType&&null!=r.contentType&&(i.contentType=r.contentType),new _x(new ZD(this._delegate,new yD(r.data,!0),i),this)}listAll(){return tx(oe(this._delegate)).then(e=>new yx(e,this.storage))}list(e){return t=this._delegate,e=e||void 0,nx(t=oe(t),e).then(e=>new yx(e,this.storage));var t}getMetadata(){return px(this._delegate)}updateMetadata(e){return rx(oe(this._delegate),e)}getDownloadURL(){return ix(oe(this._delegate))}delete(){return this._throwIfRoot("delete"),sx(oe(this._delegate))}_throwIfRoot(e){if(""===this._delegate._location.path)throw JP(e)}}class bx{constructor(e,t){this.app=e,this._delegate=t}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(e){if(Ix(e))throw QP("ref() expected a child path but got a URL, use refFromURL instead.");return new wx(fx(this._delegate,e),this)}refFromURL(e){if(!Ix(e))throw QP("refFromURL() expected a full URL but got a child path, use ref() instead.");try{eD.makeFromUrl(e,this._delegate.host)}catch(e){throw QP("refFromUrl() expected a valid full URL but got an invalid one.")}return new wx(fx(this._delegate,e),this)}setMaxUploadRetryTime(e){this._delegate.maxUploadRetryTime=e}setMaxOperationRetryTime(e){this._delegate.maxOperationRetryTime=e}useEmulator(e,t,n={}){gx(this._delegate,e,t,n)}}function Ix(e){return/^[A-Za-z]+:\/\//.test(e)}function Tx(e,{instanceIdentifier:t}){var n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("storage").getImmediate({identifier:t});return new bx(n,r)}LP=bt,FP={TaskState:GD,TaskEvent:WD,StringFormat:pD,Storage:bx,Reference:wx},LP.INTERNAL.registerComponent(new ce("storage-compat",Tx,"PUBLIC").setServiceProps(FP).setMultipleInstances(!0)),LP.registerVersion("@firebase/storage-compat","0.3.3");const Ex="@firebase/performance",Cx="0.6.4",Sx=Cx,kx="FB-PERF-TRACE-MEASURE",Ax="@firebase/performance/config",Nx="@firebase/performance/configexpire";var Rx,Px,Dx,xx="Performance";const Ox=new D("performance",xx,{"trace started":"Trace {$traceName} was started before.","trace stopped":"Trace {$traceName} is not running.","nonpositive trace startTime":"Trace {$traceName} startTime should be positive.","nonpositive trace duration":"Trace {$traceName} duration should be positive.","no window":"Window is not available.","no app id":"App id is not available.","no project id":"Project id is not available.","no api key":"Api key is not available.","invalid cc log":"Attempted to queue invalid cc event","FB not default":"Performance can only start when Firebase app instance is the default one.","RC response not ok":"RC response is not ok","invalid attribute name":"Attribute name {$attributeName} is invalid.","invalid attribute value":"Attribute value {$attributeValue} is invalid.","invalid custom metric name":"Custom metric name {$customMetricName} is invalid","invalid String merger input":"Input for String merger is invalid, contact support team to resolve.","already initialized":"initializePerformance() has already been called with different options. To avoid this error, call initializePerformance() with the same options as when it was originally called, or call getPerformance() to return the already initialized instance."}),Mx=new ve(xx);Mx.logLevel=m.INFO;let Lx,Fx;class Ux{constructor(e){if(!(this.window=e))throw Ox.create("no window");this.performance=e.performance,this.PerformanceObserver=e.PerformanceObserver,this.windowLocation=e.location,this.navigator=e.navigator,this.document=e.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=e.localStorage),e.perfMetrics&&e.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=e.perfMetrics.onFirstInputDelay)}getUrl(){return this.windowLocation.href.split("?")[0]}mark(e){this.performance&&this.performance.mark&&this.performance.mark(e)}measure(e,t,n){this.performance&&this.performance.measure&&this.performance.measure(e,t,n)}getEntriesByType(e){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(e):[]}getEntriesByName(e){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(e):[]}getTimeOrigin(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)}requiredApisAvailable(){return fetch&&Promise&&R()?!!A()||(Mx.info("IndexedDB is not supported by current browser"),!1):(Mx.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1)}setupObserver(e,n){if(this.PerformanceObserver){const t=new this.PerformanceObserver(e=>{for(const t of e.getEntries())n(t)});t.observe({entryTypes:[e]})}}static getInstance(){return void 0===Lx&&(Lx=new Ux(Fx)),Lx}}let Vx;function qx(e,t){var n=e.length-t.length;if(n<0||1<n)throw Ox.create("invalid String merger input");const r=[];for(let i=0;i<e.length;i++)r.push(e.charAt(i)),t.length>i&&r.push(t.charAt(i));return r.join("")}let Bx;class jx{constructor(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=qx("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=qx("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}getFlTransportFullUrl(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)}static getInstance(){return void 0===Bx&&(Bx=new jx),Bx}}(Tt=Rx=Rx||{})[Tt.UNKNOWN=0]="UNKNOWN",Tt[Tt.VISIBLE=1]="VISIBLE",Tt[Tt.HIDDEN=2]="HIDDEN";const zx=["firebase_","google_","ga_"],$x=new RegExp("^[a-zA-Z]\\w*$");function Kx(){switch(Ux.getInstance().document.visibilityState){case"visible":return Rx.VISIBLE;case"hidden":return Rx.HIDDEN;default:return Rx.UNKNOWN}}function Wx(e){var t=null===(t=e.options)||void 0===t?void 0:t.appId;if(!t)throw Ox.create("no app id");return t}const Gx="0.0.1",Hx={loggingEnabled:!0},Qx="FIREBASE_INSTALLATIONS_AUTH";function Yx(e,t){var r,i,n=function(){const e=Ux.getInstance().localStorage;if(e){var t=e.getItem(Nx);if(t&&function(e){return Number(e)>Date.now()}(t)){t=e.getItem(Ax);if(t)try{return JSON.parse(t)}catch(e){return}}}}();return n?(Xx(n),Promise.resolve()):(i=t,function(e){const t=e.getToken();return t.then(e=>{}),t}((r=e).installations).then(e=>{var t=function(e){var t=null===(t=e.options)||void 0===t?void 0:t.projectId;if(!t)throw Ox.create("no project id");return t}(r.app),n=function(e){var t=null===(t=e.options)||void 0===t?void 0:t.apiKey;if(!t)throw Ox.create("no api key");return t}(r.app),n=new Request(`https://firebaseremoteconfig.googleapis.com/v1/projects/${t}/namespaces/fireperf:fetch?key=${n}`,{method:"POST",headers:{Authorization:`${Qx} ${e}`},body:JSON.stringify({app_instance_id:i,app_instance_id_token:e,app_id:Wx(r.app),app_version:Sx,sdk_version:Gx})});return fetch(n).then(e=>{if(e.ok)return e.json();throw Ox.create("RC response not ok")})}).catch(()=>{Mx.info(Jx)}).then(Xx).then(e=>function(e){const t=Ux.getInstance().localStorage;e&&t&&(t.setItem(Ax,JSON.stringify(e)),t.setItem(Nx,String(Date.now()+60*jx.getInstance().configTimeToLive*60*1e3)))}(e),()=>{}))}const Jx="Could not fetch config, will use default configs";function Xx(e){if(!e)return e;const t=jx.getInstance();var n=e.entries||{};return void 0!==n.fpr_enabled?t.loggingEnabled="true"===String(n.fpr_enabled):t.loggingEnabled=Hx.loggingEnabled,n.fpr_log_source?t.logSource=Number(n.fpr_log_source):Hx.logSource&&(t.logSource=Hx.logSource),n.fpr_log_endpoint_url?t.logEndPointUrl=n.fpr_log_endpoint_url:Hx.logEndPointUrl&&(t.logEndPointUrl=Hx.logEndPointUrl),n.fpr_log_transport_key?t.transportKey=n.fpr_log_transport_key:Hx.transportKey&&(t.transportKey=Hx.transportKey),void 0!==n.fpr_vc_network_request_sampling_rate?t.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate):void 0!==Hx.networkRequestsSamplingRate&&(t.networkRequestsSamplingRate=Hx.networkRequestsSamplingRate),void 0!==n.fpr_vc_trace_sampling_rate?t.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate):void 0!==Hx.tracesSamplingRate&&(t.tracesSamplingRate=Hx.tracesSamplingRate),t.logTraceAfterSampling=Zx(t.tracesSamplingRate),t.logNetworkAfterSampling=Zx(t.networkRequestsSamplingRate),e}function Zx(e){return Math.random()<=e}let e1=1,t1;function n1(e){var t;return e1=2,t1=t1||(t=e,function(){const n=Ux.getInstance().document;return new Promise(e=>{if(n&&"complete"!==n.readyState){const t=()=>{"complete"===n.readyState&&(n.removeEventListener("readystatechange",t),e())};n.addEventListener("readystatechange",t)}else e()})}().then(()=>function(e){const t=e.getId();return t.then(e=>{Vx=e}),t}(t.installations)).then(e=>Yx(t,e)).then(()=>r1(),()=>r1())),t1}function r1(){e1=3}const i1=1e4,s1=3,a1=1e3;let o1=s1,c1=[],l1=!1;function u1(e){setTimeout(()=>{if(0!==o1)return c1.length?void function(){const e=c1.splice(0,a1),t=e.map(e=>({source_extension_json_proto3:e.message,event_time_ms:String(e.eventTime)})),n={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:jx.getInstance().logSource,log_event:t};!function(e,r){return function(e){var t=jx.getInstance().getFlTransportFullUrl();return fetch(t,{method:"POST",body:JSON.stringify(e)})}(e).then(e=>(e.ok||Mx.info("Call to Firebase backend failed."),e.json())).then(e=>{var t=Number(e.nextRequestWaitMillis);let n=i1;isNaN(t)||(n=Math.max(t,n));t=e.logResponseDetails;Array.isArray(t)&&0<t.length&&"RETRY_REQUEST_LATER"===t[0].responseAction&&(c1=[...r,...c1],Mx.info("Retry transport request later.")),o1=s1,u1(n)})}(n,e).catch(()=>{c1=[...e,...c1],o1--,Mx.info(`Tries left: ${o1}.`),u1(i1)})}():u1(i1)},e)}function h1(t){return(...e)=>{!function(e){if(!e.eventTime||!e.message)throw Ox.create("invalid cc log");c1=[...c1,e]}({message:t(...e),eventTime:Date.now()})}}let d1;function p1(e,t){d1=d1||h1(m1),d1(e,t)}function f1(e){var t=jx.getInstance();!t.instrumentationEnabled&&e.isAuto||(t.dataCollectionEnabled||e.isAuto)&&Ux.getInstance().requiredApisAvailable()&&(e.isAuto&&Kx()!==Rx.VISIBLE||(3===e1?g1(e):n1(e.performanceController).then(()=>g1(e),()=>g1(e))))}function g1(e){var t;!Vx||(t=jx.getInstance()).loggingEnabled&&t.logTraceAfterSampling&&setTimeout(()=>p1(e,1),0)}function m1(e,t){return 0===t?(n={url:e.url,http_method:e.httpMethod||0,http_response_code:200,response_payload_bytes:e.responsePayloadBytes,client_start_time_us:e.startTimeUs,time_to_response_initiated_us:e.timeToResponseInitiatedUs,time_to_response_completed_us:e.timeToResponseCompletedUs},n={application_info:v1(e.performanceController.app),network_request_metric:n},JSON.stringify(n)):function(e){const t={name:e.name,is_auto:e.isAuto,client_start_time_us:e.startTimeUs,duration_us:e.durationUs};0!==Object.keys(e.counters).length&&(t.counters=e.counters);var n=e.getAttributes();0!==Object.keys(n).length&&(t.custom_attributes=n);n={application_info:v1(e.performanceController.app),trace_metric:t};return JSON.stringify(n)}(e);var n}function v1(e){return{google_app_id:Wx(e),app_instance_id:Vx,web_app_info:{sdk_version:Sx,page_url:Ux.getInstance().getUrl(),service_worker_status:null!=(t=Ux.getInstance().navigator)&&t.serviceWorker?t.serviceWorker.controller?2:3:1,visibility_state:Kx(),effective_connection_type:function(){var e=Ux.getInstance().navigator.connection;switch(e&&e.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}()},application_process_state:0};var t}const _1=["_fp","_fcp","_fid"];class y1{constructor(e,t,n=!1,r){this.performanceController=e,this.name=t,this.isAuto=n,this.state=1,this.customAttributes={},this.counters={},this.api=Ux.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark=`FB-PERF-TRACE-START-${this.randomId}-${this.name}`,this.traceStopMark=`FB-PERF-TRACE-STOP-${this.randomId}-${this.name}`,this.traceMeasure=r||`${kx}-${this.randomId}-${this.name}`,r&&this.calculateTraceMetrics())}start(){if(1!==this.state)throw Ox.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2}stop(){if(2!==this.state)throw Ox.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),f1(this)}record(e,t,n){if(e<=0)throw Ox.create("nonpositive trace startTime",{traceName:this.name});if(t<=0)throw Ox.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(1e3*t),this.startTimeUs=Math.floor(1e3*e),n&&n.attributes&&(this.customAttributes=Object.assign({},n.attributes)),n&&n.metrics)for(const r of Object.keys(n.metrics))isNaN(Number(n.metrics[r]))||(this.counters[r]=Math.floor(Number(n.metrics[r])));f1(this)}incrementMetric(e,t=1){void 0===this.counters[e]?this.putMetric(e,t):this.putMetric(e,this.counters[e]+t)}putMetric(e,t){if(r=e,i=this.name,0===r.length||100<r.length||!(i&&i.startsWith("_wt_")&&-1<_1.indexOf(r))&&r.startsWith("_"))throw Ox.create("invalid custom metric name",{customMetricName:e});var n,r,i;this.counters[e]=(t=null!=t?t:0,(n=Math.floor(t))<t&&Mx.info(`Metric value should be an Integer, setting the value as : ${n}.`),n)}getMetric(e){return this.counters[e]||0}putAttribute(e,t){var n,r,i=!(0===(n=e).length||40<n.length)&&(!zx.some(e=>n.startsWith(e))&&!!n.match($x)),s=0!==(r=t).length&&r.length<=100;if(i&&s)this.customAttributes[e]=t;else{if(!i)throw Ox.create("invalid attribute name",{attributeName:e});if(!s)throw Ox.create("invalid attribute value",{attributeValue:t})}}getAttribute(e){return this.customAttributes[e]}removeAttribute(e){void 0!==this.customAttributes[e]&&delete this.customAttributes[e]}getAttributes(){return Object.assign({},this.customAttributes)}setStartTime(e){this.startTimeUs=e}setDuration(e){this.durationUs=e}calculateTraceMetrics(){var e=this.api.getEntriesByName(this.traceMeasure),e=e&&e[0];e&&(this.durationUs=Math.floor(1e3*e.duration),this.startTimeUs=Math.floor(1e3*(e.startTime+this.api.getTimeOrigin())))}static createOobTrace(e,t,n,r){var i=Ux.getInstance().getUrl();if(i){const s=new y1(e,"_wt_"+i,!0);i=Math.floor(1e3*Ux.getInstance().getTimeOrigin());s.setStartTime(i),t&&t[0]&&(s.setDuration(Math.floor(1e3*t[0].duration)),s.putMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),s.putMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),s.putMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd)));n&&((i=n.find(e=>"first-paint"===e.name))&&i.startTime&&s.putMetric("_fp",Math.floor(1e3*i.startTime)),(i=n.find(e=>"first-contentful-paint"===e.name))&&i.startTime&&s.putMetric("_fcp",Math.floor(1e3*i.startTime)),r&&s.putMetric("_fid",Math.floor(1e3*r))),f1(s)}}static createUserTimingTrace(e,t){f1(new y1(e,t,!1,t))}}function w1(e,t){const n=t;var r,i,s;n&&void 0!==n.responseStart&&(s=Ux.getInstance().getTimeOrigin(),r=Math.floor(1e3*(n.startTime+s)),i=n.responseStart?Math.floor(1e3*(n.responseStart-n.startTime)):void 0,s=Math.floor(1e3*(n.responseEnd-n.startTime)),function(e){const t=jx.getInstance();var n,r,i;t.instrumentationEnabled&&(n=e.url,r=t.logEndPointUrl.split("?")[0],i=t.flTransportEndpointUrl.split("?")[0],n!==r&&n!==i&&t.loggingEnabled&&t.logNetworkAfterSampling&&setTimeout(()=>p1(e,0),0))}({performanceController:e,url:n.name&&n.name.split("?")[0],responsePayloadBytes:n.transferSize,startTimeUs:r,timeToResponseInitiatedUs:i,timeToResponseCompletedUs:s}))}const b1=5e3;function I1(e){Vx&&(setTimeout(()=>function(n){const e=Ux.getInstance(),r=e.getEntriesByType("navigation"),i=e.getEntriesByType("paint");if(e.onFirstInputDelay){let t=setTimeout(()=>{y1.createOobTrace(n,r,i),t=void 0},b1);e.onFirstInputDelay(e=>{t&&(clearTimeout(t),y1.createOobTrace(n,r,i,e))})}else y1.createOobTrace(n,r,i)}(e),0),setTimeout(()=>function(t){const e=Ux.getInstance(),n=e.getEntriesByType("resource");for(const r of n)w1(t,r);e.setupObserver("resource",e=>w1(t,e))}(e),0),setTimeout(()=>function(t){const e=Ux.getInstance(),n=e.getEntriesByType("measure");for(const r of n)T1(t,r);e.setupObserver("measure",e=>T1(t,e))}(e),0))}function T1(e,t){const n=t.name;n.substring(0,kx.length)!==kx&&y1.createUserTimingTrace(e,n)}class E1{constructor(e,t){this.app=e,this.installations=t,this.initialized=!1}_init(e){this.initialized||(void 0!==(null==e?void 0:e.dataCollectionEnabled)&&(this.dataCollectionEnabled=e.dataCollectionEnabled),void 0!==(null==e?void 0:e.instrumentationEnabled)&&(this.instrumentationEnabled=e.instrumentationEnabled),Ux.getInstance().requiredApisAvailable()?N().then(e=>{e&&(l1||(u1(5500),l1=!0),n1(this).then(()=>I1(this),()=>I1(this)),this.initialized=!0)}).catch(e=>{Mx.info(`Environment doesn't support IndexedDB: ${e}`)}):Mx.info('Firebase Performance cannot start if the browser does not support "Fetch" and "Promise", or cookies are disabled.'))}set instrumentationEnabled(e){jx.getInstance().instrumentationEnabled=e}get instrumentationEnabled(){return jx.getInstance().instrumentationEnabled}set dataCollectionEnabled(e){jx.getInstance().dataCollectionEnabled=e}get dataCollectionEnabled(){return jx.getInstance().dataCollectionEnabled}}const C1="[DEFAULT]";const S1=(e,{options:t})=>{var n=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();if(n.name!==C1)throw Ox.create("FB not default");if("undefined"==typeof window)throw Ox.create("no window");e=window,Fx=e;const i=new E1(n,r);return i._init(t),i};Ge(new ce("performance",S1,"PUBLIC")),tt(Ex,Cx),tt(Ex,Cx,"esm2017");class k1{constructor(e,t){this.app=e,this._delegate=t}get instrumentationEnabled(){return this._delegate.instrumentationEnabled}set instrumentationEnabled(e){this._delegate.instrumentationEnabled=e}get dataCollectionEnabled(){return this._delegate.dataCollectionEnabled}set dataCollectionEnabled(e){this._delegate.dataCollectionEnabled=e}trace(e){return t=this._delegate,e=e,t=oe(t),new y1(t,e);var t}}function A1(e){var t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("performance").getImmediate();return new k1(t,n)}(Px=bt).INTERNAL.registerComponent(new ce("performance-compat",A1,"PUBLIC")),Px.registerVersion("@firebase/performance-compat","0.2.4");const N1="@firebase/remote-config";class R1{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}const P1=new D("remoteconfig","Remote Config",{"registration-window":"Undefined window object. This SDK only supports usage in a browser environment.","registration-project-id":"Undefined project identifier. Check Firebase app initialization.","registration-api-key":"Undefined API key. Check Firebase app initialization.","registration-app-id":"Undefined app identifier. Check Firebase app initialization.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}.","fetch-client-network":"Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-timeout":'The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',"fetch-throttle":'The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',"fetch-client-parse":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","indexed-db-unavailable":"Indexed DB is not supported by current browser"});const D1=["1","true","t","yes","y","on"];class x1{constructor(e,t=""){this._source=e,this._value=t}asString(){return this._value}asBoolean(){return"static"!==this._source&&0<=D1.indexOf(this._value.toLowerCase())}asNumber(){if("static"===this._source)return 0;let e=Number(this._value);return isNaN(e)&&(e=0),e}getSource(){return this._source}}async function O1(e){const t=oe(e);var[n,r]=await Promise.all([t._storage.getLastSuccessfulFetchResponse(),t._storage.getActiveConfigEtag()]);return!!(n&&n.config&&n.eTag&&n.eTag!==r)&&(await Promise.all([t._storageCache.setActiveConfig(n.config),t._storage.setActiveConfigEtag(n.eTag)]),!0)}function M1(e){const t=oe(e);return t._initializePromise||(t._initializePromise=t._storageCache.loadFromStorage().then(()=>{t._isInitializationComplete=!0})),t._initializePromise}async function L1(t){const n=oe(t),e=new R1;setTimeout(async()=>{e.abort()},n.settings.fetchTimeoutMillis);try{await n._client.fetch({cacheMaxAgeMillis:n.settings.minimumFetchIntervalMillis,signal:e}),await n._storageCache.setLastFetchStatus("success")}catch(e){var r=(i="fetch-throttle",(t=e)instanceof P&&-1!==t.code.indexOf(i)?"throttle":"failure");throw await n._storageCache.setLastFetchStatus(r),e}var i}function F1(n){const e=oe(n);return[t={},r={}]=[e._storageCache.getActiveConfig(),e.defaultConfig],Object.keys(Object.assign(Object.assign({},t),r)).reduce((e,t)=>(e[t]=U1(n,t),e),{});var t,r}function U1(e,t){const n=oe(e);n._isInitializationComplete||n._logger.debug(`A value was requested for key "${t}" before SDK initialization completed.`+" Await on ensureInitialized if the intent was to get a previously activated value.");var r=n._storageCache.getActiveConfig();return r&&void 0!==r[t]?new x1("remote",r[t]):n.defaultConfig&&void 0!==n.defaultConfig[t]?new x1("default",String(n.defaultConfig[t])):(n._logger.debug(`Returning static value for key "${t}".`+" Define a default or remote value if this is unintentional."),new x1("static"))}class V1{constructor(e,t,n,r){this.client=e,this.storage=t,this.storageCache=n,this.logger=r}isCachedDataFresh(e,t){if(!t)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;var n=Date.now()-t,r=n<=e;return this.logger.debug("Config fetch cache check."+` Cache age millis: ${n}.`+` Cache max age millis (minimumFetchIntervalMillis setting): ${e}.`+` Is cache hit: ${r}.`),r}async fetch(e){var[t,n]=await Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()]);if(n&&this.isCachedDataFresh(e.cacheMaxAgeMillis,t))return n;e.eTag=n&&n.eTag;n=await this.client.fetch(e);const r=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())];return 200===n.status&&r.push(this.storage.setLastSuccessfulFetchResponse(n)),await Promise.all(r),n}}class q1{constructor(e,t,n,r,i,s){this.firebaseInstallations=e,this.sdkVersion=t,this.namespace=n,this.projectId=r,this.apiKey=i,this.appId=s}async fetch(n){var e,[t,r]=await Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()]),i=`${window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com"}/v1/projects/${this.projectId}/namespaces/${this.namespace}:fetch?key=${this.apiKey}`,s={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":n.eTag||"*"},r={sdk_version:this.sdkVersion,app_instance_id:t,app_instance_id_token:r,app_id:this.appId,language_code:(e=navigator).languages&&e.languages[0]||e.language},r={method:"POST",headers:s,body:JSON.stringify(r)},i=fetch(i,r),r=new Promise((e,t)=>{n.signal.addEventListener(()=>{const e=new Error("The operation was aborted.");e.name="AbortError",t(e)})});let a;try{await Promise.race([i,r]),a=await i}catch(e){let t="fetch-client-network";throw"AbortError"===(null==e?void 0:e.name)&&(t="fetch-timeout"),P1.create(t,{originalErrorMessage:null==e?void 0:e.message})}let o=a.status;i=a.headers.get("ETag")||void 0;let c,l;if(200===a.status){let e;try{e=await a.json()}catch(e){throw P1.create("fetch-client-parse",{originalErrorMessage:null==e?void 0:e.message})}c=e.entries,l=e.state}if("INSTANCE_STATE_UNSPECIFIED"===l?o=500:"NO_CHANGE"===l?o=304:"NO_TEMPLATE"!==l&&"EMPTY_CONFIG"!==l||(c={}),304!==o&&200!==o)throw P1.create("fetch-status",{httpStatus:o});return{status:o,eTag:i,config:c}}}class B1{constructor(e,t){this.client=e,this.storage=t}async fetch(e){var t=await this.storage.getThrottleMetadata()||{backoffCount:0,throttleEndTimeMillis:Date.now()};return this.attemptFetch(e,t)}async attemptFetch(t,{throttleEndTimeMillis:e,backoffCount:n}){var i,s;i=t.signal,s=e,await new Promise((e,t)=>{var n=Math.max(s-Date.now(),0);const r=setTimeout(e,n);i.addEventListener(()=>{clearTimeout(r),t(P1.create("fetch-throttle",{throttleEndTimeMillis:s}))})});try{var r=await this.client.fetch(t);return await this.storage.deleteThrottleMetadata(),r}catch(e){if(!function(e){if(e instanceof P&&e.customData){var t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}}(e))throw e;r={throttleEndTimeMillis:Date.now()+ae(n),backoffCount:n+1};return await this.storage.setThrottleMetadata(r),this.attemptFetch(t,r)}}}class j1{constructor(e,t,n,r,i){this.app=e,this._client=t,this._storageCache=n,this._storage=r,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:6e4,minimumFetchIntervalMillis:432e5},this.defaultConfig={}}get fetchTimeMillis(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1}get lastFetchStatus(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"}}function z1(e,t){var n=e.target.error||void 0;return P1.create(t,{originalErrorMessage:n&&(null==n?void 0:n.message)})}const $1="app_namespace_store";class K1{constructor(e,t,n,r=function(){return new Promise((t,n)=>{try{const e=indexedDB.open("firebase_remote_config",1);e.onerror=e=>{n(z1(e,"storage-open"))},e.onsuccess=e=>{t(e.target.result)},e.onupgradeneeded=e=>{const t=e.target.result;0===e.oldVersion&&t.createObjectStore($1,{keyPath:"compositeKey"})}}catch(e){n(P1.create("storage-open",{originalErrorMessage:null==e?void 0:e.message}))}})}()){this.appId=e,this.appName=t,this.namespace=n,this.openDbPromise=r}getLastFetchStatus(){return this.get("last_fetch_status")}setLastFetchStatus(e){return this.set("last_fetch_status",e)}getLastSuccessfulFetchTimestampMillis(){return this.get("last_successful_fetch_timestamp_millis")}setLastSuccessfulFetchTimestampMillis(e){return this.set("last_successful_fetch_timestamp_millis",e)}getLastSuccessfulFetchResponse(){return this.get("last_successful_fetch_response")}setLastSuccessfulFetchResponse(e){return this.set("last_successful_fetch_response",e)}getActiveConfig(){return this.get("active_config")}setActiveConfig(e){return this.set("active_config",e)}getActiveConfigEtag(){return this.get("active_config_etag")}setActiveConfigEtag(e){return this.set("active_config_etag",e)}getThrottleMetadata(){return this.get("throttle_metadata")}setThrottleMetadata(e){return this.set("throttle_metadata",e)}deleteThrottleMetadata(){return this.delete("throttle_metadata")}async get(a){const o=await this.openDbPromise;return new Promise((n,t)=>{const e=o.transaction([$1],"readonly"),r=e.objectStore($1);var i=this.createCompositeKey(a);try{const s=r.get(i);s.onerror=e=>{t(z1(e,"storage-get"))},s.onsuccess=e=>{var t=e.target.result;n(t?t.value:void 0)}}catch(e){t(P1.create("storage-get",{originalErrorMessage:null==e?void 0:e.message}))}})}async set(a,o){const c=await this.openDbPromise;return new Promise((e,t)=>{const n=c.transaction([$1],"readwrite"),r=n.objectStore($1);var i=this.createCompositeKey(a);try{const s=r.put({compositeKey:i,value:o});s.onerror=e=>{t(z1(e,"storage-set"))},s.onsuccess=()=>{e()}}catch(e){t(P1.create("storage-set",{originalErrorMessage:null==e?void 0:e.message}))}})}async delete(a){const o=await this.openDbPromise;return new Promise((e,t)=>{const n=o.transaction([$1],"readwrite"),r=n.objectStore($1);var i=this.createCompositeKey(a);try{const s=r.delete(i);s.onerror=e=>{t(z1(e,"storage-delete"))},s.onsuccess=()=>{e()}}catch(e){t(P1.create("storage-delete",{originalErrorMessage:null==e?void 0:e.message}))}})}createCompositeKey(e){return[this.appId,this.appName,this.namespace,e].join()}}class W1{constructor(e){this.storage=e}getLastFetchStatus(){return this.lastFetchStatus}getLastSuccessfulFetchTimestampMillis(){return this.lastSuccessfulFetchTimestampMillis}getActiveConfig(){return this.activeConfig}async loadFromStorage(){var e=this.storage.getLastFetchStatus(),t=this.storage.getLastSuccessfulFetchTimestampMillis(),n=this.storage.getActiveConfig(),e=await e;e&&(this.lastFetchStatus=e);t=await t;t&&(this.lastSuccessfulFetchTimestampMillis=t);n=await n;n&&(this.activeConfig=n)}setLastFetchStatus(e){return this.lastFetchStatus=e,this.storage.setLastFetchStatus(e)}setLastSuccessfulFetchTimestampMillis(e){return this.lastSuccessfulFetchTimestampMillis=e,this.storage.setLastSuccessfulFetchTimestampMillis(e)}setActiveConfig(e){return this.activeConfig=e,this.storage.setActiveConfig(e)}}async function G1(){if(!A())return!1;try{return await N()}catch(e){return!1}}Ge(new ce("remote-config",function(e,{instanceIdentifier:t}){var n=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();if("undefined"==typeof window)throw P1.create("registration-window");if(!A())throw P1.create("indexed-db-unavailable");var{projectId:i,apiKey:s,appId:a}=n.options;if(!i)throw P1.create("registration-project-id");if(!s)throw P1.create("registration-api-key");if(!a)throw P1.create("registration-app-id");t=t||"firebase";const o=new K1(a,n.name,t),c=new W1(o),l=new ve(N1);l.logLevel=m.ERROR;a=new q1(r,Je,t,i,s,a),a=new B1(a,o),a=new V1(a,o,c,l),a=new j1(n,a,c,o,l);return M1(a),a},"PUBLIC").setMultipleInstances(!0)),tt(N1,"0.4.4"),tt(N1,"0.4.4","esm2017");class H1{constructor(e,t){this.app=e,this._delegate=t}get defaultConfig(){return this._delegate.defaultConfig}set defaultConfig(e){this._delegate.defaultConfig=e}get fetchTimeMillis(){return this._delegate.fetchTimeMillis}get lastFetchStatus(){return this._delegate.lastFetchStatus}get settings(){return this._delegate.settings}set settings(e){this._delegate.settings=e}activate(){return O1(this._delegate)}ensureInitialized(){return M1(this._delegate)}fetch(){return L1(this._delegate)}fetchAndActivate(){return async function(e){return await L1(e=oe(e)),O1(e)}(this._delegate)}getAll(){return F1(this._delegate)}getBoolean(e){return U1(oe(this._delegate),e).asBoolean()}getNumber(e){return U1(oe(this._delegate),e).asNumber()}getString(e){return U1(oe(this._delegate),e).asString()}getValue(e){return U1(this._delegate,e)}setLogLevel(e){!function(e,t){const n=oe(e);switch(t){case"debug":n._logger.logLevel=m.DEBUG;break;case"silent":n._logger.logLevel=m.SILENT;break;default:n._logger.logLevel=m.ERROR}}(this._delegate,e)}}function Q1(e,{instanceIdentifier:t}){var n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("remote-config").getImmediate({identifier:t});return new H1(n,r)}return(Dx=bt).INTERNAL.registerComponent(new ce("remoteConfig-compat",Q1,"PUBLIC").setMultipleInstances(!0).setServiceProps({isSupported:G1})),Dx.registerVersion("@firebase/remote-config-compat","0.2.4"),console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the CDN builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nhttps://www.gstatic.com/firebasejs/5.0.0/firebase-<PACKAGE>.js\n"),bt.registerVersion("firebase","10.7.1","compat-cdn"),bt});
//# sourceMappingURL=firebase-compat.js.map
